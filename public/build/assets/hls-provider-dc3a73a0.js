import{j as e}from"./vendor-query-78cda8b8.js";import{r as t}from"./vendor-core-56622d1d.js";import{bs as r,bt as a,bu as i,bv as o,bw as s}from"./video-grid-45ae6b45.js";import{H as n}from"./vendor-video-4238b934.js";import"./main-07195345.js";import"./vendor-ui-7d465812.js";import"./vendor-form-c566d70e.js";import"./breadcrumb-0f8d48e1.js";import"./formatted-duration-8c5fa317.js";function u(){const u=t.useContext(r),d=a((e=>e.cuedMedia)),c=t.useRef(null),v=i(c),m=o(v),p=s(v),f=t.useRef(),[E,g]=t.useState(!1),y=t.useCallback((()=>{var e;f&&(null==(e=f.current)||e.destroy(),f.current=void 0,g(!1))}),[]),S=t.useCallback((()=>{if(!n.isSupported())return void u.getState().emit("error",{fatal:!0});const e=new n({startLevel:-1});e.on(n.Events.ERROR,((t,r)=>{if(r.fatal)switch(r.type){case n.ErrorTypes.NETWORK_ERROR:e.startLoad();break;case n.ErrorTypes.MEDIA_ERROR:e.recoverMediaError();break;default:y()}u.getState().emit("error",{sourceEvent:r,fatal:r.fatal})})),e.on(n.Events.MANIFEST_PARSED,(()=>{var t;(null==(t=e.levels)?void 0:t.length)&&(u.getState().emit("playbackQualities",{qualities:["auto",...e.levels.map(l)]}),u.getState().emit("playbackQualityChange",{quality:"auto"}))})),e.on(n.Events.AUDIO_TRACK_SWITCHED,((e,t)=>{const r=u.getState().audioTracks.find((e=>e.id===t.id));r&&u.getState().emit("currentAudioTrackChange",{trackId:r.id})})),e.on(n.Events.LEVEL_LOADED,((t,r)=>{var a;if(!u.getState().providerReady){const{type:t,live:i,totalduration:o}=r.details,s=i?"EVENT"===t&&Number.isFinite(o)?"live:dvr":"live":"on-demand";u.getState().emit("streamTypeChange",{streamType:(null==(a=u.getState().cuedMedia)?void 0:a.streamType)||s}),u.getState().emit("durationChange",{duration:o});const n=e.audioTracks.map((e=>({id:e.id,label:e.name,language:e.lang||"",kind:"main"})));u.getState().emit("audioTracks",{tracks:n})}})),e.attachMedia(c.current),f.current=e,g(!0)}),[y,u]);return t.useEffect((()=>(S(),()=>{y()})),[S,y]),t.useEffect((()=>{f.current&&(null==d?void 0:d.src)&&f.current.url!==(null==d?void 0:d.src)&&f.current.loadSource(d.src)}),[null==d?void 0:d.src,E]),t.useEffect((()=>{E&&u.setState({providerApi:{...p,setCurrentAudioTrack:e=>{f.current&&(f.current.audioTrack=e)},setPlaybackQuality:e=>{f.current&&(f.current.currentLevel=f.current.levels.findIndex((t=>l(t)===e)),u.getState().emit("playbackQualityChange",{quality:e}))}}})}),[p,u,E]),e.jsx("video",{className:"h-full w-full",ref:c,playsInline:!0,poster:null==d?void 0:d.poster,...m})}const l=e=>-1===e?"auto":`${e.height}p`;export{u as default};
