import{j as e}from"./vendor-query-78cda8b8.js";import{r as t}from"./vendor-core-56622d1d.js";import{bs as r,bt as a,bu as i,bv as o,bw as s}from"./video-grid-3e80e058.js";import{d as u}from"./vendor-video-4238b934.js";import"./main-a00ca822.js";import"./vendor-ui-7d465812.js";import"./vendor-form-c566d70e.js";import"./breadcrumb-50a88f63.js";import"./formatted-duration-8d56a4f7.js";function n(){const n=t.useContext(r),c=a((e=>e.cuedMedia)),d=t.useRef(null),f=i(d),m=o(f),v=s(f),p=t.useRef(),[y,b]=t.useState(!1),g=t.useCallback((()=>{p.current&&(p.current.destroy(),p.current=void 0,b(!1))}),[]),j=t.useCallback((()=>{if(!u.supportsMediaSource())return void n.getState().emit("error",{fatal:!0});const e=u.MediaPlayer().create();e.on(u.MediaPlayer.events.ERROR,(e=>{n.getState().emit("error",{sourceEvent:e})})),e.on(u.MediaPlayer.events.PLAYBACK_METADATA_LOADED,(()=>{const t=e.getBitrateInfoListFor("video");(null==t?void 0:t.length)&&(n.getState().emit("playbackQualities",{qualities:["auto",...t.map(l)]}),n.getState().emit("playbackQualityChange",{quality:"auto"}))})),e.initialize(d.current,void 0,!1),p.current=e,b(!0)}),[n]);return t.useEffect((()=>(j(),()=>{g()})),[j,g]),t.useEffect((()=>{p.current&&(null==c?void 0:c.src)&&p.current.attachSource(c.src)}),[null==c?void 0:c.src,y]),t.useEffect((()=>{y&&n.setState({providerApi:{...v,setPlaybackQuality:e=>{if(!p.current)return;const t=p.current.getBitrateInfoListFor("video").findIndex((t=>l(t)===e));p.current.updateSettings({streaming:{abr:{autoSwitchBitrate:{video:-1===t}}}}),t>=0&&p.current.setQualityFor("video",t),n.getState().emit("playbackQualityChange",{quality:e})}}})}),[n,v,y]),e.jsx("video",{className:"h-full w-full",ref:d,playsInline:!0,poster:null==c?void 0:c.poster,...m})}const l=e=>-1===e?"auto":`${e.height}p`;export{n as default};
