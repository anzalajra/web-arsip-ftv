function e(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var t,r,n,i,o,l={exports:{}};t=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,n=/(?:\/|^)\.(?=\/)/g,i=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g;var u=l.exports=o={buildAbsoluteURL:function(e,t,n){if(n=n||{},e=e.trim(),!(t=t.trim())){if(!n.alwaysNormalize)return e;var i=o.parseURL(e);if(!i)throw new Error("Error trying to parse base URL.");return i.path=o.normalizePath(i.path),o.buildURLFromParts(i)}var a=o.parseURL(t);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return n.alwaysNormalize?(a.path=o.normalizePath(a.path),o.buildURLFromParts(a)):t;var s=o.parseURL(e);if(!s)throw new Error("Error trying to parse base URL.");if(!s.netLoc&&s.path&&"/"!==s.path[0]){var l=r.exec(s.path);s.netLoc=l[1],s.path=l[2]}s.netLoc&&!s.path&&(s.path="/");var u={scheme:s.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(u.netLoc=s.netLoc,"/"!==a.path[0]))if(a.path){var c=s.path,f=c.substring(0,c.lastIndexOf("/")+1)+a.path;u.path=o.normalizePath(f)}else u.path=s.path,a.params||(u.params=s.params,a.query||(u.query=s.query));return null===u.path&&(u.path=n.alwaysNormalize?o.normalizePath(a.path):a.path),o.buildURLFromParts(u)},parseURL:function(e){var r=t.exec(e);return r?{scheme:r[1]||"",netLoc:r[2]||"",path:r[3]||"",params:r[4]||"",query:r[5]||"",fragment:r[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(n,"");e.length!==(e=e.replace(i,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){h(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function d(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function h(e,t,r){return(t=d(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function g(){return g=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},g.apply(this,arguments)}const m=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},p=Number.isSafeInteger||function(e){return"number"==typeof e&&Math.abs(e)<=y},y=Number.MAX_SAFE_INTEGER||9007199254740991;let E=function(e){return e.MEDIA_ATTACHING="hlsMediaAttaching",e.MEDIA_ATTACHED="hlsMediaAttached",e.MEDIA_DETACHING="hlsMediaDetaching",e.MEDIA_DETACHED="hlsMediaDetached",e.BUFFER_RESET="hlsBufferReset",e.BUFFER_CODECS="hlsBufferCodecs",e.BUFFER_CREATED="hlsBufferCreated",e.BUFFER_APPENDING="hlsBufferAppending",e.BUFFER_APPENDED="hlsBufferAppended",e.BUFFER_EOS="hlsBufferEos",e.BUFFER_FLUSHING="hlsBufferFlushing",e.BUFFER_FLUSHED="hlsBufferFlushed",e.MANIFEST_LOADING="hlsManifestLoading",e.MANIFEST_LOADED="hlsManifestLoaded",e.MANIFEST_PARSED="hlsManifestParsed",e.LEVEL_SWITCHING="hlsLevelSwitching",e.LEVEL_SWITCHED="hlsLevelSwitched",e.LEVEL_LOADING="hlsLevelLoading",e.LEVEL_LOADED="hlsLevelLoaded",e.LEVEL_UPDATED="hlsLevelUpdated",e.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",e.LEVELS_UPDATED="hlsLevelsUpdated",e.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",e.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",e.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",e.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",e.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",e.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",e.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",e.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",e.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",e.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",e.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",e.CUES_PARSED="hlsCuesParsed",e.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",e.INIT_PTS_FOUND="hlsInitPtsFound",e.FRAG_LOADING="hlsFragLoading",e.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",e.FRAG_LOADED="hlsFragLoaded",e.FRAG_DECRYPTED="hlsFragDecrypted",e.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",e.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",e.FRAG_PARSING_METADATA="hlsFragParsingMetadata",e.FRAG_PARSED="hlsFragParsed",e.FRAG_BUFFERED="hlsFragBuffered",e.FRAG_CHANGED="hlsFragChanged",e.FPS_DROP="hlsFpsDrop",e.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",e.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",e.ERROR="hlsError",e.DESTROYING="hlsDestroying",e.KEY_LOADING="hlsKeyLoading",e.KEY_LOADED="hlsKeyLoaded",e.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",e.BACK_BUFFER_REACHED="hlsBackBufferReached",e.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",e}({}),v=function(e){return e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError",e}({}),T=function(e){return e.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",e.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",e.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",e.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_EMPTY_ERROR="levelEmptyError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_PARSING_ERROR="levelParsingError",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",e.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.FRAG_GAP="fragGap",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.INTERNAL_EXCEPTION="internalException",e.INTERNAL_ABORTED="aborted",e.UNKNOWN="unknown",e}({});const _=function(){},S={trace:_,debug:_,log:_,warn:_,info:_,error:_};let A=S;function b(e,...t){t.forEach((function(t){A[t]=e[t]?e[t].bind(e):function(e){const t=self.console[e];return t?t.bind(self.console,`[${e}] >`):_}(t)}))}const R=A,I=/^(\d+)x(\d+)$/,w=/(.+?)=(".*?"|.*?)(?:,|$)/g;class C{constructor(e){"string"==typeof e&&(e=C.parseAttrList(e)),g(this,e)}get clientAttrs(){return Object.keys(this).filter((e=>"X-"===e.substring(0,2)))}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;const r=new Uint8Array(t.length/2);for(let e=0;e<t.length/2;e++)r[e]=parseInt(t.slice(2*e,2*e+2),16);return r}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const r=this[e];return r?parseFloat(r):t}enumeratedString(e){return this[e]}bool(e){return"YES"===this[e]}decimalResolution(e){const t=I.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e){let t;const r={};for(w.lastIndex=0;null!==(t=w.exec(e));){let e=t[2];0===e.indexOf('"')&&e.lastIndexOf('"')===e.length-1&&(e=e.slice(1,-1));r[t[1].trim()]=e}return r}}function D(e){return"SCTE35-OUT"===e||"SCTE35-IN"===e}class L{constructor(e,t){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,t){const r=t.attr;for(const t in r)if(Object.prototype.hasOwnProperty.call(e,t)&&e[t]!==r[t]){R.warn(`DATERANGE tag attribute: "${t}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=t;break}e=g(new C({}),r,e)}if(this.attr=e,this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const e=new Date(this.attr["END-DATE"]);m(e.getTime())&&(this._endDate=e)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;const e=this.duration;return null!==e?new Date(this._startDate.getTime()+1e3*e):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(m(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&m(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class N{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var O="audio",M="video",P="audiovideo";class k{constructor(e){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[O]:null,[M]:null,[P]:null},this.baseurl=e}setByteRange(e,t){const r=e.split("@",2);let n;n=1===r.length?(null==t?void 0:t.byteRangeEndOffset)||0:parseInt(r[1]),this._byteRange=[n,parseInt(r[0])+n]}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=u.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}}class x extends k{constructor(e,t){super(t),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new N,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const e=this.levelkeys.identity;if(e)this._decryptdata=e.getDecryptData(this.sn);else{const e=Object.keys(this.levelkeys);if(1===e.length)return this._decryptdata=this.levelkeys[e[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(null===this.programDateTime)return null;if(!m(this.programDateTime))return null;const e=m(this.duration)?this.duration:0;return this.programDateTime+1e3*e}get encrypted(){var e;if(null!=(e=this._decryptdata)&&e.encrypted)return!0;if(this.levelkeys){const e=Object.keys(this.levelkeys),t=e.length;if(t>1||1===t&&this.levelkeys[e[0]].encrypted)return!0}return!1}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;null==(e=this.loader)||e.abort(),null==(t=this.keyLoader)||t.abort()}setElementaryStreamInfo(e,t,r,n,i,a=!1){const{elementaryStreams:o}=this,s=o[e];s?(s.startPTS=Math.min(s.startPTS,t),s.endPTS=Math.max(s.endPTS,r),s.startDTS=Math.min(s.startDTS,n),s.endDTS=Math.max(s.endDTS,i)):o[e]={startPTS:t,endPTS:r,startDTS:n,endDTS:i,partial:a}}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[O]=null,e[M]=null,e[P]=null}}class F extends k{constructor(e,t,r,n,i){super(r),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new N,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=n;const a=e.enumeratedString("BYTERANGE");a&&this.setByteRange(a,i),i&&(this.fragOffset=i.fragOffset+i.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}class U{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e)return this.advanced=!0,void(this.updated=!0);const t=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||0===t&&r>0,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay}get hasProgramDateTime(){return!!this.fragments.length&&m(this.fragments[this.fragments.length-1].programDateTime)}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||10}get drift(){const e=this.driftEndTime-this.driftStartTime;if(e>0){return 1e3*(this.driftEnd-this.driftStart)/e}return 1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return null!=(e=this.fragments)&&e.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function B(e){return Uint8Array.from(atob(e),(e=>e.charCodeAt(0)))}function Z(e){const t=e.split(":");let r=null;if("data"===t[0]&&2===t.length){const e=t[1].split(";"),n=e[e.length-1].split(",");if(2===n.length){const t="base64"===n[0],i=n[1];t?(e.splice(-1,1),r=B(i)):r=function(e){const t=G(e).subarray(0,16),r=new Uint8Array(16);return r.set(t,16-t.length),r}(i)}}return r}function G(e){return Uint8Array.from(unescape(encodeURIComponent(e)),(e=>e.charCodeAt(0)))}const H="undefined"!=typeof self?self:void 0;var K={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Y="org.w3.clearkey",q="com.apple.streamingkeydelivery",V="com.microsoft.playready",j="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";function $(e){switch(e){case q:return K.FAIRPLAY;case V:return K.PLAYREADY;case j:return K.WIDEVINE;case Y:return K.CLEARKEY}}var z="edef8ba979d64acea3c827dcd51d21ed";function W(e){switch(e){case K.FAIRPLAY:return q;case K.PLAYREADY:return V;case K.WIDEVINE:return j;case K.CLEARKEY:return Y}}function X(e){const{drmSystems:t,widevineLicenseUrl:r}=e,n=t?[K.FAIRPLAY,K.WIDEVINE,K.PLAYREADY,K.CLEARKEY].filter((e=>!!t[e])):[];return!n[K.WIDEVINE]&&r&&n.push(K.WIDEVINE),n}const Q=null!=H&&null!=(J=H.navigator)&&J.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;var J;function ee(e,t,r){return Uint8Array.prototype.slice?e.slice(t,r):new Uint8Array(Array.prototype.slice.call(e,t,r))}const te=(e,t)=>t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128,re=(e,t)=>t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128,ne=(e,t)=>{const r=t;let n=0;for(;te(e,t);){n+=10;n+=ie(e,t+6),re(e,t+10)&&(n+=10),t+=n}if(n>0)return e.subarray(r,r+n)},ie=(e,t)=>{let r=0;return r=(127&e[t])<<21,r|=(127&e[t+1])<<14,r|=(127&e[t+2])<<7,r|=127&e[t+3],r},ae=(e,t)=>te(e,t)&&ie(e,t+6)+10<=e.length-t,oe=e=>{const t=ue(e);for(let r=0;r<t.length;r++){const e=t[r];if(se(e))return ge(e)}},se=e=>e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info,le=e=>{const t=String.fromCharCode(e[0],e[1],e[2],e[3]),r=ie(e,4);return{type:t,size:r,data:e.subarray(10,10+r)}},ue=e=>{let t=0;const r=[];for(;te(e,t);){const n=ie(e,t+6);t+=10;const i=t+n;for(;t+8<i;){const n=le(e.subarray(t)),i=ce(n);i&&r.push(i),t+=n.size+10}re(e,t)&&(t+=10)}return r},ce=e=>"PRIV"===e.type?fe(e):"W"===e.type[0]?he(e):de(e),fe=e=>{if(e.size<2)return;const t=me(e.data,!0),r=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:r.buffer}},de=e=>{if(e.size<2)return;if("TXXX"===e.type){let t=1;const r=me(e.data.subarray(t),!0);t+=r.length+1;const n=me(e.data.subarray(t));return{key:e.type,info:r,data:n}}const t=me(e.data.subarray(1));return{key:e.type,data:t}},he=e=>{if("WXXX"===e.type){if(e.size<2)return;let t=1;const r=me(e.data.subarray(t),!0);t+=r.length+1;const n=me(e.data.subarray(t));return{key:e.type,info:r,data:n}}const t=me(e.data);return{key:e.type,data:t}},ge=e=>{if(8===e.data.byteLength){const t=new Uint8Array(e.data),r=1&t[3];let n=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return n/=45,r&&(n+=47721858.84),Math.round(n)}},me=(e,t=!1)=>{const r=function(){if(navigator.userAgent.includes("PlayStation 4"))return;pe||void 0===self.TextDecoder||(pe=new self.TextDecoder("utf-8"));return pe}();if(r){const n=r.decode(e);if(t){const e=n.indexOf("\0");return-1!==e?n.substring(0,e):n}return n.replace(/\0/g,"")}const n=e.length;let i,a,o,s="",l=0;for(;l<n;){if(i=e[l++],0===i&&t)return s;if(0!==i&&3!==i)switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:s+=String.fromCharCode(i);break;case 12:case 13:a=e[l++],s+=String.fromCharCode((31&i)<<6|63&a);break;case 14:a=e[l++],o=e[l++],s+=String.fromCharCode((15&i)<<12|(63&a)<<6|63&o)}}return s};let pe;const ye=function(e){let t="";for(let r=0;r<e.length;r++){let n=e[r].toString(16);n.length<2&&(n="0"+n),t+=n}return t},Ee=Math.pow(2,32)-1,ve=[].push,Te={video:1,audio:2,id3:3,text:4};function _e(e){return String.fromCharCode.apply(null,e)}function Se(e,t){const r=e[t]<<8|e[t+1];return r<0?65536+r:r}function Ae(e,t){const r=Re(e,t);return r<0?4294967296+r:r}function be(e,t){let r=Ae(e,t);return r*=Math.pow(2,32),r+=Ae(e,t+4),r}function Re(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function Ie(e,t,r){e[t]=r>>24,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=255&r}function we(e,t){const r=[];if(!t.length)return r;const n=e.byteLength;for(let i=0;i<n;){const a=Ae(e,i),o=a>1?i+a:n;if(_e(e.subarray(i+4,i+8))===t[0])if(1===t.length)r.push(e.subarray(i+8,o));else{const n=we(e.subarray(i+8,o),t.slice(1));n.length&&ve.apply(r,n)}i=o}return r}function Ce(e){const t=[],r=e[0];let n=8;const i=Ae(e,n);n+=4;let a=0,o=0;0===r?(a=Ae(e,n),o=Ae(e,n+4),n+=8):(a=be(e,n),o=be(e,n+8),n+=16),n+=2;let s=e.length+o;const l=Se(e,n);n+=2;for(let u=0;u<l;u++){let r=n;const a=Ae(e,r);r+=4;const o=2147483647&a;if(1===(2147483648&a)>>>31)return R.warn("SIDX has hierarchical references (not supported)"),null;const l=Ae(e,r);r+=4,t.push({referenceSize:o,subsegmentDuration:l,info:{duration:l/i,start:s,end:s+o-1}}),s+=o,r+=4,n=r}return{earliestPresentationTime:a,timescale:i,version:r,referencesCount:l,references:t}}function De(e){const t=[],r=we(e,["moov","trak"]);for(let n=0;n<r.length;n++){const e=r[n],i=we(e,["tkhd"])[0];if(i){let r=i[0];const n=Ae(i,0===r?12:20),a=we(e,["mdia","mdhd"])[0];if(a){r=a[0];const i=Ae(a,0===r?12:20),o=we(e,["mdia","hdlr"])[0];if(o){const r=_e(o.subarray(8,12)),a={soun:O,vide:M}[r];if(a){const r=Le(we(e,["mdia","minf","stbl","stsd"])[0]);t[n]={timescale:i,type:a},t[a]=f({timescale:i,id:n},r)}}}}}return we(e,["moov","mvex","trex"]).forEach((e=>{const r=Ae(e,4),n=t[r];n&&(n.default={duration:Ae(e,12),flags:Ae(e,20)})})),t}function Le(e){const t=e.subarray(8),r=t.subarray(86),n=_e(t.subarray(4,8));let i=n;const a="enca"===n||"encv"===n;if(a){const e=we(t,[n])[0];we(e.subarray("enca"===n?28:78),["sinf"]).forEach((e=>{const t=we(e,["schm"])[0];if(t){const r=_e(t.subarray(4,8));if("cbcs"===r||"cenc"===r){const t=we(e,["frma"])[0];t&&(i=_e(t))}}}))}switch(i){case"avc1":case"avc2":case"avc3":case"avc4":{const e=we(r,["avcC"])[0];i+="."+Oe(e[1])+Oe(e[2])+Oe(e[3]);break}case"mp4a":{const e=we(t,[n])[0],r=we(e.subarray(28),["esds"])[0];if(r&&r.length>12){let e=4;if(3!==r[e++])break;e=Ne(r,e),e+=2;const t=r[e++];if(128&t&&(e+=2),64&t&&(e+=r[e++]),4!==r[e++])break;e=Ne(r,e);const n=r[e++];if(64!==n)break;if(i+="."+Oe(n),e+=12,5!==r[e++])break;e=Ne(r,e);const a=r[e++];let o=(248&a)>>3;31===o&&(o+=1+((7&a)<<3)+((224&r[e])>>5)),i+="."+o}break}case"hvc1":case"hev1":{const e=we(r,["hvcC"])[0],t=e[1],n=["","A","B","C"][t>>6],a=31&t,o=Ae(e,2),s=(32&t)>>5?"H":"L",l=e[12],u=e.subarray(6,12);i+="."+n+a,i+="."+o.toString(16).toUpperCase(),i+="."+s+l;let c="";for(let r=u.length;r--;){const e=u[r];if(e||c){c="."+e.toString(16).toUpperCase()+c}}i+=c;break}case"dvh1":case"dvhe":{const e=we(r,["dvcC"])[0],t=e[2]>>1&127,n=e[2]<<5&32|e[3]>>3&31;i+="."+Me(t)+"."+Me(n);break}case"vp09":{const e=we(r,["vpcC"])[0],t=e[4],n=e[5],a=e[6]>>4&15;i+="."+Me(t)+"."+Me(n)+"."+Me(a);break}case"av01":{const e=we(r,["av1C"])[0],t=e[1]>>>5,n=31&e[1],a=e[2]>>>7?"H":"M",o=(64&e[2])>>6,s=(32&e[2])>>5,l=2===t&&o?s?12:10:o?10:8,u=(16&e[2])>>4,c=(8&e[2])>>3,f=(4&e[2])>>2,d=3&e[2],h=1,g=1,m=1,p=0;i+="."+t+"."+Me(n)+a+"."+Me(l)+"."+u+"."+c+f+d+"."+Me(h)+"."+Me(g)+"."+Me(m)+"."+p;break}}return{codec:i,encrypted:a}}function Ne(e,t){const r=t+5;for(;128&e[t++]&&t<r;);return t}function Oe(e){return("0"+e.toString(16).toUpperCase()).slice(-2)}function Me(e){return(e<10?"0":"")+e}function Pe(e){const t=we(e,["schm"])[0];if(t){const r=_e(t.subarray(4,8));if("cbcs"===r||"cenc"===r)return we(e,["schi","tenc"])[0]}return R.error("[eme] missing 'schm' box"),null}function ke(e){const t=Ae(e,0);let r=8;1&t&&(r+=4),4&t&&(r+=4);let n=0;const i=Ae(e,4);for(let a=0;a<i;a++){if(256&t){n+=Ae(e,r),r+=4}512&t&&(r+=4),1024&t&&(r+=4),2048&t&&(r+=4)}return n}function xe(e,t){const r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}function Fe(e,t){const r=[],n=t.samples,i=t.timescale,a=t.id;let o=!1;return we(n,["moof"]).map((s=>{const l=s.byteOffset-8;we(s,["traf"]).map((s=>{const u=we(s,["tfdt"]).map((e=>{const t=e[0];let r=Ae(e,4);return 1===t&&(r*=Math.pow(2,32),r+=Ae(e,8)),r/i}))[0];return void 0!==u&&(e=u),we(s,["tfhd"]).map((u=>{const c=Ae(u,4),f=16777215&Ae(u,0);let d=0;const h=!!(16&f);let g=0;const m=!!(32&f);let p=8;c===a&&(!!(1&f)&&(p+=8),!!(2&f)&&(p+=4),!!(8&f)&&(d=Ae(u,p),p+=4),h&&(g=Ae(u,p),p+=4),m&&(p+=4),"video"===t.type&&(o=function(e){if(!e)return!1;const t=e.indexOf("."),r=t<0?e:e.substring(0,t);return"hvc1"===r||"hev1"===r||"dvh1"===r||"dvhe"===r}(t.codec)),we(s,["trun"]).map((a=>{const s=a[0],u=16777215&Ae(a,0),c=!!(1&u);let f=0;const h=!!(4&u),m=!!(256&u);let p=0;const y=!!(512&u);let E=0;const v=!!(1024&u),T=!!(2048&u);let _=0;const S=Ae(a,4);let A=8;c&&(f=Ae(a,A),A+=4),h&&(A+=4);let b=f+l;for(let l=0;l<S;l++){if(m?(p=Ae(a,A),A+=4):p=d,y?(E=Ae(a,A),A+=4):E=g,v&&(A+=4),T&&(_=0===s?Ae(a,A):Re(a,A),A+=4),t.type===M){let t=0;for(;t<E;){const a=Ae(n,b);if(b+=4,Ue(o,n[b])){Be(n.subarray(b,b+a),o?2:1,e+_/i,r)}b+=a,t+=a+4}}e+=p/i}})))}))}))})),r}function Ue(e,t){if(e){const e=t>>1&63;return 39===e||40===e}return 6===(31&t)}function Be(e,t,r,n){const i=Ze(e);let a=0;a+=t;let o=0,s=0,l=0;for(;a<i.length;){o=0;do{if(a>=i.length)break;l=i[a++],o+=l}while(255===l);s=0;do{if(a>=i.length)break;l=i[a++],s+=l}while(255===l);const e=i.length-a;let t=a;if(s<e)a+=s;else if(s>e){R.error(`Malformed SEI payload. ${s} is too small, only ${e} bytes left to parse.`);break}if(4===o){if(181===i[t++]){const e=Se(i,t);if(t+=2,49===e){const e=Ae(i,t);if(t+=4,1195456820===e){const e=i[t++];if(3===e){const a=i[t++],s=64&a,l=s?2+3*(31&a):0,u=new Uint8Array(l);if(s){u[0]=a;for(let e=1;e<l;e++)u[e]=i[t++]}n.push({type:e,payloadType:o,pts:r,bytes:u})}}}}}else if(5===o&&s>16){const e=[];for(let r=0;r<16;r++){const n=i[t++].toString(16);e.push(1==n.length?"0"+n:n),3!==r&&5!==r&&7!==r&&9!==r||e.push("-")}const a=s-16,l=new Uint8Array(a);for(let r=0;r<a;r++)l[r]=i[t++];n.push({payloadType:o,pts:r,uuid:e.join(""),userData:me(l),userDataBytes:l})}}}function Ze(e){const t=e.byteLength,r=[];let n=1;for(;n<t-2;)0===e[n]&&0===e[n+1]&&3===e[n+2]?(r.push(n+2),n+=2):n++;if(0===r.length)return e;const i=t-r.length,a=new Uint8Array(i);let o=0;for(n=0;n<i;o++,n++)o===r[0]&&(o++,r.shift()),a[n]=e[o];return a}function Ge(e,t,r){if(16!==e.byteLength)throw new RangeError("Invalid system id");let n,i,a;if(t){n=1,i=new Uint8Array(16*t.length);for(let e=0;e<t.length;e++){const r=t[e];if(16!==r.byteLength)throw new RangeError("Invalid key");i.set(r,16*e)}}else n=0,i=new Uint8Array;n>0?(a=new Uint8Array(4),t.length>0&&new DataView(a.buffer).setUint32(0,t.length,!1)):a=new Uint8Array;const o=new Uint8Array(4);return r&&r.byteLength>0&&new DataView(o.buffer).setUint32(0,r.byteLength,!1),function(e,...t){const r=t.length;let n=8,i=r;for(;i--;)n+=t[i].byteLength;const a=new Uint8Array(n);for(a[0]=n>>24&255,a[1]=n>>16&255,a[2]=n>>8&255,a[3]=255&n,a.set(e,4),i=0,n=8;i<r;i++)a.set(t[i],n),n+=t[i].byteLength;return a}([112,115,115,104],new Uint8Array([n,0,0,0]),e,a,i,o,r||new Uint8Array)}let He={};class Ke{static clearKeyUriToKeyIdMap(){He={}}constructor(e,t,r,n=[1],i=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=r,this.keyFormatVersions=n,this.iv=i,this.encrypted=!!e&&"NONE"!==e,this.isCommonEncryption=this.encrypted&&"AES-128"!==e}isSupported(){if(this.method){if("AES-128"===this.method||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case q:case j:case V:case Y:return-1!==["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if("AES-128"===this.method&&this.uri&&!this.iv){"number"!=typeof e&&("AES-128"!==this.method||this.iv||R.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const t=function(e){const t=new Uint8Array(16);for(let r=12;r<16;r++)t[r]=e>>8*(15-r)&255;return t}(e);return new Ke(this.method,this.uri,"identity",this.keyFormatVersions,t)}const t=Z(this.uri);if(t)switch(this.keyFormat){case j:this.pssh=t,t.length>=22&&(this.keyId=t.subarray(t.length-22,t.length-6));break;case V:{const e=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=Ge(e,null,t);const r=new Uint16Array(t.buffer,t.byteOffset,t.byteLength/2),n=String.fromCharCode.apply(null,Array.from(r)),i=n.substring(n.indexOf("<"),n.length),a=(new DOMParser).parseFromString(i,"text/xml").getElementsByTagName("KID")[0];if(a){const e=a.childNodes[0]?a.childNodes[0].nodeValue:a.getAttribute("VALUE");if(e){const t=B(e).subarray(0,16);!function(e){const t=function(e,t,r){const n=e[t];e[t]=e[r],e[r]=n};t(e,0,3),t(e,1,2),t(e,4,5),t(e,6,7)}(t),this.keyId=t}}break}default:{let e=t.subarray(0,16);if(16!==e.length){const t=new Uint8Array(16);t.set(e,16-e.length),e=t}this.keyId=e;break}}if(!this.keyId||16!==this.keyId.byteLength){let e=He[this.uri];if(!e){const t=Object.keys(He).length%Number.MAX_SAFE_INTEGER;e=new Uint8Array(16);new DataView(e.buffer,12,4).setUint32(0,t),He[this.uri]=e}this.keyId=e}return this}}const Ye=/\{\$([a-zA-Z0-9-_]+)\}/g;function qe(e){return Ye.test(e)}function Ve(e,t,r){if(null!==e.variableList||e.hasVariableRefs)for(let n=r.length;n--;){const i=r[n],a=t[i];a&&(t[i]=je(e,a))}}function je(e,t){if(null!==e.variableList||e.hasVariableRefs){const r=e.variableList;return t.replace(Ye,(t=>{const n=t.substring(2,t.length-1),i=null==r?void 0:r[n];return void 0===i?(e.playlistParsingError||(e.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${n}"`)),t):i}))}return t}function $e(e,t,r){let n,i,a=e.variableList;if(a||(e.variableList=a={}),"QUERYPARAM"in t){n=t.QUERYPARAM;try{const e=new self.URL(r).searchParams;if(!e.has(n))throw new Error(`"${n}" does not match any query parameter in URI: "${r}"`);i=e.get(n)}catch(o){e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else n=t.NAME,i=t.VALUE;n in a?e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${n}"`)):a[n]=i||""}function ze(e,t,r){const n=t.IMPORT;if(r&&n in r){let t=e.variableList;t||(e.variableList=t={}),t[n]=r[n]}else e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${n}"`))}function We(e=!0){if("undefined"==typeof self)return;return(e||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}const Xe={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Qe(e,t,r=!0){return!e.split(",").some((e=>!Je(e,t,r)))}function Je(e,t,r=!0){var n;const i=We(r);return null!=(n=null==i?void 0:i.isTypeSupported(et(e,t)))&&n}function et(e,t){return`${t}/mp4;codecs="${e}"`}function tt(e){if(e){const t=e.substring(0,4);return Xe.video[t]}return 2}function rt(e){return e.split(",").reduce(((e,t)=>{const r=Xe.video[t];return r?(2*r+e)/(e?3:2):(Xe.audio[t]+e)/(e?2:1)}),0)}const nt={};const it=/flac|opus/i;function at(e,t=!0){return e.replace(it,(e=>function(e,t=!0){if(nt[e])return nt[e];const r={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"]}[e];for(let n=0;n<r.length;n++)if(Je(r[n],"audio",t))return nt[e]=r[n],r[n];return e}(e.toLowerCase(),t)))}function ot(e,t){return e&&"mp4a"!==e?e:t?t.split(",")[0]:t}const st=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,lt=/#EXT-X-MEDIA:(.*)/g,ut=/^#EXT(?:INF|-X-TARGETDURATION):/m,ct=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),ft=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class dt{static findGroup(e,t){for(let r=0;r<e.length;r++){const n=e[r];if(n.id===t)return n}}static resolve(e,t){return u.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return ut.test(e)}static parseMasterPlaylist(e,t){const r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:qe(e)},n=[];let i;for(st.lastIndex=0;null!=(i=st.exec(e));)if(i[1]){var a;const e=new C(i[1]);Ve(r,e,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);const o=je(r,i[2]),s={attrs:e,bitrate:e.decimalInteger("BANDWIDTH")||e.decimalInteger("AVERAGE-BANDWIDTH"),name:e.NAME,url:dt.resolve(o,t)},l=e.decimalResolution("RESOLUTION");l&&(s.width=l.width,s.height=l.height),mt(e.CODECS,s),null!=(a=s.unknownCodecs)&&a.length||n.push(s),r.levels.push(s)}else if(i[3]){const e=i[3],n=i[4];switch(e){case"SESSION-DATA":{const e=new C(n);Ve(r,e,["DATA-ID","LANGUAGE","VALUE","URI"]);const t=e["DATA-ID"];t&&(null===r.sessionData&&(r.sessionData={}),r.sessionData[t]=e);break}case"SESSION-KEY":{const e=ht(n,t,r);e.encrypted&&e.isSupported()?(null===r.sessionKeys&&(r.sessionKeys=[]),r.sessionKeys.push(e)):R.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${n}"`);break}case"DEFINE":{const e=new C(n);Ve(r,e,["NAME","VALUE","QUERYPARAM"]),$e(r,e,t)}break;case"CONTENT-STEERING":{const e=new C(n);Ve(r,e,["SERVER-URI","PATHWAY-ID"]),r.contentSteering={uri:dt.resolve(e["SERVER-URI"],t),pathwayId:e["PATHWAY-ID"]||"."};break}case"START":r.startTimeOffset=gt(n)}}const o=n.length>0&&n.length<r.levels.length;return r.levels=o?n:r.levels,0===r.levels.length&&(r.playlistParsingError=new Error("no levels found in manifest")),r}static parseMasterPlaylistMedia(e,t,r){let n;const i={},a=r.levels,o={AUDIO:a.map((e=>({id:e.attrs.AUDIO,audioCodec:e.audioCodec}))),SUBTITLES:a.map((e=>({id:e.attrs.SUBTITLES,textCodec:e.textCodec}))),"CLOSED-CAPTIONS":[]};let s=0;for(lt.lastIndex=0;null!==(n=lt.exec(e));){const e=new C(n[1]),a=e.TYPE;if(a){const n=o[a],l=i[a]||[];i[a]=l,Ve(r,e,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);const u=e.LANGUAGE,c=e["ASSOC-LANGUAGE"],f=e.CHANNELS,d=e.CHARACTERISTICS,h=e["INSTREAM-ID"],g={attrs:e,bitrate:0,id:s++,groupId:e["GROUP-ID"]||"",name:e.NAME||u||"",type:a,default:e.bool("DEFAULT"),autoselect:e.bool("AUTOSELECT"),forced:e.bool("FORCED"),lang:u,url:e.URI?dt.resolve(e.URI,t):""};if(c&&(g.assocLang=c),f&&(g.channels=f),d&&(g.characteristics=d),h&&(g.instreamId=h),null!=n&&n.length){const e=dt.findGroup(n,g.groupId)||n[0];pt(g,e,"audioCodec"),pt(g,e,"textCodec")}l.push(g)}}return i}static parseLevelPlaylist(e,t,r,n,i,a){const o=new U(t),s=o.fragments;let l,u,c,f=null,d=0,h=0,p=0,y=0,E=null,v=new x(n,t),T=-1,_=!1,S=null;for(ct.lastIndex=0,o.m3u8=e,o.hasVariableRefs=qe(e);null!==(l=ct.exec(e));){_&&(_=!1,v=new x(n,t),v.start=p,v.sn=d,v.cc=y,v.level=r,f&&(v.initSegment=f,v.rawProgramDateTime=f.rawProgramDateTime,f.rawProgramDateTime=null,S&&(v.setByteRange(S),S=null)));const e=l[1];if(e){v.duration=parseFloat(e);const t=(" "+l[2]).slice(1);v.title=t||null,v.tagList.push(t?["INF",e,t]:["INF",e])}else if(l[3]){if(m(v.duration)){v.start=p,c&&vt(v,c,o),v.sn=d,v.level=r,v.cc=y,s.push(v);const e=(" "+l[3]).slice(1);v.relurl=je(o,e),yt(v,E),E=v,p+=v.duration,d++,h=0,_=!0}}else if(l[4]){const e=(" "+l[4]).slice(1);E?v.setByteRange(e,E):v.setByteRange(e)}else if(l[5])v.rawProgramDateTime=(" "+l[5]).slice(1),v.tagList.push(["PROGRAM-DATE-TIME",v.rawProgramDateTime]),-1===T&&(T=s.length);else{if(l=l[0].match(ft),!l){R.warn("No matches on slow regex match for level playlist!");continue}for(u=1;u<l.length&&void 0===l[u];u++);const e=(" "+l[u]).slice(1),i=(" "+l[u+1]).slice(1),p=l[u+2]?(" "+l[u+2]).slice(1):"";switch(e){case"PLAYLIST-TYPE":o.type=i.toUpperCase();break;case"MEDIA-SEQUENCE":d=o.startSN=parseInt(i);break;case"SKIP":{const e=new C(i);Ve(o,e,["RECENTLY-REMOVED-DATERANGES"]);const t=e.decimalInteger("SKIPPED-SEGMENTS");if(m(t)){o.skippedSegments=t;for(let e=t;e--;)s.unshift(null);d+=t}const r=e.enumeratedString("RECENTLY-REMOVED-DATERANGES");r&&(o.recentlyRemovedDateranges=r.split("\t"));break}case"TARGETDURATION":o.targetduration=Math.max(parseInt(i),1);break;case"VERSION":o.version=parseInt(i);break;case"INDEPENDENT-SEGMENTS":case"EXTM3U":break;case"ENDLIST":o.live=!1;break;case"#":(i||p)&&v.tagList.push(p?[i,p]:[i]);break;case"DISCONTINUITY":y++,v.tagList.push(["DIS"]);break;case"GAP":v.gap=!0,v.tagList.push([e]);break;case"BITRATE":v.tagList.push([e,i]);break;case"DATERANGE":{const e=new C(i);Ve(o,e,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),Ve(o,e,e.clientAttrs);const t=new L(e,o.dateRanges[e.ID]);t.isValid||o.skippedSegments?o.dateRanges[t.id]=t:R.warn(`Ignoring invalid DATERANGE tag: "${i}"`),v.tagList.push(["EXT-X-DATERANGE",i]);break}case"DEFINE":{const e=new C(i);Ve(o,e,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in e?ze(o,e,a):$e(o,e,t)}break;case"DISCONTINUITY-SEQUENCE":y=parseInt(i);break;case"KEY":{const e=ht(i,t,o);if(e.isSupported()){if("NONE"===e.method){c=void 0;break}c||(c={}),c[e.keyFormat]&&(c=g({},c)),c[e.keyFormat]=e}else R.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${i}"`);break}case"START":o.startTimeOffset=gt(i);break;case"MAP":{const e=new C(i);if(Ve(o,e,["BYTERANGE","URI"]),v.duration){const i=new x(n,t);Et(i,e,r,c),f=i,v.initSegment=f,f.rawProgramDateTime&&!v.rawProgramDateTime&&(v.rawProgramDateTime=f.rawProgramDateTime)}else{const t=v.byteRangeEndOffset;if(t){const e=v.byteRangeStartOffset;S=`${t-e}@${e}`}else S=null;Et(v,e,r,c),f=v,_=!0}break}case"SERVER-CONTROL":{const e=new C(i);o.canBlockReload=e.bool("CAN-BLOCK-RELOAD"),o.canSkipUntil=e.optionalFloat("CAN-SKIP-UNTIL",0),o.canSkipDateRanges=o.canSkipUntil>0&&e.bool("CAN-SKIP-DATERANGES"),o.partHoldBack=e.optionalFloat("PART-HOLD-BACK",0),o.holdBack=e.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const e=new C(i);o.partTarget=e.decimalFloatingPoint("PART-TARGET");break}case"PART":{let e=o.partList;e||(e=o.partList=[]);const r=h>0?e[e.length-1]:void 0,n=h++,a=new C(i);Ve(o,a,["BYTERANGE","URI"]);const s=new F(a,v,t,n,r);e.push(s),v.duration+=s.duration;break}case"PRELOAD-HINT":{const e=new C(i);Ve(o,e,["URI"]),o.preloadHint=e;break}case"RENDITION-REPORT":{const e=new C(i);Ve(o,e,["URI"]),o.renditionReports=o.renditionReports||[],o.renditionReports.push(e);break}default:R.warn(`line parsed but not handled: ${l}`)}}}E&&!E.relurl?(s.pop(),p-=E.duration,o.partList&&(o.fragmentHint=E)):o.partList&&(yt(v,E),v.cc=y,o.fragmentHint=v,c&&vt(v,c,o));const A=s.length,b=s[0],I=s[A-1];if(p+=o.skippedSegments*o.targetduration,p>0&&A&&I){o.averagetargetduration=p/A;const e=I.sn;o.endSN="initSegment"!==e?e:0,o.live||(I.endList=!0),b&&(o.startCC=b.cc)}else o.endSN=0,o.startCC=0;return o.fragmentHint&&(p+=o.fragmentHint.duration),o.totalduration=p,o.endCC=y,T>0&&function(e,t){let r=e[t];for(let n=t;n--;){const t=e[n];if(!t)return;t.programDateTime=r.programDateTime-1e3*t.duration,r=t}}(s,T),o}}function ht(e,t,r){var n,i;const a=new C(e);Ve(r,a,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);const o=null!=(n=a.METHOD)?n:"",s=a.URI,l=a.hexadecimalInteger("IV"),u=a.KEYFORMATVERSIONS,c=null!=(i=a.KEYFORMAT)?i:"identity";s&&a.IV&&!l&&R.error(`Invalid IV: ${a.IV}`);const f=s?dt.resolve(s,t):"",d=(u||"1").split("/").map(Number).filter(Number.isFinite);return new Ke(o,f,c,d,l)}function gt(e){const t=new C(e).decimalFloatingPoint("TIME-OFFSET");return m(t)?t:null}function mt(e,t){let r=(e||"").split(/[ ,]+/).filter((e=>e));["video","audio","text"].forEach((e=>{const n=r.filter((t=>function(e,t){const r=Xe[t];return!!r&&!!r[e.slice(0,4)]}(t,e)));n.length&&(t[`${e}Codec`]=n.join(","),r=r.filter((e=>-1===n.indexOf(e))))})),t.unknownCodecs=r}function pt(e,t,r){const n=t[r];n&&(e[r]=n)}function yt(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),m(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}function Et(e,t,r,n){e.relurl=t.URI,t.BYTERANGE&&e.setByteRange(t.BYTERANGE),e.level=r,e.sn="initSegment",n&&(e.levelkeys=n),e.initSegment=null}function vt(e,t,r){e.levelkeys=t;const{encryptedFragments:n}=r;n.length&&n[n.length-1].levelkeys===t||!Object.keys(t).some((e=>t[e].isCommonEncryption))||n.push(e)}var Tt="manifest",_t="level",St="audioTrack",At="subtitleTrack",bt="main",Rt="audio",It="subtitle";function wt(e){const{type:t}=e;switch(t){case St:return Rt;case At:return It;default:return bt}}function Ct(e,t){let r=e.url;return void 0!==r&&0!==r.indexOf("data:")||(r=t.url),r}class Dt{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.LEVEL_LOADING,this.onLevelLoading,this),e.on(E.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(E.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){const{hls:e}=this;e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.LEVEL_LOADING,this.onLevelLoading,this),e.off(E.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(E.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(e){const t=this.hls.config,r=t.pLoader,n=t.loader,i=new(r||n)(t);return this.loaders[e.type]=i,i}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:r}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Tt,url:r,deliveryDirectives:null})}onLevelLoading(e,t){const{id:r,level:n,pathwayId:i,url:a,deliveryDirectives:o}=t;this.load({id:r,level:n,pathwayId:i,responseType:"text",type:_t,url:a,deliveryDirectives:o})}onAudioTrackLoading(e,t){const{id:r,groupId:n,url:i,deliveryDirectives:a}=t;this.load({id:r,groupId:n,level:null,responseType:"text",type:St,url:i,deliveryDirectives:a})}onSubtitleTrackLoading(e,t){const{id:r,groupId:n,url:i,deliveryDirectives:a}=t;this.load({id:r,groupId:n,level:null,responseType:"text",type:At,url:i,deliveryDirectives:a})}load(e){var t;const r=this.hls.config;let n,i=this.getInternalLoader(e);if(i){const t=i.context;if(t&&t.url===e.url&&t.level===e.level)return void R.trace("[playlist-loader]: playlist request ongoing");R.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),i.abort()}if(n=e.type===Tt?r.manifestLoadPolicy.default:g({},r.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),i=this.createInternalLoader(e),m(null==(t=e.deliveryDirectives)?void 0:t.part)){let t;if(e.type===_t&&null!==e.level?t=this.hls.levels[e.level].details:e.type===St&&null!==e.id?t=this.hls.audioTracks[e.id].details:e.type===At&&null!==e.id&&(t=this.hls.subtitleTracks[e.id].details),t){const e=t.partTarget,r=t.targetduration;if(e&&r){const t=1e3*Math.max(3*e,.8*r);n=g({},n,{maxTimeToFirstByteMs:Math.min(t,n.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(t,n.maxTimeToFirstByteMs)})}}}const a=n.errorRetry||n.timeoutRetry||{},o={loadPolicy:n,timeout:n.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},s={onSuccess:(e,t,r,n)=>{const i=this.getInternalLoader(r);this.resetInternalLoader(r.type);const a=e.data;0===a.indexOf("#EXTM3U")?(t.parsing.start=performance.now(),dt.isMediaPlaylist(a)?this.handleTrackOrLevelPlaylist(e,t,r,n||null,i):this.handleMasterPlaylist(e,t,r,n)):this.handleManifestParsingError(e,r,new Error("no EXTM3U delimiter"),n||null,t)},onError:(e,t,r,n)=>{this.handleNetworkError(t,r,!1,e,n)},onTimeout:(e,t,r)=>{this.handleNetworkError(t,r,!0,void 0,e)}};i.load(e,o,s)}handleMasterPlaylist(e,t,r,n){const i=this.hls,a=e.data,o=Ct(e,r),s=dt.parseMasterPlaylist(a,o);if(s.playlistParsingError)return void this.handleManifestParsingError(e,r,s.playlistParsingError,n,t);const{contentSteering:l,levels:u,sessionData:c,sessionKeys:f,startTimeOffset:d,variableList:h}=s;this.variableList=h;const{AUDIO:g=[],SUBTITLES:m,"CLOSED-CAPTIONS":p}=dt.parseMasterPlaylistMedia(a,o,s);if(g.length){g.some((e=>!e.url))||!u[0].audioCodec||u[0].attrs.AUDIO||(R.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),g.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new C({}),bitrate:0,url:""}))}i.trigger(E.MANIFEST_LOADED,{levels:u,audioTracks:g,subtitles:m,captions:p,contentSteering:l,url:o,stats:t,networkDetails:n,sessionData:c,sessionKeys:f,startTimeOffset:d,variableList:h})}handleTrackOrLevelPlaylist(e,t,r,n,i){const a=this.hls,{id:o,level:s,type:l}=r,u=Ct(e,r),c=m(s)?s:m(o)?o:0,f=wt(r),d=dt.parseLevelPlaylist(e.data,u,c,f,0,this.variableList);if(l===Tt){const e={attrs:new C({}),bitrate:0,details:d,name:"",url:u};a.trigger(E.MANIFEST_LOADED,{levels:[e],audioTracks:[],url:u,stats:t,networkDetails:n,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=d,this.handlePlaylistLoaded(d,e,t,r,n,i)}handleManifestParsingError(e,t,r,n,i){this.hls.trigger(E.ERROR,{type:v.NETWORK_ERROR,details:T.MANIFEST_PARSING_ERROR,fatal:t.type===Tt,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:n,stats:i})}handleNetworkError(e,t,r=!1,n,i){let a=`A network ${r?"timeout":"error"+(n?" (status "+n.code+")":"")} occurred while loading ${e.type}`;e.type===_t?a+=`: ${e.level} id: ${e.id}`:e.type!==St&&e.type!==At||(a+=` id: ${e.id} group-id: "${e.groupId}"`);const o=new Error(a);R.warn(`[playlist-loader]: ${a}`);let s=T.UNKNOWN,l=!1;const u=this.getInternalLoader(e);switch(e.type){case Tt:s=r?T.MANIFEST_LOAD_TIMEOUT:T.MANIFEST_LOAD_ERROR,l=!0;break;case _t:s=r?T.LEVEL_LOAD_TIMEOUT:T.LEVEL_LOAD_ERROR,l=!1;break;case St:s=r?T.AUDIO_TRACK_LOAD_TIMEOUT:T.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case At:s=r?T.SUBTITLE_TRACK_LOAD_TIMEOUT:T.SUBTITLE_LOAD_ERROR,l=!1}u&&this.resetInternalLoader(e.type);const c={type:v.NETWORK_ERROR,details:s,fatal:l,url:e.url,loader:u,context:e,error:o,networkDetails:t,stats:i};if(n){const r=(null==t?void 0:t.url)||e.url;c.response=f({url:r,data:void 0},n)}this.hls.trigger(E.ERROR,c)}handlePlaylistLoaded(e,t,r,n,i,a){const o=this.hls,{type:s,level:l,id:u,groupId:c,deliveryDirectives:f}=n,d=Ct(t,n),h=wt(n),g="number"==typeof n.level&&h===bt?l:void 0;if(!e.fragments.length){const e=new Error("No Segments found in Playlist");return void o.trigger(E.ERROR,{type:v.NETWORK_ERROR,details:T.LEVEL_EMPTY_ERROR,fatal:!1,url:d,error:e,reason:e.message,response:t,context:n,level:g,parent:h,networkDetails:i,stats:r})}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const m=e.playlistParsingError;if(m)o.trigger(E.ERROR,{type:v.NETWORK_ERROR,details:T.LEVEL_PARSING_ERROR,fatal:!1,url:d,error:m,reason:m.message,response:t,context:n,level:g,parent:h,networkDetails:i,stats:r});else switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),a.getCacheAge&&!isNaN(e.ageHeader)||(e.ageHeader=0)),s){case Tt:case _t:o.trigger(E.LEVEL_LOADED,{details:e,level:g||0,id:u||0,stats:r,networkDetails:i,deliveryDirectives:f});break;case St:o.trigger(E.AUDIO_TRACK_LOADED,{details:e,id:u||0,groupId:c||"",stats:r,networkDetails:i,deliveryDirectives:f});break;case At:o.trigger(E.SUBTITLE_TRACK_LOADED,{details:e,id:u||0,groupId:c||"",stats:r,networkDetails:i,deliveryDirectives:f})}}}function Lt(e,t){let r;try{r=new Event("addtrack")}catch(n){r=document.createEvent("Event"),r.initEvent("addtrack",!1,!1)}r.track=e,t.dispatchEvent(r)}function Nt(e,t){const r=e.mode;if("disabled"===r&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw new Error(`addCue is failed for: ${t}`)}catch(n){R.debug(`[texttrack-utils]: ${n}`);try{const r=new self.TextTrackCue(t.startTime,t.endTime,t.text);r.id=t.id,e.addCue(r)}catch(i){R.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${i}`)}}"disabled"===r&&(e.mode=r)}function Ot(e){const t=e.mode;if("disabled"===t&&(e.mode="hidden"),e.cues)for(let r=e.cues.length;r--;)e.removeCue(e.cues[r]);"disabled"===t&&(e.mode=t)}function Mt(e,t,r,n){const i=e.mode;if("disabled"===i&&(e.mode="hidden"),e.cues&&e.cues.length>0){const i=function(e,t,r){const n=[],i=function(e,t){if(t<e[0].startTime)return 0;const r=e.length-1;if(t>e[r].endTime)return-1;let n=0,i=r;for(;n<=i;){const a=Math.floor((i+n)/2);if(t<e[a].startTime)i=a-1;else{if(!(t>e[a].startTime&&n<r))return a;n=a+1}}return e[n].startTime-t<t-e[i].startTime?n:i}(e,t);if(i>-1)for(let a=i,o=e.length;a<o;a++){const i=e[a];if(i.startTime>=t&&i.endTime<=r)n.push(i);else if(i.startTime>r)return n}return n}(e.cues,t,r);for(let t=0;t<i.length;t++)n&&!n(i[t])||e.removeCue(i[t])}"disabled"===i&&(e.mode=i)}function Pt(e){const t=[];for(let r=0;r<e.length;r++){const n=e[r];"subtitles"!==n.kind&&"captions"!==n.kind||!n.label||t.push(e[r])}return t}var kt="org.id3",xt="com.apple.quicktime.HLS",Ft="https://aomedia.org/emsg/ID3";function Ut(){if("undefined"!=typeof self)return self.VTTCue||self.TextTrackCue}function Bt(e,t,r,n,i){let a=new e(t,r,"");try{a.value=n,i&&(a.type=i)}catch(o){a=new e(t,r,JSON.stringify(i?f({type:i},n):n))}return a}const Zt=(()=>{const e=Ut();try{e&&new e(0,Number.POSITIVE_INFINITY,"")}catch(t){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function Gt(e,t){return e.getTime()/1e3-t}class Ht{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){const{hls:e}=this;e.on(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(E.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(E.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(E.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(E.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(e,t){this.media=t.media}onMediaDetaching(){this.id3Track&&(Ot(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const r=e[t];if("metadata"===r.kind&&"id3"===r.label)return Lt(r,this.media),r}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:r,enableID3MetadataCues:n}}}=this;if(!r&&!n)return;const{samples:i}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const a=Ut();if(a)for(let o=0;o<i.length;o++){const e=i[o].type;if(e===Ft&&!r||!n)continue;const t=ue(i[o].data);if(t){const r=i[o].pts;let n=r+i[o].duration;n>Zt&&(n=Zt);n-r<=0&&(n=r+.25);for(let i=0;i<t.length;i++){const o=t[i];if(!se(o)){this.updateId3CueEnds(r,e);const t=Bt(a,r,n,o,e);t&&this.id3Track.addCue(t)}}}}}updateId3CueEnds(e,t){var r;const n=null==(r=this.id3Track)?void 0:r.cues;if(n)for(let i=n.length;i--;){const r=n[i];r.type===t&&r.startTime<e&&r.endTime===Zt&&(r.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:r,type:n}){const{id3Track:i,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:o,enableID3MetadataCues:s}}=a;if(i&&(o||s)){let e;e="audio"===n?e=>e.type===kt&&s:"video"===n?e=>e.type===Ft&&o:e=>e.type===kt&&s||e.type===Ft&&o,Mt(i,t,r,e)}}onLevelUpdated(e,{details:t}){if(!this.media||!t.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{dateRangeCuesAppended:r,id3Track:n}=this,{dateRanges:i}=t,a=Object.keys(i);if(n){const e=Object.keys(r).filter((e=>!a.includes(e)));for(let t=e.length;t--;){const i=e[t];Object.keys(r[i].cues).forEach((e=>{n.removeCue(r[i].cues[e])})),delete r[i]}}const o=t.fragments[t.fragments.length-1];if(0===a.length||!m(null==o?void 0:o.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const s=o.programDateTime/1e3-o.start,l=Ut();for(let f=0;f<a.length;f++){const e=a[f],t=i[e],n=Gt(t.startDate,s),o=r[e],d=(null==o?void 0:o.cues)||{};let h=(null==o?void 0:o.durationKnown)||!1,g=Zt;const m=t.endDate;if(m)g=Gt(m,s),h=!0;else if(t.endOnNext&&!h){const e=a.reduce(((e,r)=>{if(r!==t.id){const n=i[r];if(n.class===t.class&&n.startDate>t.startDate&&(!e||t.startDate<e.startDate))return n}return e}),null);e&&(g=Gt(e.startDate,s),h=!0)}const p=Object.keys(t.attr);for(let r=0;r<p.length;r++){const i=p[r];if("ID"===(c=i)||"CLASS"===c||"START-DATE"===c||"DURATION"===c||"END-DATE"===c||"END-ON-NEXT"===c)continue;const a=d[i];if(a)h&&!o.durationKnown&&(a.endTime=g);else if(l){let r=t.attr[i];D(i)&&(u=r,r=Uint8Array.from(u.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer);const a=Bt(l,n,g,{key:i,data:r},xt);a&&(a.id=e,this.id3Track.addCue(a),d[i]=a)}}r[e]={cues:d,dateRange:t,durationKnown:h}}var u,c}}class Kt{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=e,this.config=e.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){const{config:e,levelDetails:t}=this;return void 0!==e.liveMaxLatencyDuration?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const{levelDetails:e}=this;if(null===e)return null;const{holdBack:t,partHoldBack:r,targetduration:n}=e,{liveSyncDuration:i,liveSyncDurationCount:a,lowLatencyMode:o}=this.config,s=this.hls.userConfig;let l=o&&r||t;(s.liveSyncDuration||s.liveSyncDurationCount||0===l)&&(l=void 0!==i?i:a*n);const u=n;return l+Math.min(1*this.stallCount,u)}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency,r=this.levelDetails;if(null===e||null===t||null===r)return null;const n=r.edge,i=e-t-this.edgeStalled,a=n-r.totalduration,o=n-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(a,i),o)}get drift(){const{levelDetails:e}=this;return null===e?1:e.drift}get edgeStalled(){const{levelDetails:e}=this;if(null===e)return 0;const t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e,levelDetails:t}=this;if(!e||!t)return 0;const r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(E.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(E.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(E.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(E.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(E.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(E.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(E.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(E.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(E.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(E.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){this.levelDetails=t,t.advanced&&this.timeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(e,t){var r;t.details===T.BUFFER_STALLED_ERROR&&(this.stallCount++,null!=(r=this.levelDetails)&&r.live&&R.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){const{media:e,levelDetails:t}=this;if(!e||!t)return;this.currentTime=e.currentTime;const r=this.computeLatency();if(null===r)return;this._latency=r;const{lowLatencyMode:n,maxLiveSyncPlaybackRate:i}=this.config;if(!n||1===i||!t.live)return;const a=this.targetLatency;if(null===a)return;const o=r-a;if(o<Math.min(this.maxLatency,a+t.targetduration)&&o>.05&&this.forwardBufferLength>1){const t=Math.min(2,Math.max(1,i)),r=Math.round(2/(1+Math.exp(-.75*o-this.edgeStalled))*20)/20;e.playbackRate=Math.min(t,Math.max(1,r))}else 1!==e.playbackRate&&0!==e.playbackRate&&(e.playbackRate=1)}estimateLiveEdge(){const{levelDetails:e}=this;return null===e?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return null===e?null:e-this.currentTime}}const Yt=["NONE","TYPE-0","TYPE-1",null];const qt=["SDR","PQ","HLG"];var Vt="",jt="YES",$t="v2";function zt(e){const{canSkipUntil:t,canSkipDateRanges:r,age:n}=e;return t&&n<t/2?r?$t:jt:Vt}class Wt{constructor(e,t,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=r}addDirectives(e){const t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Xt{constructor(e){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter((e=>!!e)).map((e=>e.substring(0,4))).join(","),this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Qt(this._audioGroups,e)}hasSubtitleGroup(e){return Qt(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t)if("audio"===e){let e=this._audioGroups;e||(e=this._audioGroups=[]),-1===e.indexOf(t)&&e.push(t)}else if("text"===e){let e=this._subtitleGroups;e||(e=this._subtitleGroups=[]),-1===e.indexOf(t)&&e.push(t)}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return null==(e=this.audioGroups)?void 0:e[0]}get textGroupId(){var e;return null==(e=this.subtitleGroups)?void 0:e[0]}addFallback(){}}function Qt(e,t){return!(!t||!e)&&-1!==e.indexOf(t)}function Jt(e,t){const r=t.startPTS;if(m(r)){let n,i=0;t.sn>e.sn?(i=r-e.start,n=e):(i=e.start-r,n=t),n.duration!==i&&(n.duration=i)}else if(t.sn>e.sn){e.cc===t.cc&&e.minEndPTS?t.start=e.start+(e.minEndPTS-e.start):t.start=e.start+e.duration}else t.start=Math.max(e.start-t.duration,0)}function er(e,t,r,n,i,a){n-r<=0&&(R.warn("Fragment should have a positive duration",t),n=r+t.duration,a=i+t.duration);let o=r,s=n;const l=t.startPTS,u=t.endPTS;if(m(l)){const e=Math.abs(l-r);m(t.deltaPTS)?t.deltaPTS=Math.max(e,t.deltaPTS):t.deltaPTS=e,o=Math.max(r,l),r=Math.min(r,l),i=Math.min(i,t.startDTS),s=Math.min(n,u),n=Math.max(n,u),a=Math.max(a,t.endDTS)}const c=r-t.start;0!==t.start&&(t.start=r),t.duration=n-t.start,t.startPTS=r,t.maxStartPTS=o,t.startDTS=i,t.endPTS=n,t.minEndPTS=s,t.endDTS=a;const f=t.sn;if(!e||f<e.startSN||f>e.endSN)return 0;let d;const h=f-e.startSN,g=e.fragments;for(g[h]=t,d=h;d>0;d--)Jt(g[d],g[d-1]);for(d=h;d<g.length-1;d++)Jt(g[d],g[d+1]);return e.fragmentHint&&Jt(g[g.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,c}function tr(e,t){let r=null;const n=e.fragments;for(let l=n.length-1;l>=0;l--){const e=n[l].initSegment;if(e){r=e;break}}e.fragmentHint&&delete e.fragmentHint.endPTS;let i,a=0;if(function(e,t,r){const n=t.skippedSegments,i=Math.max(e.startSN,t.startSN)-t.startSN,a=(e.fragmentHint?1:0)+(n?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,o=t.startSN-e.startSN,s=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments;for(let u=i;u<=a;u++){const e=l[o+u];let i=s[u];n&&!i&&u<n&&(i=t.fragments[u]=e),e&&i&&r(e,i)}}(e,t,((e,n)=>{e.relurl&&(a=e.cc-n.cc),m(e.startPTS)&&m(e.endPTS)&&(n.start=n.startPTS=e.startPTS,n.startDTS=e.startDTS,n.maxStartPTS=e.maxStartPTS,n.endPTS=e.endPTS,n.endDTS=e.endDTS,n.minEndPTS=e.minEndPTS,n.duration=e.endPTS-e.startPTS,n.duration&&(i=n),t.PTSKnown=t.alignedSliding=!0),n.elementaryStreams=e.elementaryStreams,n.loader=e.loader,n.stats=e.stats,e.initSegment&&(n.initSegment=e.initSegment,r=e.initSegment)})),r){(t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments).forEach((e=>{var t;!e||e.initSegment&&e.initSegment.relurl!==(null==(t=r)?void 0:t.relurl)||(e.initSegment=r)}))}if(t.skippedSegments)if(t.deltaUpdateFailed=t.fragments.some((e=>!e)),t.deltaUpdateFailed){R.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let e=t.skippedSegments;e--;)t.fragments.shift();t.startSN=t.fragments[0].sn,t.startCC=t.fragments[0].cc}else t.canSkipDateRanges&&(t.dateRanges=function(e,t,r){const n=g({},e);r&&r.forEach((e=>{delete n[e]}));return Object.keys(t).forEach((e=>{const r=new L(t[e].attr,n[e]);r.isValid?n[e]=r:R.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(t[e].attr)}"`)})),n}(e.dateRanges,t.dateRanges,t.recentlyRemovedDateranges));const o=t.fragments;if(a){R.warn("discontinuity sliding from playlist, take drift into account");for(let e=0;e<o.length;e++)o[e].cc+=a}t.skippedSegments&&(t.startCC=t.fragments[0].cc),function(e,t,r){if(e&&t){let n=0;for(let i=0,a=e.length;i<=a;i++){const a=e[i],o=t[i+n];a&&o&&a.index===o.index&&a.fragment.sn===o.fragment.sn?r(a,o):n--}}}(e.partList,t.partList,((e,t)=>{t.elementaryStreams=e.elementaryStreams,t.stats=e.stats})),i?er(t,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS):rr(e,t),o.length&&(t.totalduration=t.edge-o[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;const s=t.advancedDateTime;if(t.advanced&&s){const e=t.edge;t.driftStart||(t.driftStartTime=s,t.driftStart=e),t.driftEndTime=s,t.driftEnd=e}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime}function rr(e,t){const r=t.startSN+t.skippedSegments-e.startSN,n=e.fragments;r<0||r>=n.length||nr(t,n[r].start)}function nr(e,t){if(t){const r=e.fragments;for(let n=e.skippedSegments;n<r.length;n++)r[n].start+=t;e.fragmentHint&&(e.fragmentHint.start+=t)}}function ir(e,t,r){var n;return null!=e&&e.details?ar(null==(n=e.details)?void 0:n.partList,t,r):null}function ar(e,t,r){if(e)for(let n=e.length;n--;){const i=e[n];if(i.index===r&&i.fragment.sn===t)return i}return null}function or(e){e.forEach(((e,t)=>{const{details:r}=e;null!=r&&r.fragments&&r.fragments.forEach((e=>{e.level=t}))}))}function sr(e){switch(e.details){case T.FRAG_LOAD_TIMEOUT:case T.KEY_LOAD_TIMEOUT:case T.LEVEL_LOAD_TIMEOUT:case T.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function lr(e,t){const r=sr(t);return e.default[(r?"timeout":"error")+"Retry"]}function ur(e,t){const r="linear"===e.backoff?1:Math.pow(2,t);return Math.min(r*e.retryDelayMs,e.maxRetryDelayMs)}function cr(e){return f(f({},e),{errorRetry:null,timeoutRetry:null})}function fr(e,t,r,n){if(!e)return!1;const i=null==n?void 0:n.code,a=t<e.maxNumRetry&&(function(e){return 0===e&&!1===navigator.onLine||!!e&&(e<400||e>499)}(i)||!!r);return e.shouldRetry?e.shouldRetry(e,t,r,n,a):a}const dr=function(e,t){let r=0,n=e.length-1,i=null,a=null;for(;r<=n;){i=(r+n)/2|0,a=e[i];const o=t(a);if(o>0)r=i+1;else{if(!(o<0))return a;n=i-1}}return null};function hr(e,t,r=0,n=0,i=.005){let a=null;if(e){a=t[e.sn-t[0].sn+1]||null;const n=e.endDTS-r;n>0&&n<15e-7&&(r+=15e-7)}else 0===r&&0===t[0].start&&(a=t[0]);if(a&&((!e||e.level===a.level)&&0===gr(r,n,a)||function(e,t,r){if(t&&0===t.start&&t.level<e.level&&(t.endPTS||0)>0){const n=t.tagList.reduce(((e,t)=>("INF"===t[0]&&(e+=parseFloat(t[1])),e)),r);return e.start<=n}return!1}(a,e,Math.min(i,n))))return a;const o=dr(t,gr.bind(null,r,n));return!o||o===e&&a?a:o}function gr(e=0,t=0,r){if(r.start<=e&&r.start+r.duration>e)return 0;const n=Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0));return r.start+r.duration-n<=e?1:r.start-n>e&&r.start?-1:0}function mr(e,t,r){const n=1e3*Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0));return(r.endProgramDateTime||0)-n>e}var pr=0,yr=2,Er=3,vr=5,Tr=0,_r=1,Sr=2;class Ar{constructor(e,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=R.log.bind(R,`${t}:`),this.warn=R.warn.bind(R,`${t}:`),this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){-1!==this.timer&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,r){const n=null==t?void 0:t.renditionReports;if(n){let a=-1;for(let r=0;r<n.length;r++){const o=n[r];let s;try{s=new self.URL(o.URI,t.url).href}catch(i){R.warn(`Could not construct new URL for Rendition Report: ${i}`),s=o.URI||""}if(s===e){a=r;break}s===e.substring(0,s.length)&&(a=r)}if(-1!==a){const e=n[a],i=parseInt(e["LAST-MSN"])||(null==t?void 0:t.lastPartSn);let o=parseInt(e["LAST-PART"])||(null==t?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){const e=Math.min(t.age-t.partTarget,t.targetduration);o>=0&&e>t.partTarget&&(o+=1)}const s=r&&zt(r);return new Wt(i,o>=0?o:void 0,s)}}}loadPlaylist(e){-1===this.requestScheduled&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}shouldReloadPlaylist(e){return-1===this.timer&&-1===this.requestScheduled&&this.shouldLoadPlaylist(e)}playlistLoaded(e,t,r){const{details:n,stats:i}=t,a=self.performance.now(),o=i.loading.first?Math.max(0,a-i.loading.first):0;if(n.advancedDateTime=Date.now()-o,n.live||null!=r&&r.live){if(n.reloaded(r),r&&this.log(`live playlist ${e} ${n.advanced?"REFRESHED "+n.lastPartSn+"-"+n.lastPartIndex:n.updated?"UPDATED":"MISSED"}`),r&&n.fragments.length>0&&tr(r,n),!this.canLoad||!n.live)return;let o,s,l;if(n.canBlockReload&&n.endSN&&n.advanced){const e=this.hls.config.lowLatencyMode,i=n.lastPartSn,a=n.endSN,u=n.lastPartIndex,c=i===a;-1!==u?(s=c?a+1:i,l=c?e?0:u:u+1):s=a+1;const f=n.age,d=f+n.ageHeader;let h=Math.min(d-n.partTarget,1.5*n.targetduration);if(h>0){if(r&&h>r.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${r.tuneInGoal} to: ${h} with playlist age: ${n.age}`),h=0;else{const e=Math.floor(h/n.targetduration);if(s+=e,void 0!==l){l+=Math.round(h%n.targetduration/n.partTarget)}this.log(`CDN Tune-in age: ${n.ageHeader}s last advanced ${f.toFixed(2)}s goal: ${h} skip sn ${e} to part ${l}`)}n.tuneInGoal=h}if(o=this.getDeliveryDirectives(n,t.deliveryDirectives,s,l),e||!c)return void this.loadPlaylist(o)}else(n.canBlockReload||n.canSkipUntil)&&(o=this.getDeliveryDirectives(n,t.deliveryDirectives,s,l));const u=this.hls.mainForwardBufferInfo,c=u?u.end-u.len:0,f=function(e,t=1/0){let r=1e3*e.targetduration;if(e.updated){const n=e.fragments,i=4;if(n.length&&r*i>t){const e=1e3*n[n.length-1].duration;e<r&&(r=e)}}else r/=2;return Math.round(r)}(n,1e3*(n.edge-c));n.updated&&a>this.requestScheduled+f&&(this.requestScheduled=i.loading.start),void 0!==s&&n.canBlockReload?this.requestScheduled=i.loading.first+f-(1e3*n.partTarget||1e3):-1===this.requestScheduled||this.requestScheduled+f<a?this.requestScheduled=a:this.requestScheduled-a<=0&&(this.requestScheduled+=f);let d=this.requestScheduled-a;d=Math.max(0,d),this.log(`reload live playlist ${e} in ${Math.round(d)} ms`),this.timer=self.setTimeout((()=>this.loadPlaylist(o)),d)}else this.clearTimer()}getDeliveryDirectives(e,t,r,n){let i=zt(e);return null!=t&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,n=t.part,i=Vt),new Wt(r,n,i)}checkRetry(e){const t=e.details,r=sr(e),n=e.errorAction,{action:i,retryCount:a=0,retryConfig:o}=n||{},s=!!n&&!!o&&(i===vr||!n.resolved&&i===yr);if(s){var l;if(this.requestScheduled=-1,a>=o.maxNumRetry)return!1;if(r&&null!=(l=e.context)&&l.deliveryDirectives)this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const e=ur(o,a);this.timer=self.setTimeout((()=>this.loadPlaylist()),e),this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${t}" in ${e}ms`)}e.levelRetry=!0,n.resolved=!0}return s}}class br{constructor(e,t=0,r=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}sample(e,t){const r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class Rr{constructor(e,t,r,n=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new br(e),this.fast_=new br(t),this.defaultTTFB_=n,this.ttfb_=new br(e)}update(e,t){const{slow_:r,fast_:n,ttfb_:i}=this;r.halfLife!==e&&(this.slow_=new br(e,r.getEstimate(),r.getTotalWeight())),n.halfLife!==t&&(this.fast_=new br(t,n.getEstimate(),n.getTotalWeight())),i.halfLife!==e&&(this.ttfb_=new br(e,i.getEstimate(),i.getTotalWeight()))}sample(e,t){const r=(e=Math.max(e,this.minDelayMs_))/1e3,n=8*t/r;this.fast_.sample(r,n),this.slow_.sample(r,n)}sampleTTFB(e){const t=e/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(r,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}const Ir={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]},wr={};function Cr(e,t,r,n,i,a){const o=e.audioCodec?e.audioGroups:null,s=null==a?void 0:a.audioCodec,l=null==a?void 0:a.channels,u=l?parseInt(l):s?1/0:2;let c=null;if(null!=o&&o.length)try{c=1===o.length&&o[0]?t.groups[o[0]].channels:o.reduce(((e,r)=>{if(r){const n=t.groups[r];if(!n)throw new Error(`Audio track group ${r} not found`);Object.keys(n.channels).forEach((t=>{e[t]=(e[t]||0)+n.channels[t]}))}return e}),{2:0})}catch(f){return!0}return void 0!==e.videoCodec&&(e.width>1920&&e.height>1088||e.height>1920&&e.width>1088||e.frameRate>Math.max(n,30)||"SDR"!==e.videoRange&&e.videoRange!==r||e.bitrate>Math.max(i,8e6))||!!c&&m(u)&&Object.keys(c).some((e=>parseInt(e)>u))}function Dr(e,t,r){const n=e.videoCodec,i=e.audioCodec;if(!n||!i||!r)return Promise.resolve(Ir);const a={width:e.width,height:e.height,bitrate:Math.ceil(Math.max(.9*e.bitrate,e.averageBitrate)),framerate:e.frameRate||30},o=e.videoRange;"SDR"!==o&&(a.transferFunction=o.toLowerCase());const s=n.split(",").map((e=>({type:"media-source",video:f(f({},a),{},{contentType:et(e,"video")})})));return i&&e.audioGroups&&e.audioGroups.forEach((e=>{var r;e&&(null==(r=t.groups[e])||r.tracks.forEach((t=>{if(t.groupId===e){const e=t.channels||"",r=parseFloat(e);m(r)&&r>2&&s.push.apply(s,i.split(",").map((e=>({type:"media-source",audio:{contentType:et(e,"audio"),channels:""+r}}))))}})))})),Promise.all(s.map((e=>{const t=function(e){const{audio:t,video:r}=e,n=r||t;if(n){const e=n.contentType.split('"')[1];if(r)return`r${r.height}x${r.width}f${Math.ceil(r.framerate)}${r.transferFunction||"sd"}_${e}_${Math.ceil(r.bitrate/1e5)}`;if(t)return`c${t.channels}${t.spatialRendering?"s":"n"}_${e}`}return""}(e);return wr[t]||(wr[t]=r.decodingInfo(e))}))).then((e=>({supported:!e.some((e=>!e.supported)),configurations:s,decodingInfoResults:e}))).catch((e=>({supported:!1,configurations:s,decodingInfoResults:[],error:e})))}function Lr(e,t){let r=!1,n=[];return e&&(r="SDR"!==e,n=[e]),t&&(n=t.allowedVideoRanges||qt.slice(0),r=void 0!==t.preferHDR?t.preferHDR:function(){if("function"==typeof matchMedia){const e=matchMedia("(dynamic-range: high)"),t=matchMedia("bad query");if(e.media!==t.media)return!0===e.matches}return!1}(),n=r?n.filter((e=>"SDR"!==e)):["SDR"]),{preferHDR:r,allowedVideoRanges:n}}function Nr(e,t){R.log(`[abr] start candidates with "${e}" ignored because ${t}`)}function Or(e,t,r){if("attrs"in e){const r=t.indexOf(e);if(-1!==r)return r}for(let n=0;n<t.length;n++){if(Mr(e,t[n],r))return n}return-1}function Mr(e,t,r){const{groupId:n,name:i,lang:a,assocLang:o,characteristics:s,default:l}=e,u=e.forced;return(void 0===n||t.groupId===n)&&(void 0===i||t.name===i)&&(void 0===a||t.lang===a)&&(void 0===a||t.assocLang===o)&&(void 0===l||t.default===l)&&(void 0===u||t.forced===u)&&(void 0===s||function(e,t=""){const r=e.split(","),n=t.split(",");return r.length===n.length&&!r.some((e=>-1===n.indexOf(e)))}(s,t.characteristics))&&(void 0===r||r(e,t))}function Pr(e,t){const{audioCodec:r,channels:n}=e;return!(void 0!==r&&(t.audioCodec||"").substring(0,4)!==r.substring(0,4)||void 0!==n&&n!==(t.channels||"2"))}function kr(e,t,r){for(let n=t;n;n--)if(r(e[n]))return n;for(let n=t+1;n<e.length;n++)if(r(e[n]))return n;return-1}class xr{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)}clearNextTick(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)}tick(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}var Fr="NOT_LOADED",Ur="APPENDING",Br="PARTIAL",Zr="OK";class Gr{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(E.BUFFER_APPENDED,this.onBufferAppended,this),e.on(E.FRAG_BUFFERED,this.onFragBuffered,this),e.on(E.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off(E.BUFFER_APPENDED,this.onBufferAppended,this),e.off(E.FRAG_BUFFERED,this.onFragBuffered,this),e.off(E.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const r=this.activePartLists[t];if(r)for(let n=r.length;n--;){const t=r[n];if(!t)break;const i=t.end;if(t.start<=e&&null!==i&&e<=i)return t}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){const{fragments:r}=this,n=Object.keys(r);for(let i=n.length;i--;){const a=r[n[i]];if((null==a?void 0:a.body.type)===t&&a.buffered){const t=a.body;if(t.start<=e&&e<=t.end)return t}}return null}detectEvictedFragments(e,t,r,n){this.timeRanges&&(this.timeRanges[e]=t);const i=(null==n?void 0:n.fragment.sn)||-1;Object.keys(this.fragments).forEach((n=>{const a=this.fragments[n];if(!a)return;if(i>=a.body.sn)return;if(!a.buffered&&!a.loaded)return void(a.body.type===r&&this.removeFragment(a.body));const o=a.range[e];o&&o.time.some((e=>{const r=!this.isTimeBuffered(e.startPTS,e.endPTS,t);return r&&this.removeFragment(a.body),r}))}))}detectPartialFragments(e){const t=this.timeRanges,{frag:r,part:n}=e;if(!t||"initSegment"===r.sn)return;const i=Kr(r),a=this.fragments[i];if(!a||a.buffered&&r.gap)return;const o=!r.relurl;if(Object.keys(t).forEach((e=>{const i=r.elementaryStreams[e];if(!i)return;const s=t[e],l=o||!0===i.partial;a.range[e]=this.getBufferedTimes(r,n,l,s)})),a.loaded=null,Object.keys(a.range).length){a.buffered=!0;(a.body.endList=r.endList||a.body.endList)&&(this.endListFragments[a.body.type]=a),Hr(a)||this.removeParts(r.sn-1,r.type)}else this.removeFragment(a.body)}removeParts(e,t){const r=this.activePartLists[t];r&&(this.activePartLists[t]=r.filter((t=>t.fragment.sn>=e)))}fragBuffered(e,t){const r=Kr(e);let n=this.fragments[r];!n&&t&&(n=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),n&&(n.loaded=null,n.buffered=!0)}getBufferedTimes(e,t,r,n){const i={time:[],partial:r},a=e.start,o=e.end,s=e.minEndPTS||o,l=e.maxStartPTS||a;for(let u=0;u<n.length;u++){const e=n.start(u)-this.bufferPadding,t=n.end(u)+this.bufferPadding;if(l>=e&&s<=t){i.time.push({startPTS:Math.max(a,n.start(u)),endPTS:Math.min(o,n.end(u))});break}if(a<t&&o>e){const e=Math.max(a,n.start(u)),t=Math.min(o,n.end(u));t>e&&(i.partial=!0,i.time.push({startPTS:e,endPTS:t}))}else if(o<=e)break}return i}getPartialFragment(e){let t,r,n,i=null,a=0;const{bufferPadding:o,fragments:s}=this;return Object.keys(s).forEach((l=>{const u=s[l];u&&Hr(u)&&(r=u.body.start-o,n=u.body.end+o,e>=r&&e<=n&&(t=Math.min(e-r,n-e),a<=t&&(i=u.body,a=t)))})),i}isEndListAppended(e){const t=this.endListFragments[e];return void 0!==t&&(t.buffered||Hr(t))}getState(e){const t=Kr(e),r=this.fragments[t];return r?r.buffered?Hr(r)?Br:Zr:Ur:Fr}isTimeBuffered(e,t,r){let n,i;for(let a=0;a<r.length;a++){if(n=r.start(a)-this.bufferPadding,i=r.end(a)+this.bufferPadding,e>=n&&t<=i)return!0;if(t<=n)return!1}return!1}onFragLoaded(e,t){const{frag:r,part:n}=t;if("initSegment"===r.sn||r.bitrateTest)return;const i=n?null:t,a=Kr(r);this.fragments[a]={body:r,appendedPTS:null,loaded:i,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:r,part:n,timeRanges:i}=t;if("initSegment"===r.sn)return;const a=r.type;if(n){let e=this.activePartLists[a];e||(this.activePartLists[a]=e=[]),e.push(n)}this.timeRanges=i,Object.keys(i).forEach((e=>{const t=i[e];this.detectEvictedFragments(e,t,a,n)}))}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Kr(e);return!!this.fragments[t]}hasParts(e){var t;return!(null==(t=this.activePartLists[e])||!t.length)}removeFragmentsInRange(e,t,r,n,i){n&&!this.hasGaps||Object.keys(this.fragments).forEach((a=>{const o=this.fragments[a];if(!o)return;const s=o.body;s.type!==r||n&&!s.gap||s.start<t&&s.end>e&&(o.buffered||i)&&this.removeFragment(s)}))}removeFragment(e){const t=Kr(e);e.stats.loaded=0,e.clearElementaryStreamInfo();const r=this.activePartLists[e.type];if(r){const t=e.sn;this.activePartLists[e.type]=r.filter((e=>e.fragment.sn!==t))}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function Hr(e){var t,r,n;return e.buffered&&(e.body.gap||(null==(t=e.range.video)?void 0:t.partial)||(null==(r=e.range.audio)?void 0:r.partial)||(null==(n=e.range.audiovideo)?void 0:n.partial))}function Kr(e){return`${e.type}_${e.level}_${e.sn}`}const Yr={length:0,start:()=>0,end:()=>0};class qr{static isBuffered(e,t){try{if(e){const r=qr.getBuffered(e);for(let e=0;e<r.length;e++)if(t>=r.start(e)&&t<=r.end(e))return!0}}catch(r){}return!1}static bufferInfo(e,t,r){try{if(e){const n=qr.getBuffered(e),i=[];let a;for(a=0;a<n.length;a++)i.push({start:n.start(a),end:n.end(a)});return this.bufferedInfo(i,t,r)}}catch(n){}return{len:0,start:t,end:t,nextStart:void 0}}static bufferedInfo(e,t,r){t=Math.max(0,t),e.sort((function(e,t){const r=e.start-t.start;return r||t.end-e.end}));let n=[];if(r)for(let l=0;l<e.length;l++){const t=n.length;if(t){const i=n[t-1].end;e[l].start-i<r?e[l].end>i&&(n[t-1].end=e[l].end):n.push(e[l])}else n.push(e[l])}else n=e;let i,a=0,o=t,s=t;for(let l=0;l<n.length;l++){const e=n[l].start,u=n[l].end;if(t+r>=e&&t<u)o=e,s=u,a=s-t;else if(t+r<e){i=e;break}}return{len:a,start:o||0,end:s||0,nextStart:i}}static getBuffered(e){try{return e.buffered}catch(t){return R.log("failed to get media.buffered",t),Yr}}}class Vr{constructor(e,t,r,n=0,i=-1,a=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=e,this.sn=t,this.id=r,this.size=n,this.part=i,this.partial=a}}function jr(e,t){for(let n=0,i=e.length;n<i;n++){var r;if((null==(r=e[n])?void 0:r.cc)===t)return e[n]}return null}function $r(e,t){if(e){const r=e.start+t;e.start=e.startPTS=r,e.endPTS=r+e.duration}}function zr(e,t){const r=t.fragments;for(let n=0,i=r.length;n<i;n++)$r(r[n],e);t.fragmentHint&&$r(t.fragmentHint,e),t.alignedSliding=!0}function Wr(e,t,r){t&&(!function(e,t,r){if(function(e,t,r){return!(!t||!(r.endCC>r.startCC||e&&e.cc<r.startCC))}(e,r,t)){const e=function(e,t){const r=e.fragments,n=t.fragments;if(!n.length||!r.length)return void R.log("No fragments to align");const i=jr(r,n[0].cc);if(i&&(!i||i.startPTS))return i;R.log("No frag in previous level to align on")}(r,t);e&&m(e.start)&&(R.log(`Adjusting PTS using last level due to CC increase within current level ${t.url}`),zr(e.start,t))}}(e,r,t),!r.alignedSliding&&t&&Xr(r,t),r.alignedSliding||!t||r.skippedSegments||rr(t,r))}function Xr(e,t){if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;const r=e.fragments,n=t.fragments;if(!r.length||!n.length)return;let i,a;const o=Math.min(t.endCC,e.endCC);t.startCC<o&&e.startCC<o&&(i=jr(n,o),a=jr(r,o)),i&&a||(i=n[Math.floor(n.length/2)],a=jr(r,i.cc)||r[Math.floor(r.length/2)]);const s=i.programDateTime,l=a.programDateTime;if(!s||!l)return;zr((l-s)/1e3-(a.start-i.start),e)}const Qr=Math.pow(2,17);class Jr{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const r=e.url;if(!r)return Promise.reject(new rn({type:v.NETWORK_ERROR,details:T.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error("Fragment does not have a "+(r?"part list":"url")),networkDetails:null}));this.abort();const n=this.config,i=n.fLoader,a=n.loader;return new Promise(((o,s)=>{if(this.loader&&this.loader.destroy(),e.gap){if(e.tagList.some((e=>"GAP"===e[0])))return void s(tn(e));e.gap=!1}const l=this.loader=e.loader=i?new i(n):new a(n),u=en(e),c=cr(n.fragLoadPolicy.default),d={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===e.sn?1/0:Qr};e.stats=l.stats,l.load(u,d,{onSuccess:(t,r,n,i)=>{this.resetLoader(e,l);let a=t.data;n.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(a.slice(0,16)),a=a.slice(16)),o({frag:e,part:null,payload:a,networkDetails:i})},onError:(t,n,i,a)=>{this.resetLoader(e,l),s(new rn({type:v.NETWORK_ERROR,details:T.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:f({url:r,data:void 0},t),error:new Error(`HTTP Error ${t.code} ${t.text}`),networkDetails:i,stats:a}))},onAbort:(t,r,n)=>{this.resetLoader(e,l),s(new rn({type:v.NETWORK_ERROR,details:T.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:n,stats:t}))},onTimeout:(t,r,n)=>{this.resetLoader(e,l),s(new rn({type:v.NETWORK_ERROR,details:T.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${d.timeout}ms`),networkDetails:n,stats:t}))},onProgress:(r,n,i,a)=>{t&&t({frag:e,part:null,payload:i,networkDetails:a})}})}))}loadPart(e,t,r){this.abort();const n=this.config,i=n.fLoader,a=n.loader;return new Promise(((o,s)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap)return void s(tn(e,t));const l=this.loader=e.loader=i?new i(n):new a(n),u=en(e,t),c=cr(n.fragLoadPolicy.default),d={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Qr};t.stats=l.stats,l.load(u,d,{onSuccess:(n,i,a,s)=>{this.resetLoader(e,l),this.updateStatsFromPart(e,t);const u={frag:e,part:t,payload:n.data,networkDetails:s};r(u),o(u)},onError:(r,n,i,a)=>{this.resetLoader(e,l),s(new rn({type:v.NETWORK_ERROR,details:T.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:f({url:u.url,data:void 0},r),error:new Error(`HTTP Error ${r.code} ${r.text}`),networkDetails:i,stats:a}))},onAbort:(r,n,i)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,l),s(new rn({type:v.NETWORK_ERROR,details:T.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:i,stats:r}))},onTimeout:(r,n,i)=>{this.resetLoader(e,l),s(new rn({type:v.NETWORK_ERROR,details:T.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${d.timeout}ms`),networkDetails:i,stats:r}))}})}))}updateStatsFromPart(e,t){const r=e.stats,n=t.stats,i=n.total;if(r.loaded+=n.loaded,i){const n=Math.round(e.duration/t.duration),a=Math.min(Math.round(r.loaded/i),n),o=(n-a)*Math.round(r.loaded/a);r.total=r.loaded+o}else r.total=Math.max(r.loaded,r.total);const a=r.loading,o=n.loading;a.start?a.first+=o.first-o.start:(a.start=o.start,a.first=o.first),a.end=o.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function en(e,t=null){const r=t||e,n={frag:e,part:t,responseType:"arraybuffer",url:r.url,headers:{},rangeStart:0,rangeEnd:0},i=r.byteRangeStartOffset,a=r.byteRangeEndOffset;if(m(i)&&m(a)){var o;let t=i,r=a;if("initSegment"===e.sn&&"AES-128"===(null==(o=e.decryptdata)?void 0:o.method)){const e=a-i;e%16&&(r=a+(16-e%16)),0!==i&&(n.resetIV=!0,t=i-16)}n.rangeStart=t,n.rangeEnd=r}return n}function tn(e,t){const r=new Error(`GAP ${e.gap?"tag":"attribute"} found`),n={type:v.MEDIA_ERROR,details:T.FRAG_GAP,fatal:!1,frag:e,error:r,networkDetails:null};return t&&(n.part=t),(t||e).stats.aborted=!0,new rn(n)}class rn extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class nn{constructor(e,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=t}decrypt(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}}class an{constructor(e,t){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=t}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}class on{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),r=new Uint32Array(4);for(let n=0;n<4;n++)r[n]=t.getUint32(4*n);return r}initTable(){const e=this.sBox,t=this.invSBox,r=this.subMix,n=r[0],i=r[1],a=r[2],o=r[3],s=this.invSubMix,l=s[0],u=s[1],c=s[2],f=s[3],d=new Uint32Array(256);let h=0,g=0,m=0;for(m=0;m<256;m++)d[m]=m<128?m<<1:m<<1^283;for(m=0;m<256;m++){let r=g^g<<1^g<<2^g<<3^g<<4;r=r>>>8^255&r^99,e[h]=r,t[r]=h;const s=d[h],m=d[s],p=d[m];let y=257*d[r]^16843008*r;n[h]=y<<24|y>>>8,i[h]=y<<16|y>>>16,a[h]=y<<8|y>>>24,o[h]=y,y=16843009*p^65537*m^257*s^16843008*h,l[r]=y<<24|y>>>8,u[r]=y<<16|y>>>16,c[r]=y<<8|y>>>24,f[r]=y,h?(h=s^d[d[d[p^s]]],g^=d[d[g]]):h=g=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let r=!0,n=0;for(;n<t.length&&r;)r=t[n]===this.key[n],n++;if(r)return;this.key=t;const i=this.keySize=t.length;if(4!==i&&6!==i&&8!==i)throw new Error("Invalid aes key size="+i);const a=this.ksRows=4*(i+6+1);let o,s;const l=this.keySchedule=new Uint32Array(a),u=this.invKeySchedule=new Uint32Array(a),c=this.sBox,f=this.rcon,d=this.invSubMix,h=d[0],g=d[1],m=d[2],p=d[3];let y,E;for(o=0;o<a;o++)o<i?y=l[o]=t[o]:(E=y,o%i==0?(E=E<<8|E>>>24,E=c[E>>>24]<<24|c[E>>>16&255]<<16|c[E>>>8&255]<<8|c[255&E],E^=f[o/i|0]<<24):i>6&&o%i==4&&(E=c[E>>>24]<<24|c[E>>>16&255]<<16|c[E>>>8&255]<<8|c[255&E]),l[o]=y=(l[o-i]^E)>>>0);for(s=0;s<a;s++)o=a-s,E=3&s?l[o]:l[o-4],u[s]=s<4||o<=4?E:h[c[E>>>24]]^g[c[E>>>16&255]]^m[c[E>>>8&255]]^p[c[255&E]],u[s]=u[s]>>>0}networkToHostOrderSwap(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}decrypt(e,t,r){const n=this.keySize+6,i=this.invKeySchedule,a=this.invSBox,o=this.invSubMix,s=o[0],l=o[1],u=o[2],c=o[3],f=this.uint8ArrayToUint32Array_(r);let d=f[0],h=f[1],g=f[2],m=f[3];const p=new Int32Array(e),y=new Int32Array(p.length);let E,v,T,_,S,A,b,R,I,w,C,D,L,N;const O=this.networkToHostOrderSwap;for(;t<p.length;){for(I=O(p[t]),w=O(p[t+1]),C=O(p[t+2]),D=O(p[t+3]),S=I^i[0],A=D^i[1],b=C^i[2],R=w^i[3],L=4,N=1;N<n;N++)E=s[S>>>24]^l[A>>16&255]^u[b>>8&255]^c[255&R]^i[L],v=s[A>>>24]^l[b>>16&255]^u[R>>8&255]^c[255&S]^i[L+1],T=s[b>>>24]^l[R>>16&255]^u[S>>8&255]^c[255&A]^i[L+2],_=s[R>>>24]^l[S>>16&255]^u[A>>8&255]^c[255&b]^i[L+3],S=E,A=v,b=T,R=_,L+=4;E=a[S>>>24]<<24^a[A>>16&255]<<16^a[b>>8&255]<<8^a[255&R]^i[L],v=a[A>>>24]<<24^a[b>>16&255]<<16^a[R>>8&255]<<8^a[255&S]^i[L+1],T=a[b>>>24]<<24^a[R>>16&255]<<16^a[S>>8&255]<<8^a[255&A]^i[L+2],_=a[R>>>24]<<24^a[S>>16&255]<<16^a[A>>8&255]<<8^a[255&b]^i[L+3],y[t]=O(E^d),y[t+1]=O(_^h),y[t+2]=O(T^g),y[t+3]=O(v^m),d=I,h=w,g=C,m=D,t+=4}return y.buffer}}class sn{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const e=self.crypto;e&&(this.subtle=e.subtle||e.webkitSubtle)}catch(r){}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const r=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?function(e){const t=e.byteLength,r=t&&new DataView(e.buffer).getUint8(t-1);return r?ee(e,0,t-r):e}(r):r}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,r){return this.useSoftware?new Promise(((n,i)=>{this.softwareDecrypt(new Uint8Array(e),t,r);const a=this.flush();a?n(a.buffer):i(new Error("[softwareDecrypt] Failed to decrypt data"))})):this.webCryptoDecrypt(new Uint8Array(e),t,r)}softwareDecrypt(e,t,r){const{currentIV:n,currentResult:i,remainderData:a}=this;this.logOnce("JS AES decrypt"),a&&(e=xe(a,e),this.remainderData=null);const o=this.getValidChunk(e);if(!o.length)return null;n&&(r=n);let s=this.softwareDecrypter;s||(s=this.softwareDecrypter=new on),s.expandKey(t);const l=i;return this.currentResult=s.decrypt(o.buffer,0,r),this.currentIV=ee(o,-16).buffer,l||null}webCryptoDecrypt(e,t,r){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,r));this.key=t,this.fastAesKey=new an(this.subtle,t)}return this.fastAesKey.expandKey().then((t=>{if(!this.subtle)return Promise.reject(new Error("web crypto not initialized"));this.logOnce("WebCrypto AES decrypt");return new nn(this.subtle,new Uint8Array(r)).decrypt(e.buffer,t)})).catch((n=>(R.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${n.name}: ${n.message}`),this.onWebCryptoError(e,t,r))))}onWebCryptoError(e,t,r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r);const n=this.flush();if(n)return n.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(e){let t=e;const r=e.length-e.length%16;return r!==e.length&&(t=ee(e,0,r),this.remainderData=ee(e,r)),t}logOnce(e){this.logEnabled&&(R.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const ln=function(e){let t="";const r=e.length;for(let n=0;n<r;n++)t+=`[${e.start(n).toFixed(3)}-${e.end(n).toFixed(3)}]`;return t},un="STOPPED",cn="IDLE",fn="KEY_LOADING",dn="FRAG_LOADING",hn="FRAG_LOADING_WAITING_RETRY",gn="WAITING_TRACK",mn="PARSING",pn="PARSED",yn="ENDED",En="ERROR",vn="WAITING_INIT_PTS",Tn="WAITING_LEVEL";class _n extends xr{constructor(e,t,r,n,i){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=un,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=i,this.logPrefix=n,this.log=R.log.bind(R,`${n}:`),this.warn=R.warn.bind(R,`${n}:`),this.hls=e,this.fragmentLoader=new Jr(e.config),this.keyLoader=r,this.fragmentTracker=t,this.config=e.config,this.decrypter=new sn(e.config),e.on(E.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;null!=e&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=un}_streamEnded(e,t){if(t.live||e.nextStart||!e.end||!this.media)return!1;const r=t.partList;if(null!=r&&r.length){const e=r[r.length-1];return qr.isBuffered(this.media,e.start+e.duration/2)}const n=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(n)}getLevelDetails(){var e;if(this.levels&&null!==this.levelLastLoaded)return null==(e=this.levelLastLoaded)?void 0:e.details}onMediaAttached(e,t){const r=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),r.addEventListener("seeking",this.onvseeking),r.addEventListener("ended",this.onvended);const n=this.config;this.levels&&n.autoStartLoad&&this.state===un&&this.startLoad(n.startPosition)}onMediaDetaching(){const e=this.media;null!=e&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&this.onvseeking&&this.onvended&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){const{config:e,fragCurrent:t,media:r,mediaBuffer:n,state:i}=this,a=r?r.currentTime:0,o=qr.bufferInfo(n||r,a,e.maxBufferHole);if(this.log(`media seeking to ${m(a)?a.toFixed(3):a}, state: ${i}`),this.state===yn)this.resetLoadingState();else if(t){const r=e.maxFragLookUpTolerance,n=t.start-r,i=t.start+t.duration+r;if(!o.len||i<o.start||n>o.end){const e=a>i;(a<n||e)&&(e&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}r&&(this.fragmentTracker.removeFragmentsInRange(a,1/0,this.playlistType,!0),this.lastCurrentTime=a),this.loadedmetadata||o.len||(this.nextLoadPosition=this.startPosition=a),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.hls.off(E.MANIFEST_LOADED,this.onManifestLoaded,this),this.stopLoad(),super.onHandlerDestroying(),this.hls=null}onHandlerDestroyed(){this.state=un,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,r){this._loadFragForPlayback(e,t,r)}_loadFragForPlayback(e,t,r){this._doFragLoad(e,t,r,(t=>{if(this.fragContextChanged(e))return this.warn(`Fragment ${e.sn}${t.part?" p: "+t.part.index:""} of level ${e.level} was dropped during download.`),void this.fragmentTracker.removeFragment(e);e.stats.chunkCount++,this._handleFragmentLoadProgress(t)})).then((t=>{if(!t)return;const r=this.state;this.fragContextChanged(e)?(r===dn||!this.fragCurrent&&r===mn)&&(this.fragmentTracker.removeFragment(e),this.state=cn):("payload"in t&&(this.log(`Loaded fragment ${e.sn} of level ${e.level}`),this.hls.trigger(E.FRAG_LOADED,t)),this._handleFragmentLoadComplete(t))})).catch((t=>{this.state!==un&&this.state!==En&&(this.warn(`Frag error: ${(null==t?void 0:t.message)||t}`),this.resetFragmentLoading(e))}))}clearTrackerIfNeeded(e){var t;const{fragmentTracker:r}=this;if(r.getState(e)===Ur){const t=e.type,n=this.getFwdBufferInfo(this.mediaBuffer,t),i=Math.max(e.duration,n?n.len:this.config.maxBufferLength),a=this.backtrackFragment;(1===(a?e.sn-a.sn:0)||this.reduceMaxBufferLength(i))&&r.removeFragment(e)}else 0===(null==(t=this.mediaBuffer)?void 0:t.buffered.length)?r.removeAllFragments():r.hasParts(e.type)&&(r.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),r.getState(e)===Br&&r.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}flushMainBuffer(e,t,r=null){if(!(e-t))return;const n={startOffset:e,endOffset:t,type:r};this.hls.trigger(E.BUFFER_FLUSHING,n)}_loadInitSegment(e,t){this._doFragLoad(e,t).then((t=>{if(!t||this.fragContextChanged(e)||!this.levels)throw new Error("init load aborted");return t})).then((t=>{const{hls:r}=this,{payload:n}=t,i=e.decryptdata;if(n&&n.byteLength>0&&null!=i&&i.key&&i.iv&&"AES-128"===i.method){const a=self.performance.now();return this.decrypter.decrypt(new Uint8Array(n),i.key.buffer,i.iv.buffer).catch((t=>{throw r.trigger(E.ERROR,{type:v.MEDIA_ERROR,details:T.FRAG_DECRYPT_ERROR,fatal:!1,error:t,reason:t.message,frag:e}),t})).then((n=>{const i=self.performance.now();return r.trigger(E.FRAG_DECRYPTED,{frag:e,payload:n,stats:{tstart:a,tdecrypt:i}}),t.payload=n,this.completeInitSegmentLoad(t)}))}return this.completeInitSegmentLoad(t)})).catch((t=>{this.state!==un&&this.state!==En&&(this.warn(t),this.resetFragmentLoading(e))}))}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const r=e.frag.stats;this.state=cn,e.frag.data=new Uint8Array(e.payload),r.parsing.start=r.buffering.start=self.performance.now(),r.parsing.end=r.buffering.end=self.performance.now(),this.tick()}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){var r,n,i,a;const o=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.playlistType===bt?"level":"track"} ${e.level} (frag:[${(null!=(r=e.startPTS)?r:NaN).toFixed(3)}-${(null!=(n=e.endPTS)?n:NaN).toFixed(3)}] > buffer:${o?ln(qr.getBuffered(o)):"(detached)"})`),"initSegment"!==e.sn){var s;if(e.type!==It){const t=e.elementaryStreams;if(!Object.keys(t).some((e=>!!t[e])))return void(this.state=cn)}const t=null==(s=this.levels)?void 0:s[e.level];null!=t&&t.fragmentError&&(this.log(`Resetting level fragment error count of ${t.fragmentError} on frag buffered`),t.fragmentError=0)}this.state=cn,o&&(!this.loadedmetadata&&e.type==bt&&o.buffered.length&&(null==(i=this.fragCurrent)?void 0:i.sn)===(null==(a=this.fragPrevious)?void 0:a.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:r,part:n,partsLoaded:i}=e,a=!i||0===i.length||i.some((e=>!e)),o=new Vr(r.level,r.sn,r.stats.chunkCount+1,0,n?n.index:-1,!a);t.flush(o)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,r=null,n){var i;const a=null==t?void 0:t.details;if(!this.levels||!a)throw new Error(`frag load aborted, missing level${a?"":" detail"}s`);let o=null;if(!e.encrypted||null!=(i=e.decryptdata)&&i.key?!e.encrypted&&a.encryptedFragments.length&&this.keyLoader.loadClear(e,a.encryptedFragments):(this.log(`Loading key for ${e.sn} of [${a.startSN}-${a.endSN}], ${"[stream-controller]"===this.logPrefix?"level":"track"} ${e.level}`),this.state=fn,this.fragCurrent=e,o=this.keyLoader.load(e).then((e=>{if(!this.fragContextChanged(e.frag))return this.hls.trigger(E.KEY_LOADED,e),this.state===fn&&(this.state=cn),e})),this.hls.trigger(E.KEY_LOADING,{frag:e}),null===this.fragCurrent&&(o=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))),r=Math.max(e.start,r||0),this.config.lowLatencyMode&&"initSegment"!==e.sn){const i=a.partList;if(i&&n){r>e.end&&a.fragmentHint&&(e=a.fragmentHint);const s=this.getNextPart(i,e,r);if(s>-1){const l=i[s];let u;return this.log(`Loading part sn: ${e.sn} p: ${l.index} cc: ${e.cc} of playlist [${a.startSN}-${a.endSN}] parts [0-${s}-${i.length-1}] ${"[stream-controller]"===this.logPrefix?"level":"track"}: ${e.level}, target: ${parseFloat(r.toFixed(3))}`),this.nextLoadPosition=l.start+l.duration,this.state=dn,u=o?o.then((r=>!r||this.fragContextChanged(r.frag)?null:this.doFragPartsLoad(e,l,t,n))).catch((e=>this.handleFragLoadError(e))):this.doFragPartsLoad(e,l,t,n).catch((e=>this.handleFragLoadError(e))),this.hls.trigger(E.FRAG_LOADING,{frag:e,part:l,targetBufferTime:r}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):u}if(!e.url||this.loadedEndOfParts(i,r))return Promise.resolve(null)}}this.log(`Loading fragment ${e.sn} cc: ${e.cc} ${a?"of ["+a.startSN+"-"+a.endSN+"] ":""}${"[stream-controller]"===this.logPrefix?"level":"track"}: ${e.level}, target: ${parseFloat(r.toFixed(3))}`),m(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=dn;const s=this.config.progressive;let l;return l=s&&o?o.then((t=>!t||this.fragContextChanged(null==t?void 0:t.frag)?null:this.fragmentLoader.load(e,n))).catch((e=>this.handleFragLoadError(e))):Promise.all([this.fragmentLoader.load(e,s?n:void 0),o]).then((([e])=>(!s&&e&&n&&n(e),e))).catch((e=>this.handleFragLoadError(e))),this.hls.trigger(E.FRAG_LOADING,{frag:e,targetBufferTime:r}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):l}doFragPartsLoad(e,t,r,n){return new Promise(((i,a)=>{var o;const s=[],l=null==(o=r.details)?void 0:o.partList,u=t=>{this.fragmentLoader.loadPart(e,t,n).then((n=>{s[t.index]=n;const a=n.part;this.hls.trigger(E.FRAG_LOADED,n);const o=ir(r,e.sn,t.index+1)||ar(l,e.sn,t.index+1);if(!o)return i({frag:e,part:a,partsLoaded:s});u(o)})).catch(a)};u(t)}))}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===T.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(E.ERROR,t)}else this.hls.trigger(E.ERROR,{type:v.OTHER_ERROR,details:T.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==mn)return void(this.fragCurrent||this.state===un||this.state===En||(this.state=cn));const{frag:r,part:n,level:i}=t,a=self.performance.now();r.stats.parsing.end=a,n&&(n.stats.parsing.end=a),this.updateLevelTiming(r,n,i,e.partial)}getCurrentContext(e){const{levels:t,fragCurrent:r}=this,{level:n,sn:i,part:a}=e;if(null==t||!t[n])return this.warn(`Levels object was unset while buffering fragment ${i} of level ${n}. The current chunk will not be buffered.`),null;const o=t[n],s=a>-1?ir(o,i,a):null,l=s?s.fragment:function(e,t,r){if(null==e||!e.details)return null;const n=e.details;let i=n.fragments[t-n.startSN];return i||(i=n.fragmentHint,i&&i.sn===t?i:t<n.startSN&&r&&r.sn===t?r:null)}(o,i,r);return l?(r&&r!==l&&(l.stats=r.stats),{frag:l,part:s,level:o}):null}bufferFragmentData(e,t,r,n,i){var a;if(!e||this.state!==mn)return;const{data1:o,data2:s}=e;let l=o;if(o&&s&&(l=xe(o,s)),null==(a=l)||!a.length)return;const u={type:e.type,frag:t,part:r,chunkMeta:n,parent:t.type,data:l};if(this.hls.trigger(E.BUFFER_APPENDING,u),e.dropped&&e.independent&&!r){if(i)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!qr.isBuffered(t,t.currentTime))return void this.flushMainBuffer(0,e.start);const r=t.currentTime,n=qr.bufferInfo(t,r,0),i=e.duration,a=Math.min(2*this.config.maxFragLookUpTolerance,.25*i),o=Math.max(Math.min(e.start-a,n.end-a),r+a);e.start-o>a&&this.flushMainBuffer(o,e.start)}getFwdBufferInfo(e,t){const r=this.getLoadPosition();return m(r)?this.getFwdBufferInfoAtPos(e,r,t):null}getFwdBufferInfoAtPos(e,t,r){const{config:{maxBufferHole:n}}=this,i=qr.bufferInfo(e,t,n);if(0===i.len&&void 0!==i.nextStart){const a=this.fragmentTracker.getBufferedFrag(t,r);if(a&&i.nextStart<a.end)return qr.bufferInfo(e,t,Math.max(i.nextStart,n))}return i}getMaxBufferLength(e){const{config:t}=this;let r;return r=e?Math.max(8*t.maxBufferSize/e,t.maxBufferLength):t.maxBufferLength,Math.min(r,t.maxMaxBufferLength)}reduceMaxBufferLength(e){const t=this.config,r=e||t.maxBufferLength,n=t.maxMaxBufferLength/2;return n>=r&&(t.maxMaxBufferLength=n,this.warn(`Reduce max buffer length to ${n}s`),!0)}getAppendedFrag(e,t=bt){const r=this.fragmentTracker.getAppendedFrag(e,bt);return r&&"fragment"in r?r.fragment:r}getNextFragment(e,t){const r=t.fragments,n=r.length;if(!n)return null;const{config:i}=this,a=r[0].start;let o;if(t.live){const s=i.initialLiveManifestSize;if(n<s)return this.warn(`Not enough fragments to start playback (have: ${n}, need: ${s})`),null;(!t.PTSKnown&&!this.startFragRequested&&-1===this.startPosition||e<a)&&(o=this.getInitialLiveFragment(t,r),this.startPosition=this.nextLoadPosition=o?this.hls.liveSyncPosition||o.start:e)}else e<=a&&(o=r[0]);if(!o){const r=i.lowLatencyMode?t.partEnd:t.fragmentEnd;o=this.getFragmentAtPosition(e,r,t)}return this.mapToInitFragWhenRequired(o)}isLoopLoading(e,t){const r=this.fragmentTracker.getState(e);return(r===Zr||r===Br&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,r,n,i){const a=e.gap,o=this.getNextFragment(this.nextLoadPosition,t);if(null===o)return o;if(e=o,a&&e&&!e.gap&&r.nextStart){const t=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,r.nextStart,n);if(null!==t&&r.len+t.len>=i)return this.log(`buffer full after gaps in "${n}" playlist starting at sn: ${e.sn}`),null}return e}mapToInitFragWhenRequired(e){return null==e||!e.initSegment||null!=e&&e.initSegment.data||this.bitrateTest?e:e.initSegment}getNextPart(e,t,r){let n=-1,i=!1,a=!0;for(let o=0,s=e.length;o<s;o++){const s=e[o];if(a=a&&!s.independent,n>-1&&r<s.start)break;const l=s.loaded;l?n=-1:(i||s.independent||a)&&s.fragment===t&&(n=o),i=l}return n}loadedEndOfParts(e,t){const r=e[e.length-1];return r&&t>r.start&&r.loaded}getInitialLiveFragment(e,t){const r=this.fragPrevious;let n=null;if(r){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${r.programDateTime}`),n=function(e,t,r){if(null===t||!Array.isArray(e)||!e.length||!m(t))return null;if(t<(e[0].programDateTime||0))return null;if(t>=(e[e.length-1].endProgramDateTime||0))return null;r=r||0;for(let n=0;n<e.length;++n){const i=e[n];if(mr(t,r,i))return i}return null}(t,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!n){const i=r.sn+1;if(i>=e.startSN&&i<=e.endSN){const a=t[i-e.startSN];r.cc===a.cc&&(n=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${n.sn}`))}n||(n=function(e,t){return dr(e,(e=>e.cc<t?1:e.cc>t?-1:0))}(t,r.cc),n&&this.log(`Live playlist, switching playlist, load frag with same CC: ${n.sn}`))}}else{const t=this.hls.liveSyncPosition;null!==t&&(n=this.getFragmentAtPosition(t,this.bitrateTest?e.fragmentEnd:e.edge,e))}return n}getFragmentAtPosition(e,t,r){const{config:n}=this;let{fragPrevious:i}=this,{fragments:a,endSN:o}=r;const{fragmentHint:s}=r,{maxFragLookUpTolerance:l}=n,u=r.partList,c=!!(n.lowLatencyMode&&null!=u&&u.length&&s);let f;if(c&&s&&!this.bitrateTest&&(a=a.concat(s),o=s.sn),e<t){f=hr(i,a,e,e>t-l?0:l)}else f=a[a.length-1];if(f){const e=f.sn-r.startSN,t=this.fragmentTracker.getState(f);if((t===Zr||t===Br&&f.gap)&&(i=f),i&&f.sn===i.sn&&(!c||u[0].fragment.sn>f.sn)){if(i&&f.level===i.level){const t=a[e+1];f=f.sn<o&&this.fragmentTracker.getState(t)!==Zr?t:null}}}return f}synchronizeToLiveEdge(e){const{config:t,media:r}=this;if(!r)return;const n=this.hls.liveSyncPosition,i=r.currentTime,a=e.fragments[0].start,o=e.edge,s=i>=a-t.maxFragLookUpTolerance&&i<=o;if(null!==n&&r.duration>n&&(i<n||!s)){const a=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!s&&r.readyState<4||i<o-a)&&(this.loadedmetadata||(this.nextLoadPosition=n),r.readyState&&(this.warn(`Playback: ${i.toFixed(3)} is located too far from the end of live sliding playlist: ${o}, reset currentTime to : ${n.toFixed(3)}`),r.currentTime=n))}}alignPlaylists(e,t,r){const n=e.fragments.length;if(!n)return this.warn("No fragments in live playlist"),0;const i=e.fragments[0].start,a=!t,o=e.alignedSliding&&m(i);if(a||!o&&!i){const{fragPrevious:i}=this;Wr(i,r,e);const a=e.fragments[0].start;return this.log(`Live playlist sliding: ${a.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} prev-sn: ${i?i.sn:"na"} fragments: ${n}`),a}return i}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)}setStartPosition(e,t){let r=this.startPosition;if(r<t&&(r=-1),-1===r||-1===this.lastCurrentTime){const n=null!==this.startTimeOffset,i=n?this.startTimeOffset:e.startTimeOffset;null!==i&&m(i)?(r=t+i,i<0&&(r+=e.totalduration),r=Math.min(Math.max(t,r),t+e.totalduration),this.log(`Start time offset ${i} found in ${n?"multivariant":"media"} playlist, adjust startPosition to ${r}`),this.startPosition=r):e.live?r=this.hls.liveSyncPosition||t:this.startPosition=r=0,this.lastCurrentTime=r}this.nextLoadPosition=r}getLoadPosition(){const{media:e}=this;let t=0;return this.loadedmetadata&&e?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t}handleFragLoadAborted(e,t){this.transmuxer&&"initSegment"!==e.sn&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){this.fragCurrent&&(this.fragContextChanged(e)||this.state===hn)||(this.state=cn)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const e=this.getCurrentContext(t.chunkMeta);e&&(t.frag=e.frag)}const r=t.frag;if(!r||r.type!==e||!this.levels)return;var n;if(this.fragContextChanged(r))return void this.warn(`Frag load error must match current frag to retry ${r.url} > ${null==(n=this.fragCurrent)?void 0:n.url}`);const i=t.details===T.FRAG_GAP;i&&this.fragmentTracker.fragBuffered(r,!0);const a=t.errorAction,{action:o,retryCount:s=0,retryConfig:l}=a||{};if(a&&o===vr&&l){this.resetStartWhenNotLoaded(this.levelLastLoaded);const n=ur(l,s);this.warn(`Fragment ${r.sn} of ${e} ${r.level} errored with ${t.details}, retrying loading ${s+1}/${l.maxNumRetry} in ${n}ms`),a.resolved=!0,this.retryDate=self.performance.now()+n,this.state=hn}else if(l&&a){if(this.resetFragmentErrors(e),!(s<l.maxNumRetry))return void R.warn(`${t.details} reached or exceeded max retry (${s})`);i||o===Er||(a.resolved=!0)}else(null==a?void 0:a.action)===yr?this.state=Tn:this.state=En;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===mn||this.state===pn){const t=e.parent,r=this.getFwdBufferInfo(this.mediaBuffer,t),n=r&&r.len>.5;n&&this.reduceMaxBufferLength(r.len);const i=!n;return i&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${t} buffer`),e.frag&&(this.fragmentTracker.removeFragment(e.frag),this.nextLoadPosition=e.frag.start),this.resetLoadingState(),i}return!1}resetFragmentErrors(e){e===Rt&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==un&&(this.state=cn)}afterBufferFlushed(e,t,r){if(!e)return;const n=qr.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,n,r),this.state===yn&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=cn}resetStartWhenNotLoaded(e){if(!this.loadedmetadata){this.startFragRequested=!1;const t=e?e.details:null;null!=t&&t.live?(this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of level ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,r,n){var i;const a=r.details;if(!a)return void this.warn("level.details undefined");if(!Object.keys(e.elementaryStreams).reduce(((t,i)=>{const o=e.elementaryStreams[i];if(o){const s=o.endPTS-o.startPTS;if(s<=0)return this.warn(`Could not parse fragment ${e.sn} ${i} duration reliably (${s})`),t||!1;const l=n?0:er(a,e,o.startPTS,o.endPTS,o.startDTS,o.endDTS);return this.hls.trigger(E.LEVEL_PTS_UPDATED,{details:a,level:r,drift:l,type:i,frag:e,start:o.startPTS,end:o.endPTS}),!0}return t}),!1)&&null===(null==(i=this.transmuxer)?void 0:i.error)){const t=new Error(`Found no media in fragment ${e.sn} of level ${e.level} resetting transmuxer to fallback to playlist timing`);if(0===r.fragmentError&&(r.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)),this.warn(t.message),this.hls.trigger(E.ERROR,{type:v.MEDIA_ERROR,details:T.FRAG_PARSING_ERROR,fatal:!1,error:t,frag:e,reason:`Found no media in msn ${e.sn} of level "${r.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=pn,this.hls.trigger(E.FRAG_PARSED,{frag:e,part:t})}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(e){"demuxerWorker"===e.event&&(this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}class Sn{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let r;return e.length?(r=1===e.length?e[0]:function(e,t){const r=new Uint8Array(t);let n=0;for(let i=0;i<e.length;i++){const t=e[i];r.set(t,n),n+=t.length}return r}(e,t),this.reset(),r):new Uint8Array(0)}reset(){this.chunks.length=0,this.dataLength=0}}function An(e="",t=9e4){return{type:e,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}class bn{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,r,n){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,r){}demux(e,t){this.cachedData&&(e=xe(this.cachedData,e),this.cachedData=null);let r,n=ne(e,0),i=n?n.length:0;const a=this._audioTrack,o=this._id3Track,s=n?oe(n):void 0,l=e.length;for((null===this.basePTS||0===this.frameIndex&&m(s))&&(this.basePTS=Rn(s,t,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),n&&n.length>0&&o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:kt,duration:Number.POSITIVE_INFINITY});i<l;){if(this.canParse(e,i)){const t=this.appendFrame(a,e,i);t?(this.frameIndex++,this.lastPTS=t.sample.pts,i+=t.length,r=i):i=l}else ae(e,i)?(n=ne(e,i),o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:kt,duration:Number.POSITIVE_INFINITY}),i+=n.length,r=i):i++;if(i===l&&r!==l){const t=ee(e,r);this.cachedData?this.cachedData=xe(this.cachedData,t):this.cachedData=t}}return{audioTrack:a,videoTrack:An(),id3Track:o,textTrack:An()}}demuxSampleAes(e,t,r){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:An(),id3Track:this._id3Track,textTrack:An()}}destroy(){}}const Rn=(e,t,r)=>{if(m(e))return 90*e;return 9e4*t+(r?9e4*r.baseTime/r.timescale:0)};function In(e,t){return 255===e[t]&&240==(246&e[t+1])}function wn(e,t){return 1&e[t+1]?7:9}function Cn(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function Dn(e,t){return t+1<e.length&&In(e,t)}function Ln(e,t){if(Dn(e,t)){const r=wn(e,t);if(t+r>=e.length)return!1;const n=Cn(e,t);if(n<=r)return!1;const i=t+n;return i===e.length||Dn(e,i)}return!1}function Nn(e,t,r,n,i){if(!e.samplerate){const a=function(e,t,r,n){let i,a,o,s;const l=navigator.userAgent.toLowerCase(),u=n,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];i=1+((192&t[r+2])>>>6);const f=(60&t[r+2])>>>2;if(!(f>c.length-1))return o=(1&t[r+2])<<2,o|=(192&t[r+3])>>>6,R.log(`manifest codec:${n}, ADTS type:${i}, samplingIndex:${f}`),/firefox/i.test(l)?f>=6?(i=5,s=new Array(4),a=f-3):(i=2,s=new Array(2),a=f):-1!==l.indexOf("android")?(i=2,s=new Array(2),a=f):(i=5,s=new Array(4),n&&(-1!==n.indexOf("mp4a.40.29")||-1!==n.indexOf("mp4a.40.5"))||!n&&f>=6?a=f-3:((n&&-1!==n.indexOf("mp4a.40.2")&&(f>=6&&1===o||/vivaldi/i.test(l))||!n&&1===o)&&(i=2,s=new Array(2)),a=f)),s[0]=i<<3,s[0]|=(14&f)>>1,s[1]|=(1&f)<<7,s[1]|=o<<3,5===i&&(s[1]|=(14&a)>>1,s[2]=(1&a)<<7,s[2]|=8,s[3]=0),{config:s,samplerate:c[f],channelCount:o,codec:"mp4a.40."+i,manifestCodec:u};{const t=new Error(`invalid ADTS sampling index:${f}`);e.emit(E.ERROR,E.ERROR,{type:v.MEDIA_ERROR,details:T.FRAG_PARSING_ERROR,fatal:!0,error:t,reason:t.message})}}(t,r,n,i);if(!a)return;e.config=a.config,e.samplerate=a.samplerate,e.channelCount=a.channelCount,e.codec=a.codec,e.manifestCodec=a.manifestCodec,R.log(`parsed codec:${e.codec}, rate:${a.samplerate}, channels:${a.channelCount}`)}}function On(e){return 9216e4/e}function Mn(e,t,r,n,i){const a=n+i*On(e.samplerate),o=function(e,t){const r=wn(e,t);if(t+r<=e.length){const n=Cn(e,t)-r;if(n>0)return{headerLength:r,frameLength:n}}}(t,r);let s;if(o){const{frameLength:n,headerLength:i}=o,l=i+n,u=Math.max(0,r+l-t.length);u?(s=new Uint8Array(l-i),s.set(t.subarray(r+i,t.length),0)):s=t.subarray(r+i,r+l);const c={unit:s,pts:a};return u||e.samples.push(c),{sample:c,length:l,missing:u}}const l=t.length-r;s=new Uint8Array(l),s.set(t.subarray(r,t.length),0);return{sample:{unit:s,pts:a},length:l,missing:-1}}let Pn=null;const kn=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],xn=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],Fn=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],Un=[0,1,1,4];function Bn(e,t,r,n,i){if(r+24>t.length)return;const a=Zn(t,r);if(a&&r+a.frameLength<=t.length){const o=n+i*(9e4*a.samplesPerFrame/a.sampleRate),s={unit:t.subarray(r,r+a.frameLength),pts:o,dts:o};return e.config=[],e.channelCount=a.channelCount,e.samplerate=a.sampleRate,e.samples.push(s),{sample:s,length:a.frameLength,missing:0}}}function Zn(e,t){const r=e[t+1]>>3&3,n=e[t+1]>>1&3,i=e[t+2]>>4&15,a=e[t+2]>>2&3;if(1!==r&&0!==i&&15!==i&&3!==a){const o=e[t+2]>>1&1,s=e[t+3]>>6,l=1e3*kn[14*(3===r?3-n:3===n?3:4)+i-1],u=xn[3*(3===r?0:2===r?1:2)+a],c=3===s?1:2,f=Fn[r][n],d=Un[n],h=8*f*d,g=Math.floor(f*l/u+o)*d;if(null===Pn){const e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Pn=e?parseInt(e[1]):0}return!!Pn&&Pn<=87&&2===n&&l>=224e3&&0===s&&(e[t+3]=128|e[t+3]),{sampleRate:u,channelCount:c,frameLength:g,samplesPerFrame:h}}}function Gn(e,t){return!(255!==e[t]||224&~e[t+1]||!(6&e[t+1]))}function Hn(e,t){return t+1<e.length&&Gn(e,t)}function Kn(e,t){if(t+1<e.length&&Gn(e,t)){const r=4,n=Zn(e,t);let i=r;null!=n&&n.frameLength&&(i=n.frameLength);const a=t+i;return a===e.length||Hn(e,a)}return!1}const Yn=/\/emsg[-/]ID3/i;const qn=(e,t)=>{let r=0,n=5;t+=n;const i=new Uint32Array(1),a=new Uint32Array(1),o=new Uint8Array(1);for(;n>0;){o[0]=e[t];const s=Math.min(n,8),l=8-s;a[0]=4278190080>>>24+l<<l,i[0]=(o[0]&a[0])>>l,r=r?r<<s|i[0]:i[0],t+=1,n-=s}return r};class Vn extends bn{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,r,n){super.resetInitSegment(e,t,r,n),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,r){const n=jn(e,t,r,this.basePTS,this.frameIndex);if(-1!==n){return{sample:e.samples[e.samples.length-1],length:n,missing:0}}}static probe(e){if(!e)return!1;const t=ne(e,0);if(!t)return!1;const r=t.length;return 11===e[r]&&119===e[r+1]&&void 0!==oe(t)&&qn(e,r)<16}}function jn(e,t,r,n,i){if(r+8>t.length)return-1;if(11!==t[r]||119!==t[r+1])return-1;const a=t[r+4]>>6;if(a>=3)return-1;const o=[48e3,44100,32e3][a],s=63&t[r+4],l=2*[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][3*s+a];if(r+l>t.length)return-1;const u=t[r+6]>>5;let c=0;2===u?c+=2:(1&u&&1!==u&&(c+=2),4&u&&(c+=2));const f=(t[r+6]<<8|t[r+7])>>12-c&1,d=[2,1,2,3,3,4,4,5][u]+f,h=t[r+5]>>3,g=7&t[r+5],m=new Uint8Array([a<<6|h<<1|g>>2,(3&g)<<6|u<<3|f<<2|s>>4,s<<4&224]),p=n+i*(1536/o*9e4),y=t.subarray(r,r+l);return e.config=m,e.channelCount=d,e.samplerate=o,e.samples.push({unit:y,pts:p}),l}class $n{constructor(){this.VideoSample=null}createVideoSample(e,t,r,n){return{key:e,frame:!1,pts:t,dts:r,units:[],debug:n,length:0}}getLastNalUnit(e){var t;let r,n=this.VideoSample;if(n&&0!==n.units.length||(n=e[e.length-1]),null!=(t=n)&&t.units){const e=n.units;r=e[e.length-1]}return r}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(void 0===e.pts){const r=t.samples,n=r.length;if(!n)return void t.dropped++;{const t=r[n-1];e.pts=t.pts,e.dts=t.dts}}t.samples.push(e)}e.debug.length&&R.log(e.pts+"/"+e.dts+":"+e.debug)}}class zn{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,r=e.byteLength-t,n=new Uint8Array(4),i=Math.min(4,t);if(0===i)throw new Error("no bytes available");n.set(e.subarray(r,r+i)),this.word=new DataView(n.buffer).getUint32(0),this.bitsAvailable=8*i,this.bytesAvailable-=i}skipBits(e){let t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(t=(e-=this.bitsAvailable)>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const r=this.word>>>32-t;if(e>32&&R.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return t=e-t,t>0&&this.bitsAvailable?r<<t|this.readBits(t):r}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return 1===this.readBits(1)}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(e){let t,r=8,n=8;for(let i=0;i<e;i++)0!==n&&(t=this.readEG(),n=(r+t+256)%256),r=0===n?r:n}readSPS(){let e,t,r,n=0,i=0,a=0,o=0;const s=this.readUByte.bind(this),l=this.readBits.bind(this),u=this.readUEG.bind(this),c=this.readBoolean.bind(this),f=this.skipBits.bind(this),d=this.skipEG.bind(this),h=this.skipUEG.bind(this),g=this.skipScalingList.bind(this);s();const m=s();if(l(5),f(3),s(),h(),100===m||110===m||122===m||244===m||44===m||83===m||86===m||118===m||128===m){const e=u();if(3===e&&f(1),h(),h(),f(1),c())for(t=3!==e?8:12,r=0;r<t;r++)c()&&g(r<6?16:64)}h();const p=u();if(0===p)u();else if(1===p)for(f(1),d(),d(),e=u(),r=0;r<e;r++)d();h(),f(1);const y=u(),E=u(),v=l(1);0===v&&f(1),f(1),c()&&(n=u(),i=u(),a=u(),o=u());let T=[1,1];if(c()&&c()){switch(s()){case 1:T=[1,1];break;case 2:T=[12,11];break;case 3:T=[10,11];break;case 4:T=[16,11];break;case 5:T=[40,33];break;case 6:T=[24,11];break;case 7:T=[20,11];break;case 8:T=[32,11];break;case 9:T=[80,33];break;case 10:T=[18,11];break;case 11:T=[15,11];break;case 12:T=[64,33];break;case 13:T=[160,99];break;case 14:T=[4,3];break;case 15:T=[3,2];break;case 16:T=[2,1];break;case 255:T=[s()<<8|s(),s()<<8|s()]}}return{width:Math.ceil(16*(y+1)-2*n-2*i),height:(2-v)*(E+1)*16-(v?2:4)*(a+o),pixelRatio:T}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class Wn extends $n{parseAVCPES(e,t,r,n,i){const a=this.parseAVCNALu(e,r.data);let o,s=this.VideoSample,l=!1;r.data=null,s&&a.length&&!e.audFound&&(this.pushAccessUnit(s,e),s=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts,"")),a.forEach((n=>{var a;switch(n.type){case 1:{let t=!1;o=!0;const i=n.data;if(l&&i.length>4){const e=new zn(i).readSliceType();2!==e&&4!==e&&7!==e&&9!==e||(t=!0)}var u;if(t)null!=(u=s)&&u.frame&&!s.key&&(this.pushAccessUnit(s,e),s=this.VideoSample=null);s||(s=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts,"")),s.frame=!0,s.key=t;break}case 5:o=!0,null!=(a=s)&&a.frame&&!s.key&&(this.pushAccessUnit(s,e),s=this.VideoSample=null),s||(s=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts,"")),s.key=!0,s.frame=!0;break;case 6:o=!0,Be(n.data,1,r.pts,t.samples);break;case 7:{var c,f;o=!0,l=!0;const t=n.data,r=new zn(t).readSPS();if(!e.sps||e.width!==r.width||e.height!==r.height||(null==(c=e.pixelRatio)?void 0:c[0])!==r.pixelRatio[0]||(null==(f=e.pixelRatio)?void 0:f[1])!==r.pixelRatio[1]){e.width=r.width,e.height=r.height,e.pixelRatio=r.pixelRatio,e.sps=[t],e.duration=i;const n=t.subarray(1,4);let a="avc1.";for(let e=0;e<3;e++){let t=n[e].toString(16);t.length<2&&(t="0"+t),a+=t}e.codec=a}break}case 8:o=!0,e.pps=[n.data];break;case 9:o=!0,e.audFound=!0,s&&this.pushAccessUnit(s,e),s=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts,"");break;case 12:o=!0;break;default:o=!1,s&&(s.debug+="unknown NAL "+n.type+" ")}if(s&&o){s.units.push(n)}})),n&&s&&(this.pushAccessUnit(s,e),this.VideoSample=null)}parseAVCNALu(e,t){const r=t.byteLength;let n=e.naluState||0;const i=n,a=[];let o,s,l,u=0,c=-1,f=0;for(-1===n&&(c=0,f=31&t[0],n=0,u=1);u<r;)if(o=t[u++],n)if(1!==n)if(o)if(1===o){if(s=u-n-1,c>=0){const e={data:t.subarray(c,s),type:f};a.push(e)}else{const r=this.getLastNalUnit(e.samples);r&&(i&&u<=4-i&&r.state&&(r.data=r.data.subarray(0,r.data.byteLength-i)),s>0&&(r.data=xe(r.data,t.subarray(0,s)),r.state=0))}u<r?(l=31&t[u],c=u,f=l,n=0):n=-1}else n=0;else n=3;else n=o?0:2;else n=o?0:1;if(c>=0&&n>=0){const e={data:t.subarray(c,r),type:f,state:n};a.push(e)}if(0===a.length){const r=this.getLastNalUnit(e.samples);r&&(r.data=xe(r.data,t))}return e.naluState=n,a}}class Xn{constructor(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new sn(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(e,t,r){const n=e[t].unit;if(n.length<=16)return;const i=n.subarray(16,n.length-n.length%16),a=i.buffer.slice(i.byteOffset,i.byteOffset+i.length);this.decryptBuffer(a).then((i=>{const a=new Uint8Array(i);n.set(a,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,r)}))}decryptAacSamples(e,t,r){for(;;t++){if(t>=e.length)return void r();if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,r),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=16*Math.floor((e.length-48)/160)+16,r=new Int8Array(t);let n=0;for(let i=32;i<e.length-16;i+=160,n+=16)r.set(e.subarray(i,i+16),n);return r}getAvcDecryptedUnit(e,t){const r=new Uint8Array(t);let n=0;for(let i=32;i<e.length-16;i+=160,n+=16)e.set(r.subarray(n,n+16),i);return e}decryptAvcSample(e,t,r,n,i){const a=Ze(i.data),o=this.getAvcEncryptedData(a);this.decryptBuffer(o.buffer).then((o=>{i.data=this.getAvcDecryptedUnit(a,o),this.decrypter.isSync()||this.decryptAvcSamples(e,t,r+1,n)}))}decryptAvcSamples(e,t,r,n){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length)return void n();const i=e[t].units;for(;!(r>=i.length);r++){const a=i[r];if(!(a.data.length<=48||1!==a.type&&5!==a.type||(this.decryptAvcSample(e,t,r,n,a),this.decrypter.isSync())))return}}}}const Qn=188;class Jn{constructor(e,t,r){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.videoParser=new Wn}static probe(e){const t=Jn.syncOffset(e);return t>0&&R.warn(`MPEG2-TS detected but first sync word found @ offset ${t}`),-1!==t}static syncOffset(e){const t=e.length;let r=Math.min(940,t-Qn)+1,n=0;for(;n<r;){let i=!1,a=-1,o=0;for(let s=n;s<t;s+=Qn){if(71!==e[s]||t-s!==Qn&&71!==e[s+Qn]){if(o)return-1;break}if(o++,-1===a&&(a=s,0!==a&&(r=Math.min(a+18612,e.length-Qn)+1)),i||(i=0===ei(e,s)),i&&o>1&&(0===a&&o>2||s+Qn>r))return a}n++}return-1}static createTrack(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:Te[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}}resetInitSegment(e,t,r,n){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Jn.createTrack("video"),this._audioTrack=Jn.createTrack("audio",n),this._id3Track=Jn.createTrack("id3"),this._txtTrack=Jn.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=r,this._duration=n}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:r}=this;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,r=!1,n=!1){let i;r||(this.sampleAes=null);const a=this._videoTrack,o=this._audioTrack,s=this._id3Track,l=this._txtTrack;let u=a.pid,c=a.pesData,f=o.pid,d=s.pid,h=o.pesData,g=s.pesData,m=null,p=this.pmtParsed,y=this._pmtId,E=e.length;if(this.remainderData&&(E=(e=xe(this.remainderData,e)).length,this.remainderData=null),E<Qn&&!n)return this.remainderData=e,{audioTrack:o,videoTrack:a,id3Track:s,textTrack:l};const v=Math.max(0,Jn.syncOffset(e));E-=(E-v)%Qn,E<e.byteLength&&!n&&(this.remainderData=new Uint8Array(e.buffer,E,e.buffer.byteLength-E));let T=0;for(let S=v;S<E;S+=Qn)if(71===e[S]){const t=!!(64&e[S+1]),n=ei(e,S);let E;if((48&e[S+3])>>4>1){if(E=S+5+e[S+4],E===S+Qn)continue}else E=S+4;switch(n){case u:t&&(c&&(i=ai(c))&&this.videoParser.parseAVCPES(a,l,i,!1,this._duration),c={data:[],size:0}),c&&(c.data.push(e.subarray(E,S+Qn)),c.size+=S+Qn-E);break;case f:if(t){if(h&&(i=ai(h)))switch(o.segmentCodec){case"aac":this.parseAACPES(o,i);break;case"mp3":this.parseMPEGPES(o,i);break;case"ac3":this.parseAC3PES(o,i)}h={data:[],size:0}}h&&(h.data.push(e.subarray(E,S+Qn)),h.size+=S+Qn-E);break;case d:t&&(g&&(i=ai(g))&&this.parseID3PES(s,i),g={data:[],size:0}),g&&(g.data.push(e.subarray(E,S+Qn)),g.size+=S+Qn-E);break;case 0:t&&(E+=e[E]+1),y=this._pmtId=ti(e,E);break;case y:{t&&(E+=e[E]+1);const n=ri(e,E,this.typeSupported,r,this.observer);u=n.videoPid,u>0&&(a.pid=u,a.segmentCodec=n.segmentVideoCodec),f=n.audioPid,f>0&&(o.pid=f,o.segmentCodec=n.segmentAudioCodec),d=n.id3Pid,d>0&&(s.pid=d),null===m||p||(R.warn(`MPEG-TS PMT found at ${S} after unknown PID '${m}'. Backtracking to sync byte @${v} to parse all TS packets.`),m=null,S=v-188),p=this.pmtParsed=!0;break}case 17:case 8191:break;default:m=n}}else T++;T>0&&ni(this.observer,new Error(`Found ${T} TS packet/s that do not start with 0x47`)),a.pesData=c,o.pesData=h,s.pesData=g;const _={audioTrack:o,videoTrack:a,id3Track:s,textTrack:l};return n&&this.extractRemainingSamples(_),_}flush(){const{remainderData:e}=this;let t;return this.remainderData=null,t=e?this.demux(e,-1,!1,!0):{videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:r,id3Track:n,textTrack:i}=e,a=r.pesData,o=t.pesData,s=n.pesData;let l;if(a&&(l=ai(a))?(this.videoParser.parseAVCPES(r,i,l,!0,this._duration),r.pesData=null):r.pesData=a,o&&(l=ai(o))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,l);break;case"mp3":this.parseMPEGPES(t,l);break;case"ac3":this.parseAC3PES(t,l)}t.pesData=null}else null!=o&&o.size&&R.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=o;s&&(l=ai(s))?(this.parseID3PES(n,l),n.pesData=null):n.pesData=s}demuxSampleAes(e,t,r){const n=this.demux(e,r,!0,!this.config.progressive),i=this.sampleAes=new Xn(this.observer,this.config,t);return this.decrypt(n,i)}decrypt(e,t){return new Promise((r=>{const{audioTrack:n,videoTrack:i}=e;n.samples&&"aac"===n.segmentCodec?t.decryptAacSamples(n.samples,0,(()=>{i.samples?t.decryptAvcSamples(i.samples,0,0,(()=>{r(e)})):r(e)})):i.samples&&t.decryptAvcSamples(i.samples,0,0,(()=>{r(e)}))}))}destroy(){this._duration=0}parseAACPES(e,t){let r=0;const n=this.aacOverFlow;let i,a,o,s=t.data;if(n){this.aacOverFlow=null;const t=n.missing,i=n.sample.unit.byteLength;if(-1===t)s=xe(n.sample.unit,s);else{const a=i-t;n.sample.unit.set(s.subarray(0,t),a),e.samples.push(n.sample),r=n.missing}}for(i=r,a=s.length;i<a-1&&!Dn(s,i);i++);if(i!==r){let e;const t=i<a-1;if(e=t?`AAC PES did not start with ADTS header,offset:${i}`:"No ADTS header found in AAC PES",ni(this.observer,new Error(e),t),!t)return}if(Nn(e,this.observer,s,i,this.audioCodec),void 0!==t.pts)o=t.pts;else{if(!n)return void R.warn("[tsdemuxer]: AAC PES unknown PTS");{const t=On(e.samplerate);o=n.sample.pts+t}}let l,u=0;for(;i<a;){if(l=Mn(e,s,i,o,u),i+=l.length,l.missing){this.aacOverFlow=l;break}for(u++;i<a-1&&!Dn(s,i);i++);}}parseMPEGPES(e,t){const r=t.data,n=r.length;let i=0,a=0;const o=t.pts;if(void 0!==o)for(;a<n;)if(Hn(r,a)){const t=Bn(e,r,a,o,i);if(!t)break;a+=t.length,i++}else a++;else R.warn("[tsdemuxer]: MPEG PES unknown PTS")}parseAC3PES(e,t){{const r=t.data,n=t.pts;if(void 0===n)return void R.warn("[tsdemuxer]: AC3 PES unknown PTS");const i=r.length;let a,o=0,s=0;for(;s<i&&(a=jn(e,r,s,n,o++))>0;)s+=a}}parseID3PES(e,t){if(void 0===t.pts)return void R.warn("[tsdemuxer]: ID3 PES unknown PTS");const r=g({},t,{type:this._videoTrack?Ft:kt,duration:Number.POSITIVE_INFINITY});e.samples.push(r)}}function ei(e,t){return((31&e[t+1])<<8)+e[t+2]}function ti(e,t){return(31&e[t+10])<<8|e[t+11]}function ri(e,t,r,n,i){const a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=t+3+((15&e[t+1])<<8|e[t+2])-4;for(t+=12+((15&e[t+10])<<8|e[t+11]);t<o;){const o=ei(e,t),s=(15&e[t+3])<<8|e[t+4];switch(e[t]){case 207:if(!n){ii("ADTS AAC");break}case 15:-1===a.audioPid&&(a.audioPid=o);break;case 21:-1===a.id3Pid&&(a.id3Pid=o);break;case 219:if(!n){ii("H.264");break}case 27:-1===a.videoPid&&(a.videoPid=o,a.segmentVideoCodec="avc");break;case 3:case 4:r.mpeg||r.mp3?-1===a.audioPid&&(a.audioPid=o,a.segmentAudioCodec="mp3"):R.log("MPEG audio found, not supported in this browser");break;case 193:if(!n){ii("AC-3");break}case 129:r.ac3?-1===a.audioPid&&(a.audioPid=o,a.segmentAudioCodec="ac3"):R.log("AC-3 audio found, not supported in this browser");break;case 6:if(-1===a.audioPid&&s>0){let n=t+5,i=s;for(;i>2;){if(106===e[n])!0!==r.ac3?R.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=o,a.segmentAudioCodec="ac3");const t=e[n+1]+2;n+=t,i-=t}}break;case 194:case 135:return ni(i,new Error("Unsupported EC-3 in M2TS found")),a;case 36:return ni(i,new Error("Unsupported HEVC in M2TS found")),a}t+=s+5}return a}function ni(e,t,r){R.warn(`parsing error: ${t.message}`),e.emit(E.ERROR,E.ERROR,{type:v.MEDIA_ERROR,details:T.FRAG_PARSING_ERROR,fatal:!1,levelRetry:r,error:t,reason:t.message})}function ii(e){R.log(`${e} with AES-128-CBC encryption found in unencrypted stream`)}function ai(e){let t,r,n,i,a,o=0;const s=e.data;if(!e||0===e.size)return null;for(;s[0].length<19&&s.length>1;)s[0]=xe(s[0],s[1]),s.splice(1,1);t=s[0];if(1===(t[0]<<16)+(t[1]<<8)+t[2]){if(r=(t[4]<<8)+t[5],r&&r>e.size-6)return null;const l=t[7];192&l&&(i=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,64&l?(a=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2,i-a>54e5&&(R.warn(`${Math.round((i-a)/9e4)}s delta between PTS and DTS, align them`),i=a)):a=i),n=t[8];let u=n+9;if(e.size<=u)return null;e.size-=u;const c=new Uint8Array(e.size);for(let e=0,r=s.length;e<r;e++){t=s[e];let r=t.byteLength;if(u){if(u>r){u-=r;continue}t=t.subarray(u),r-=u,u=0}c.set(t,o),o+=r}return r&&(r-=n+3),{data:c,pts:i,dts:a,len:r}}return null}class oi{static getSilentFrame(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}const si=Math.pow(2,32)-1;class li{static init(){let e;for(e in li.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},li.types)li.types.hasOwnProperty(e)&&(li.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);li.HDLR_TYPES={video:t,audio:r};const n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]);li.STTS=li.STSC=li.STCO=i,li.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),li.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),li.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),li.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),s=new Uint8Array([0,0,0,1]);li.FTYP=li.box(li.types.ftyp,a,s,a,o),li.DINF=li.box(li.types.dinf,li.box(li.types.dref,n))}static box(e,...t){let r=8,n=t.length;const i=n;for(;n--;)r+=t[n].byteLength;const a=new Uint8Array(r);for(a[0]=r>>24&255,a[1]=r>>16&255,a[2]=r>>8&255,a[3]=255&r,a.set(e,4),n=0,r=8;n<i;n++)a.set(t[n],r),r+=t[n].byteLength;return a}static hdlr(e){return li.box(li.types.hdlr,li.HDLR_TYPES[e])}static mdat(e){return li.box(li.types.mdat,e)}static mdhd(e,t){t*=e;const r=Math.floor(t/(si+1)),n=Math.floor(t%(si+1));return li.box(li.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,r>>24,r>>16&255,r>>8&255,255&r,n>>24,n>>16&255,n>>8&255,255&n,85,196,0,0]))}static mdia(e){return li.box(li.types.mdia,li.mdhd(e.timescale,e.duration),li.hdlr(e.type),li.minf(e))}static mfhd(e){return li.box(li.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))}static minf(e){return"audio"===e.type?li.box(li.types.minf,li.box(li.types.smhd,li.SMHD),li.DINF,li.stbl(e)):li.box(li.types.minf,li.box(li.types.vmhd,li.VMHD),li.DINF,li.stbl(e))}static moof(e,t,r){return li.box(li.types.moof,li.mfhd(e),li.traf(r,t))}static moov(e){let t=e.length;const r=[];for(;t--;)r[t]=li.trak(e[t]);return li.box.apply(null,[li.types.moov,li.mvhd(e[0].timescale,e[0].duration)].concat(r).concat(li.mvex(e)))}static mvex(e){let t=e.length;const r=[];for(;t--;)r[t]=li.trex(e[t]);return li.box.apply(null,[li.types.mvex,...r])}static mvhd(e,t){t*=e;const r=Math.floor(t/(si+1)),n=Math.floor(t%(si+1)),i=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,r>>24,r>>16&255,r>>8&255,255&r,n>>24,n>>16&255,n>>8&255,255&n,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return li.box(li.types.mvhd,i)}static sdtp(e){const t=e.samples||[],r=new Uint8Array(4+t.length);let n,i;for(n=0;n<t.length;n++)i=t[n].flags,r[n+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return li.box(li.types.sdtp,r)}static stbl(e){return li.box(li.types.stbl,li.stsd(e),li.box(li.types.stts,li.STTS),li.box(li.types.stsc,li.STSC),li.box(li.types.stsz,li.STSZ),li.box(li.types.stco,li.STCO))}static avc1(e){let t,r,n,i=[],a=[];for(t=0;t<e.sps.length;t++)r=e.sps[t],n=r.byteLength,i.push(n>>>8&255),i.push(255&n),i=i.concat(Array.prototype.slice.call(r));for(t=0;t<e.pps.length;t++)r=e.pps[t],n=r.byteLength,a.push(n>>>8&255),a.push(255&n),a=a.concat(Array.prototype.slice.call(r));const o=li.box(li.types.avcC,new Uint8Array([1,i[3],i[4],i[5],255,224|e.sps.length].concat(i).concat([e.pps.length]).concat(a))),s=e.width,l=e.height,u=e.pixelRatio[0],c=e.pixelRatio[1];return li.box(li.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,s>>8&255,255&s,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,li.box(li.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),li.box(li.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,c>>24,c>>16&255,c>>8&255,255&c])))}static esds(e){const t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}static audioStsd(e){const t=e.samplerate;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,255&t,0,0])}static mp4a(e){return li.box(li.types.mp4a,li.audioStsd(e),li.box(li.types.esds,li.esds(e)))}static mp3(e){return li.box(li.types[".mp3"],li.audioStsd(e))}static ac3(e){return li.box(li.types["ac-3"],li.audioStsd(e),li.box(li.types.dac3,e.config))}static stsd(e){return"audio"===e.type?"mp3"===e.segmentCodec&&"mp3"===e.codec?li.box(li.types.stsd,li.STSD,li.mp3(e)):"ac3"===e.segmentCodec?li.box(li.types.stsd,li.STSD,li.ac3(e)):li.box(li.types.stsd,li.STSD,li.mp4a(e)):li.box(li.types.stsd,li.STSD,li.avc1(e))}static tkhd(e){const t=e.id,r=e.duration*e.timescale,n=e.width,i=e.height,a=Math.floor(r/(si+1)),o=Math.floor(r%(si+1));return li.box(li.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,o>>24,o>>16&255,o>>8&255,255&o,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,255&n,0,0,i>>8&255,255&i,0,0]))}static traf(e,t){const r=li.sdtp(e),n=e.id,i=Math.floor(t/(si+1)),a=Math.floor(t%(si+1));return li.box(li.types.traf,li.box(li.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n])),li.box(li.types.tfdt,new Uint8Array([1,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,a>>24,a>>16&255,a>>8&255,255&a])),li.trun(e,r.length+16+20+8+16+8+8),r)}static trak(e){return e.duration=e.duration||4294967295,li.box(li.types.trak,li.tkhd(e),li.mdia(e))}static trex(e){const t=e.id;return li.box(li.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const r=e.samples||[],n=r.length,i=12+16*n,a=new Uint8Array(i);let o,s,l,u,c,f;for(t+=8+i,a.set(["video"===e.type?1:0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,255&n,t>>>24&255,t>>>16&255,t>>>8&255,255&t],0),o=0;o<n;o++)s=r[o],l=s.duration,u=s.size,c=s.flags,f=s.cts,a.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,u>>>24&255,u>>>16&255,u>>>8&255,255&u,c.isLeading<<2|c.dependsOn,c.isDependedOn<<6|c.hasRedundancy<<4|c.paddingValue<<1|c.isNonSync,61440&c.degradPrio,15&c.degradPrio,f>>>24&255,f>>>16&255,f>>>8&255,255&f],12+16*o);return li.box(li.types.trun,a)}static initSegment(e){li.types||li.init();const t=li.moov(e);return xe(li.FTYP,t)}}li.types=void 0,li.HDLR_TYPES=void 0,li.STTS=void 0,li.STSC=void 0,li.STCO=void 0,li.STSZ=void 0,li.VMHD=void 0,li.SMHD=void 0,li.STSD=void 0,li.FTYP=void 0,li.DINF=void 0;const ui=9e4;function ci(e,t,r=1,n=!1){const i=e*t*r;return n?Math.round(i):i}function fi(e,t=!1){return ci(e,1e3,1/ui,t)}let di,hi=null,gi=null;class mi{constructor(e,t,r,n=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.ISGenerated=!1,null===hi){const e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);hi=e?parseInt(e[1]):0}if(null===gi){const e=navigator.userAgent.match(/Safari\/(\d+)/i);gi=e?parseInt(e[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){R.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){R.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){R.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const r=e.reduce(((e,r)=>{const n=r.pts-e;return n<-4294967296?(t=!0,pi(e,r.pts)):n>0?e:r.pts}),e[0].pts);return t&&R.debug("PTS rollover detected"),r}remux(e,t,r,n,i,a,o,s){let l,u,c,f,d,h,g=i,m=i;const p=e.pid>-1,y=t.pid>-1,E=t.samples.length,v=e.samples.length>0,T=o&&E>0||E>1;if((!p||v)&&(!y||T)||this.ISGenerated||o){if(this.ISGenerated){var _,S,A,b;const e=this.videoTrackConfig;!e||t.width===e.width&&t.height===e.height&&(null==(_=t.pixelRatio)?void 0:_[0])===(null==(S=e.pixelRatio)?void 0:S[0])&&(null==(A=t.pixelRatio)?void 0:A[1])===(null==(b=e.pixelRatio)?void 0:b[1])||this.resetInitSegment()}else c=this.generateIS(e,t,i,a);const r=this.isVideoContiguous;let n,o=-1;if(T&&(o=function(e){for(let t=0;t<e.length;t++)if(e[t].key)return t;return-1}(t.samples),!r&&this.config.forceKeyFrameOnDiscontinuity))if(h=!0,o>0){R.warn(`[mp4-remuxer]: Dropped ${o} out of ${E} video samples due to a missing keyframe`);const e=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(o),t.dropped+=o,m+=(t.samples[0].pts-e)/t.inputTimeScale,n=m}else-1===o&&(R.warn(`[mp4-remuxer]: No keyframe found out of ${E} video samples`),h=!1);if(this.ISGenerated){if(v&&T){const r=this.getVideoStartPts(t.samples),n=(pi(e.samples[0].pts,r)-r)/t.inputTimeScale;g+=Math.max(0,n),m+=Math.max(0,-n)}if(v){if(e.samplerate||(R.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),c=this.generateIS(e,t,i,a)),u=this.remuxAudio(e,g,this.isAudioContiguous,a,y||T||s===Rt?m:void 0),T){const n=u?u.endPTS-u.startPTS:0;t.inputTimeScale||(R.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),c=this.generateIS(e,t,i,a)),l=this.remuxVideo(t,m,r,n)}}else T&&(l=this.remuxVideo(t,m,r,0));l&&(l.firstKeyFrame=o,l.independent=-1!==o,l.firstKeyFramePTS=n)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(d=yi(r,i,this._initPTS,this._initDTS)),n.samples.length&&(f=Ei(n,i,this._initPTS))),{audio:u,video:l,initSegment:c,independent:h,text:f,id3:d}}generateIS(e,t,r,n){const i=e.samples,a=t.samples,o=this.typeSupported,s={},l=this._initPTS;let u,c,f,d=!l||n,h="audio/mp4";if(d&&(u=c=1/0),e.config&&i.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":o.mpeg?(h="audio/mpeg",e.codec=""):o.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3"}s.audio={id:"audio",container:h,codec:e.codec,initSegment:"mp3"===e.segmentCodec&&o.mpeg?new Uint8Array(0):li.initSegment([e]),metadata:{channelCount:e.channelCount}},d&&(f=e.inputTimeScale,l&&f===l.timescale?d=!1:u=c=i[0].pts-Math.round(f*r))}if(t.sps&&t.pps&&a.length){if(t.timescale=t.inputTimeScale,s.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:li.initSegment([t]),metadata:{width:t.width,height:t.height}},d)if(f=t.inputTimeScale,l&&f===l.timescale)d=!1;else{const e=this.getVideoStartPts(a),t=Math.round(f*r);c=Math.min(c,pi(a[0].dts,e)-t),u=Math.min(u,e-t)}this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(s).length)return this.ISGenerated=!0,d?(this._initPTS={baseTime:u,timescale:f},this._initDTS={baseTime:c,timescale:f}):u=f=void 0,{tracks:s,initPTS:u,timescale:f}}remuxVideo(e,t,r,n){const i=e.inputTimeScale,a=e.samples,o=[],s=a.length,l=this._initPTS;let u,c,f=this.nextAvcDts,d=8,h=this.videoSampleDuration,m=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,y=!1;if(!r||null===f){const e=t*i,n=a[0].pts-pi(a[0].dts,a[0].pts);hi&&null!==f&&Math.abs(e-n-f)<15e3?r=!0:f=e-n}const _=l.baseTime*i/l.timescale;for(let g=0;g<s;g++){const e=a[g];e.pts=pi(e.pts-_,f),e.dts=pi(e.dts-_,f),e.dts<a[g>0?g-1:g].dts&&(y=!0)}y&&a.sort((function(e,t){const r=e.dts-t.dts,n=e.pts-t.pts;return r||n})),u=a[0].dts,c=a[a.length-1].dts;const S=c-u,A=S?Math.round(S/(s-1)):h||e.inputTimeScale/30;if(r){const e=u-f,r=e>A,n=e<-1;if((r||n)&&(r?R.warn(`AVC: ${fi(e,!0)} ms (${e}dts) hole between fragments detected at ${t.toFixed(3)}`):R.warn(`AVC: ${fi(-e,!0)} ms (${e}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!n||f>=a[0].pts||hi)){u=f;const t=a[0].pts-e;if(r)a[0].dts=u,a[0].pts=t;else for(let r=0;r<a.length&&!(a[r].dts>t);r++)a[r].dts-=e,a[r].pts-=e;R.log(`Video: Initial PTS/DTS adjusted: ${fi(t,!0)}/${fi(u,!0)}, delta: ${fi(e,!0)} ms`)}}u=Math.max(0,u);let b=0,I=0,w=u;for(let g=0;g<s;g++){const e=a[g],t=e.units,r=t.length;let n=0;for(let i=0;i<r;i++)n+=t[i].data.length;I+=n,b+=r,e.length=n,e.dts<w?(e.dts=w,w+=A/4|0||1):w=e.dts,m=Math.min(e.pts,m),p=Math.max(e.pts,p)}c=a[s-1].dts;const C=I+4*b+8;let D;try{D=new Uint8Array(C)}catch(F){return void this.observer.emit(E.ERROR,E.ERROR,{type:v.MUX_ERROR,details:T.REMUX_ALLOC_ERROR,fatal:!1,error:F,bytes:C,reason:`fail allocating video mdat ${C}`})}const L=new DataView(D.buffer);L.setUint32(0,C),D.set(li.types.mdat,4);let N=!1,O=Number.POSITIVE_INFINITY,M=Number.POSITIVE_INFINITY,P=Number.NEGATIVE_INFINITY,k=Number.NEGATIVE_INFINITY;for(let g=0;g<s;g++){const e=a[g],t=e.units;let r,l=0;for(let n=0,i=t.length;n<i;n++){const e=t[n],r=e.data,i=e.data.byteLength;L.setUint32(d,i),d+=4,D.set(r,d),d+=i,l+=4+i}if(g<s-1)h=a[g+1].dts-e.dts,r=a[g+1].pts-e.pts;else{const t=this.config,o=g>0?e.dts-a[g-1].dts:A;if(r=g>0?e.pts-a[g-1].pts:A,t.stretchShortVideoTrack&&null!==this.nextAudioPts){const r=Math.floor(t.maxBufferHole*i),a=(n?m+n*i:this.nextAudioPts)-e.pts;a>r?(h=a-o,h<0?h=o:N=!0,R.log(`[mp4-remuxer]: It is approximately ${a/90} ms to the next segment; using duration ${h/90} ms for the last video frame.`)):h=o}else h=o}const u=Math.round(e.pts-e.dts);O=Math.min(O,h),P=Math.max(P,h),M=Math.min(M,r),k=Math.max(k,r),o.push(new vi(e.key,h,l,u))}if(o.length)if(hi){if(hi<70){const e=o[0].flags;e.dependsOn=2,e.isNonSync=0}}else if(gi&&k-M<P-O&&A/P<.025&&0===o[0].cts){R.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let e=u;for(let t=0,r=o.length;t<r;t++){const n=e+o[t].duration,i=e+o[t].cts;if(t<r-1){const e=n+o[t+1].cts;o[t].duration=e-i}else o[t].duration=t?o[t-1].duration:A;o[t].cts=0,e=n}}h=N||!h?A:h,this.nextAvcDts=f=c+h,this.videoSampleDuration=h,this.isVideoContiguous=!0;const x={data1:li.moof(e.sequenceNumber++,u,g({},e,{samples:o})),data2:D,startPTS:m/i,endPTS:(p+h)/i,startDTS:u/i,endDTS:f/i,type:"video",hasAudio:!1,hasVideo:!0,nb:o.length,dropped:e.dropped};return e.samples=[],e.dropped=0,x}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return 1152;case"ac3":return 1536;default:return 1024}}remuxAudio(e,t,r,n,i){const a=e.inputTimeScale,o=a/(e.samplerate?e.samplerate:a),s=this.getSamplesPerFrame(e),l=s*o,u=this._initPTS,c="mp3"===e.segmentCodec&&this.typeSupported.mpeg,f=[],d=void 0!==i;let h=e.samples,m=c?0:8,p=this.nextAudioPts||-1;const y=t*a,_=u.baseTime*a/u.timescale;if(this.isAudioContiguous=r=r||h.length&&p>0&&(n&&Math.abs(y-p)<9e3||Math.abs(pi(h[0].pts-_,y)-p)<20*l),h.forEach((function(e){e.pts=pi(e.pts-_,y)})),!r||p<0){if(h=h.filter((e=>e.pts>=0)),!h.length)return;p=0===i?0:n&&!d?Math.max(0,y):h[0].pts}if("aac"===e.segmentCodec){const t=this.config.maxAudioFramesDrift;for(let r=0,n=p;r<h.length;r++){const i=h[r],o=i.pts,s=o-n,u=Math.abs(1e3*s/a);if(s<=-t*l&&d)0===r&&(R.warn(`Audio frame @ ${(o/a).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*s/a)} ms.`),this.nextAudioPts=p=n=o);else if(s>=t*l&&u<1e4&&d){let t=Math.round(s/l);n=o-t*l,n<0&&(t--,n+=l),0===r&&(this.nextAudioPts=p=n),R.warn(`[mp4-remuxer]: Injecting ${t} audio frame @ ${(n/a).toFixed(3)}s due to ${Math.round(1e3*s/a)} ms gap.`);for(let a=0;a<t;a++){const t=Math.max(n,0);let a=oi.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);a||(R.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),a=i.unit.subarray()),h.splice(r,0,{unit:a,pts:t}),n+=l,r++}}i.pts=n,n+=l}}let S,A=null,b=null,I=0,w=h.length;for(;w--;)I+=h[w].unit.byteLength;for(let g=0,R=h.length;g<R;g++){const t=h[g],n=t.unit;let i=t.pts;if(null!==b){f[g-1].duration=Math.round((i-b)/o)}else{if(r&&"aac"===e.segmentCodec&&(i=p),A=i,!(I>0))return;I+=m;try{S=new Uint8Array(I)}catch(P){return void this.observer.emit(E.ERROR,E.ERROR,{type:v.MUX_ERROR,details:T.REMUX_ALLOC_ERROR,fatal:!1,error:P,bytes:I,reason:`fail allocating audio mdat ${I}`})}if(!c){new DataView(S.buffer).setUint32(0,I),S.set(li.types.mdat,4)}}S.set(n,m);const a=n.byteLength;m+=a,f.push(new vi(!0,s,a,0)),b=i}const C=f.length;if(!C)return;const D=f[f.length-1];this.nextAudioPts=p=b+o*D.duration;const L=c?new Uint8Array(0):li.moof(e.sequenceNumber++,A/o,g({},e,{samples:f}));e.samples=[];const N=A/a,O=p/a,M={data1:L,data2:S,startPTS:N,endPTS:O,startDTS:N,endDTS:O,type:"audio",hasAudio:!0,hasVideo:!1,nb:C};return this.isAudioContiguous=!0,M}remuxEmptyAudio(e,t,r,n){const i=e.inputTimeScale,a=i/(e.samplerate?e.samplerate:i),o=this.nextAudioPts,s=this._initDTS,l=9e4*s.baseTime/s.timescale,u=(null!==o?o:n.startDTS*i)+l,c=n.endDTS*i+l,f=1024*a,d=Math.ceil((c-u)/f),h=oi.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(R.warn("[mp4-remuxer]: remux empty Audio"),!h)return void R.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");const g=[];for(let m=0;m<d;m++){const e=u+m*f;g.push({unit:h,pts:e,dts:e})}return e.samples=g,this.remuxAudio(e,t,r,!1)}}function pi(e,t){let r;if(null===t)return e;for(r=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=r;return e}function yi(e,t,r,n){const i=e.samples.length;if(!i)return;const a=e.inputTimeScale;for(let s=0;s<i;s++){const i=e.samples[s];i.pts=pi(i.pts-r.baseTime*a/r.timescale,t*a)/a,i.dts=pi(i.dts-n.baseTime*a/n.timescale,t*a)/a}const o=e.samples;return e.samples=[],{samples:o}}function Ei(e,t,r){const n=e.samples.length;if(!n)return;const i=e.inputTimeScale;for(let o=0;o<n;o++){const n=e.samples[o];n.pts=pi(n.pts-r.baseTime*i/r.timescale,t*i)/i}e.samples.sort(((e,t)=>e.pts-t.pts));const a=e.samples;return e.samples=[],{samples:a}}class vi{constructor(e,t,r,n){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=t,this.size=r,this.cts=n,this.flags={isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:e?2:1,isNonSync:e?0:1}}}function Ti(e,t){const r=null==e?void 0:e.codec;if(r&&r.length>4)return r;if(t===O){if("ec-3"===r||"ac-3"===r||"alac"===r)return r;if("fLaC"===r||"Opus"===r){return at(r,!1)}const e="mp4a.40.5";return R.info(`Parsed audio codec "${r}" or audio object type not handled. Using "${e}"`),e}return R.warn(`Unhandled video codec "${r}"`),"hvc1"===r||"hev1"===r?"hvc1.1.6.L120.90":"av01"===r?"av01.0.04M.08":"avc1.42e01e"}try{di=self.performance.now.bind(self.performance)}catch(jo){R.debug("Unable to use Performance API on this environment"),di=null==H?void 0:H.Date.now}const _i=[{demux:class{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,r,n){const i=this.videoTrack=An("video",1),a=this.audioTrack=An("audio",1),o=this.txtTrack=An("text",1);if(this.id3Track=An("id3",1),this.timeOffset=0,null==e||!e.byteLength)return;const s=De(e);if(s.video){const{id:e,timescale:t,codec:r}=s.video;i.id=e,i.timescale=o.timescale=t,i.codec=r}if(s.audio){const{id:e,timescale:t,codec:r}=s.audio;a.id=e,a.timescale=t,a.codec=r}o.id=Te.text,i.sampleDuration=0,i.duration=a.duration=n}resetContiguity(){this.remainderData=null}static probe(e){return function(e){const t=e.byteLength;for(let r=0;r<t;){const n=Ae(e,r);if(n>8&&109===e[r+4]&&111===e[r+5]&&111===e[r+6]&&102===e[r+7])return!0;r=n>1?r+n:t}return!1}(e)}demux(e,t){this.timeOffset=t;let r=e;const n=this.videoTrack,i=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=xe(this.remainderData,e));const t=function(e){const t={valid:null,remainder:null},r=we(e,["moof"]);if(r.length<2)return t.remainder=e,t;const n=r[r.length-1];return t.valid=ee(e,0,n.byteOffset-8),t.remainder=ee(e,n.byteOffset-8),t}(r);this.remainderData=t.remainder,n.samples=t.valid||new Uint8Array}else n.samples=r;const a=this.extractID3Track(n,t);return i.samples=Fe(t,n),{videoTrack:n,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const n=this.extractID3Track(t,this.timeOffset);return r.samples=Fe(e,t),{videoTrack:t,audioTrack:An(),id3Track:n,textTrack:An()}}extractID3Track(e,t){const r=this.id3Track;if(e.samples.length){const n=we(e.samples,["emsg"]);n&&n.forEach((e=>{const n=function(e){const t=e[0];let r="",n="",i=0,a=0,o=0,s=0,l=0,u=0;if(0===t){for(;"\0"!==_e(e.subarray(u,u+1));)r+=_e(e.subarray(u,u+1)),u+=1;for(r+=_e(e.subarray(u,u+1)),u+=1;"\0"!==_e(e.subarray(u,u+1));)n+=_e(e.subarray(u,u+1)),u+=1;n+=_e(e.subarray(u,u+1)),u+=1,i=Ae(e,12),a=Ae(e,16),s=Ae(e,20),l=Ae(e,24),u=28}else if(1===t){u+=4,i=Ae(e,u),u+=4;const t=Ae(e,u);u+=4;const a=Ae(e,u);for(u+=4,o=2**32*t+a,p(o)||(o=Number.MAX_SAFE_INTEGER,R.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),s=Ae(e,u),u+=4,l=Ae(e,u),u+=4;"\0"!==_e(e.subarray(u,u+1));)r+=_e(e.subarray(u,u+1)),u+=1;for(r+=_e(e.subarray(u,u+1)),u+=1;"\0"!==_e(e.subarray(u,u+1));)n+=_e(e.subarray(u,u+1)),u+=1;n+=_e(e.subarray(u,u+1)),u+=1}return{schemeIdUri:r,value:n,timeScale:i,presentationTime:o,presentationTimeDelta:a,eventDuration:s,id:l,payload:e.subarray(u,e.byteLength)}}(e);if(Yn.test(n.schemeIdUri)){const e=m(n.presentationTime)?n.presentationTime/n.timeScale:t+n.presentationTimeDelta/n.timeScale;let i=4294967295===n.eventDuration?Number.POSITIVE_INFINITY:n.eventDuration/n.timeScale;i<=.001&&(i=Number.POSITIVE_INFINITY);const a=n.payload;r.samples.push({data:a,len:a.byteLength,dts:e,pts:e,type:Ft,duration:i})}}))}return r}demuxSampleAes(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}},remux:class{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(e,t,r,n){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(function(e,t){if(!e||!t)return e;const r=t.keyId;r&&t.isCommonEncryption&&we(e,["moov","trak"]).forEach((e=>{const t=we(e,["mdia","minf","stbl","stsd"])[0].subarray(8);let n=we(t,["enca"]);const i=n.length>0;i||(n=we(t,["encv"])),n.forEach((e=>{we(i?e.subarray(28):e.subarray(78),["sinf"]).forEach((e=>{const t=Pe(e);if(t){const e=t.subarray(8,24);e.some((e=>0!==e))||(R.log(`[eme] Patching keyId in 'enc${i?"a":"v"}>sinf>>tenc' box: ${ye(e)} -> ${ye(r)}`),t.set(r,8))}}))}))}));return e}(e,n)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:r}=this;if(null==e||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);const n=this.initData=De(e);n.audio&&(t=Ti(n.audio,O)),n.video&&(r=Ti(n.video,M));const i={};n.audio&&n.video?i.audiovideo={container:"video/mp4",codec:t+","+r,initSegment:e,id:"main"}:n.audio?i.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:n.video?i.video={container:"video/mp4",codec:r,initSegment:e,id:"main"}:R.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=i}remux(e,t,r,n,i,a){var o,s;let{initPTS:l,lastEndTime:u}=this;const c={audio:void 0,video:void 0,text:n,id3:r,initSegment:void 0};m(u)||(u=this.lastEndTime=i||0);const f=t.samples;if(null==f||!f.length)return c;const d={initPTS:void 0,timescale:1};let h=this.initData;if(null!=(o=h)&&o.length||(this.generateInitSegment(f),h=this.initData),null==(s=h)||!s.length)return R.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),c;this.emitInitSegment&&(d.tracks=this.initTracks,this.emitInitSegment=!1);const g=function(e,t){let r=0,n=0,i=0;const a=we(e,["moof","traf"]);for(let o=0;o<a.length;o++){const e=a[o],s=we(e,["tfhd"])[0],l=t[Ae(s,4)];if(!l)continue;const u=l.default,c=Ae(s,0)|(null==u?void 0:u.flags);let f=null==u?void 0:u.duration;8&c&&(f=Ae(s,2&c?12:8));const d=l.timescale||9e4,h=we(e,["trun"]);for(let t=0;t<h.length;t++)r=ke(h[t]),!r&&f&&(r=f*Ae(h[t],4)),l.type===M?n+=r/d:l.type===O&&(i+=r/d)}if(0===n&&0===i){let t=1/0,r=0,n=0;const i=we(e,["sidx"]);for(let e=0;e<i.length;e++){const a=Ce(i[e]);if(null!=a&&a.references){t=Math.min(t,a.earliestPresentationTime/a.timescale);const e=a.references.reduce(((e,t)=>e+t.info.duration||0),0);r=Math.max(r,e+a.earliestPresentationTime/a.timescale),n=r-t}}if(n&&m(n))return n}return n||i}(f,h),p=function(e,t){return we(t,["moof","traf"]).reduce(((t,r)=>{const n=we(r,["tfdt"])[0],i=n[0],a=we(r,["tfhd"]).reduce(((t,r)=>{const a=Ae(r,4),o=e[a];if(o){let e=Ae(n,4);if(1===i){if(e===Ee)return R.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),t;e*=Ee+1,e+=Ae(n,8)}const r=e/(o.timescale||9e4);if(m(r)&&(null===t||r<t))return r}return t}),null);return null!==a&&m(a)&&(null===t||a<t)?a:t}),null)}(h,f),y=null===p?i:p;(function(e,t,r,n){if(null===e)return!0;const i=Math.max(n,1),a=t-e.baseTime/e.timescale;return Math.abs(a-r)>i}(l,y,i,g)||d.timescale!==l.timescale&&a)&&(d.initPTS=y-i,l&&1===l.timescale&&R.warn("Adjusting initPTS by "+(d.initPTS-l.baseTime)),this.initPTS=l={baseTime:d.initPTS,timescale:1});const E=e?y-l.baseTime/l.timescale:u,v=E+g;!function(e,t,r){we(t,["moof","traf"]).forEach((t=>{we(t,["tfhd"]).forEach((n=>{const i=Ae(n,4),a=e[i];if(!a)return;const o=a.timescale||9e4;we(t,["tfdt"]).forEach((e=>{const t=e[0],n=r*o;if(n){let r=Ae(e,4);if(0===t)r-=n,r=Math.max(r,0),Ie(e,4,r);else{r*=Math.pow(2,32),r+=Ae(e,8),r-=n,r=Math.max(r,0);const t=Math.floor(r/(Ee+1)),i=Math.floor(r%(Ee+1));Ie(e,4,t),Ie(e,8,i)}}}))}))}))}(h,f,l.baseTime/l.timescale),g>0?this.lastEndTime=v:(R.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const T=!!h.audio,_=!!h.video;let S="";T&&(S+="audio"),_&&(S+="video");const A={data1:f,startPTS:E,startDTS:E,endPTS:v,endDTS:v,type:S,hasAudio:T,hasVideo:_,nb:1,dropped:0};return c.audio="audio"===A.type?A:void 0,c.video="audio"!==A.type?A:void 0,c.initSegment=d,c.id3=yi(r,i,l,l),n.samples.length&&(c.text=Ei(n,i,l)),c}}},{demux:Jn,remux:mi},{demux:class extends bn{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,r,n){super.resetInitSegment(e,t,r,n),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=ne(e,0);let r=(null==t?void 0:t.length)||0;if(Kn(e,r))return!1;for(let n=e.length;r<n;r++)if(Ln(e,r))return R.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return function(e,t){return function(e,t){return t+5<e.length}(e,t)&&In(e,t)&&Cn(e,t)<=e.length-t}(e,t)}appendFrame(e,t,r){Nn(e,this.observer,t,r,e.manifestCodec);const n=Mn(e,t,r,this.basePTS,this.frameIndex);if(n&&0===n.missing)return n}},remux:mi},{demux:class extends bn{resetInitSegment(e,t,r,n){super.resetInitSegment(e,t,r,n),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=ne(e,0);let r=(null==t?void 0:t.length)||0;if(t&&11===e[r]&&119===e[r+1]&&void 0!==oe(t)&&qn(e,r)<=16)return!1;for(let n=e.length;r<n;r++)if(Kn(e,r))return R.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return function(e,t){return Gn(e,t)&&4<=e.length-t}(e,t)}appendFrame(e,t,r){if(null!==this.basePTS)return Bn(e,t,r,this.basePTS,this.frameIndex)}},remux:mi}];_i.splice(2,0,{demux:Vn,remux:mi});class Si{constructor(e,t,r,n,i){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=r,this.vendor=n,this.id=i}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,r,n){const i=r.transmuxing;i.executeStart=di();let a=new Uint8Array(e);const{currentTransmuxState:o,transmuxConfig:s}=this;n&&(this.currentTransmuxState=n);const{contiguous:l,discontinuity:u,trackSwitch:c,accurateTimeOffset:f,timeOffset:d,initSegmentChange:h}=n||o,{audioCodec:g,videoCodec:m,defaultInitPts:p,duration:y,initSegmentData:_}=s,S=function(e,t){let r=null;e.byteLength>0&&null!=(null==t?void 0:t.key)&&null!==t.iv&&null!=t.method&&(r=t);return r}(a,t);if(S&&"AES-128"===S.method){const e=this.getDecrypter();if(!e.isSync())return this.decryptionPromise=e.webCryptoDecrypt(a,S.key.buffer,S.iv.buffer).then((e=>{const t=this.push(e,null,r);return this.decryptionPromise=null,t})),this.decryptionPromise;{let t=e.softwareDecrypt(a,S.key.buffer,S.iv.buffer);if(r.part>-1&&(t=e.flush()),!t)return i.executeEnd=di(),Ai(r);a=new Uint8Array(t)}}const A=this.needsProbing(u,c);if(A){const e=this.configureTransmuxer(a);if(e)return R.warn(`[transmuxer] ${e.message}`),this.observer.emit(E.ERROR,E.ERROR,{type:v.MEDIA_ERROR,details:T.FRAG_PARSING_ERROR,fatal:!1,error:e,reason:e.message}),i.executeEnd=di(),Ai(r)}(u||c||h||A)&&this.resetInitSegment(_,g,m,y,t),(u||h||A)&&this.resetInitialTimestamp(p),l||this.resetContiguity();const b=this.transmux(a,S,d,f,r),I=this.currentTransmuxState;return I.contiguous=!0,I.discontinuity=!1,I.trackSwitch=!1,i.executeEnd=di(),b}flush(e){const t=e.transmuxing;t.executeStart=di();const{decrypter:r,currentTransmuxState:n,decryptionPromise:i}=this;if(i)return i.then((()=>this.flush(e)));const a=[],{timeOffset:o}=n;if(r){const t=r.flush();t&&a.push(this.push(t,null,e))}const{demuxer:s,remuxer:l}=this;if(!s||!l)return t.executeEnd=di(),[Ai(e)];const u=s.flush(o);return bi(u)?u.then((t=>(this.flushRemux(a,t,e),a))):(this.flushRemux(a,u,e),a)}flushRemux(e,t,r){const{audioTrack:n,videoTrack:i,id3Track:a,textTrack:o}=t,{accurateTimeOffset:s,timeOffset:l}=this.currentTransmuxState;R.log(`[transmuxer.ts]: Flushed fragment ${r.sn}${r.part>-1?" p: "+r.part:""} of level ${r.level}`);const u=this.remuxer.remux(n,i,a,o,l,s,!0,this.id);e.push({remuxResult:u,chunkMeta:r}),r.transmuxing.executeEnd=di()}resetInitialTimestamp(e){const{demuxer:t,remuxer:r}=this;t&&r&&(t.resetTimeStamp(e),r.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,r,n,i){const{demuxer:a,remuxer:o}=this;a&&o&&(a.resetInitSegment(e,t,r,n),o.resetInitSegment(e,t,r,i))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,r,n,i){let a;return a=t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,r,n,i):this.transmuxUnencrypted(e,r,n,i),a}transmuxUnencrypted(e,t,r,n){const{audioTrack:i,videoTrack:a,id3Track:o,textTrack:s}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(i,a,o,s,t,r,!1,this.id),chunkMeta:n}}transmuxSampleAes(e,t,r,n,i){return this.demuxer.demuxSampleAes(e,t,r).then((e=>({remuxResult:this.remuxer.remux(e.audioTrack,e.videoTrack,e.id3Track,e.textTrack,r,n,!1,this.id),chunkMeta:i})))}configureTransmuxer(e){const{config:t,observer:r,typeSupported:n,vendor:i}=this;let a;for(let f=0,d=_i.length;f<d;f++){var o;if(null!=(o=_i[f].demux)&&o.probe(e)){a=_i[f];break}}if(!a)return new Error("Failed to find demuxer by probing fragment data");const s=this.demuxer,l=this.remuxer,u=a.remux,c=a.demux;l&&l instanceof u||(this.remuxer=new u(r,t,n,i)),s&&s instanceof c||(this.demuxer=new c(r,t,n),this.probe=c.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new sn(this.config)),e}}const Ai=e=>({remuxResult:{},chunkMeta:e});function bi(e){return"then"in e&&e.then instanceof Function}class Ri{constructor(e,t,r,n,i){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=r,this.duration=n,this.defaultInitPts=i||null}}class Ii{constructor(e,t,r,n,i,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=r,this.trackSwitch=n,this.timeOffset=i,this.initSegmentChange=a}}var wi={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function a(e,t,n,a,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new i(n,a||e,o),l=r?r+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],s]:e._events[l].push(s):(e._events[l]=s,e._eventsCount++),e}function o(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function s(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),s.prototype.eventNames=function(){var e,n,i=[];if(0===this._eventsCount)return i;for(n in e=this._events)t.call(e,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,a=n.length,o=new Array(a);i<a;i++)o[i]=n[i].fn;return o},s.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},s.prototype.emit=function(e,t,n,i,a,o){var s=r?r+e:e;if(!this._events[s])return!1;var l,u,c=this._events[s],f=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),f){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,i),!0;case 5:return c.fn.call(c.context,t,n,i,a),!0;case 6:return c.fn.call(c.context,t,n,i,a,o),!0}for(u=1,l=new Array(f-1);u<f;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var d,h=c.length;for(u=0;u<h;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),f){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,n);break;case 4:c[u].fn.call(c[u].context,t,n,i);break;default:if(!l)for(d=1,l=new Array(f-1);d<f;d++)l[d-1]=arguments[d];c[u].fn.apply(c[u].context,l)}}return!0},s.prototype.on=function(e,t,r){return a(this,e,t,r,!1)},s.prototype.once=function(e,t,r){return a(this,e,t,r,!0)},s.prototype.removeListener=function(e,t,n,i){var a=r?r+e:e;if(!this._events[a])return this;if(!t)return o(this,a),this;var s=this._events[a];if(s.fn)s.fn!==t||i&&!s.once||n&&s.context!==n||o(this,a);else{for(var l=0,u=[],c=s.length;l<c;l++)(s[l].fn!==t||i&&!s[l].once||n&&s[l].context!==n)&&u.push(s[l]);u.length?this._events[a]=1===u.length?u[0]:u:o(this,a)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&o(this,t)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,e.exports=s}(wi);var Ci=e(wi.exports);class Di{constructor(e,t,r,n){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;const i=e.config;this.hls=e,this.id=t,this.useWorker=!!i.enableWorker,this.onTransmuxComplete=r,this.onFlush=n;const a=(e,t)=>{(t=t||{}).frag=this.frag,t.id=this.id,e===E.ERROR&&(this.error=t.error),this.hls.trigger(e,t)};this.observer=new Ci,this.observer.on(E.FRAG_DECRYPTED,a),this.observer.on(E.ERROR,a);const o=We(i.preferManagedMediaSource)||{isTypeSupported:()=>!1},s={mpeg:o.isTypeSupported("audio/mpeg"),mp3:o.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:o.isTypeSupported('audio/mp4; codecs="ac-3"')};if(this.useWorker&&"undefined"!=typeof Worker){if(i.workerPath||"function"==typeof __HLS_WORKER_BUNDLE__){try{i.workerPath?(R.log(`loading Web Worker ${i.workerPath} for "${t}"`),this.workerContext=function(e){const t=new self.URL(e,self.location.href).href;return{worker:new self.Worker(t),scriptURL:t}}(i.workerPath)):(R.log(`injecting Web Worker for "${t}"`),this.workerContext=function(){const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e);return{worker:new self.Worker(t),objectURL:t}}()),this.onwmsg=e=>this.onWorkerMessage(e);const{worker:e}=this.workerContext;e.addEventListener("message",this.onwmsg),e.onerror=e=>{const r=new Error(`${e.message}  (${e.filename}:${e.lineno})`);i.enableWorker=!1,R.warn(`Error in "${t}" Web Worker, fallback to inline`),this.hls.trigger(E.ERROR,{type:v.OTHER_ERROR,details:T.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:r})},e.postMessage({cmd:"init",typeSupported:s,vendor:"",id:t,config:JSON.stringify(i)})}catch(jo){R.warn(`Error setting up "${t}" Web Worker, fallback to inline`,jo),this.resetWorker(),this.error=null,this.transmuxer=new Si(this.observer,s,i,"",t)}return}}this.transmuxer=new Si(this.observer,s,i,"",t)}resetWorker(){if(this.workerContext){const{worker:e,objectURL:t}=this.workerContext;t&&self.URL.revokeObjectURL(t),e.removeEventListener("message",this.onwmsg),e.onerror=null,e.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{const e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(e,t,r,n,i,a,o,s,l,u){var c,f;l.transmuxing.start=self.performance.now();const{transmuxer:d}=this,h=a?a.start:i.start,g=i.decryptdata,m=this.frag,p=!(m&&i.cc===m.cc),y=!(m&&l.level===m.level),E=m?l.sn-m.sn:-1,v=this.part?l.part-this.part.index:-1,T=0===E&&l.id>1&&l.id===(null==m?void 0:m.stats.chunkCount),_=!y&&(1===E||0===E&&(1===v||T&&v<=0)),S=self.performance.now();(y||E||0===i.stats.parsing.start)&&(i.stats.parsing.start=S),!a||!v&&_||(a.stats.parsing.start=S);const A=!(m&&(null==(c=i.initSegment)?void 0:c.url)===(null==(f=m.initSegment)?void 0:f.url)),b=new Ii(p,_,s,y,h,A);if(!_||p||A){R.log(`[transmuxer-interface, ${i.type}]: Starting new transmux session for sn: ${l.sn} p: ${l.part} level: ${l.level} id: ${l.id}\n        discontinuity: ${p}\n        trackSwitch: ${y}\n        contiguous: ${_}\n        accurateTimeOffset: ${s}\n        timeOffset: ${h}\n        initSegmentChange: ${A}`);const e=new Ri(r,n,t,o,u);this.configureTransmuxer(e)}if(this.frag=i,this.part=a,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:e,decryptdata:g,chunkMeta:l,state:b},e instanceof ArrayBuffer?[e]:[]);else if(d){const t=d.push(e,g,l,b);bi(t)?(d.async=!0,t.then((e=>{this.handleTransmuxComplete(e)})).catch((e=>{this.transmuxerError(e,l,"transmuxer-interface push error")}))):(d.async=!1,this.handleTransmuxComplete(t))}}flush(e){e.transmuxing.start=self.performance.now();const{transmuxer:t}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e});else if(t){let r=t.flush(e);bi(r)||t.async?(bi(r)||(r=Promise.resolve(r)),r.then((t=>{this.handleFlushResult(t,e)})).catch((t=>{this.transmuxerError(t,e,"transmuxer-interface flush error")}))):this.handleFlushResult(r,e)}}transmuxerError(e,t,r){this.hls&&(this.error=e,this.hls.trigger(E.ERROR,{type:v.MEDIA_ERROR,details:T.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,fatal:!1,error:e,err:e,reason:r}))}handleFlushResult(e,t){e.forEach((e=>{this.handleTransmuxComplete(e)})),this.onFlush(t)}onWorkerMessage(e){const t=e.data;if(null==t||!t.event)return void R.warn("worker message received with no "+(t?"event name":"data"));const r=this.hls;if(this.hls)switch(t.event){case"init":{var n;const e=null==(n=this.workerContext)?void 0:n.objectURL;e&&self.URL.revokeObjectURL(e);break}case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":R[t.data.logType]&&R[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,r.trigger(t.event,t.data)}}configureTransmuxer(e){const{transmuxer:t}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):t&&t.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}function Li(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!Ni(e[r].attrs,t[r].attrs))return!1;return!0}function Ni(e,t,r){const n=e["STABLE-RENDITION-ID"];return n&&!r?n===t["STABLE-RENDITION-ID"]:!(r||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some((r=>e[r]!==t[r]))}function Oi(e,t){return t.label.toLowerCase()===e.name.toLowerCase()&&(!t.language||t.language.toLowerCase()===(e.lang||"").toLowerCase())}class Mi{constructor(e){this.buffered=void 0;const t=(t,r,n)=>{if((r>>>=0)>n-1)throw new DOMException(`Failed to execute '${t}' on 'TimeRanges': The index provided (${r}) is greater than the maximum bound (${n})`);return e[r][t]};this.buffered={get length(){return e.length},end:r=>t("end",r,e.length),start:r=>t("start",r,e.length)}}}class Pi{constructor(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}append(e,t,r){const n=this.queues[t];n.push(e),1!==n.length||r||this.executeNext(t)}insertAbort(e,t){this.queues[t].unshift(e),this.executeNext(t)}appendBlocker(e){let t;const r=new Promise((e=>{t=e})),n={execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(n,e),r}executeNext(e){const t=this.queues[e];if(t.length){const n=t[0];try{n.execute()}catch(r){R.warn(`[buffer-operation-queue]: Exception executing "${e}" SourceBuffer operation: ${r}`),n.onError(r);const t=this.buffers[e];null!=t&&t.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues[e].shift(),this.executeNext(e)}current(e){return this.queues[e][0]}}const ki=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/;function xi(e){const t=e.querySelectorAll("source");[].slice.call(t).forEach((t=>{e.removeChild(t)}))}const Fi={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Ui=e=>String.fromCharCode(Fi[e]||e),Bi=15,Zi=100,Gi={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Hi={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Ki={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Yi={25:2,26:4,29:6,30:8,31:10,27:13,28:15},qi=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class Vi{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const r="function"==typeof t?t():t;R.log(`${this.time} [${e}] ${r}`)}}}const ji=function(e){const t=[];for(let r=0;r<e.length;r++)t.push(e[r].toString(16));return t};class $i{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let r=0;r<t.length;r++){const n=t[r];e.hasOwnProperty(n)&&(this[n]=e[n])}}isDefault(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class zi{constructor(){this.uchar=" ",this.penState=new $i}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return" "===this.uchar&&this.penState.isDefault()}}class Wi{constructor(e){this.chars=[],this.pos=0,this.currPenState=new $i,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Zi;t++)this.chars.push(new zi);this.logger=e}equals(e){for(let t=0;t<Zi;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Zi;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Zi;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Zi&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Zi)}moveCursor(e){const t=this.pos+e;if(e>1)for(let r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=Ui(e);this.pos>=Zi?this.logger.log(0,(()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!")):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))}clearFromPos(e){let t;for(t=e;t<Zi;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let r=0;r<Zi;r++){const n=this.chars[r].uchar;" "!==n&&(t=!1),e.push(n)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e);this.chars[this.pos].setPenState(this.currPenState)}}class Xi{constructor(e){this.rows=[],this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<Bi;t++)this.rows.push(new Wi(e));this.logger=e}reset(){for(let e=0;e<Bi;e++)this.rows[e].clear();this.currRow=14}equals(e){let t=!0;for(let r=0;r<Bi;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t}copy(e){for(let t=0;t<Bi;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Bi;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e);this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,(()=>"pacData = "+JSON.stringify(e)));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let t=0;t<Bi;t++)this.rows[t].clear();const e=this.currRow+1-this.nrRollUpRows,r=this.lastOutputScreen;if(r){const n=r.rows[e].cueStartTime,i=this.logger.time;if(null!==n&&null!==i&&n<i)for(let a=0;a<this.nrRollUpRows;a++)this.rows[t-this.nrRollUpRows+a+1].copy(r.rows[e+a])}}this.currRow=t;const r=this.rows[this.currRow];if(null!==e.indent){const t=e.indent,n=Math.max(t-1,0);r.setCursor(e.indent),e.color=r.chars[n].penState.foreground}const n={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(n)}setBkgData(e){this.logger.log(2,(()=>"bkgData = "+JSON.stringify(e))),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(null===this.nrRollUpRows)return void this.logger.log(3,"roll_up but nrRollUpRows not set yet");this.logger.log(1,(()=>this.getDisplayText()));const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let r="",n=-1;for(let i=0;i<Bi;i++){const r=this.rows[i].getTextString();r&&(n=i+1,e?t.push("Row "+n+": '"+r+"'"):t.push(r.trim()))}return t.length>0&&(r=e?"["+t.join(" | ")+"]":t.join("\n")),r}getTextAndFormat(){return this.rows}}class Qi{constructor(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Xi(r),this.nonDisplayedMemory=new Xi(r),this.lastOutputScreen=new Xi(r),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,(()=>"MODE="+e)),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let r=0;r<e.length;r++)this.writeScreen.insertChar(e[r]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,(()=>t+": "+this.writeScreen.getDisplayText(!0))),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(1,(()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0))),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,(()=>"DISP: "+this.displayedMemory.getDisplayText()))}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{const r=Math.floor(e/2)-16,n=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=n[r]}this.logger.log(2,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Ji{constructor(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory={a:null,b:null},this.logger=void 0;const n=this.logger=new Vi;this.channels=[null,new Qi(e,t,n),new Qi(e+1,r,n)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let r=0;r<t.length;r+=2){const e=127&t[r],n=127&t[r+1];let i=!1,a=null;if(0===e&&0===n)continue;this.logger.log(3,(()=>"["+ji([t[r],t[r+1]])+"] -> ("+ji([e,n])+")"));const o=this.cmdHistory;if(e>=16&&e<=31){if(ta(e,n,o)){ea(null,null,o),this.logger.log(3,(()=>"Repeated command ("+ji([e,n])+") is dropped"));continue}ea(e,n,this.cmdHistory),i=this.parseCmd(e,n),i||(i=this.parseMidrow(e,n)),i||(i=this.parsePAC(e,n)),i||(i=this.parseBackgroundAttributes(e,n))}else ea(null,null,o);if(!i&&(a=this.parseChars(e,n),a)){const e=this.currentChannel;if(e&&e>0){this.channels[e].insertChars(a)}else this.logger.log(2,"No channel found yet. TEXT-MODE?")}i||a||this.logger.log(2,(()=>"Couldn't parse cleaned data "+ji([e,n])+" orig: "+ji([t[r],t[r+1]])))}}parseCmd(e,t){if(!((20===e||28===e||21===e||29===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=33&&t<=35))return!1;const r=20===e||21===e||23===e?1:2,n=this.channels[r];return 20===e||21===e||28===e||29===e?32===t?n.ccRCL():33===t?n.ccBS():34===t?n.ccAOF():35===t?n.ccAON():36===t?n.ccDER():37===t?n.ccRU(2):38===t?n.ccRU(3):39===t?n.ccRU(4):40===t?n.ccFON():41===t?n.ccRDC():42===t?n.ccTR():43===t?n.ccRTD():44===t?n.ccEDM():45===t?n.ccCR():46===t?n.ccENM():47===t&&n.ccEOC():n.ccTO(t-32),this.currentChannel=r,!0}parseMidrow(e,t){let r=0;if((17===e||25===e)&&t>=32&&t<=47){if(r=17===e?1:2,r!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const n=this.channels[r];return!!n&&(n.ccMIDROW(t),this.logger.log(3,(()=>"MIDROW ("+ji([e,t])+")")),!0)}return!1}parsePAC(e,t){let r;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127)&&!((16===e||24===e)&&t>=64&&t<=95))return!1;const n=e<=23?1:2;r=t>=64&&t<=95?1===n?Gi[e]:Ki[e]:1===n?Hi[e]:Yi[e];const i=this.channels[n];return!!i&&(i.setPAC(this.interpretPAC(r,t)),this.currentChannel=n,!0)}interpretPAC(e,t){let r;const n={color:null,italics:!1,indent:null,underline:!1,row:e};return r=t>95?t-96:t-64,n.underline=!(1&~r),r<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(n.italics=!0,n.color="white"):n.indent=4*Math.floor((r-16)/2),n}parseChars(e,t){let r,n=null,i=null;if(e>=25?(r=2,i=e-8):(r=1,i=e),i>=17&&i<=19){let e;e=17===i?t+80:18===i?t+112:t+144,this.logger.log(2,(()=>"Special char '"+Ui(e)+"' in channel "+r)),n=[e]}else e>=32&&e<=127&&(n=0===t?[e]:[e,t]);return n&&this.logger.log(3,(()=>"Char codes =  "+ji(n).join(","))),n}parseBackgroundAttributes(e,t){if(!((16===e||24===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=45&&t<=47))return!1;let r;const n={};16===e||24===e?(r=Math.floor((t-32)/2),n.background=qi[r],t%2==1&&(n.background=n.background+"_semi")):45===t?n.background="transparent":(n.foreground="black",47===t&&(n.underline=!0));const i=e<=23?1:2;return this.channels[i].setBkgData(n),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}ea(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const r=this.channels[t];r&&r.cueSplitAtTime(e)}}}function ea(e,t,r){r.a=e,r.b=t}function ta(e,t,r){return r.a===e&&r.b===t}class ra{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,r){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var na=function(){if(null!=H&&H.VTTCue)return self.VTTCue;const e=["","lr","rl"],t=["start","middle","end","left","right"];function r(e,t){if("string"!=typeof t)return!1;if(!Array.isArray(e))return!1;const r=t.toLowerCase();return!!~e.indexOf(r)&&r}function n(e){return r(t,e)}function i(e,...t){let r=1;for(;r<arguments.length;r++){const t=arguments[r];for(const r in t)e[r]=t[r]}return e}function a(t,a,o){const s=this,l={enumerable:!0};s.hasBeenReset=!1;let u="",c=!1,f=t,d=a,h=o,g=null,m="",p=!0,y="auto",E="start",v=50,T="middle",_=50,S="middle";Object.defineProperty(s,"id",i({},l,{get:function(){return u},set:function(e){u=""+e}})),Object.defineProperty(s,"pauseOnExit",i({},l,{get:function(){return c},set:function(e){c=!!e}})),Object.defineProperty(s,"startTime",i({},l,{get:function(){return f},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");f=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"endTime",i({},l,{get:function(){return d},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");d=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"text",i({},l,{get:function(){return h},set:function(e){h=""+e,this.hasBeenReset=!0}})),Object.defineProperty(s,"region",i({},l,{get:function(){return g},set:function(e){g=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"vertical",i({},l,{get:function(){return m},set:function(t){const n=function(t){return r(e,t)}(t);if(!1===n)throw new SyntaxError("An invalid or illegal string was specified.");m=n,this.hasBeenReset=!0}})),Object.defineProperty(s,"snapToLines",i({},l,{get:function(){return p},set:function(e){p=!!e,this.hasBeenReset=!0}})),Object.defineProperty(s,"line",i({},l,{get:function(){return y},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"lineAlign",i({},l,{get:function(){return E},set:function(e){const t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");E=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"position",i({},l,{get:function(){return v},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");v=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"positionAlign",i({},l,{get:function(){return T},set:function(e){const t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");T=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"size",i({},l,{get:function(){return _},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");_=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"align",i({},l,{get:function(){return S},set:function(e){const t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");S=t,this.hasBeenReset=!0}})),s.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a}();class ia{decode(e,t){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function aa(e){function t(e,t,r,n){return 3600*(0|e)+60*(0|t)+(0|r)+parseFloat(n||0)}const r=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return r?parseFloat(r[2])>59?t(r[2],r[3],0,r[4]):t(r[1],r[2],r[3],r[4]):null}class oa{constructor(){this.values=Object.create(null)}set(e,t){this.get(e)||""===t||(this.values[e]=t)}get(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,r){for(let n=0;n<r.length;++n)if(t===r[n]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1}}function sa(e,t,r,n){const i=n?e.split(n):[e];for(const a in i){if("string"!=typeof i[a])continue;const e=i[a].split(r);if(2!==e.length)continue;t(e[0],e[1])}}const la=new na(0,0,""),ua="middle"===la.align?"middle":"center";function ca(e,t,r){const n=e;function i(){const t=aa(e);if(null===t)throw new Error("Malformed timestamp: "+n);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function a(){e=e.replace(/^\s+/,"")}if(a(),t.startTime=i(),a(),"--\x3e"!==e.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+n);e=e.slice(3),a(),t.endTime=i(),a(),function(e,t){const n=new oa;sa(e,(function(e,t){let i;switch(e){case"region":for(let i=r.length-1;i>=0;i--)if(r[i].id===t){n.set(e,r[i].region);break}break;case"vertical":n.alt(e,t,["rl","lr"]);break;case"line":i=t.split(","),n.integer(e,i[0]),n.percent(e,i[0])&&n.set("snapToLines",!1),n.alt(e,i[0],["auto"]),2===i.length&&n.alt("lineAlign",i[1],["start",ua,"end"]);break;case"position":i=t.split(","),n.percent(e,i[0]),2===i.length&&n.alt("positionAlign",i[1],["start",ua,"end","line-left","line-right","auto"]);break;case"size":n.percent(e,t);break;case"align":n.alt(e,t,["start",ua,"end","left","right"])}}),/:/,/\s/),t.region=n.get("region",null),t.vertical=n.get("vertical","");let i=n.get("line","auto");"auto"===i&&-1===la.line&&(i=-1),t.line=i,t.lineAlign=n.get("lineAlign","start"),t.snapToLines=n.get("snapToLines",!0),t.size=n.get("size",100),t.align=n.get("align",ua);let a=n.get("position","auto");"auto"===a&&50===la.position&&(a="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=a}(e,t)}function fa(e){return e.replace(/<br(?: \/)?>/gi,"\n")}class da{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new ia,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;function r(){let e=t.buffer,r=0;for(e=fa(e);r<e.length&&"\r"!==e[r]&&"\n"!==e[r];)++r;const n=e.slice(0,r);return"\r"===e[r]&&++r,"\n"===e[r]&&++r,t.buffer=e.slice(r),n}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{let e="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;e=r();const n=e.match(/^()?WEBVTT([ \t].*)?$/);if(null==n||!n[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let i=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(i?i=!1:e=r(),t.state){case"HEADER":/:/.test(e)?sa(e,(function(e,t){}),/:/):e||(t.state="ID");continue;case"NOTE":e||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){t.state="NOTE";break}if(!e)continue;if(t.cue=new na(0,0,""),t.state="CUE",-1===e.indexOf("--\x3e")){t.cue.id=e;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{ca(e,t.cue,t.regionList)}catch(n){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const r=-1!==e.indexOf("--\x3e");if(!e||r&&(i=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=e}continue;case"BADCUE":e||(t.state="ID")}}}catch(n){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state||"BADWEBVTT"===e.state)throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const ha=/\r\n|\n\r|\n|\r/g,ga=function(e,t,r=0){return e.slice(r,r+t.length)===t},ma=function(e){let t=5381,r=e.length;for(;r;)t=33*t^e.charCodeAt(--r);return(t>>>0).toString()};function pa(e,t,r){return ma(e.toString())+ma(t.toString())+ma(r)}function ya(e,t,r,n,i,a,o){const s=new da,l=me(new Uint8Array(e)).trim().replace(ha,"\n").split("\n"),u=[],c=t?function(e,t=1){return ci(e,ui,1/t)}(t.baseTime,t.timescale):0;let f,d="00:00.000",h=0,g=0,p=!0;s.oncue=function(e){const a=r[n];let o=r.ccOffset;const s=(h-c)/9e4;if(null!=a&&a.new&&(void 0!==g?o=r.ccOffset=a.start:function(e,t,r){let n=e[t],i=e[n.prevCC];if(!i||!i.new&&n.new)return e.ccOffset=e.presentationOffset=n.start,void(n.new=!1);for(;null!=(a=i)&&a.new;){var a;e.ccOffset+=n.start-i.start,n.new=!1,n=i,i=e[n.prevCC]}e.presentationOffset=r}(r,n,s)),s){if(!t)return void(f=new Error("Missing initPTS for VTT MPEGTS"));o=s-r.presentationOffset}const l=e.endTime-e.startTime,d=pi(9e4*(e.startTime+o-g),9e4*i)/9e4;e.startTime=Math.max(d,0),e.endTime=Math.max(d+l,0);const m=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(m)),e.id||(e.id=pa(e.startTime,e.endTime,m)),e.endTime>0&&u.push(e)},s.onparsingerror=function(e){f=e},s.onflush=function(){f?o(f):a(u)},l.forEach((e=>{if(p){if(ga(e,"X-TIMESTAMP-MAP=")){p=!1,e.slice(16).split(",").forEach((e=>{ga(e,"LOCAL:")?d=e.slice(6):ga(e,"MPEGTS:")&&(h=parseInt(e.slice(7)))}));try{g=function(e){let t=parseInt(e.slice(-3));const r=parseInt(e.slice(-6,-4)),n=parseInt(e.slice(-9,-7)),i=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!(m(t)&&m(r)&&m(n)&&m(i)))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*r,t+=6e4*n,t+=36e5*i,t}(d)/1e3}catch(t){f=t}return}""===e&&(p=!1)}s.parse(e+"\n")})),s.flush()}const Ea="stpp.ttml.im1t",va=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Ta=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,_a={left:"start",center:"center",right:"end",start:"start",end:"end"};function Sa(e,t,r,n){const i=we(new Uint8Array(e),["mdat"]);if(0===i.length)return void n(new Error("Could not parse IMSC1 mdat"));const a=i.map((e=>me(e))),o=function(e,t,r=1,n=!1){return ci(e,t,1/r,n)}(t.baseTime,1,t.timescale);try{a.forEach((e=>r(function(e,t){const r=(new DOMParser).parseFromString(e,"text/xml"),n=r.getElementsByTagName("tt")[0];if(!n)throw new Error("Invalid ttml");const i={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(i).reduce(((e,t)=>(e[t]=n.getAttribute(`ttp:${t}`)||i[t],e)),{}),o="preserve"!==n.getAttribute("xml:space"),s=ba(Aa(n,"styling","style")),l=ba(Aa(n,"layout","region")),u=Aa(n,"body","[begin]");return[].map.call(u,(e=>{const r=Ra(e,o);if(!r||!e.hasAttribute("begin"))return null;const n=Ca(e.getAttribute("begin"),a),i=Ca(e.getAttribute("dur"),a);let u=Ca(e.getAttribute("end"),a);if(null===n)throw wa(e);if(null===u){if(null===i)throw wa(e);u=n+i}const c=new na(n-t,u-t,r);c.id=pa(c.startTime,c.endTime,c.text);const f=function(e,t,r){const n="http://www.w3.org/ns/ttml#styling";let i=null;const a=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],o=null!=e&&e.hasAttribute("style")?e.getAttribute("style"):null;o&&r.hasOwnProperty(o)&&(i=r[o]);return a.reduce(((r,a)=>{const o=Ia(t,n,a)||Ia(e,n,a)||Ia(i,n,a);return o&&(r[a]=o),r}),{})}(l[e.getAttribute("region")],s[e.getAttribute("style")],s),{textAlign:d}=f;if(d){const e=_a[d];e&&(c.lineAlign=e),c.align=d}return g(c,f),c})).filter((e=>null!==e))}(e,o))))}catch(s){n(s)}}function Aa(e,t,r){const n=e.getElementsByTagName(t)[0];return n?[].slice.call(n.querySelectorAll(r)):[]}function ba(e){return e.reduce(((e,t)=>{const r=t.getAttribute("xml:id");return r&&(e[r]=t),e}),{})}function Ra(e,t){return[].slice.call(e.childNodes).reduce(((e,r,n)=>{var i;return"br"===r.nodeName&&n?e+"\n":null!=(i=r.childNodes)&&i.length?Ra(r,t):t?e+r.textContent.trim().replace(/\s+/g," "):e+r.textContent}),"")}function Ia(e,t,r){return e&&e.hasAttributeNS(t,r)?e.getAttributeNS(t,r):null}function wa(e){return new Error(`Could not parse ttml timestamp ${e}`)}function Ca(e,t){if(!e)return null;let r=aa(e);return null===r&&(va.test(e)?r=function(e,t){const r=va.exec(e),n=(0|r[4])+(0|r[5])/t.subFrameRate;return 3600*(0|r[1])+60*(0|r[2])+(0|r[3])+n/t.frameRate}(e,t):Ta.test(e)&&(r=function(e,t){const r=Ta.exec(e),n=Number(r[1]);switch(r[2]){case"h":return 3600*n;case"m":return 60*n;case"ms":return 1e3*n;case"f":return n/t.frameRate;case"t":return n/t.tickRate}return n}(e,t))),r}function Da(e){return e.characteristics&&/transcribes-spoken-dialog/gi.test(e.characteristics)&&/describes-music-and-sound/gi.test(e.characteristics)?"captions":"subtitles"}function La(e,t){return!!e&&e.kind===Da(t)&&Oi(t,e)}class Na{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(E.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(E.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(E.MANIFEST_PARSED,this.onManifestParsed,this),e.on(E.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(E.BUFFER_CODECS,this.onBufferCodecs,this),e.on(E.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(E.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(E.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(E.MANIFEST_PARSED,this.onManifestParsed,this),e.off(E.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(E.BUFFER_CODECS,this.onBufferCodecs,this),e.off(E.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const r=this.hls.levels[t.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&m(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0)return void(this.clientRect=null);const e=this.hls.levels;if(e.length){const t=this.hls,r=this.getMaxLevel(e.length-1);r!==this.autoLevelCapping&&R.log(`Setting autoLevelCapping to ${r}: ${e[r].height}p@${e[r].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=r,t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const r=t.filter(((t,r)=>this.isLevelAllowed(t)&&r<=e));return this.clientRect=null,Na.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,t.width||t.height||(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(t){}return e}isLevelAllowed(e){return!this.restrictedLevels.some((t=>e.bitrate===t.bitrate&&e.width===t.width&&e.height===t.height))}static getMaxLevelByMediaSize(e,t,r){if(null==e||!e.length)return-1;let n=e.length-1;const i=Math.max(t,r);for(let s=0;s<e.length;s+=1){const t=e[s];if((t.width>=i||t.height>=i)&&(a=t,!(o=e[s+1])||a.width!==o.width||a.height!==o.height)){n=s;break}}var a,o;return n}}const Oa="[eme]";class Ma{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=Ma.CDMCleanupPromise?[Ma.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=R.debug.bind(R,Oa),this.log=R.log.bind(R,Oa),this.warn=R.warn.bind(R,Oa),this.error=R.error.bind(R,Oa),this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}registerListeners(){this.hls.on(E.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(E.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(E.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(E.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(E.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(E.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(E.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(E.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:r}=this.config,n=t[e];if(n)return n.licenseUrl;if(e===K.WIDEVINE&&r)return r;throw new Error(`no license server URL configured for key-system "${e}"`)}getServerCertificateUrl(e){const{drmSystems:t}=this.config,r=t[e];if(r)return r.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,r=(e,t,r)=>!!e&&r.indexOf(e)===t,n=t.map((e=>e.audioCodec)).filter(r),i=t.map((e=>e.videoCodec)).filter(r);return n.length+i.length===0&&i.push("avc1.42e01e"),new Promise(((t,r)=>{const a=e=>{const o=e.shift();this.getMediaKeysPromise(o,n,i).then((e=>t({keySystem:o,mediaKeys:e}))).catch((t=>{e.length?a(e):r(t instanceof Pa?t:new Pa({type:v.KEY_SYSTEM_ERROR,details:T.KEY_SYSTEM_NO_ACCESS,error:t,fatal:!0},t.message))}))};a(e)}))}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:r}=this.config;if("function"!=typeof r){let e=`Configured requestMediaKeySystemAccess is not a function ${r}`;return null===Q&&"http:"===self.location.protocol&&(e=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(e))}return r(e,t)}getMediaKeysPromise(e,t,r){const n=function(e,t,r,n){let i;switch(e){case K.FAIRPLAY:i=["cenc","sinf"];break;case K.WIDEVINE:case K.PLAYREADY:i=["cenc"];break;case K.CLEARKEY:i=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${e}`)}return function(e,t,r,n){return[{initDataTypes:e,persistentState:n.persistentState||"optional",distinctiveIdentifier:n.distinctiveIdentifier||"optional",sessionTypes:n.sessionTypes||[n.sessionType||"temporary"],audioCapabilities:t.map((e=>({contentType:`audio/mp4; codecs="${e}"`,robustness:n.audioRobustness||"",encryptionScheme:n.audioEncryptionScheme||null}))),videoCapabilities:r.map((e=>({contentType:`video/mp4; codecs="${e}"`,robustness:n.videoRobustness||"",encryptionScheme:n.videoEncryptionScheme||null})))}]}(i,t,r,n)}(e,t,r,this.config.drmSystemOptions),i=this.keySystemAccessPromises[e];let a=null==i?void 0:i.keySystemAccess;if(!a){this.log(`Requesting encrypted media "${e}" key-system access with config: ${JSON.stringify(n)}`),a=this.requestMediaKeySystemAccess(e,n);const t=this.keySystemAccessPromises[e]={keySystemAccess:a};return a.catch((t=>{this.log(`Failed to obtain access to key-system "${e}": ${t}`)})),a.then((r=>{this.log(`Access for key-system "${r.keySystem}" obtained`);const n=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),t.mediaKeys=r.createMediaKeys().then((t=>(this.log(`Media-keys created for "${e}"`),n.then((r=>r?this.setMediaKeysServerCertificate(t,e,r):t))))),t.mediaKeys.catch((t=>{this.error(`Failed to create media-keys for "${e}"}: ${t}`)})),t.mediaKeys}))}return a.then((()=>i.mediaKeys))}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:r}){this.log(`Creating key-system session "${t}" keyId: ${ye(e.keyId||[])}`);const n=r.createSession(),i={decryptdata:e,keySystem:t,mediaKeys:r,mediaKeysSession:n,keyStatus:"status-pending"};return this.mediaKeySessions.push(i),i}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const r=this.createMediaKeySessionContext(e),n=this.getKeyIdString(t),i="cenc";this.keyIdToKeySessionPromise[n]=this.generateRequestWithPreferredKeySession(r,i,t.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(null===e.keyId)throw new Error("keyId is null");return ye(e.keyId)}updateKeySession(e,t){var r;const n=e.mediaKeysSession;return this.log(`Updating key-session "${n.sessionId}" for keyID ${ye((null==(r=e.decryptdata)?void 0:r.keyId)||[])}\n      } (data length: ${t?t.byteLength:t})`),n.update(t)}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){return new Promise(((t,r)=>{const n=X(this.config),i=e.map($).filter((e=>!!e&&-1!==n.indexOf(e)));return this.getKeySystemSelectionPromise(i).then((({keySystem:e})=>{const n=W(e);n?t(n):r(new Error(`Unable to find format for key-system "${e}"`))})).catch(r)}))}loadKey(e){const t=e.keyInfo.decryptdata,r=this.getKeyIdString(t),n=`(keyId: ${r} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${n}`);let i=this.keyIdToKeySessionPromise[r];return i||(i=this.keyIdToKeySessionPromise[r]=this.getKeySystemForKeyPromise(t).then((({keySystem:r,mediaKeys:i})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${n}`),this.attemptSetMediaKeys(r,i).then((()=>{this.throwIfDestroyed();const e=this.createMediaKeySessionContext({keySystem:r,mediaKeys:i,decryptdata:t});return this.generateRequestWithPreferredKeySession(e,"cenc",t.pssh,"playlist-key")}))))),i.catch((e=>this.handleError(e)))),i}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof Pa?this.hls.trigger(E.ERROR,e.data):this.hls.trigger(E.ERROR,{type:v.KEY_SYSTEM_ERROR,details:T.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),r=this.keyIdToKeySessionPromise[t];if(!r){const t=$(e.keyFormat),r=t?[t]:X(this.config);return this.attemptKeySystemAccess(r)}return r}getKeySystemSelectionPromise(e){if(e.length||(e=X(this.config)),0===e.length)throw new Pa({type:v.KEY_SYSTEM_ERROR,details:T.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}_onMediaEncrypted(e){const{initDataType:t,initData:r}=e;if(this.debug(`"${e.type}" event: init data type: "${t}"`),null===r)return;let n,i;if("sinf"===t&&this.config.drmSystems[K.FAIRPLAY]){const e=_e(new Uint8Array(r));try{const t=B(JSON.parse(e).sinf),r=Pe(new Uint8Array(t));if(!r)return;n=r.subarray(8,24),i=K.FAIRPLAY}catch(u){return void this.warn('Failed to parse sinf "encrypted" event message initData')}}else{const e=function(e){if(!(e instanceof ArrayBuffer)||e.byteLength<32)return null;const t={version:0,systemId:"",kids:null,data:null},r=new DataView(e),n=r.getUint32(0);if(e.byteLength!==n&&n>44)return null;if(1886614376!==r.getUint32(4))return null;if(t.version=r.getUint32(8)>>>24,t.version>1)return null;t.systemId=ye(new Uint8Array(e,12,16));const i=r.getUint32(28);if(0===t.version){if(n-32<i)return null;t.data=new Uint8Array(e,32,i)}else if(1===t.version){t.kids=[];for(let r=0;r<i;r++)t.kids.push(new Uint8Array(e,32+16*r,16))}return t}(r);if(null===e)return;0===e.version&&e.systemId===z&&e.data&&(n=e.data.subarray(8,24)),i=function(e){if(e===z)return K.WIDEVINE}(e.systemId)}if(!i||!n)return;const a=ye(n),{keyIdToKeySessionPromise:o,mediaKeySessions:s}=this;let l=o[a];for(let c=0;c<s.length;c++){const e=s[c],i=e.decryptdata;if(i.pssh||!i.keyId)continue;const u=ye(i.keyId);if(a===u||-1!==i.uri.replace(/-/g,"").indexOf(a)){l=o[u],delete o[u],i.pssh=new Uint8Array(r),i.keyId=n,l=o[a]=l.then((()=>this.generateRequestWithPreferredKeySession(e,t,r,"encrypted-event-key-match")));break}}l||(l=o[a]=this.getKeySystemSelectionPromise([i]).then((({keySystem:e,mediaKeys:i})=>{var o;this.throwIfDestroyed();const s=new Ke("ISO-23001-7",a,null!=(o=W(e))?o:"");return s.pssh=new Uint8Array(r),s.keyId=n,this.attemptSetMediaKeys(e,i).then((()=>{this.throwIfDestroyed();const n=this.createMediaKeySessionContext({decryptdata:s,keySystem:e,mediaKeys:i});return this.generateRequestWithPreferredKeySession(n,t,r,"encrypted-event-no-match")}))}))),l.catch((e=>this.handleError(e)))}_onWaitingForKey(e){this.log(`"${e.type}" event`)}attemptSetMediaKeys(e,t){const r=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const n=Promise.all(r).then((()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)}));return this.setMediaKeysQueue.push(n),n.then((()=>{this.log(`Media-keys set for "${e}"`),r.push(n),this.setMediaKeysQueue=this.setMediaKeysQueue.filter((e=>-1===r.indexOf(e)))}))}generateRequestWithPreferredKeySession(e,t,r,n){var i,a;const o=null==(i=this.config.drmSystems)||null==(a=i[e.keySystem])?void 0:a.generateRequest;if(o)try{const n=o.call(this.hls,t,r,e);if(!n)throw new Error("Invalid response from configured generateRequest filter");t=n.initDataType,r=e.decryptdata.pssh=n.initData?new Uint8Array(n.initData):null}catch(h){var s;if(this.warn(h.message),null!=(s=this.hls)&&s.config.debug)throw h}if(null===r)return this.log(`Skipping key-session request for "${n}" (no initData)`),Promise.resolve(e);const l=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${n}": ${l} (init data type: ${t} length: ${r?r.byteLength:null})`);const u=new Ci,c=e._onmessage=t=>{const r=e.mediaKeysSession;if(!r)return void u.emit("error",new Error("invalid state"));const{messageType:n,message:i}=t;this.log(`"${n}" message event for session "${r.sessionId}" message size: ${i.byteLength}`),"license-request"===n||"license-renewal"===n?this.renewLicense(e,i).catch((e=>{this.handleError(e),u.emit("error",e)})):"license-release"===n?e.keySystem===K.FAIRPLAY&&(this.updateKeySession(e,G("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${n}"`)},f=e._onkeystatuseschange=t=>{if(!e.mediaKeysSession)return void u.emit("error",new Error("invalid state"));this.onKeyStatusChange(e);const r=e.keyStatus;u.emit("keyStatus",r),"expired"===r&&(this.warn(`${e.keySystem} expired for key ${l}`),this.renewKeySession(e))};e.mediaKeysSession.addEventListener("message",c),e.mediaKeysSession.addEventListener("keystatuseschange",f);const d=new Promise(((e,t)=>{u.on("error",t),u.on("keyStatus",(r=>{r.startsWith("usable")?e():"output-restricted"===r?t(new Pa({type:v.KEY_SYSTEM_ERROR,details:T.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):"internal-error"===r?t(new Pa({type:v.KEY_SYSTEM_ERROR,details:T.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${r}"`)):"expired"===r?t(new Error("key expired while generating request")):this.warn(`unhandled key status change "${r}"`)}))}));return e.mediaKeysSession.generateRequest(t,r).then((()=>{var t;this.log(`Request generated for key-session "${null==(t=e.mediaKeysSession)?void 0:t.sessionId}" keyId: ${l}`)})).catch((e=>{throw new Pa({type:v.KEY_SYSTEM_ERROR,details:T.KEY_SYSTEM_NO_SESSION,error:e,fatal:!1},`Error generating key-session request: ${e}`)})).then((()=>d)).catch((t=>{throw u.removeAllListeners(),this.removeSession(e),t})).then((()=>(u.removeAllListeners(),e)))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach(((t,r)=>{this.log(`key status change "${t}" for keyStatuses keyId: ${ye("buffer"in r?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r))} session keyId: ${ye(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t}))}fetchServerCertificate(e){const t=this.config,r=new(0,t.loader)(t),n=this.getServerCertificateUrl(e);return n?(this.log(`Fetching server certificate for "${e}"`),new Promise(((i,a)=>{const o={responseType:"arraybuffer",url:n},s=t.certLoadPolicy.default,l={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},u={onSuccess:(e,t,r,n)=>{i(e.data)},onError:(t,r,i,s)=>{a(new Pa({type:v.KEY_SYSTEM_ERROR,details:T.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:i,response:f({url:o.url,data:void 0},t)},`"${e}" certificate request failed (${n}). Status: ${t.code} (${t.text})`))},onTimeout:(t,r,i)=>{a(new Pa({type:v.KEY_SYSTEM_ERROR,details:T.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:i,response:{url:o.url,data:void 0}},`"${e}" certificate request timed out (${n})`))},onAbort:(e,t,r)=>{a(new Error("aborted"))}};r.load(o,l,u)}))):Promise.resolve()}setMediaKeysServerCertificate(e,t,r){return new Promise(((n,i)=>{e.setServerCertificate(r).then((i=>{this.log(`setServerCertificate ${i?"success":"not supported by CDM"} (${null==r?void 0:r.byteLength}) on "${t}"`),n(e)})).catch((e=>{i(new Pa({type:v.KEY_SYSTEM_ERROR,details:T.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:e,fatal:!0},e.message))}))}))}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then((t=>this.updateKeySession(e,new Uint8Array(t)).catch((e=>{throw new Pa({type:v.KEY_SYSTEM_ERROR,details:T.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:e,fatal:!0},e.message)}))))}unpackPlayReadyKeyMessage(e,t){const r=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!r.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const n=(new DOMParser).parseFromString(r,"application/xml"),i=n.querySelectorAll("HttpHeader");if(i.length>0){let t;for(let r=0,n=i.length;r<n;r++){var a,o;t=i[r];const n=null==(a=t.querySelector("name"))?void 0:a.textContent,s=null==(o=t.querySelector("value"))?void 0:o.textContent;n&&s&&e.setRequestHeader(n,s)}}const s=n.querySelector("Challenge"),l=null==s?void 0:s.textContent;if(!l)throw new Error("Cannot find <Challenge> in key message");return G(atob(l))}setupLicenseXHR(e,t,r,n){const i=this.config.licenseXhrSetup;return i?Promise.resolve().then((()=>{if(!r.decryptdata)throw new Error("Key removed");return i.call(this.hls,e,t,r,n)})).catch((a=>{if(!r.decryptdata)throw a;return e.open("POST",t,!0),i.call(this.hls,e,t,r,n)})).then((r=>{e.readyState||e.open("POST",t,!0);return{xhr:e,licenseChallenge:r||n}})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:n}))}requestLicense(e,t){const r=this.config.keyLoadPolicy.default;return new Promise(((n,i)=>{const a=this.getLicenseServerUrl(e.keySystem);this.log(`Sending license request to URL: ${a}`);const o=new XMLHttpRequest;o.responseType="arraybuffer",o.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return i(new Error("invalid state"));if(4===o.readyState)if(200===o.status){this._requestLicenseFailureCount=0;let t=o.response;this.log(`License received ${t instanceof ArrayBuffer?t.byteLength:t}`);const r=this.config.licenseResponseCallback;if(r)try{t=r.call(this.hls,o,a,e)}catch(s){this.error(s)}n(t)}else{const s=r.errorRetry,l=s?s.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>l||o.status>=400&&o.status<500)i(new Pa({type:v.KEY_SYSTEM_ERROR,details:T.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:o,response:{url:a,data:void 0,code:o.status,text:o.statusText}},`License Request XHR failed (${a}). Status: ${o.status} (${o.statusText})`));else{const r=l-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${r} attempts left`),this.requestLicense(e,t).then(n,i)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=o,this.setupLicenseXHR(o,a,e,t).then((({xhr:t,licenseChallenge:r})=>{e.keySystem==K.PLAYREADY&&(r=this.unpackPlayReadyKeyMessage(t,r)),t.send(r)}))}))}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const r=t.media;this.media=r,r.addEventListener("encrypted",this.onMediaEncrypted),r.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media,t=this.mediaKeySessions;e&&(e.removeEventListener("encrypted",this.onMediaEncrypted),e.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},Ke.clearKeyUriToKeyIdMap();const r=t.length;Ma.CDMCleanupPromise=Promise.all(t.map((e=>this.removeSession(e))).concat(null==e?void 0:e.setMediaKeys(null).catch((e=>{this.log(`Could not clear media keys: ${e}`)})))).then((()=>{r&&(this.log("finished closing key sessions and clearing media keys"),t.length=0)})).catch((e=>{this.log(`Could not close sessions and clear media keys: ${e}`)}))}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:t}){if(t&&this.config.emeEnabled&&!this.keyFormatPromise){const e=t.reduce(((e,t)=>(-1===e.indexOf(t.keyFormat)&&e.push(t.keyFormat),e)),[]);this.log(`Selecting key-system from session-keys ${e.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(e)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:r}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),r&&r.readyState!==XMLHttpRequest.DONE&&r.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const n=this.mediaKeySessions.indexOf(e);return n>-1&&this.mediaKeySessions.splice(n,1),t.remove().catch((e=>{this.log(`Could not remove session: ${e}`)})).then((()=>t.close())).catch((e=>{this.log(`Could not close session: ${e}`)}))}}}Ma.CDMCleanupPromise=void 0;class Pa extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}var ka,xa,Fa,Ua,Ba,Za;(xa=ka||(ka={})).MANIFEST="m",xa.AUDIO="a",xa.VIDEO="v",xa.MUXED="av",xa.INIT="i",xa.CAPTION="c",xa.TIMED_TEXT="tt",xa.KEY="k",xa.OTHER="o",(Ua=Fa||(Fa={})).DASH="d",Ua.HLS="h",Ua.SMOOTH="s",Ua.OTHER="o",(Za=Ba||(Ba={})).OBJECT="CMCD-Object",Za.REQUEST="CMCD-Request",Za.SESSION="CMCD-Session",Za.STATUS="CMCD-Status";const Ga={[Ba.OBJECT]:["br","d","ot","tb"],[Ba.REQUEST]:["bl","dl","mtp","nor","nrr","su"],[Ba.SESSION]:["cid","pr","sf","sid","st","v"],[Ba.STATUS]:["bs","rtp"]};class Ha{constructor(e,t){this.value=void 0,this.params=void 0,Array.isArray(e)&&(e=e.map((e=>e instanceof Ha?e:new Ha(e)))),this.value=e,this.params=t}}class Ka{constructor(e){this.description=void 0,this.description=e}}const Ya="Dict";function qa(e,t,r,n){return new Error(`failed to ${e} "${i=t,Array.isArray(i)?JSON.stringify(i):i instanceof Map?"Map{}":i instanceof Set?"Set{}":"object"==typeof i?JSON.stringify(i):String(i)}" as ${r}`,{cause:n});var i}const Va="Bare Item",ja="Boolean",$a="Byte Sequence",za="Decimal",Wa="Integer";const Xa=/[\x00-\x1f\x7f]+/,Qa="Token",Ja="Key";function eo(e,t,r){return qa("serialize",e,t,r)}function to(e){if(!1===ArrayBuffer.isView(e))throw eo(e,$a);return`:${t=e,btoa(String.fromCharCode(...t))}:`;var t}function ro(e){if(function(e){return e<-999999999999999||999999999999999<e}(e))throw eo(e,Wa);return e.toString()}function no(e,t){if(e<0)return-no(-e,t);const r=Math.pow(10,t);if(Math.abs(e*r%1-.5)<Number.EPSILON){const t=Math.floor(e*r);return(t%2==0?t:t+1)/r}return Math.round(e*r)/r}function io(e){const t=no(e,3);if(Math.floor(Math.abs(t)).toString().length>12)throw eo(e,za);const r=t.toString();return r.includes(".")?r:`${r}.0`}const ao="String";function oo(e){const t=(r=e).description||r.toString().slice(7,-1);var r;if(!1===/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(t))throw eo(t,Qa);return t}function so(e){switch(typeof e){case"number":if(!m(e))throw eo(e,Va);return Number.isInteger(e)?ro(e):io(e);case"string":return function(e){if(Xa.test(e))throw eo(e,ao);return`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}(e);case"symbol":return oo(e);case"boolean":return function(e){if("boolean"!=typeof e)throw eo(e,ja);return e?"?1":"?0"}(e);case"object":if(e instanceof Date)return function(e){return`@${ro(e.getTime()/1e3)}`}(e);if(e instanceof Uint8Array)return to(e);if(e instanceof Ka)return oo(e);default:throw eo(e,Va)}}function lo(e){if(!1===/^[a-z*][a-z0-9\-_.*]*$/.test(e))throw eo(e,Ja);return e}function uo(e){return null==e?"":Object.entries(e).map((([e,t])=>!0===t?`;${lo(e)}`:`;${lo(e)}=${so(t)}`)).join("")}function co(e){return e instanceof Ha?`${so(e.value)}${uo(e.params)}`:so(e)}function fo(e,t={whitespace:!0}){if("object"!=typeof e)throw eo(e,Ya);const r=e instanceof Map?e.entries():Object.entries(e),n=null!=t&&t.whitespace?" ":"";return Array.from(r).map((([e,t])=>{t instanceof Ha==!1&&(t=new Ha(t));let r=lo(e);var n;return!0===t.value?r+=uo(t.params):(r+="=",Array.isArray(t.value)?r+=`(${(n=t).value.map(co).join(" ")})${uo(n.params)}`:r+=co(t)),r})).join(`,${n}`)}const ho=e=>"ot"===e||"sf"===e||"st"===e,go=e=>"number"==typeof e?m(e):null!=e&&""!==e&&!1!==e;const mo=e=>Math.round(e),po=e=>100*mo(e/100),yo={br:mo,d:mo,bl:po,dl:po,mtp:po,nor:(e,t)=>(null!=t&&t.baseUrl&&(e=function(e,t){const r=new URL(e),n=new URL(t);if(r.origin!==n.origin)return e;const i=r.pathname.split("/").slice(1),a=n.pathname.split("/").slice(1,-1);for(;i[0]===a[0];)i.shift(),a.shift();for(;a.length;)a.shift(),i.unshift("..");return i.join("/")}(e,t.baseUrl)),encodeURIComponent(e)),rtp:po,tb:mo};function Eo(e,t={}){return e?function(e,t){return fo(e,t)}(function(e,t){const r={};if(null==e||"object"!=typeof e)return r;const n=Object.keys(e).sort(),i=g({},yo,null==t?void 0:t.formatters),a=null==t?void 0:t.filter;return n.forEach((n=>{if(null!=a&&a(n))return;let o=e[n];const s=i[n];s&&(o=s(o,t)),"v"===n&&1===o||"pr"==n&&1===o||go(o)&&(ho(n)&&"string"==typeof o&&(o=new Ka(o)),r[n]=o)})),r}(e,t),g({whitespace:!1},t)):""}function vo(e,t,r){return g(e,function(e,t={}){if(!e)return{};const r=Object.entries(e),n=Object.entries(Ga).concat(Object.entries((null==t?void 0:t.customHeaderMap)||{})),i=r.reduce(((e,t)=>{var r;const[i,a]=t,o=(null==(r=n.find((e=>e[1].includes(i))))?void 0:r[0])||Ba.REQUEST;return null!=e[o]||(e[o]={}),e[o][i]=a,e}),{});return Object.entries(i).reduce(((e,[r,n])=>(e[r]=Eo(n,t),e)),{})}(t,r))}const To="CMCD";const _o=/CMCD=[^&#]+/;function So(e,t,r){const n=function(e,t={}){if(!e)return"";const r=Eo(e,t);return`${To}=${encodeURIComponent(r)}`}(t,r);if(!n)return e;if(_o.test(e))return e.replace(_o,n);const i=e.includes("?")?"&":"?";return`${e}${i}${n}`}function Ao(e,t,r,n){e&&Object.keys(t).forEach((i=>{const a=e.filter((e=>e.groupId===i)).map((e=>{const a=g({},e);return a.details=void 0,a.attrs=new C(a.attrs),a.url=a.attrs.URI=bo(e.url,e.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",r),a.groupId=a.attrs["GROUP-ID"]=t[i],a.attrs["PATHWAY-ID"]=n,a}));e.push(...a)}))}function bo(e,t,r,n){const{HOST:i,PARAMS:a,[r]:o}=n;let s;t&&(s=null==o?void 0:o[t],s&&(e=s));const l=new self.URL(e);return i&&!s&&(l.host=i),a&&Object.keys(a).sort().forEach((e=>{e&&l.searchParams.set(e,a[e])})),l.href}const Ro=/^age:\s*[\d.]+\s*$/im;class Io{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new N,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const r=this.loader=new self.XMLHttpRequest,n=this.stats;n.loading.first=0,n.loaded=0,n.aborted=!1;const i=this.xhrSetup;i?Promise.resolve().then((()=>{if(this.loader===r&&!this.stats.aborted)return i(r,t.url)})).catch((e=>{if(this.loader===r&&!this.stats.aborted)return r.open("GET",t.url,!0),i(r,t.url)})).then((()=>{this.loader!==r||this.stats.aborted||this.openAndSendXhr(r,t,e)})).catch((e=>{this.callbacks.onError({code:r.status,text:e.message},t,r,n)})):this.openAndSendXhr(r,t,e)}openAndSendXhr(e,t,r){e.readyState||e.open("GET",t.url,!0);const n=t.headers,{maxTimeToFirstByteMs:i,maxLoadTimeMs:a}=r.loadPolicy;if(n)for(const o in n)e.setRequestHeader(o,n[o]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),r.timeout=i&&m(i)?i:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:r}=this;if(!e||!t)return;const n=t.readyState,i=this.config;if(!r.aborted&&n>=2&&(0===r.loading.first&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),i.timeout!==i.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),i.timeout=i.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),4===n)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const n=t.status,a="text"!==t.responseType;if(n>=200&&n<300&&(a&&t.response||null!==t.responseText)){r.loading.end=Math.max(self.performance.now(),r.loading.first);const i=a?t.response:t.responseText,o="arraybuffer"===t.responseType?i.byteLength:i.length;if(r.loaded=r.total=o,r.bwEstimate=8e3*r.total/(r.loading.end-r.loading.first),!this.callbacks)return;const s=this.callbacks.onProgress;if(s&&s(r,e,i,t),!this.callbacks)return;const l={url:t.responseURL,data:i,code:n};this.callbacks.onSuccess(l,r,e,t)}else{const a=i.loadPolicy.errorRetry;fr(a,r.retry,!1,{url:e.url,data:void 0,code:n})?this.retry(a):(R.error(`${n} while loading ${e.url}`),this.callbacks.onError({code:n,text:t.statusText},e,t,r))}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry;if(fr(e,this.stats.retry,!0))this.retry(e);else{var t;R.warn(`timeout while loading ${null==(t=this.context)?void 0:t.url}`);const e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:r}=this;this.retryDelay=ur(e,r.retry),r.retry++,R.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${null==t?void 0:t.url}, retrying ${r.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&Ro.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const wo=/(\d+)-(\d+)\/(\d+)/;class Co{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||Do,this.controller=new self.AbortController,this.stats=new N}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,r){const n=this.stats;if(n.loading.start)throw new Error("Loader can only be used once.");n.loading.start=self.performance.now();const i=function(e,t){const r={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(g({},e.headers))};e.rangeEnd&&r.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1));return r}(e,this.controller.signal),a=r.onProgress,o="arraybuffer"===e.responseType,s=o?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:u}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,i),self.clearTimeout(this.requestTimeout),t.timeout=l&&m(l)?l:u,this.requestTimeout=self.setTimeout((()=>{this.abortInternal(),r.onTimeout(n,e,this.response)}),t.timeout),self.fetch(this.request).then((i=>{this.response=this.loader=i;const s=Math.max(self.performance.now(),n.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=u,this.requestTimeout=self.setTimeout((()=>{this.abortInternal(),r.onTimeout(n,e,this.response)}),u-(s-n.loading.start)),!i.ok){const{status:e,statusText:t}=i;throw new Lo(t||"fetch, bad network response",e,i)}return n.loading.first=s,n.total=function(e){const t=e.get("Content-Range");if(t){const e=function(e){const t=wo.exec(e);if(t)return parseInt(t[2])-parseInt(t[1])+1}(t);if(m(e))return e}const r=e.get("Content-Length");if(r)return parseInt(r)}(i.headers)||n.total,a&&m(t.highWaterMark)?this.loadProgressively(i,n,e,t.highWaterMark,a):o?i.arrayBuffer():"json"===e.responseType?i.json():i.text()})).then((i=>{const o=this.response;if(!o)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),n.loading.end=Math.max(self.performance.now(),n.loading.first);const l=i[s];l&&(n.loaded=n.total=l);const u={url:o.url,data:i,code:o.status};a&&!m(t.highWaterMark)&&a(n,e,i,o),r.onSuccess(u,n,e,o)})).catch((t=>{if(self.clearTimeout(this.requestTimeout),n.aborted)return;const i=t&&t.code||0,a=t?t.message:null;r.onError({code:i,text:a},e,t?t.details:null,n)}))}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,r,n=0,i){const a=new Sn,o=e.body.getReader(),s=()=>o.read().then((o=>{if(o.done)return a.dataLength&&i(t,r,a.flush(),e),Promise.resolve(new ArrayBuffer(0));const l=o.value,u=l.length;return t.loaded+=u,u<n||a.dataLength?(a.push(l),a.dataLength>=n&&i(t,r,a.flush(),e)):i(t,r,l,e),s()})).catch((()=>Promise.reject()));return s()}}function Do(e,t){return new self.Request(e.url,t)}class Lo extends Error{constructor(e,t,r){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=r}}const No=/\s/,Oo={newCue(e,t,r,n){const i=[];let a,o,s,l,u;const c=self.VTTCue||self.TextTrackCue;for(let d=0;d<n.rows.length;d++)if(a=n.rows[d],s=!0,l=0,u="",!a.isEmpty()){var f;for(let e=0;e<a.chars.length;e++)No.test(a.chars[e].uchar)&&s?l++:(u+=a.chars[e].uchar,s=!1);a.cueStartTime=t,t===r&&(r+=1e-4),l>=16?l--:l++;const n=fa(u.trim()),h=pa(t,r,n);null!=e&&null!=(f=e.cues)&&f.getCueById(h)||(o=new c(t,r,n),o.id=h,o.line=d+1,o.align="left",o.position=10+Math.min(80,10*Math.floor(8*l/32)),i.push(o))}return e&&i.length&&(i.sort(((e,t)=>"auto"===e.line||"auto"===t.line?0:e.line>8&&t.line>8?t.line-e.line:e.line-t.line)),i.forEach((t=>Nt(e,t)))),i}},Mo=f(f({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:Io,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:class{constructor(e){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this._abandonRulesCheck=()=>{const{fragCurrent:e,partCurrent:t,hls:r}=this,{autoLevelEnabled:n,media:i}=r;if(!e||!i)return;const a=performance.now(),o=t?t.stats:e.stats,s=t?t.duration:e.duration,l=a-o.loading.start,u=r.minAutoLevel;if(o.aborted||o.loaded&&o.loaded===o.total||e.level<=u)return this.clearTimer(),void(this._nextAutoLevel=-1);if(!n||i.paused||!i.playbackRate||!i.readyState)return;const c=r.mainForwardBufferInfo;if(null===c)return;const f=this.bwEstimator.getEstimateTTFB(),d=Math.abs(i.playbackRate);if(l<=Math.max(f,s/(2*d)*1e3))return;const h=c.len/d,g=o.loading.first?o.loading.first-o.loading.start:-1,p=o.loaded&&g>-1,y=this.getBwEstimate(),v=r.levels,T=v[e.level],_=o.total||Math.max(o.loaded,Math.round(s*T.averageBitrate/8));let S=p?l-g:l;S<1&&p&&(S=Math.min(l,8*o.loaded/y));const A=p?1e3*o.loaded/S:0,b=A?(_-o.loaded)/A:8*_/y+f/1e3;if(b<=h)return;const I=A?8*A:y;let w,C=Number.POSITIVE_INFINITY;for(w=e.level-1;w>u;w--){const e=v[w].maxBitrate;if(C=this.getTimeToLoadFrag(f/1e3,I,s*e,!v[w].details),C<h)break}if(C>=b)return;if(C>10*s)return;r.nextLoadLevel=r.nextAutoLevel=w,p?this.bwEstimator.sample(l-Math.min(f,g),o.loaded):this.bwEstimator.sampleTTFB(l);const D=v[w].maxBitrate;this.getBwEstimate()*this.hls.config.abrBandWidthUpFactor>D&&this.resetEstimator(D),this.clearTimer(),R.warn(`[abr] Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} is loading too slowly;\n      Time to underbuffer: ${h.toFixed(3)} s\n      Estimated load time for current fragment: ${b.toFixed(3)} s\n      Estimated load time for down switch fragment: ${C.toFixed(3)} s\n      TTFB estimate: ${0|g} ms\n      Current BW estimate: ${m(y)?0|y:"Unknown"} bps\n      New BW estimate: ${0|this.getBwEstimate()} bps\n      Switching to level ${w} @ ${0|D} bps`),r.trigger(E.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,part:t,stats:o})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(R.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new Rr(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.FRAG_LOADING,this.onFragLoading,this),e.on(E.FRAG_LOADED,this.onFragLoaded,this),e.on(E.FRAG_BUFFERED,this.onFragBuffered,this),e.on(E.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(E.LEVEL_LOADED,this.onLevelLoaded,this),e.on(E.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(E.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(E.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.FRAG_LOADING,this.onFragLoading,this),e.off(E.FRAG_LOADED,this.onFragLoaded,this),e.off(E.FRAG_BUFFERED,this.onFragBuffered,this),e.off(E.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(E.LEVEL_LOADED,this.onLevelLoaded,this),e.off(E.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(E.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(E.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const r=t.frag;if(!this.ignoreFragment(r)){var n;if(!r.bitrateTest)this.fragCurrent=r,this.partCurrent=null!=(n=t.part)?n:null;this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case T.BUFFER_ADD_CODEC_ERROR:case T.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case T.FRAG_LOAD_TIMEOUT:{const e=t.frag,{fragCurrent:r,partCurrent:n}=this;if(e&&r&&e.sn===r.sn&&e.level===r.level){const t=performance.now(),r=n?n.stats:e.stats,i=t-r.loading.start,a=r.loading.first?r.loading.first-r.loading.start:-1;if(r.loaded&&a>-1){const e=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(i-Math.min(e,a),r.loaded)}else this.bwEstimator.sampleTTFB(i)}break}}}getTimeToLoadFrag(e,t,r,n){return e+r/t+(n?this.lastLevelLoadSec:0)}onLevelLoaded(e,t){const r=this.hls.config,{loading:n}=t.stats,i=n.end-n.start;m(i)&&(this.lastLevelLoadSec=i/1e3),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD)}onFragLoaded(e,{frag:t,part:r}){const n=r?r.stats:t.stats;if(t.type===bt&&this.bwEstimator.sampleTTFB(n.loading.first-n.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const e=r?r.duration:t.duration,i=this.hls.levels[t.level],a=(i.loaded?i.loaded.bytes:0)+n.loaded,o=(i.loaded?i.loaded.duration:0)+e;i.loaded={bytes:a,duration:o},i.realBitrate=Math.round(8*a/o)}if(t.bitrateTest){const e={stats:n,frag:t,part:r,id:t.type};this.onFragBuffered(E.FRAG_BUFFERED,e),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:r,part:n}=t,i=null!=n&&n.stats.loaded?n.stats:r.stats;if(i.aborted)return;if(this.ignoreFragment(r))return;const a=i.parsing.end-i.loading.start-Math.min(i.loading.first-i.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,i.loaded),i.bwEstimate=this.getBwEstimate(),r.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==bt||"initSegment"===e.sn}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,r=this.getBwEstimate(),n=this.hls.config.maxStarvationDelay,i=this.findBestLevel(r,t,e,0,n,1,1);if(i>-1)return i;const a=this.hls.firstLevel,o=Math.min(Math.max(a,t),e);return R.warn(`[abr] Could not find best starting auto level. Defaulting to first in playlist ${a} clamped to ${o}`),o}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,t=this.bwEstimator.canEstimate(),r=this.lastLoadedFragLevel>-1;if(!(-1===e||t&&r&&this.nextAutoLevelKey!==this.getAutoLevelKey()))return e;const n=t&&r?this.getNextABRAutoLevel():this.firstAutoLevel;if(-1!==e){const t=this.hls.levels;if(t.length>Math.max(e,n)&&t[e].loadError<=t[n].loadError)return e}return this._nextAutoLevel=n,this.nextAutoLevelKey=this.getAutoLevelKey(),n}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:r}=this,{maxAutoLevel:n,config:i,minAutoLevel:a}=r,o=t?t.duration:e?e.duration:0,s=this.getBwEstimate(),l=this.getStarvationDelay();let u=i.abrBandWidthFactor,c=i.abrBandWidthUpFactor;if(l){const e=this.findBestLevel(s,a,n,l,0,u,c);if(e>=0)return e}let f=o?Math.min(o,i.maxStarvationDelay):i.maxStarvationDelay;if(!l){const e=this.bitrateTestDelay;if(e){f=(o?Math.min(o,i.maxLoadingDelay):i.maxLoadingDelay)-e,R.info(`[abr] bitrate test took ${Math.round(1e3*e)}ms, set first fragment max fetchDuration to ${Math.round(1e3*f)} ms`),u=c=1}}const d=this.findBestLevel(s,a,n,l,f,u,c);if(R.info(`[abr] ${l?"rebuffering expected":"buffer is empty"}, optimal quality level ${d}`),d>-1)return d;const h=r.levels[a],g=r.levels[r.loadLevel];return(null==h?void 0:h.bitrate)<(null==g?void 0:g.bitrate)?a:r.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const r=t&&0!==t.playbackRate?Math.abs(t.playbackRate):1,n=e.mainForwardBufferInfo;return(n?n.len:0)/r}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,r,n,i,a,o){var s;const l=n+i,u=this.lastLoadedFragLevel,c=-1===u?this.hls.firstLevel:u,{fragCurrent:f,partCurrent:d}=this,{levels:h,allAudioTracks:g,loadLevel:p,config:y}=this.hls;if(1===h.length)return 0;const E=h[c],v=!(null==E||null==(s=E.details)||!s.live),T=-1===p||-1===u;let _,S="SDR",A=(null==E?void 0:E.frameRate)||0;const{audioPreference:b,videoPreference:I}=y,w=this.audioTracksByGroup||(this.audioTracksByGroup=function(e){return e.reduce(((e,t)=>{let r=e.groups[t.groupId];r||(r=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),r.tracks.push(t);const n=t.channels||"2";return r.channels[n]=(r.channels[n]||0)+1,r.hasDefault=r.hasDefault||t.default,r.hasAutoSelect=r.hasAutoSelect||t.autoselect,r.hasDefault&&(e.hasDefaultAudio=!0),r.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e}),{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}(g));if(T){if(-1!==this.firstSelection)return this.firstSelection;const n=this.codecTiers||(this.codecTiers=function(e,t,r,n){return e.slice(r,n+1).reduce(((e,r)=>{if(!r.codecSet)return e;const n=r.audioGroups;let i=e[r.codecSet];i||(e[r.codecSet]=i={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!n,fragmentError:0}),i.minBitrate=Math.min(i.minBitrate,r.bitrate);const a=Math.min(r.height,r.width);return i.minHeight=Math.min(i.minHeight,a),i.minFramerate=Math.min(i.minFramerate,r.frameRate),i.maxScore=Math.max(i.maxScore,r.score),i.fragmentError+=r.fragmentError,i.videoRanges[r.videoRange]=(i.videoRanges[r.videoRange]||0)+1,n&&n.forEach((e=>{if(!e)return;const r=t.groups[e];r&&(i.hasDefaultAudio=i.hasDefaultAudio||t.hasDefaultAudio?r.hasDefault:r.hasAutoSelect||!t.hasDefaultAudio&&!t.hasAutoSelectAudio,Object.keys(r.channels).forEach((e=>{i.channels[e]=(i.channels[e]||0)+r.channels[e]})))})),e}),{})}(h,w,t,r)),i=function(e,t,r,n,i){const a=Object.keys(e),o=null==n?void 0:n.channels,s=null==n?void 0:n.audioCodec,l=o&&2===parseInt(o);let u=!0,c=!1,f=1/0,d=1/0,h=1/0,g=0,p=[];const{preferHDR:y,allowedVideoRanges:E}=Lr(t,i);for(let m=a.length;m--;){const t=e[a[m]];u=t.channels[2]>0,f=Math.min(f,t.minHeight),d=Math.min(d,t.minFramerate),h=Math.min(h,t.minBitrate);const r=E.filter((e=>t.videoRanges[e]>0));r.length>0&&(c=!0,p=r)}f=m(f)?f:0,d=m(d)?d:0;const v=Math.max(1080,f),T=Math.max(30,d);return h=m(h)?h:r,r=Math.max(h,r),c||(t=void 0,p=[]),{codecSet:a.reduce(((t,n)=>{const i=e[n];if(n===t)return t;if(i.minBitrate>r)return Nr(n,`min bitrate of ${i.minBitrate} > current estimate of ${r}`),t;if(!i.hasDefaultAudio)return Nr(n,"no renditions with default or auto-select sound found"),t;if(s&&n.indexOf(s.substring(0,4))%5!=0)return Nr(n,`audio codec preference "${s}" not found`),t;if(o&&!l){if(!i.channels[o])return Nr(n,`no renditions with ${o} channel sound found (channels options: ${Object.keys(i.channels)})`),t}else if((!s||l)&&u&&0===i.channels[2])return Nr(n,"no renditions with stereo sound found"),t;return i.minHeight>v?(Nr(n,`min resolution of ${i.minHeight} > maximum of ${v}`),t):i.minFramerate>T?(Nr(n,`min framerate of ${i.minFramerate} > maximum of ${T}`),t):p.some((e=>i.videoRanges[e]>0))?i.maxScore<g?(Nr(n,`max score of ${i.maxScore} < selected max of ${g}`),t):t&&(rt(n)>=rt(t)||i.fragmentError>e[t].fragmentError)?t:(g=i.maxScore,n):(Nr(n,`no variants with VIDEO-RANGE of ${JSON.stringify(p)} found`),t)}),void 0),videoRanges:p,preferHDR:y,minFramerate:d,minBitrate:h}}(n,S,e,b,I),{codecSet:a,videoRanges:o,minFramerate:s,minBitrate:l,preferHDR:u}=i;_=a,S=u?o[o.length-1]:o[0],A=s,e=Math.max(e,l),R.log(`[abr] picked start tier ${JSON.stringify(i)}`)}else _=null==E?void 0:E.codecSet,S=null==E?void 0:E.videoRange;const C=d?d.duration:f?f.duration:0,D=this.bwEstimator.getEstimateTTFB()/1e3,L=[];for(let O=r;O>=t;O--){var N;const t=h[O],s=O>c;if(!t)continue;if(y.useMediaCapabilities&&!t.supportedResult&&!t.supportedPromise){const r=navigator.mediaCapabilities;"function"==typeof(null==r?void 0:r.decodingInfo)&&Cr(t,w,S,A,e,b)?(t.supportedPromise=Dr(t,w,r),t.supportedPromise.then((e=>{if(!this.hls)return;t.supportedResult=e;const r=this.hls.levels,n=r.indexOf(t);e.error?R.warn(`[abr] MediaCapabilities decodingInfo error: "${e.error}" for level ${n} ${JSON.stringify(e)}`):e.supported||(R.warn(`[abr] Unsupported MediaCapabilities decodingInfo result for level ${n} ${JSON.stringify(e)}`),n>-1&&r.length>1&&(R.log(`[abr] Removing unsupported level ${n}`),this.hls.removeLevel(n)))}))):t.supportedResult=Ir}if(_&&t.codecSet!==_||S&&t.videoRange!==S||s&&A>t.frameRate||!s&&A>0&&A<t.frameRate||t.supportedResult&&(null==(N=t.supportedResult.decodingInfoResults)||!N[0].smooth)){L.push(O);continue}const f=t.details,g=(d?null==f?void 0:f.partTarget:null==f?void 0:f.averagetargetduration)||C;let I;I=s?o*e:a*e;const M=C&&n>=2*C&&0===i?h[O].averageBitrate:h[O].maxBitrate,P=this.getTimeToLoadFrag(D,I,M*g,void 0===f);if(I>=M&&(O===u||0===t.loadError&&0===t.fragmentError)&&(P<=D||!m(P)||v&&!this.bitrateTestDelay||P<l)){const e=this.forcedAutoLevel;return O===p||-1!==e&&e===p||(L.length&&R.trace(`[abr] Skipped level(s) ${L.join(",")} of ${r} max with CODECS and VIDEO-RANGE:"${h[L[0]].codecs}" ${h[L[0]].videoRange}; not compatible with "${E.codecs}" ${S}`),R.info(`[abr] switch candidate:${c}->${O} adjustedbw(${Math.round(I)})-bitrate=${Math.round(I-M)} ttfb:${D.toFixed(1)} avgDuration:${g.toFixed(1)} maxFetchDuration:${l.toFixed(1)} fetchDuration:${P.toFixed(1)} firstSelection:${T} codecSet:${_} videoRange:${S} hls.loadLevel:${p}`)),T&&(this.firstSelection=O),O}}return-1}set nextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:r}=this.hls,n=Math.min(Math.max(e,r),t);this._nextAutoLevel!==n&&(this.nextAutoLevelKey="",this._nextAutoLevel=n)}},bufferController:class{constructor(e){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendSource=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this.log=void 0,this.warn=void 0,this.error=void 0,this._onEndStreaming=e=>{this.hls&&this.hls.pauseBuffering()},this._onStartStreaming=e=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=()=>{const{media:e,mediaSource:t}=this;this.log("Media source opened"),e&&(e.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(E.MEDIA_ATTACHED,{media:e,mediaSource:t})),t&&t.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:e,_objectUrl:t}=this;e!==t&&R.error(`Media element src was set while attaching MediaSource (${t} > ${e})`)},this.hls=e;const t="[buffer-controller]";var r;this.appendSource=(r=We(e.config.preferManagedMediaSource),"undefined"!=typeof self&&r===self.ManagedMediaSource),this.log=R.log.bind(R,t),this.warn=R.warn.bind(R,t),this.error=R.error.bind(R,t),this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null,this.hls=null}registerListeners(){const{hls:e}=this;e.on(E.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.MANIFEST_PARSED,this.onManifestParsed,this),e.on(E.BUFFER_RESET,this.onBufferReset,this),e.on(E.BUFFER_APPENDING,this.onBufferAppending,this),e.on(E.BUFFER_CODECS,this.onBufferCodecs,this),e.on(E.BUFFER_EOS,this.onBufferEos,this),e.on(E.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(E.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(E.FRAG_PARSED,this.onFragParsed,this),e.on(E.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){const{hls:e}=this;e.off(E.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.MANIFEST_PARSED,this.onManifestParsed,this),e.off(E.BUFFER_RESET,this.onBufferReset,this),e.off(E.BUFFER_APPENDING,this.onBufferAppending,this),e.off(E.BUFFER_CODECS,this.onBufferCodecs,this),e.off(E.BUFFER_EOS,this.onBufferEos,this),e.off(E.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(E.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(E.FRAG_PARSED,this.onFragParsed,this),e.off(E.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new Pi(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.appendErrors={audio:0,video:0,audiovideo:0},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){let r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=r,this.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(e,t){const r=this.media=t.media,n=We(this.appendSource);if(r&&n){var i;const e=this.mediaSource=new n;this.log(`created media source: ${null==(i=e.constructor)?void 0:i.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming));const t=this._objectUrl=self.URL.createObjectURL(e);if(this.appendSource)try{r.removeAttribute("src");const n=self.ManagedMediaSource;r.disableRemotePlayback=r.disableRemotePlayback||n&&e instanceof n,xi(r),function(e,t){const r=self.document.createElement("source");r.type="video/mp4",r.src=t,e.appendChild(r)}(r,t),r.load()}catch(a){r.src=t}else r.src=t;r.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){const{media:e,mediaSource:t,_objectUrl:r}=this;if(t){if(this.log("media source detaching"),"open"===t.readyState)try{t.endOfStream()}catch(jo){this.warn(`onMediaDetaching: ${jo.message} while calling endOfStream`)}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(t.removeEventListener("startstreaming",this._onStartStreaming),t.removeEventListener("endstreaming",this._onEndStreaming)),e&&(e.removeEventListener("emptied",this._onMediaEmptied),r&&self.URL.revokeObjectURL(r),this.mediaSrc===r?(e.removeAttribute("src"),this.appendSource&&xi(e),e.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(E.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach((e=>{this.resetBuffer(e)})),this._initSourceBuffer()}resetBuffer(e){const t=this.sourceBuffer[e];try{var r;if(t)this.removeBufferListeners(e),this.sourceBuffer[e]=void 0,null!=(r=this.mediaSource)&&r.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(t)}catch(jo){this.warn(`onBufferReset ${e}`,jo)}}onBufferCodecs(e,t){const r=this.getSourceBufferTypes().length,n=Object.keys(t);if(n.forEach((e=>{if(r){const r=this.tracks[e];if(r&&"function"==typeof r.buffer.changeType){var n;const{id:i,codec:a,levelCodec:o,container:s,metadata:l}=t[e],u=ot(r.codec,r.levelCodec),c=null==u?void 0:u.replace(ki,"$1");let f=ot(a,o);const d=null==(n=f)?void 0:n.replace(ki,"$1");if(f&&c!==d){"audio"===e.slice(0,5)&&(f=at(f,this.appendSource));const t=`${s};codecs=${f}`;this.appendChangeType(e,t),this.log(`switching codec ${u} to ${f}`),this.tracks[e]={buffer:r.buffer,codec:a,container:s,levelCodec:o,metadata:l,id:i}}}}else this.pendingTracks[e]=t[e]})),r)return;const i=Math.max(this.bufferCodecEventsExpected-1,0);this.bufferCodecEventsExpected!==i&&(this.log(`${i} bufferCodec event(s) expected ${n.join(",")}`),this.bufferCodecEventsExpected=i),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks()}appendChangeType(e,t){const{operationQueue:r}=this,n={execute:()=>{const n=this.sourceBuffer[e];n&&(this.log(`changing ${e} sourceBuffer type to ${t}`),n.changeType(t)),r.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:t=>{this.warn(`Failed to change ${e} SourceBuffer type`,t)}};r.append(n,e,!!this.pendingTracks[e])}onBufferAppending(e,t){const{hls:r,operationQueue:n,tracks:i}=this,{data:a,type:o,frag:s,part:l,chunkMeta:u}=t,c=u.buffering[o],f=self.performance.now();c.start=f;const d=s.stats.buffering,h=l?l.stats.buffering:null;0===d.start&&(d.start=f),h&&0===h.start&&(h.start=f);const g=i.audio;let m=!1;"audio"===o&&"audio/mpeg"===(null==g?void 0:g.container)&&(m=!this.lastMpegAudioChunk||1===u.id||this.lastMpegAudioChunk.sn!==u.sn,this.lastMpegAudioChunk=u);const p=s.start,y={execute:()=>{if(c.executeStart=self.performance.now(),m){const e=this.sourceBuffer[o];if(e){const t=p-e.timestampOffset;Math.abs(t)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${p} (delta: ${t}) sn: ${s.sn})`),e.timestampOffset=p)}}this.appendExecutor(a,o)},onStart:()=>{},onComplete:()=>{const e=self.performance.now();c.executeEnd=c.end=e,0===d.first&&(d.first=e),h&&0===h.first&&(h.first=e);const{sourceBuffer:t}=this,r={};for(const n in t)r[n]=qr.getBuffered(t[n]);this.appendErrors[o]=0,"audio"===o||"video"===o?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(E.BUFFER_APPENDED,{type:o,frag:s,part:l,chunkMeta:u,parent:s.type,timeRanges:r})},onError:e=>{const t={type:v.MEDIA_ERROR,parent:s.type,details:T.BUFFER_APPEND_ERROR,sourceBufferName:o,frag:s,part:l,chunkMeta:u,error:e,err:e,fatal:!1};if(e.code===DOMException.QUOTA_EXCEEDED_ERR)t.details=T.BUFFER_FULL_ERROR;else{const e=++this.appendErrors[o];t.details=T.BUFFER_APPEND_ERROR,this.warn(`Failed ${e}/${r.config.appendErrorMaxRetry} times to append segment in "${o}" sourceBuffer`),e>=r.config.appendErrorMaxRetry&&(t.fatal=!0)}r.trigger(E.ERROR,t)}};n.append(y,o,!!this.pendingTracks[o])}onBufferFlushing(e,t){const{operationQueue:r}=this,n=e=>({execute:this.removeExecutor.bind(this,e,t.startOffset,t.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(E.BUFFER_FLUSHED,{type:e})},onError:t=>{this.warn(`Failed to remove from ${e} SourceBuffer`,t)}});t.type?r.append(n(t.type),t.type):this.getSourceBufferTypes().forEach((e=>{r.append(n(e),e)}))}onFragParsed(e,t){const{frag:r,part:n}=t,i=[],a=n?n.elementaryStreams:r.elementaryStreams;a[P]?i.push("audiovideo"):(a[O]&&i.push("audio"),a[M]&&i.push("video"));0===i.length&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${r.type} level: ${r.level} sn: ${r.sn}`),this.blockBuffers((()=>{const e=self.performance.now();r.stats.buffering.end=e,n&&(n.stats.buffering.end=e);const t=n?n.stats:r.stats;this.hls.trigger(E.FRAG_BUFFERED,{frag:r,part:n,stats:t,id:r.type})}),i)}onFragChanged(e,t){this.trimBuffers()}onBufferEos(e,t){this.getSourceBufferTypes().reduce(((e,r)=>{const n=this.sourceBuffer[r];return!n||t.type&&t.type!==r||(n.ending=!0,n.ended||(n.ended=!0,this.log(`${r} sourceBuffer now EOS`))),e&&!(n&&!n.ended)}),!0)&&(this.log("Queueing mediaSource.endOfStream()"),this.blockBuffers((()=>{this.getSourceBufferTypes().forEach((e=>{const t=this.sourceBuffer[e];t&&(t.ending=!1)}));const{mediaSource:e}=this;e&&"open"===e.readyState?(this.log("Calling mediaSource.endOfStream()"),e.endOfStream()):e&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${e.readyState}`)})))}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}trimBuffers(){const{hls:e,details:t,media:r}=this;if(!r||null===t)return;if(!this.getSourceBufferTypes().length)return;const n=e.config,i=r.currentTime,a=t.levelTargetDuration,o=t.live&&null!==n.liveBackBufferLength?n.liveBackBufferLength:n.backBufferLength;if(m(o)&&o>0){const e=Math.max(o,a),t=Math.floor(i/a)*a-e;this.flushBackBuffer(i,a,t)}if(m(n.frontBufferFlushThreshold)&&n.frontBufferFlushThreshold>0){const e=Math.max(n.maxBufferLength,n.frontBufferFlushThreshold),t=Math.max(e,a),r=Math.floor(i/a)*a+t;this.flushFrontBuffer(i,a,r)}}flushBackBuffer(e,t,r){const{details:n,sourceBuffer:i}=this;this.getSourceBufferTypes().forEach((a=>{const o=i[a];if(o){const i=qr.getBuffered(o);if(i.length>0&&r>i.start(0)){if(this.hls.trigger(E.BACK_BUFFER_REACHED,{bufferEnd:r}),null!=n&&n.live)this.hls.trigger(E.LIVE_BACK_BUFFER_REACHED,{bufferEnd:r});else if(o.ended&&i.end(i.length-1)-e<2*t)return void this.log(`Cannot flush ${a} back buffer while SourceBuffer is in ended state`);this.hls.trigger(E.BUFFER_FLUSHING,{startOffset:0,endOffset:r,type:a})}}}))}flushFrontBuffer(e,t,r){const{sourceBuffer:n}=this;this.getSourceBufferTypes().forEach((i=>{const a=n[i];if(a){const n=qr.getBuffered(a),o=n.length;if(o<2)return;const s=n.start(o-1),l=n.end(o-1);if(r>s||e>=s&&e<=l)return;if(a.ended&&e-l<2*t)return void this.log(`Cannot flush ${i} front buffer while SourceBuffer is in ended state`);this.hls.trigger(E.BUFFER_FLUSHING,{startOffset:s,endOffset:1/0,type:i})}}))}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||"open"!==this.mediaSource.readyState)return;const{details:e,hls:t,media:r,mediaSource:n}=this,i=e.fragments[0].start+e.totalduration,a=r.duration,o=m(n.duration)?n.duration:0;e.live&&t.config.liveDurationInfinity?(n.duration=1/0,this.updateSeekableRange(e)):(i>o&&i>a||!m(a))&&(this.log(`Updating Media Source duration to ${i.toFixed(3)}`),n.duration=i)}updateSeekableRange(e){const t=this.mediaSource,r=e.fragments;if(r.length&&e.live&&null!=t&&t.setLiveSeekableRange){const n=Math.max(0,r[0].start),i=Math.max(n,n+e.totalduration);this.log(`Media Source duration is set to ${t.duration}. Setting seekable range to ${n}-${i}.`),t.setLiveSeekableRange(n,i)}}checkPendingTracks(){const{bufferCodecEventsExpected:e,operationQueue:t,pendingTracks:r}=this,n=Object.keys(r).length;if(n&&(!e||2===n||"audiovideo"in r)){this.createSourceBuffers(r),this.pendingTracks={};const e=this.getSourceBufferTypes();if(e.length)this.hls.trigger(E.BUFFER_CREATED,{tracks:this.tracks}),e.forEach((e=>{t.executeNext(e)}));else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(E.ERROR,{type:v.MEDIA_ERROR,details:T.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}}createSourceBuffers(e){const{sourceBuffer:t,mediaSource:r}=this;if(!r)throw Error("createSourceBuffers called when mediaSource was null");for(const i in e)if(!t[i]){var n;const a=e[i];if(!a)throw Error(`source buffer exists for track ${i}, however track does not`);let o=-1===(null==(n=a.levelCodec)?void 0:n.indexOf(","))?a.levelCodec:a.codec;o&&"audio"===i.slice(0,5)&&(o=at(o,this.appendSource));const s=`${a.container};codecs=${o}`;this.log(`creating sourceBuffer(${s})`);try{const e=t[i]=r.addSourceBuffer(s),n=i;this.addBufferListener(n,"updatestart",this._onSBUpdateStart),this.addBufferListener(n,"updateend",this._onSBUpdateEnd),this.addBufferListener(n,"error",this._onSBUpdateError),this.appendSource&&this.addBufferListener(n,"bufferedchange",((e,t)=>{const r=t.removedRanges;null!=r&&r.length&&this.hls.trigger(E.BUFFER_FLUSHED,{type:i})})),this.tracks[i]={buffer:e,codec:o,container:a.container,levelCodec:a.levelCodec,metadata:a.metadata,id:a.id}}catch(jo){this.error(`error while trying to add sourceBuffer: ${jo.message}`),this.hls.trigger(E.ERROR,{type:v.MEDIA_ERROR,details:T.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:jo,sourceBufferName:i,mimeType:s})}}}get mediaSrc(){var e;const t=(null==(e=this.media)?void 0:e.firstChild)||this.media;return null==t?void 0:t.src}_onSBUpdateStart(e){const{operationQueue:t}=this;t.current(e).onStart()}_onSBUpdateEnd(e){var t;if("closed"===(null==(t=this.mediaSource)?void 0:t.readyState))return void this.resetBuffer(e);const{operationQueue:r}=this;r.current(e).onComplete(),r.shiftAndExecuteNext(e)}_onSBUpdateError(e,t){var r;const n=new Error(`${e} SourceBuffer error. MediaSource readyState: ${null==(r=this.mediaSource)?void 0:r.readyState}`);this.error(`${n}`,t),this.hls.trigger(E.ERROR,{type:v.MEDIA_ERROR,details:T.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:n,fatal:!1});const i=this.operationQueue.current(e);i&&i.onError(n)}removeExecutor(e,t,r){const{media:n,mediaSource:i,operationQueue:a,sourceBuffer:o}=this,s=o[e];if(!n||!i||!s)return this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),void a.shiftAndExecuteNext(e);const l=m(n.duration)?n.duration:1/0,u=m(i.duration)?i.duration:1/0,c=Math.max(0,t),f=Math.min(r,l,u);f>c&&(!s.ending||s.ended)?(s.ended=!1,this.log(`Removing [${c},${f}] from the ${e} SourceBuffer`),s.remove(c,f)):a.shiftAndExecuteNext(e)}appendExecutor(e,t){const r=this.sourceBuffer[t];if(r)r.ended=!1,r.appendBuffer(e);else if(!this.pendingTracks[t])throw new Error(`Attempting to append to the ${t} SourceBuffer, but it does not exist`)}blockBuffers(e,t=this.getSourceBufferTypes()){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(e);const{operationQueue:r}=this,n=t.map((e=>r.appendBlocker(e)));Promise.all(n).then((()=>{e(),t.forEach((e=>{const t=this.sourceBuffer[e];null!=t&&t.updating||r.shiftAndExecuteNext(e)}))}))}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(e,t,r){const n=this.sourceBuffer[e];if(!n)return;const i=r.bind(this,e);this.listeners[e].push({event:t,listener:i}),n.addEventListener(t,i)}removeBufferListeners(e){const t=this.sourceBuffer[e];t&&this.listeners[e].forEach((e=>{t.removeEventListener(e.event,e.listener)}))}},capLevelController:Na,errorController:class{constructor(e){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=e,this.log=R.log.bind(R,"[info]:"),this.warn=R.warn.bind(R,"[warning]:"),this.error=R.error.bind(R,"[error]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(E.ERROR,this.onError,this),e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(E.ERROR,this.onError,this),e.off(E.ERROR,this.onErrorOut,this),e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(null==e?void 0:e.type)===bt?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var r,n;if(t.fatal)return;const i=this.hls,a=t.context;switch(t.details){case T.FRAG_LOAD_ERROR:case T.FRAG_LOAD_TIMEOUT:case T.KEY_LOAD_ERROR:case T.KEY_LOAD_TIMEOUT:return void(t.errorAction=this.getFragRetryOrSwitchAction(t));case T.FRAG_PARSING_ERROR:if(null!=(r=t.frag)&&r.gap)return void(t.errorAction={action:pr,flags:Tr});case T.FRAG_GAP:case T.FRAG_DECRYPT_ERROR:return t.errorAction=this.getFragRetryOrSwitchAction(t),void(t.errorAction.action=yr);case T.LEVEL_EMPTY_ERROR:case T.LEVEL_PARSING_ERROR:{var o,s;const e=t.parent===bt?t.level:i.loadLevel;t.details===T.LEVEL_EMPTY_ERROR&&null!=(o=t.context)&&null!=(s=o.levelDetails)&&s.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,e):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,e))}return;case T.LEVEL_LOAD_ERROR:case T.LEVEL_LOAD_TIMEOUT:return void("number"==typeof(null==a?void 0:a.level)&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,a.level)));case T.AUDIO_TRACK_LOAD_ERROR:case T.AUDIO_TRACK_LOAD_TIMEOUT:case T.SUBTITLE_LOAD_ERROR:case T.SUBTITLE_TRACK_LOAD_TIMEOUT:if(a){const e=i.levels[i.loadLevel];if(e&&(a.type===St&&e.hasAudioGroup(a.groupId)||a.type===At&&e.hasSubtitleGroup(a.groupId)))return t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.loadLevel),t.errorAction.action=yr,void(t.errorAction.flags=_r)}return;case T.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const e=i.levels[i.loadLevel],r=null==e?void 0:e.attrs["HDCP-LEVEL"];r?t.errorAction={action:yr,flags:Sr,hdcpLevel:r}:this.keySystemError(t)}return;case T.BUFFER_ADD_CODEC_ERROR:case T.REMUX_ALLOC_ERROR:case T.BUFFER_APPEND_ERROR:return void(t.errorAction=this.getLevelSwitchAction(t,null!=(n=t.level)?n:i.loadLevel));case T.INTERNAL_EXCEPTION:case T.BUFFER_APPENDING_ERROR:case T.BUFFER_FULL_ERROR:case T.LEVEL_SWITCH_ERROR:case T.BUFFER_STALLED_ERROR:case T.BUFFER_SEEK_OVER_HOLE:case T.BUFFER_NUDGE_ON_STALL:return void(t.errorAction={action:pr,flags:Tr})}t.type===v.KEY_SYSTEM_ERROR&&this.keySystemError(t)}keySystemError(e){const t=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t)}getPlaylistRetryOrSwitchAction(e,t){const r=lr(this.hls.config.playlistLoadPolicy,e),n=this.playlistError++;if(fr(r,n,sr(e),e.response))return{action:vr,flags:Tr,retryConfig:r,retryCount:n};const i=this.getLevelSwitchAction(e,t);return r&&(i.retryConfig=r,i.retryCount=n),i}getFragRetryOrSwitchAction(e){const t=this.hls,r=this.getVariantLevelIndex(e.frag),n=t.levels[r],{fragLoadPolicy:i,keyLoadPolicy:a}=t.config,o=lr(e.details.startsWith("key")?a:i,e),s=t.levels.reduce(((e,t)=>e+t.fragmentError),0);if(n){e.details!==T.FRAG_GAP&&n.fragmentError++;if(fr(o,s,sr(e),e.response))return{action:vr,flags:Tr,retryConfig:o,retryCount:s}}const l=this.getLevelSwitchAction(e,r);return o&&(l.retryConfig=o,l.retryCount=s),l}getLevelSwitchAction(e,t){const r=this.hls;null==t&&(t=r.loadLevel);const n=this.hls.levels[t];if(n){var i,a;const t=e.details;n.loadError++,t===T.BUFFER_APPEND_ERROR&&n.fragmentError++;let l=-1;const{levels:u,loadLevel:c,minAutoLevel:f,maxAutoLevel:d}=r;r.autoLevelEnabled||(r.loadLevel=-1);const h=null==(i=e.frag)?void 0:i.type,g=(h===Rt&&t===T.FRAG_PARSING_ERROR||"audio"===e.sourceBufferName&&(t===T.BUFFER_ADD_CODEC_ERROR||t===T.BUFFER_APPEND_ERROR))&&u.some((({audioCodec:e})=>n.audioCodec!==e)),m="video"===e.sourceBufferName&&(t===T.BUFFER_ADD_CODEC_ERROR||t===T.BUFFER_APPEND_ERROR)&&u.some((({codecSet:e,audioCodec:t})=>n.codecSet!==e&&n.audioCodec===t)),{type:p,groupId:y}=null!=(a=e.context)?a:{};for(let r=u.length;r--;){const i=(r+c)%u.length;if(i!==c&&i>=f&&i<=d&&0===u[i].loadError){var o,s;const r=u[i];if(t===T.FRAG_GAP&&h===bt&&e.frag){const t=u[i].details;if(t){const r=hr(e.frag,t.fragments,e.frag.start);if(null!=r&&r.gap)continue}}else{if(p===St&&r.hasAudioGroup(y)||p===At&&r.hasSubtitleGroup(y))continue;if(h===Rt&&null!=(o=n.audioGroups)&&o.some((e=>r.hasAudioGroup(e)))||h===It&&null!=(s=n.subtitleGroups)&&s.some((e=>r.hasSubtitleGroup(e)))||g&&n.audioCodec===r.audioCodec||!g&&n.audioCodec!==r.audioCodec||m&&n.codecSet===r.codecSet)continue}l=i;break}}if(l>-1&&r.loadLevel!==l)return e.levelRetry=!0,this.playlistError=0,{action:yr,flags:Tr,nextAutoLevel:l}}return{action:yr,flags:_r}}onErrorOut(e,t){var r;switch(null==(r=t.errorAction)?void 0:r.action){case pr:break;case yr:this.sendAlternateToPenaltyBox(t),t.errorAction.resolved||t.details===T.FRAG_GAP?/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError()):t.fatal=!0}t.fatal&&this.hls.stopLoad()}sendAlternateToPenaltyBox(e){const t=this.hls,r=e.errorAction;if(!r)return;const{flags:n,hdcpLevel:i,nextAutoLevel:a}=r;switch(n){case Tr:this.switchLevel(e,a);break;case Sr:i&&(t.maxHdcpLevel=Yt[Yt.indexOf(i)-1],r.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`)}r.resolved||this.switchLevel(e,a)}switchLevel(e,t){void 0!==t&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}},fpsController:class{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(E.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(E.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const r=this.hls.config;if(r.capLevelOnFPSDrop){const e=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=e,e&&"function"==typeof e.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}}checkFPS(e,t,r){const n=performance.now();if(t){if(this.lastTime){const e=n-this.lastTime,i=r-this.lastDroppedFrames,a=t-this.lastDecodedFrames,o=1e3*i/e,s=this.hls;if(s.trigger(E.FPS_DROP,{currentDropped:i,currentDecoded:a,totalDroppedFrames:r}),o>0&&i>s.config.fpsDroppedMonitoringThreshold*a){let e=s.currentLevel;R.warn("drop FPS ratio greater than max allowed value for currentLevel: "+e),e>0&&(-1===s.autoLevelCapping||s.autoLevelCapping>=e)&&(e-=1,s.trigger(E.FPS_DROP_LEVEL_CAPPING,{level:e,droppedLevel:s.currentLevel}),s.autoLevelCapping=e,this.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=r,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}},stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:Q,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,useMediaCapabilities:!0,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:Oo,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:class extends _n{constructor(e,t,r){super(e,t,r,"[subtitle-stream-controller]",It),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}_registerListeners(){const{hls:e}=this;e.on(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.LEVEL_LOADED,this.onLevelLoaded,this),e.on(E.ERROR,this.onError,this),e.on(E.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(E.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(E.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(E.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(E.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(E.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.LEVEL_LOADED,this.onLevelLoaded,this),e.off(E.ERROR,this.onError,this),e.off(E.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(E.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(E.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(E.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(E.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(E.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(e){this.stopLoad(),this.state=cn,this.setInterval(500),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:r,success:n}=t;if(this.fragPrevious=r,this.state=cn,!n)return;const i=this.tracksBuffered[this.currentTrackId];if(!i)return;let a;const o=r.start;for(let l=0;l<i.length;l++)if(o>=i[l].start&&o<=i[l].end){a=i[l];break}const s=r.start+r.duration;a?a.end=s:(a={start:o,end:s},i.push(a)),this.fragmentTracker.fragBuffered(r),this.fragBufferedComplete(r,null)}onBufferFlushing(e,t){const{startOffset:r,endOffset:n}=t;if(0===r&&n!==Number.POSITIVE_INFINITY){const e=n-1;if(e<=0)return;t.endOffsetSubtitles=Math.max(0,e),this.tracksBuffered.forEach((t=>{for(let r=0;r<t.length;)if(t[r].end<=e)t.shift();else{if(!(t[r].start<e))break;t[r].start=e,r++}})),this.fragmentTracker.removeFragmentsInRange(r,e,It)}}onFragBuffered(e,t){var r;this.loadedmetadata||t.frag.type!==bt||null!=(r=this.media)&&r.buffered.length&&(this.loadedmetadata=!0)}onError(e,t){const r=t.frag;(null==r?void 0:r.type)===It&&(t.details===T.FRAG_GAP&&this.fragmentTracker.fragBuffered(r,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==un&&(this.state=cn))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){this.levels&&Li(this.levels,t)?this.levels=t.map((e=>new Xt(e))):(this.tracksBuffered=[],this.levels=t.map((e=>{const t=new Xt(e);return this.tracksBuffered[t.id]=[],t})),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,It),this.fragPrevious=null,this.mediaBuffer=null)}onSubtitleTrackSwitch(e,t){var r;if(this.currentTrackId=t.id,null==(r=this.levels)||!r.length||-1===this.currentTrackId)return void this.clearInterval();const n=this.levels[this.currentTrackId];null!=n&&n.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,n&&this.setInterval(500)}onSubtitleTrackLoaded(e,t){var r;const{currentTrackId:n,levels:i}=this,{details:a,id:o}=t;if(!i)return void this.warn(`Subtitle tracks were reset while loading level ${o}`);const s=i[o];if(o>=i.length||!s)return;this.log(`Subtitle track ${o} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let l=0;if(a.live||null!=(r=s.details)&&r.live){const e=this.mainDetails;if(a.deltaUpdateFailed||!e)return;const t=e.fragments[0];var u;if(s.details)l=this.alignPlaylists(a,s.details,null==(u=this.levelLastLoaded)?void 0:u.details),0===l&&t&&(l=t.start,nr(a,l));else a.hasProgramDateTime&&e.hasProgramDateTime?(Xr(a,e),l=a.fragments[0].start):t&&(l=t.start,nr(a,l))}if(s.details=a,this.levelLastLoaded=s,o===n&&(this.startFragRequested||!this.mainDetails&&a.live||this.setStartPosition(this.mainDetails||a,l),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===cn)){hr(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),s.details=void 0)}}_handleFragmentLoadComplete(e){const{frag:t,payload:r}=e,n=t.decryptdata,i=this.hls;if(!this.fragContextChanged(t)&&r&&r.byteLength>0&&null!=n&&n.key&&n.iv&&"AES-128"===n.method){const e=performance.now();this.decrypter.decrypt(new Uint8Array(r),n.key.buffer,n.iv.buffer).catch((e=>{throw i.trigger(E.ERROR,{type:v.MEDIA_ERROR,details:T.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:t}),e})).then((r=>{const n=performance.now();i.trigger(E.FRAG_DECRYPTED,{frag:t,payload:r,stats:{tstart:e,tdecrypt:n}})})).catch((e=>{this.warn(`${e.name}: ${e.message}`),this.state=cn}))}}doTick(){if(this.media){if(this.state===cn){const{currentTrackId:e,levels:t}=this,r=null==t?void 0:t[e];if(!r||!t.length||!r.details)return;const{config:n}=this,i=this.getLoadPosition(),a=qr.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],i,n.maxBufferHole),{end:o,len:s}=a,l=this.getFwdBufferInfo(this.media,bt),u=r.details;if(s>this.getMaxBufferLength(null==l?void 0:l.len)+u.levelTargetDuration)return;const c=u.fragments,f=c.length,d=u.edge;let h=null;const g=this.fragPrevious;if(o<d){const e=n.maxFragLookUpTolerance,t=o>d-e?0:e;h=hr(g,c,Math.max(c[0].start,o),t),!h&&g&&g.start<c[0].start&&(h=c[0])}else h=c[f-1];if(!h)return;if(h=this.mapToInitFragWhenRequired(h),"initSegment"!==h.sn){const e=c[h.sn-u.startSN-1];e&&e.cc===h.cc&&this.fragmentTracker.getState(e)===Fr&&(h=e)}this.fragmentTracker.getState(h)===Fr&&this.loadFragment(h,r,o)}}else this.state=cn}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.max(t,e):t}loadFragment(e,t,r){this.fragCurrent=e,"initSegment"===e.sn?this._loadInitSegment(e,t):(this.startFragRequested=!0,super.loadFragment(e,t,r))}get mediaBufferTimeRanges(){return new Mi(this.tracksBuffered[this.currentTrackId]||[])}},subtitleTrackController:class extends Ar{constructor(e){super(e,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let e=null;const t=Pt(this.media.textTracks);for(let n=0;n<t.length;n++)if("hidden"===t[n].mode)e=t[n];else if("showing"===t[n].mode){e=t[n];break}const r=this.findTrackForTextTrack(e);this.subtitleTrack!==r&&this.setSubtitleTrack(r)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.MANIFEST_PARSED,this.onManifestParsed,this),e.on(E.LEVEL_LOADING,this.onLevelLoading,this),e.on(E.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(E.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(E.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.MANIFEST_PARSED,this.onManifestParsed,this),e.off(E.LEVEL_LOADING,this.onLevelLoading,this),e.off(E.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(E.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(E.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(){if(!this.media)return;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);Pt(this.media.textTracks).forEach((e=>{Ot(e)})),this.subtitleTrack=-1,this.media=null}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:r,groupId:n,details:i}=t,a=this.tracksInGroup[r];if(!a||a.groupId!==n)return void this.warn(`Subtitle track with id:${r} and group:${n} not found in active group ${null==a?void 0:a.groupId}`);const o=a.details;a.details=t.details,this.log(`Subtitle track ${r} "${a.name}" lang:${a.lang} group:${n} loaded [${i.startSN}-${i.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.subtitleGroups||null,n=this.groupIds;let i=this.currentTrack;if(!r||(null==n?void 0:n.length)!==(null==r?void 0:r.length)||null!=r&&r.some((e=>-1===(null==n?void 0:n.indexOf(e))))){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const e=this.tracks.filter((e=>!r||-1!==r.indexOf(e.groupId)));if(e.length)this.selectDefaultTrack&&!e.some((e=>e.default))&&(this.selectDefaultTrack=!1),e.forEach(((e,t)=>{e.id=t}));else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=e;const t=this.hls.config.subtitlePreference;if(!i&&t){this.selectDefaultTrack=!1;const r=Or(t,e);if(r>-1)i=e[r];else{const e=Or(t,this.tracks);i=this.tracks[e]}}let n=this.findTrackId(i);-1===n&&i&&(n=this.findTrackId(null));const a={subtitleTracks:e};this.log(`Updating subtitle tracks, ${e.length} track(s) found in "${null==r?void 0:r.join(",")}" group-id`),this.hls.trigger(E.SUBTITLE_TRACKS_UPDATED,a),-1!==n&&-1===this.trackId&&this.setSubtitleTrack(n)}else this.shouldReloadPlaylist(i)&&this.setSubtitleTrack(this.trackId)}findTrackId(e){const t=this.tracksInGroup,r=this.selectDefaultTrack;for(let n=0;n<t.length;n++){const i=t[n];if((!r||i.default)&&(r||e)&&(!e||Mr(i,e)))return n}if(e){for(let r=0;r<t.length;r++){const n=t[r];if(Ni(e.attrs,n.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return r}for(let r=0;r<t.length;r++){const n=t[r];if(Ni(e.attrs,n.attrs,["LANGUAGE"]))return r}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){if(Oi(t[r],e))return r}}return-1}onError(e,t){!t.fatal&&t.context&&(t.context.type!==At||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||this.checkRetry(t))}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const r=this.currentTrack;if(r&&Mr(e,r))return r;const n=Or(e,this.tracksInGroup);if(n>-1){const e=this.tracksInGroup[n];return this.setSubtitleTrack(n),e}if(r)return null;{const r=Or(e,t);if(r>-1)return t[r]}}}return null}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;if(this.shouldLoadPlaylist(t)&&t){const n=t.id,i=t.groupId;let a=t.url;if(e)try{a=e.addDirectives(a)}catch(r){this.warn(`Could not construct new URL with HLS Delivery Directives: ${r}`)}this.log(`Loading subtitle playlist for id ${n}`),this.hls.trigger(E.SUBTITLE_TRACK_LOADING,{url:a,id:n,groupId:i,deliveryDirectives:e||null})}}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=Pt(e.textTracks),r=this.currentTrack;let n;if(r&&(n=t.filter((e=>Oi(r,e)))[0],n||this.warn(`Unable to find subtitle TextTrack with name "${r.name}" and language "${r.lang}"`)),[].slice.call(t).forEach((e=>{"disabled"!==e.mode&&e!==n&&(e.mode="disabled")})),n){const e=this.subtitleDisplay?"showing":"hidden";n.mode!==e&&(n.mode=e)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media)return void(this.queuedDefaultTrack=e);if(e<-1||e>=t.length||!m(e))return void this.warn(`Invalid subtitle track id: ${e}`);this.clearTimer(),this.selectDefaultTrack=!1;const r=this.currentTrack,n=t[e]||null;if(this.trackId=e,this.currentTrack=n,this.toggleTrackModes(),!n)return void this.hls.trigger(E.SUBTITLE_TRACK_SWITCH,{id:e});const i=!!n.details&&!n.details.live;if(e===this.trackId&&n===r&&i)return;this.log(`Switching to subtitle-track ${e}`+(n?` "${n.name}" lang:${n.lang} group:${n.groupId}`:""));const{id:a,groupId:o="",name:s,type:l,url:u}=n;this.hls.trigger(E.SUBTITLE_TRACK_SWITCH,{id:a,groupId:o,name:s,type:l,url:u});const c=this.switchParams(n.url,null==r?void 0:r.details,n.details);this.loadPlaylist(c)}},timelineController:class{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(E.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(E.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(E.FRAG_LOADING,this.onFragLoading,this),e.on(E.FRAG_LOADED,this.onFragLoaded,this),e.on(E.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(E.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(E.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(E.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(E.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(E.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(E.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(E.FRAG_LOADING,this.onFragLoading,this),e.off(E.FRAG_LOADED,this.onFragLoaded,this),e.off(E.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(E.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(E.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(E.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(E.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){if(this.config.enableCEA708Captions&&(!this.cea608Parser1||!this.cea608Parser2)){const e=new ra(this,"textTrack1"),t=new ra(this,"textTrack2"),r=new ra(this,"textTrack3"),n=new ra(this,"textTrack4");this.cea608Parser1=new Ji(1,e,t),this.cea608Parser2=new Ji(3,r,n)}}addCues(e,t,r,n,i){let a=!1;for(let c=i.length;c--;){const e=i[c],n=(o=e[0],s=e[1],l=t,u=r,Math.min(s,u)-Math.max(o,l));if(n>=0&&(e[0]=Math.min(e[0],t),e[1]=Math.max(e[1],r),a=!0,n/(r-t)>.5))return}var o,s,l,u;if(a||i.push([t,r]),this.config.renderTextTracksNatively){const i=this.captionsTracks[e];this.Cues.newCue(i,t,r,n)}else{const i=this.Cues.newCue(null,t,r,n);this.hls.trigger(E.CUES_PARSED,{type:"captions",cues:i,track:e})}}onInitPtsFound(e,{frag:t,id:r,initPTS:n,timescale:i}){const{unparsedVttFrags:a}=this;"main"===r&&(this.initPTS[t.cc]={baseTime:n,timescale:i}),a.length&&(this.unparsedVttFrags=[],a.forEach((e=>{this.onFragLoaded(E.FRAG_LOADED,e)})))}getExistingTrack(e,t){const{media:r}=this;if(r)for(let n=0;n<r.textTracks.length;n++){const i=r.textTracks[n];if(La(i,{name:e,lang:t,attrs:{}}))return i}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:r,media:n}=this,{label:i,languageCode:a}=t[e],o=this.getExistingTrack(i,a);if(o)r[e]=o,Ot(r[e]),Lt(r[e],n);else{const t=this.createTextTrack("captions",i,a);t&&(t[e]=!0,r[e]=t)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const r={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=r,this.hls.trigger(E.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}createTextTrack(e,t,r){const n=this.media;if(n)return n.addTextTrack(e,t,r)}onMediaAttaching(e,t){this.media=t.media,this._cleanTracks()}onMediaDetaching(){const{captionsTracks:e}=this;Object.keys(e).forEach((t=>{Ot(e[t]),delete e[t]})),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let r=0;r<t.length;r++)Ot(t[r])}onSubtitleTracksUpdated(e,t){const r=t.subtitleTracks||[],n=r.some((e=>e.textCodec===Ea));if(this.config.enableWebVTT||n&&this.config.enableIMSC1){if(Li(this.tracks,r))return void(this.tracks=r);if(this.textTracks=[],this.tracks=r,this.config.renderTextTracksNatively){const e=this.media,t=e?Pt(e.textTracks):null;if(this.tracks.forEach(((e,r)=>{let n;if(t){let r=null;for(let n=0;n<t.length;n++)if(t[n]&&La(t[n],e)){r=t[n],t[n]=null;break}r&&(n=r)}if(n)Ot(n);else{const t=Da(e);n=this.createTextTrack(t,e.name,e.lang),n&&(n.mode="disabled")}n&&this.textTracks.push(n)})),null!=t&&t.length){const e=t.filter((e=>null!==e)).map((e=>e.label));e.length&&R.warn(`Media element contains unused subtitle tracks: ${e.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const e=this.tracks.map((e=>({label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e})));this.hls.trigger(E.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:e})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach((e=>{const t=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(!t)return;const r=`textTrack${t[1]}`,n=this.captionsProperties[r];n&&(n.label=e.name,e.lang&&(n.languageCode=e.lang),n.media=e)}))}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return null==t?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===bt){var r,n;const{cea608Parser1:e,cea608Parser2:i,lastSn:a}=this,{cc:o,sn:s}=t.frag,l=null!=(r=null==(n=t.part)?void 0:n.index)?r:-1;e&&i&&(s!==a+1||s===a&&l!==this.lastPartIndex+1||o!==this.lastCc)&&(e.reset(),i.reset()),this.lastCc=o,this.lastSn=s,this.lastPartIndex=l}}onFragLoaded(e,t){const{frag:r,payload:n}=t;if(r.type===It)if(n.byteLength){const e=r.decryptdata,i="stats"in t;if(null==e||!e.encrypted||i){const e=this.tracks[r.level],i=this.vttCCs;i[r.cc]||(i[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),e&&e.textCodec===Ea?this._parseIMSC1(r,n):this._parseVTTs(t)}}else this.hls.trigger(E.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const r=this.hls;Sa(t,this.initPTS[e.cc],(t=>{this._appendCues(t,e.level),r.trigger(E.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})}),(t=>{R.log(`Failed to parse IMSC1: ${t}`),r.trigger(E.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})}))}_parseVTTs(e){var t;const{frag:r,payload:n}=e,{initPTS:i,unparsedVttFrags:a}=this,o=i.length-1;if(!i[r.cc]&&-1===o)return void a.push(e);const s=this.hls;ya(null!=(t=r.initSegment)&&t.data?xe(r.initSegment.data,new Uint8Array(n)):n,this.initPTS[r.cc],this.vttCCs,r.cc,r.start,(e=>{this._appendCues(e,r.level),s.trigger(E.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})}),(t=>{const i="Missing initPTS for VTT MPEGTS"===t.message;i?a.push(e):this._fallbackToIMSC1(r,n),R.log(`Failed to parse VTT cue: ${t}`),i&&o>r.cc||s.trigger(E.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:t})}))}_fallbackToIMSC1(e,t){const r=this.tracks[e.level];r.textCodec||Sa(t,this.initPTS[e.cc],(()=>{r.textCodec=Ea,this._parseIMSC1(e,t)}),(()=>{r.textCodec="wvtt"}))}_appendCues(e,t){const r=this.hls;if(this.config.renderTextTracksNatively){const r=this.textTracks[t];if(!r||"disabled"===r.mode)return;e.forEach((e=>Nt(r,e)))}else{const n=this.tracks[t];if(!n)return;const i=n.default?"default":"subtitles"+t;r.trigger(E.CUES_PARSED,{type:"subtitles",cues:e,track:i})}}onFragDecrypted(e,t){const{frag:r}=t;r.type===It&&this.onFragLoaded(E.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){this.initCea608Parsers();const{cea608Parser1:r,cea608Parser2:n}=this;if(!this.enabled||!r||!n)return;const{frag:i,samples:a}=t;if(i.type!==bt||"NONE"!==this.closedCaptionsForLevel(i))for(let o=0;o<a.length;o++){const e=a[o].bytes;if(e){const t=this.extractCea608Data(e);r.addData(a[o].pts,t[0]),n.addData(a[o].pts,t[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:r,endOffsetSubtitles:n,type:i}){const{media:a}=this;if(a&&!(a.currentTime<r)){if(!i||"video"===i){const{captionsTracks:e}=this;Object.keys(e).forEach((n=>Mt(e[n],t,r)))}if(this.config.renderTextTracksNatively&&0===t&&void 0!==n){const{textTracks:e}=this;Object.keys(e).forEach((r=>Mt(e[r],t,n)))}}}extractCea608Data(e){const t=[[],[]],r=31&e[0];let n=2;for(let i=0;i<r;i++){const r=e[n++],i=127&e[n++],a=127&e[n++];if(0===i&&0===a)continue;if(!!(4&r)){const e=3&r;0!==e&&1!==e||(t[e].push(i),t[e].push(a))}}return t}},audioStreamController:class extends _n{constructor(e,t,r){super(e,t,r,"[audio-stream-controller]",Rt),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){const{hls:e}=this;e.on(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.LEVEL_LOADED,this.onLevelLoaded,this),e.on(E.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(E.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(E.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(E.ERROR,this.onError,this),e.on(E.BUFFER_RESET,this.onBufferReset,this),e.on(E.BUFFER_CREATED,this.onBufferCreated,this),e.on(E.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(E.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(E.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(E.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.LEVEL_LOADED,this.onLevelLoaded,this),e.off(E.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(E.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(E.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(E.ERROR,this.onError,this),e.off(E.BUFFER_RESET,this.onBufferReset,this),e.off(E.BUFFER_CREATED,this.onBufferCreated,this),e.off(E.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(E.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(E.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(E.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(e,{frag:t,id:r,initPTS:n,timescale:i}){if("main"===r){const e=t.cc;this.initPTS[t.cc]={baseTime:n,timescale:i},this.log(`InitPTS for cc: ${e} found from main: ${n}`),this.videoTrackCC=e,this.state===vn&&this.tick()}}startLoad(e){if(!this.levels)return this.startPosition=e,void(this.state=un);const t=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),t>0&&-1===e?(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t,this.state=cn):(this.loadedmetadata=!1,this.state=gn),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}doTick(){switch(this.state){case cn:this.doTickIdle();break;case gn:{var e;const{levels:t,trackId:r}=this,n=null==t||null==(e=t[r])?void 0:e.details;if(n){if(this.waitForCdnTuneIn(n))break;this.state=vn}break}case hn:{var t;const e=performance.now(),r=this.retryDate;if(!r||e>=r||null!=(t=this.media)&&t.seeking){const{levels:e,trackId:t}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((null==e?void 0:e[t])||null),this.state=cn}break}case vn:{const e=this.waitingData;if(e){const{frag:t,part:r,cache:n,complete:i}=e;if(void 0!==this.initPTS[t.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=dn;const e={frag:t,part:r,payload:n.flush(),networkDetails:null};this._handleFragmentLoadProgress(e),i&&super._handleFragmentLoadComplete(e)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${t.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{const e=this.getLoadPosition(),r=qr.bufferInfo(this.mediaBuffer,e,this.config.maxBufferHole);gr(r.end,this.config.maxFragLookUpTolerance,t)<0&&(this.log(`Waiting fragment cc (${t.cc}) @ ${t.start} cancelled because another fragment at ${r.end} is needed`),this.clearWaitingFragment())}}else this.state=cn}}this.onTickEnd()}clearWaitingFragment(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=cn)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:e}=this;null!=e&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){const{hls:e,levels:t,media:r,trackId:n}=this,i=e.config;if(!r&&(this.startFragRequested||!i.startFragPrefetch)||null==t||!t[n])return;const a=t[n],o=a.details;if(!o||o.live&&this.levelLastLoaded!==a||this.waitForCdnTuneIn(o))return void(this.state=gn);const s=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&s&&(this.bufferFlushed=!1,this.afterBufferFlushed(s,O,Rt));const l=this.getFwdBufferInfo(s,Rt);if(null===l)return;const{bufferedTrack:u,switchingTrack:c}=this;if(!c&&this._streamEnded(l,o))return e.trigger(E.BUFFER_EOS,{type:"audio"}),void(this.state=yn);const f=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,bt),d=l.len,h=this.getMaxBufferLength(null==f?void 0:f.len),g=o.fragments,m=g[0].start;let p=this.flushing?this.getLoadPosition():l.end;if(c&&r){const e=this.getLoadPosition();u&&!Ni(c.attrs,u.attrs)&&(p=e),o.PTSKnown&&e<m&&(l.end>m||l.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=m+.05)}if(d>=h&&!c&&p<g[g.length-1].start)return;let y=this.getNextFragment(p,o),v=!1;if(y&&this.isLoopLoading(y,p)&&(v=!!y.gap,y=this.getNextFragmentLoopLoading(y,o,l,bt,h)),!y)return void(this.bufferFlushed=!0);const T=f&&y.start>f.end+o.targetduration;if(T||(null==f||!f.len)&&l.len){const e=this.getAppendedFrag(y.start,bt);if(null===e)return;if(v||(v=!!e.gap||!!T&&0===f.len),T&&!v||v&&l.nextStart&&l.nextStart<e.end)return}this.loadFragment(y,a,p)}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.min(Math.max(t,e),this.config.maxMaxBufferLength):t}onMediaDetaching(){this.videoBuffer=null,this.bufferFlushed=this.flushing=!1,super.onMediaDetaching()}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map((e=>new Xt(e)))}onAudioTrackSwitching(e,t){const r=!!t.url;this.trackId=t.id;const{fragCurrent:n}=this;n&&(n.abortRequests(),this.removeUnbufferedFrags(n.start)),this.resetLoadingState(),r?this.setInterval(100):this.resetTransmuxer(),r?(this.switchingTrack=t,this.state=cn,this.flushAudioIfNeeded(t)):(this.switchingTrack=null,this.bufferedTrack=t,this.state=un),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=this.flushing=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(e,t){this.mainDetails=t.details,null!==this.cachedTrackLoadedData&&(this.hls.trigger(E.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(e,t){var r;if(null==this.mainDetails)return void(this.cachedTrackLoadedData=t);const{levels:n}=this,{details:i,id:a}=t;if(!n)return void this.warn(`Audio tracks were reset while loading level ${a}`);this.log(`Audio track ${a} loaded [${i.startSN},${i.endSN}]${i.lastPartSn?`[part-${i.lastPartSn}-${i.lastPartIndex}]`:""},duration:${i.totalduration}`);const o=n[a];let s=0;if(i.live||null!=(r=o.details)&&r.live){this.checkLiveUpdate(i);const e=this.mainDetails;if(i.deltaUpdateFailed||!e)return;var l;if(!o.details&&i.hasProgramDateTime&&e.hasProgramDateTime)Xr(i,e),s=i.fragments[0].start;else s=this.alignPlaylists(i,o.details,null==(l=this.levelLastLoaded)?void 0:l.details)}o.details=i,this.levelLastLoaded=o,this.startFragRequested||!this.mainDetails&&i.live||this.setStartPosition(this.mainDetails||i,s),this.state!==gn||this.waitForCdnTuneIn(i)||(this.state=cn),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:r,part:n,payload:i}=e,{config:a,trackId:o,levels:s}=this;if(!s)return void this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);const l=s[o];if(!l)return void this.warn("Audio track is undefined on fragment load progress");const u=l.details;if(!u)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(r.start);const c=a.defaultAudioCodec||l.audioCodec||"mp4a.40.2";let f=this.transmuxer;f||(f=this.transmuxer=new Di(this.hls,Rt,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const d=this.initPTS[r.cc],h=null==(t=r.initSegment)?void 0:t.data;if(void 0!==d){const e=!1,t=n?n.index:-1,a=-1!==t,o=new Vr(r.level,r.sn,r.stats.chunkCount,i.byteLength,t,a);f.push(i,h,c,"",r,n,u.totalduration,e,o,d)}else{this.log(`Unknown video PTS for cc ${r.cc}, waiting for video PTS before demuxing audio frag ${r.sn} of [${u.startSN} ,${u.endSN}],track ${o}`);const{cache:e}=this.waitingData=this.waitingData||{frag:r,part:n,cache:new Sn,complete:!1};e.push(new Uint8Array(i)),this.waitingVideoCC=this.videoTrackCC,this.state=vn}}_handleFragmentLoadComplete(e){this.waitingData?this.waitingData.complete=!0:super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(e,t){const r=t.tracks.audio;r&&(this.mediaBuffer=r.buffer||null),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer||null)}onFragBuffered(e,t){const{frag:r,part:n}=t;if(r.type===Rt)if(this.fragContextChanged(r))this.warn(`Fragment ${r.sn}${n?" p: "+n.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);else{if("initSegment"!==r.sn){this.fragPrevious=r;const e=this.switchingTrack;e&&(this.bufferedTrack=e,this.switchingTrack=null,this.hls.trigger(E.AUDIO_TRACK_SWITCHED,f({},e)))}this.fragBufferedComplete(r,n)}else if(!this.loadedmetadata&&r.type===bt){const e=this.videoBuffer||this.media;if(e){qr.getBuffered(e).length&&(this.loadedmetadata=!0)}}}onError(e,t){var r;if(t.fatal)this.state=En;else switch(t.details){case T.FRAG_GAP:case T.FRAG_PARSING_ERROR:case T.FRAG_DECRYPT_ERROR:case T.FRAG_LOAD_ERROR:case T.FRAG_LOAD_TIMEOUT:case T.KEY_LOAD_ERROR:case T.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Rt,t);break;case T.AUDIO_TRACK_LOAD_ERROR:case T.AUDIO_TRACK_LOAD_TIMEOUT:case T.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==gn||(null==(r=t.context)?void 0:r.type)!==St||(this.state=cn);break;case T.BUFFER_APPEND_ERROR:case T.BUFFER_FULL_ERROR:if(!t.parent||"audio"!==t.parent)return;if(t.details===T.BUFFER_APPEND_ERROR)return void this.resetLoadingState();this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case T.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onBufferFlushing(e,{type:t}){t!==M&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==M){this.flushing=!1,this.bufferFlushed=!0,this.state===yn&&(this.state=cn);const e=this.mediaBuffer||this.media;e&&(this.afterBufferFlushed(e,t,Rt),this.tick())}}_handleTransmuxComplete(e){var t;const r="audio",{hls:n}=this,{remuxResult:i,chunkMeta:a}=e,o=this.getCurrentContext(a);if(!o)return void this.resetWhenMissingContext(a);const{frag:s,part:l,level:u}=o,{details:c}=u,{audio:f,text:d,id3:h,initSegment:m}=i;if(!this.fragContextChanged(s)&&c){if(this.state=mn,this.switchingTrack&&f&&this.completeAudioSwitch(this.switchingTrack),null!=m&&m.tracks){const e=s.initSegment||s;this._bufferInitSegment(u,m.tracks,e,a),n.trigger(E.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:r,tracks:m.tracks})}if(f){const{startPTS:e,endPTS:t,startDTS:r,endDTS:n}=f;l&&(l.elementaryStreams[O]={startPTS:e,endPTS:t,startDTS:r,endDTS:n}),s.setElementaryStreamInfo(O,e,t,r,n),this.bufferFragmentData(f,s,l,a)}if(null!=h&&null!=(t=h.samples)&&t.length){const e=g({id:r,frag:s,details:c},h);n.trigger(E.FRAG_PARSING_METADATA,e)}if(d){const e=g({id:r,frag:s,details:c},d);n.trigger(E.FRAG_PARSING_USERDATA,e)}}else this.fragmentTracker.removeFragment(s)}_bufferInitSegment(e,t,r,n){if(this.state!==mn)return;t.video&&delete t.video;const i=t.audio;if(!i)return;i.id="audio";const a=e.audioCodec;this.log(`Init audio buffer, container:${i.container}, codecs[level/parsed]=[${a}/${i.codec}]`),a&&1===a.split(",").length&&(i.levelCodec=a),this.hls.trigger(E.BUFFER_CODECS,t);const o=i.initSegment;if(null!=o&&o.byteLength){const e={type:"audio",frag:r,part:null,chunkMeta:n,parent:r.type,data:o};this.hls.trigger(E.BUFFER_APPENDING,e)}this.tickImmediate()}loadFragment(e,t,r){const n=this.fragmentTracker.getState(e);var i;if(this.fragCurrent=e,this.switchingTrack||n===Fr||n===Br)if("initSegment"===e.sn)this._loadInitSegment(e,t);else if(null!=(i=t.details)&&i.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=vn;const r=this.mainDetails;r&&r.fragments[0].start!==t.details.fragments[0].start&&Xr(t.details,r)}else this.startFragRequested=!0,super.loadFragment(e,t,r);else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){const{media:t,bufferedTrack:r}=this,n=null==r?void 0:r.attrs,i=e.attrs;t&&n&&(n.CHANNELS!==i.CHANNELS||r.name!==e.name||r.lang!==e.lang)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null)}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(E.AUDIO_TRACK_SWITCHED,f({},e))}},audioTrackController:class extends Ar{constructor(e){super(e,"[audio-track-controller]"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.MANIFEST_PARSED,this.onManifestParsed,this),e.on(E.LEVEL_LOADING,this.onLevelLoading,this),e.on(E.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(E.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(E.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.MANIFEST_PARSED,this.onManifestParsed,this),e.off(E.LEVEL_LOADING,this.onLevelLoading,this),e.off(E.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(E.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(E.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:r,groupId:n,details:i}=t,a=this.tracksInGroup[r];if(!a||a.groupId!==n)return void this.warn(`Audio track with id:${r} and group:${n} not found in active group ${null==a?void 0:a.groupId}`);const o=a.details;a.details=t.details,this.log(`Audio track ${r} "${a.name}" lang:${a.lang} group:${n} loaded [${i.startSN}-${i.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.audioGroups||null,n=this.groupIds;let i=this.currentTrack;if(!r||(null==n?void 0:n.length)!==(null==r?void 0:r.length)||null!=r&&r.some((e=>-1===(null==n?void 0:n.indexOf(e))))){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const e=this.tracks.filter((e=>!r||-1!==r.indexOf(e.groupId)));if(e.length)this.selectDefaultTrack&&!e.some((e=>e.default))&&(this.selectDefaultTrack=!1),e.forEach(((e,t)=>{e.id=t}));else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=e;const t=this.hls.config.audioPreference;if(!i&&t){const r=Or(t,e,Pr);if(r>-1)i=e[r];else{const e=Or(t,this.tracks);i=this.tracks[e]}}let n=this.findTrackId(i);-1===n&&i&&(n=this.findTrackId(null));const o={audioTracks:e};this.log(`Updating audio tracks, ${e.length} track(s) found in group(s): ${null==r?void 0:r.join(",")}`),this.hls.trigger(E.AUDIO_TRACKS_UPDATED,o);const s=this.trackId;if(-1!==n&&-1===s)this.setAudioTrack(n);else if(e.length&&-1===s){var a;const t=new Error(`No audio track selected for current audio group-ID(s): ${null==(a=this.groupIds)?void 0:a.join(",")} track count: ${e.length}`);this.warn(t.message),this.hls.trigger(E.ERROR,{type:v.MEDIA_ERROR,details:T.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:t})}}else this.shouldReloadPlaylist(i)&&this.setAudioTrack(this.trackId)}onError(e,t){!t.fatal&&t.context&&(t.context.type!==St||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||(this.requestScheduled=-1,this.checkRetry(t)))}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const r=this.allAudioTracks;if(this.selectDefaultTrack=!1,r.length){const n=this.currentTrack;if(n&&Mr(e,n,Pr))return n;const i=Or(e,this.tracksInGroup,Pr);if(i>-1){const e=this.tracksInGroup[i];return this.setAudioTrack(i),e}if(n){let n=t.loadLevel;-1===n&&(n=t.firstAutoLevel);const i=function(e,t,r,n,i){const a=t[n],o=t.reduce(((e,t,r)=>{const n=t.uri;return(e[n]||(e[n]=[])).push(r),e}),{})[a.uri];o.length>1&&(n=Math.max.apply(Math,o));const s=a.videoRange,l=a.frameRate,u=a.codecSet.substring(0,4),c=kr(t,n,(t=>{if(t.videoRange!==s||t.frameRate!==l||t.codecSet.substring(0,4)!==u)return!1;const n=t.audioGroups,a=r.filter((e=>!n||-1!==n.indexOf(e.groupId)));return Or(e,a,i)>-1}));return c>-1?c:kr(t,n,(t=>{const n=t.audioGroups,a=r.filter((e=>!n||-1!==n.indexOf(e.groupId)));return Or(e,a,i)>-1}))}(e,t.levels,r,n,Pr);if(-1===i)return null;t.nextLoadLevel=i}if(e.channels||e.audioCodec){const t=Or(e,r);if(t>-1)return r[t]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length)return void this.warn(`Invalid audio track id: ${e}`);this.clearTimer(),this.selectDefaultTrack=!1;const r=this.currentTrack,n=t[e],i=n.details&&!n.details.live;if(e===this.trackId&&n===r&&i)return;if(this.log(`Switching to audio-track ${e} "${n.name}" lang:${n.lang} group:${n.groupId} channels:${n.channels}`),this.trackId=e,this.currentTrack=n,this.hls.trigger(E.AUDIO_TRACK_SWITCHING,f({},n)),i)return;const a=this.switchParams(n.url,null==r?void 0:r.details,n.details);this.loadPlaylist(a)}findTrackId(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const n=t[r];if((!this.selectDefaultTrack||n.default)&&(!e||Mr(e,n,Pr)))return r}if(e){const{name:r,lang:n,assocLang:i,characteristics:a,audioCodec:o,channels:s}=e;for(let e=0;e<t.length;e++){if(Mr({name:r,lang:n,assocLang:i,characteristics:a,audioCodec:o,channels:s},t[e],Pr))return e}for(let l=0;l<t.length;l++){const r=t[l];if(Ni(e.attrs,r.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return l}for(let l=0;l<t.length;l++){const r=t[l];if(Ni(e.attrs,r.attrs,["LANGUAGE"]))return l}}return-1}loadPlaylist(e){const t=this.currentTrack;if(this.shouldLoadPlaylist(t)&&t){super.loadPlaylist();const n=t.id,i=t.groupId;let a=t.url;if(e)try{a=e.addDirectives(a)}catch(r){this.warn(`Could not construct new URL with HLS Delivery Directives: ${r}`)}this.log(`loading audio-track playlist ${n} "${t.name}" lang:${t.lang} group:${i}`),this.clearTimer(),this.hls.trigger(E.AUDIO_TRACK_LOADING,{url:a,id:n,groupId:i,deliveryDirectives:e||null})}}},emeController:Ma,cmcdController:class{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=e=>{try{this.apply(e,{ot:ka.MANIFEST,su:!this.initialized})}catch(t){R.warn("Could not generate manifest CMCD data.",t)}},this.applyFragmentData=e=>{try{const t=e.frag,r=this.hls.levels[t.level],n=this.getObjectType(t),i={d:1e3*t.duration,ot:n};n!==ka.VIDEO&&n!==ka.AUDIO&&n!=ka.MUXED||(i.br=r.bitrate/1e3,i.tb=this.getTopBandwidth(n)/1e3,i.bl=this.getBufferLength(n)),this.apply(e,i)}catch(t){R.warn("Could not generate segment CMCD data.",t)}},this.hls=e;const t=this.config=e.config,{cmcd:r}=t;null!=r&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=r.sessionId||function(){try{return crypto.randomUUID()}catch(e){try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch(t){let e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{const r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?r:3&r|8).toString(16)}))}}}(),this.cid=r.contentId,this.useHeaders=!0===r.useHeaders,this.includeKeys=r.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(E.MEDIA_DETACHED,this.onMediaDetached,this),e.on(E.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(E.MEDIA_DETACHED,this.onMediaDetached,this),e.off(E.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var r,n;this.audioBuffer=null==(r=t.tracks.audio)?void 0:r.buffer,this.videoBuffer=null==(n=t.tracks.video)?void 0:n.buffer}createData(){var e;return{v:1,sf:Fa.HLS,sid:this.sid,cid:this.cid,pr:null==(e=this.media)?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){g(t,this.createData());const r=t.ot===ka.INIT||t.ot===ka.VIDEO||t.ot===ka.MUXED;this.starved&&r&&(t.bs=!0,t.su=!0,this.starved=!1),null==t.su&&(t.su=this.buffering);const{includeKeys:n}=this;n&&(t=Object.keys(t).reduce(((e,r)=>(n.includes(r)&&(e[r]=t[r]),e)),{})),this.useHeaders?(e.headers||(e.headers={}),vo(e.headers,t)):e.url=So(e.url,t)}getObjectType(e){const{type:t}=e;return"subtitle"===t?ka.TIMED_TEXT:"initSegment"===e.sn?ka.INIT:"audio"===t?ka.AUDIO:"main"===t?this.hls.audioTracks.length?ka.VIDEO:ka.MUXED:void 0}getTopBandwidth(e){let t,r=0;const n=this.hls;if(e===ka.AUDIO)t=n.audioTracks;else{const e=n.maxAutoLevel,r=e>-1?e+1:n.levels.length;t=n.levels.slice(0,r)}for(const i of t)i.bitrate>r&&(r=i.bitrate);return r>0?r:NaN}getBufferLength(e){const t=this.hls.media,r=e===ka.AUDIO?this.audioBuffer:this.videoBuffer;if(!r||!t)return NaN;return 1e3*qr.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,r=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new r(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,r,n){t(e),this.loader.load(e,r,n)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,r=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new r(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,r,n){t(e),this.loader.load(e,r,n)}}}},contentSteeringController:class{constructor(e){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.log=R.log.bind(R,"[content-steering]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(E.MANIFEST_PARSED,this.onManifestParsed,this),e.on(E.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(E.MANIFEST_PARSED,this.onManifestParsed,this),e.off(E.ERROR,this.onError,this))}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=1e3*this.timeToLoad-(performance.now()-this.updated);if(e>0)return void this.scheduleRefresh(this.uri,e)}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){-1!==this.reloadTimer&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter((t=>t!==e)))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:r}=t;null!==r&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:r}=t;if((null==r?void 0:r.action)===yr&&r.flags===_r){const e=this.levels;let n=this.pathwayPriority,i=this.pathwayId;if(t.context){const{groupId:r,pathwayId:n,type:a}=t.context;r&&e?i=this.getPathwayForGroupId(r,a,i):n&&(i=n)}i in this.penalizedPathways||(this.penalizedPathways[i]=performance.now()),!n&&e&&(n=e.reduce(((e,t)=>(-1===e.indexOf(t.pathwayId)&&e.push(t.pathwayId),e)),[])),n&&n.length>1&&(this.updatePathwayPriority(n),r.resolved=this.pathwayId!==i),r.resolved||R.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${i} levels: ${e?e.length:e} priorities: ${JSON.stringify(n)} penalized: ${JSON.stringify(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(0===t.length){const r=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${r}"`),t=this.getLevelsForPathway(r),this.pathwayId=r}return t.length!==e.length?(this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t):e}getLevelsForPathway(e){return null===this.levels?[]:this.levels.filter((t=>e===t.pathwayId))}updatePathwayPriority(e){let t;this.pathwayPriority=e;const r=this.penalizedPathways,n=performance.now();Object.keys(r).forEach((e=>{n-r[e]>3e5&&delete r[e]}));for(let i=0;i<e.length;i++){const n=e[i];if(n in r)continue;if(n===this.pathwayId)return;const a=this.hls.nextLoadLevel,o=this.hls.levels[a];if(t=this.getLevelsForPathway(n),t.length>0){this.log(`Setting Pathway to "${n}"`),this.pathwayId=n,or(t),this.hls.trigger(E.LEVELS_UPDATED,{levels:t});const e=this.hls.levels[a];o&&e&&this.levels&&(e.attrs["STABLE-VARIANT-ID"]!==o.attrs["STABLE-VARIANT-ID"]&&e.bitrate!==o.bitrate&&this.log(`Unstable Pathways change from bitrate ${o.bitrate} to ${e.bitrate}`),this.hls.nextLoadLevel=a);break}}}getPathwayForGroupId(e,t,r){const n=this.getLevelsForPathway(r).concat(this.levels||[]);for(let i=0;i<n.length;i++)if(t===St&&n[i].hasAudioGroup(e)||t===At&&n[i].hasSubtitleGroup(e))return n[i].pathwayId;return r}clonePathways(e){const t=this.levels;if(!t)return;const r={},n={};e.forEach((e=>{const{ID:i,"BASE-ID":a,"URI-REPLACEMENT":o}=e;if(t.some((e=>e.pathwayId===i)))return;const s=this.getLevelsForPathway(a).map((e=>{const t=new C(e.attrs);t["PATHWAY-ID"]=i;const a=t.AUDIO&&`${t.AUDIO}_clone_${i}`,s=t.SUBTITLES&&`${t.SUBTITLES}_clone_${i}`;a&&(r[t.AUDIO]=a,t.AUDIO=a),s&&(n[t.SUBTITLES]=s,t.SUBTITLES=s);const l=bo(e.uri,t["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",o),u=new Xt({attrs:t,audioCodec:e.audioCodec,bitrate:e.bitrate,height:e.height,name:e.name,url:l,videoCodec:e.videoCodec,width:e.width});if(e.audioGroups)for(let r=1;r<e.audioGroups.length;r++)u.addGroupId("audio",`${e.audioGroups[r]}_clone_${i}`);if(e.subtitleGroups)for(let r=1;r<e.subtitleGroups.length;r++)u.addGroupId("text",`${e.subtitleGroups[r]}_clone_${i}`);return u}));t.push(...s),Ao(this.audioTracks,r,o,i),Ao(this.subtitleTracks,n,o,i)}))}loadSteeringManifest(e){const t=this.hls.config,r=t.loader;let n;this.loader&&this.loader.destroy(),this.loader=new r(t);try{n=new self.URL(e)}catch(u){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest URI: ${e}`)}if("data:"!==n.protocol){const e=0|(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate);n.searchParams.set("_HLS_pathway",this.pathwayId),n.searchParams.set("_HLS_throughput",""+e)}const i={responseType:"json",url:n.href},a=t.steeringManifestLoadPolicy.default,o=a.errorRetry||a.timeoutRetry||{},s={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},l={onSuccess:(e,t,r,i)=>{this.log(`Loaded steering manifest: "${n}"`);const a=e.data;if(1!==a.VERSION)return void this.log(`Steering VERSION ${a.VERSION} not supported!`);this.updated=performance.now(),this.timeToLoad=a.TTL;const{"RELOAD-URI":o,"PATHWAY-CLONES":s,"PATHWAY-PRIORITY":l}=a;if(o)try{this.uri=new self.URL(o,n).href}catch(u){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest RELOAD-URI: ${o}`)}this.scheduleRefresh(this.uri||r.url),s&&this.clonePathways(s);const c={steeringManifest:a,url:n.toString()};this.hls.trigger(E.STEERING_MANIFEST_LOADED,c),l&&this.updatePathwayPriority(l)},onError:(e,t,r,n)=>{if(this.log(`Error loading steering manifest: ${e.code} ${e.text} (${t.url})`),this.stopLoad(),410===e.code)return this.enabled=!1,void this.log(`Steering manifest ${t.url} no longer available`);let i=1e3*this.timeToLoad;if(429!==e.code)this.scheduleRefresh(this.uri||t.url,i);else{const e=this.loader;if("function"==typeof(null==e?void 0:e.getResponseHeader)){const t=e.getResponseHeader("Retry-After");t&&(i=1e3*parseFloat(t))}this.log(`Steering manifest ${t.url} rate limited`)}},onTimeout:(e,t,r)=>{this.log(`Timeout loading steering manifest (${t.url})`),this.scheduleRefresh(this.uri||t.url)}};this.log(`Requesting steering manifest: ${n}`),this.loader.load(i,s,l)}scheduleRefresh(e,t=1e3*this.timeToLoad){this.clearTimeout(),this.reloadTimer=self.setTimeout((()=>{var t;const r=null==(t=this.hls)?void 0:t.media;!r||r.ended?this.scheduleRefresh(e,1e3*this.timeToLoad):this.loadSteeringManifest(e)}),t)}}});function Po(e){return e&&"object"==typeof e?Array.isArray(e)?e.map(Po):Object.keys(e).reduce(((t,r)=>(t[r]=Po(e[r]),t)),{}):e}function ko(e){const t=e.loader;if(t!==Co&&t!==Io)R.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1;else{(function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(e){}return!1})()&&(e.loader=Co,e.progressive=!0,e.enableSoftwareAES=!0,R.log("[config]: Progressive streaming enabled, using FetchLoader"))}}let xo;class Fo extends Ar{constructor(e,t){super(e,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(E.LEVEL_LOADED,this.onLevelLoaded,this),e.on(E.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(E.FRAG_BUFFERED,this.onFragBuffered,this),e.on(E.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(E.LEVEL_LOADED,this.onLevelLoaded,this),e.off(E.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(E.FRAG_BUFFERED,this.onFragBuffered,this),e.off(E.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach((e=>{e.loadError=0,e.fragmentError=0})),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const r=this.hls.config.preferManagedMediaSource,n=[],i={},a={};let o=!1,s=!1,l=!1;t.levels.forEach((e=>{var t,u;const c=e.attrs;let{audioCodec:f,videoCodec:d}=e;-1!==(null==(t=f)?void 0:t.indexOf("mp4a.40.34"))&&(xo||(xo=/chrome|firefox/i.test(navigator.userAgent)),xo&&(e.audioCodec=f=void 0)),f&&(e.audioCodec=f=at(f,r)),0===(null==(u=d)?void 0:u.indexOf("avc1"))&&(d=e.videoCodec=function(e){const t=e.split(".");if(t.length>2){let e=t.shift()+".";return e+=parseInt(t.shift()).toString(16),e+=("000"+parseInt(t.shift()).toString(16)).slice(-4),e}return e}(d));const{width:h,height:g,unknownCodecs:m}=e;if(o||(o=!(!h||!g)),s||(s=!!d),l||(l=!!f),null!=m&&m.length||f&&!Qe(f,"audio",r)||d&&!Qe(d,"video",r))return;const{CODECS:p,"FRAME-RATE":y,"HDCP-LEVEL":E,"PATHWAY-ID":v,RESOLUTION:T,"VIDEO-RANGE":_}=c,S=`${`${v||"."}-`}${e.bitrate}-${T}-${y}-${p}-${_}-${E}`;if(i[S])if(i[S].uri===e.url||e.attrs["PATHWAY-ID"])i[S].addGroupId("audio",c.AUDIO),i[S].addGroupId("text",c.SUBTITLES);else{const t=a[S]+=1;e.attrs["PATHWAY-ID"]=new Array(t+1).join(".");const r=new Xt(e);i[S]=r,n.push(r)}else{const t=new Xt(e);i[S]=t,a[S]=1,n.push(t)}})),this.filterAndSortMediaOptions(n,t,o,s,l)}filterAndSortMediaOptions(e,t,r,n,i){let a=[],o=[],s=e;if((r||n)&&i&&(s=s.filter((({videoCodec:e,videoRange:t,width:r,height:n})=>{return(!!e||!(!r||!n))&&(!!(i=t)&&qt.indexOf(i)>-1);var i}))),0===s.length)return void Promise.resolve().then((()=>{if(this.hls){t.levels.length&&this.warn(`One or more CODECS in variant not supported: ${JSON.stringify(t.levels[0].attrs)}`);const e=new Error("no level with compatible codecs found in manifest");this.hls.trigger(E.ERROR,{type:v.MEDIA_ERROR,details:T.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:e,reason:e.message})}}));if(t.audioTracks){const{preferManagedMediaSource:e}=this.hls.config;a=t.audioTracks.filter((t=>!t.audioCodec||Qe(t.audioCodec,"audio",e))),Uo(a)}t.subtitles&&(o=t.subtitles,Uo(o));const l=s.slice(0);s.sort(((e,t)=>{if(e.attrs["HDCP-LEVEL"]!==t.attrs["HDCP-LEVEL"])return(e.attrs["HDCP-LEVEL"]||"")>(t.attrs["HDCP-LEVEL"]||"")?1:-1;if(r&&e.height!==t.height)return e.height-t.height;if(e.frameRate!==t.frameRate)return e.frameRate-t.frameRate;if(e.videoRange!==t.videoRange)return qt.indexOf(e.videoRange)-qt.indexOf(t.videoRange);if(e.videoCodec!==t.videoCodec){const r=tt(e.videoCodec),n=tt(t.videoCodec);if(r!==n)return n-r}if(e.uri===t.uri&&e.codecSet!==t.codecSet){const r=rt(e.codecSet),n=rt(t.codecSet);if(r!==n)return n-r}return e.averageBitrate!==t.averageBitrate?e.averageBitrate-t.averageBitrate:0}));let u=l[0];if(this.steering&&(s=this.steering.filterParsedLevels(s),s.length!==l.length))for(let h=0;h<l.length;h++)if(l[h].pathwayId===s[0].pathwayId){u=l[h];break}this._levels=s;for(let h=0;h<s.length;h++)if(s[h]===u){var c;this._firstLevel=h;const e=u.bitrate,t=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${s.length} level(s) found, first bitrate: ${e}`),void 0===(null==(c=this.hls.userConfig)?void 0:c.abrEwmaDefaultEstimate)){const r=Math.min(e,this.hls.config.abrEwmaDefaultEstimateMax);r>t&&t===Mo.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=r)}break}const f=i&&!n,d={levels:s,audioTracks:a,subtitleTracks:o,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:i,video:n,altAudio:!f&&a.some((e=>!!e.url))};this.hls.trigger(E.MANIFEST_PARSED,d),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return 0===this._levels.length?null:this._levels}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(0===t.length)return;if(e<0||e>=t.length){const r=new Error("invalid level idx"),n=e<0;if(this.hls.trigger(E.ERROR,{type:v.OTHER_ERROR,details:T.LEVEL_SWITCH_ERROR,level:e,fatal:n,error:r,reason:r.message}),n)return;e=Math.min(e,t.length-1)}const r=this.currentLevelIndex,n=this.currentLevel,i=n?n.attrs["PATHWAY-ID"]:void 0,a=t[e],o=a.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=a,r===e&&a.details&&n&&i===o)return;this.log(`Switching to level ${e} (${a.height?a.height+"p ":""}${a.videoRange?a.videoRange+" ":""}${a.codecSet?a.codecSet+" ":""}@${a.bitrate})${o?" with Pathway "+o:""} from level ${r}${i?" with Pathway "+i:""}`);const s={level:e,attrs:a.attrs,details:a.details,bitrate:a.bitrate,averageBitrate:a.averageBitrate,maxBitrate:a.maxBitrate,realBitrate:a.realBitrate,width:a.width,height:a.height,codecSet:a.codecSet,audioCodec:a.audioCodec,videoCodec:a.videoCodec,audioGroups:a.audioGroups,subtitleGroups:a.subtitleGroups,loaded:a.loaded,loadError:a.loadError,fragmentError:a.fragmentError,name:a.name,id:a.id,uri:a.uri,url:a.url,urlId:0,audioGroupIds:a.audioGroupIds,textGroupIds:a.textGroupIds};this.hls.trigger(E.LEVEL_SWITCHING,s);const l=a.details;if(!l||l.live){const e=this.switchParams(a.uri,null==n?void 0:n.details,l);this.loadPlaylist(e)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(void 0===this._startLevel){const e=this.hls.config.startLevel;return void 0!==e?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}onError(e,t){!t.fatal&&t.context&&t.context.type===_t&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(void 0!==t&&t.type===bt){const e=t.elementaryStreams;if(!Object.keys(e).some((t=>!!e[t])))return;const r=this._levels[t.level];null!=r&&r.loadError&&(this.log(`Resetting level error count of ${r.loadError} on frag buffered`),r.loadError=0)}}onLevelLoaded(e,t){var r;const{level:n,details:i}=t,a=this._levels[n];var o;if(!a)return this.warn(`Invalid level index ${n}`),void(null!=(o=t.deliveryDirectives)&&o.skip&&(i.deltaUpdateFailed=!0));n===this.currentLevelIndex?(0===a.fragmentError&&(a.loadError=0),this.playlistLoaded(n,t,a.details)):null!=(r=t.deliveryDirectives)&&r.skip&&(i.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist();const t=this.currentLevelIndex,r=this.currentLevel;if(r&&this.shouldLoadPlaylist(r)){let i=r.uri;if(e)try{i=e.addDirectives(i)}catch(n){this.warn(`Could not construct new URL with HLS Delivery Directives: ${n}`)}const a=r.attrs["PATHWAY-ID"];this.log(`Loading level index ${t}${void 0!==(null==e?void 0:e.msn)?" at sn "+e.msn+" part "+e.part:""} with${a?" Pathway "+a:""} ${i}`),this.clearTimer(),this.hls.trigger(E.LEVEL_LOADING,{url:i,level:t,pathwayId:r.attrs["PATHWAY-ID"],id:0,deliveryDirectives:e||null})}}get nextLoadLevel(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;const r=this._levels.filter(((t,r)=>r!==e||(this.steering&&this.steering.removeLevel(t),t===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,t.details&&t.details.fragments.forEach((e=>e.level=-1))),!1)));or(r),this._levels=r,this.currentLevelIndex>-1&&null!=(t=this.currentLevel)&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.hls.trigger(E.LEVELS_UPDATED,{levels:r})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:r}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(E.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:r}))}}function Uo(e){const t={};e.forEach((e=>{const r=e.groupId||"";e.id=t[r]=t[r]||0,t[r]++}))}class Bo{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const r in this.keyUriToKeyInfo){const n=this.keyUriToKeyInfo[r].loader;if(n){var t;if(e&&e!==(null==(t=n.context)?void 0:t.frag.type))return;n.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=T.KEY_LOAD_ERROR,r,n,i){return new rn({type:v.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:i,error:r,networkDetails:n})}loadClear(e,t){if(this.emeController&&this.config.emeEnabled){const{sn:r,cc:n}=e;for(let e=0;e<t.length;e++){const i=t[e];if(n<=i.cc&&("initSegment"===r||"initSegment"===i.sn||r<i.sn)){this.emeController.selectKeySystemFormat(i).then((e=>{i.setKeyFormat(e)}));break}}}}load(e){return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then((t=>this.loadInternal(e,t))):this.loadInternal(e)}loadInternal(e,t){var r,n;t&&e.setKeyFormat(t);const i=e.decryptdata;if(!i){const r=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,T.KEY_LOAD_ERROR,r))}const a=i.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,T.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${a}"`)));let o=this.keyUriToKeyInfo[a];if(null!=(r=o)&&r.decryptdata.key)return i.key=o.decryptdata.key,Promise.resolve({frag:e,keyInfo:o});var s;if(null!=(n=o)&&n.keyLoadPromise)switch(null==(s=o.mediaKeySessionContext)?void 0:s.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return o.keyLoadPromise.then((t=>(i.key=t.keyInfo.decryptdata.key,{frag:e,keyInfo:o})))}switch(o=this.keyUriToKeyInfo[a]={decryptdata:i,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},i.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===i.keyFormat?this.loadKeyHTTP(o,e):this.loadKeyEME(o,e);case"AES-128":return this.loadKeyHTTP(o,e);default:return Promise.reject(this.createKeyLoadError(e,T.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${i.method}"`)))}}loadKeyEME(e,t){const r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const t=this.emeController.loadKey(r);if(t)return(e.keyLoadPromise=t.then((t=>(e.mediaKeySessionContext=t,r)))).catch((t=>{throw e.keyLoadPromise=null,t}))}return Promise.resolve(r)}loadKeyHTTP(e,t){const r=this.config,n=new(0,r.loader)(r);return t.keyLoader=e.loader=n,e.keyLoadPromise=new Promise(((i,a)=>{const o={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},s=r.keyLoadPolicy.default,l={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},u={onSuccess:(e,t,r,n)=>{const{frag:o,keyInfo:s,url:l}=r;if(!o.decryptdata||s!==this.keyUriToKeyInfo[l])return a(this.createKeyLoadError(o,T.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),n));s.decryptdata.key=o.decryptdata.key=new Uint8Array(e.data),o.keyLoader=null,s.loader=null,i({frag:o,keyInfo:s})},onError:(e,r,n,i)=>{this.resetLoader(r),a(this.createKeyLoadError(t,T.KEY_LOAD_ERROR,new Error(`HTTP Error ${e.code} loading key ${e.text}`),n,f({url:o.url,data:void 0},e)))},onTimeout:(e,r,n)=>{this.resetLoader(r),a(this.createKeyLoadError(t,T.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),n))},onAbort:(e,r,n)=>{this.resetLoader(r),a(this.createKeyLoadError(t,T.INTERNAL_ABORTED,new Error("key loading aborted"),n))}};n.load(o,l,u)}))}resetLoader(e){const{frag:t,keyInfo:r,url:n}=e,i=r.loader;t.keyLoader===i&&(t.keyLoader=null,r.loader=null),delete this.keyUriToKeyInfo[n],i&&i.destroy()}}function Zo(){return self.SourceBuffer||self.WebKitSourceBuffer}function Go(){if(!We())return!1;const e=Zo();return!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove}class Ho{constructor(e,t,r,n){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=r,this.hls=n}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(e,t){const{config:r,media:n,stalled:i}=this;if(null===n)return;const{currentTime:a,seeking:o}=n,s=this.seeking&&!o,l=!this.seeking&&o;if(this.seeking=o,a!==e){if(this.moved=!0,o||(this.nudgeRetry=0),null!==i){if(this.stallReported){const e=self.performance.now()-i;R.warn(`playback not stuck anymore @${a}, after ${Math.round(e)}ms`),this.stallReported=!1}this.stalled=null}return}if(l||s)return void(this.stalled=null);if(n.paused&&!o||n.ended||0===n.playbackRate||!qr.getBuffered(n).length)return void(this.nudgeRetry=0);const u=qr.bufferInfo(n,a,0),c=u.nextStart||0;if(o){const e=u.len>2,r=!c||t&&t.start<=a||c-a>2&&!this.fragmentTracker.getPartialFragment(a);if(e||r)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var f;if(!(u.len>0)&&!c)return;const e=Math.max(c,u.start||0)-a,t=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,r=(null==t||null==(f=t.details)?void 0:f.live)?2*t.details.targetduration:2,i=this.fragmentTracker.getPartialFragment(a);if(e>0&&(e<=r||i))return void(n.paused||this._trySkipBufferHole(i))}const d=self.performance.now();if(null===i)return void(this.stalled=d);const h=d-i;if(!o&&h>=250&&(this._reportStall(u),!this.media))return;const g=qr.bufferInfo(n,a,r.maxBufferHole);this._tryFixBufferStall(g,h)}_tryFixBufferStall(e,t){const{config:r,fragmentTracker:n,media:i}=this;if(null===i)return;const a=i.currentTime,o=n.getPartialFragment(a);if(o){if(this._trySkipBufferHole(o)||!this.media)return}(e.len>r.maxBufferHole||e.nextStart&&e.nextStart-a<r.maxBufferHole)&&t>1e3*r.highBufferWatchdogPeriod&&(R.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(e){const{hls:t,media:r,stallReported:n}=this;if(!n&&r){this.stallReported=!0;const n=new Error(`Playback stalling at @${r.currentTime} due to low buffer (${JSON.stringify(e)})`);R.warn(n.message),t.trigger(E.ERROR,{type:v.MEDIA_ERROR,details:T.BUFFER_STALLED_ERROR,fatal:!1,error:n,buffer:e.len})}}_trySkipBufferHole(e){const{config:t,hls:r,media:n}=this;if(null===n)return 0;const i=n.currentTime,a=qr.bufferInfo(n,i,0),o=i<a.start?a.start:a.nextStart;if(o){const s=a.len<=t.maxBufferHole,l=a.len>0&&a.len<1&&n.readyState<3,u=o-i;if(u>0&&(s||l)){if(u>t.maxBufferHole){const{fragmentTracker:t}=this;let r=!1;if(0===i){const e=t.getAppendedFrag(0,bt);e&&o<e.end&&(r=!0)}if(!r){const r=e||t.getAppendedFrag(i,bt);if(r){let e=!1,n=r.end;for(;n<o;){const r=t.getPartialFragment(n);if(!r){e=!0;break}n+=r.duration}if(e)return 0}}}const a=Math.max(o+.05,i+.1);if(R.warn(`skipping hole, adjusting currentTime from ${i} to ${a}`),this.moved=!0,this.stalled=null,n.currentTime=a,e&&!e.gap){const t=new Error(`fragment loaded with buffer holes, seeking from ${i} to ${a}`);r.trigger(E.ERROR,{type:v.MEDIA_ERROR,details:T.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:t,reason:t.message,frag:e})}return a}}return 0}_tryNudgeBuffer(){const{config:e,hls:t,media:r,nudgeRetry:n}=this;if(null===r)return;const i=r.currentTime;if(this.nudgeRetry++,n<e.nudgeMaxRetry){const a=i+(n+1)*e.nudgeOffset,o=new Error(`Nudging 'currentTime' from ${i} to ${a}`);R.warn(o.message),r.currentTime=a,t.trigger(E.ERROR,{type:v.MEDIA_ERROR,details:T.BUFFER_NUDGE_ON_STALL,error:o,fatal:!1})}else{const r=new Error(`Playhead still not moving while enough data buffered @${i} after ${e.nudgeMaxRetry} nudges`);R.error(r.message),t.trigger(E.ERROR,{type:v.MEDIA_ERROR,details:T.BUFFER_STALLED_ERROR,error:r,fatal:!0})}}}class Ko extends _n{constructor(e,t,r){super(e,t,r,"[stream-controller]",bt),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.MANIFEST_PARSED,this.onManifestParsed,this),e.on(E.LEVEL_LOADING,this.onLevelLoading,this),e.on(E.LEVEL_LOADED,this.onLevelLoaded,this),e.on(E.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(E.ERROR,this.onError,this),e.on(E.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(E.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(E.BUFFER_CREATED,this.onBufferCreated,this),e.on(E.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(E.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(E.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.MANIFEST_PARSED,this.onManifestParsed,this),e.off(E.LEVEL_LOADED,this.onLevelLoaded,this),e.off(E.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(E.ERROR,this.onError,this),e.off(E.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(E.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(E.BUFFER_CREATED,this.onBufferCreated,this),e.off(E.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(E.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(E.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying()}startLoad(e){if(this.levels){const{lastCurrentTime:t,hls:r}=this;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){let e=r.startLevel;-1===e&&(r.config.testBandwidth&&this.levels.length>1?(e=0,this.bitrateTest=!0):e=r.firstAutoLevel),r.nextLoadLevel=e,this.level=r.loadLevel,this.loadedmetadata=!1}t>0&&-1===e&&(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t),this.state=cn,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=un}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case Tn:{const{levels:e,level:t}=this,r=null==e?void 0:e[t],n=null==r?void 0:r.details;if(n&&(!n.live||this.levelLastLoaded===r)){if(this.waitForCdnTuneIn(n))break;this.state=cn;break}if(this.hls.nextLoadLevel!==this.level){this.state=cn;break}break}case hn:{var e;const t=self.performance.now(),r=this.retryDate;if(!r||t>=r||null!=(e=this.media)&&e.seeking){const{levels:e,level:t}=this,r=null==e?void 0:e[t];this.resetStartWhenNotLoaded(r||null),this.state=cn}}}this.state===cn&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:r,media:n}=this;if(null===t||!n&&(this.startFragRequested||!e.config.startFragPrefetch))return;if(this.altAudio&&this.audioOnly)return;const i=e.nextLoadLevel;if(null==r||!r[i])return;const a=r[i],o=this.getMainFwdBufferInfo();if(null===o)return;const s=this.getLevelDetails();if(s&&this._streamEnded(o,s)){const e={};return this.altAudio&&(e.type="video"),this.hls.trigger(E.BUFFER_EOS,e),void(this.state=yn)}e.loadLevel!==i&&-1===e.manualLevel&&this.log(`Adapting to level ${i} from level ${this.level}`),this.level=e.nextLoadLevel=i;const l=a.details;if(!l||this.state===Tn||l.live&&this.levelLastLoaded!==a)return this.level=i,void(this.state=Tn);const u=o.len,c=this.getMaxBufferLength(a.maxBitrate);if(u>=c)return;this.backtrackFragment&&this.backtrackFragment.start>o.end&&(this.backtrackFragment=null);const f=this.backtrackFragment?this.backtrackFragment.start:o.end;let d=this.getNextFragment(f,l);if(this.couldBacktrack&&!this.fragPrevious&&d&&"initSegment"!==d.sn&&this.fragmentTracker.getState(d)!==Zr){var h;const e=(null!=(h=this.backtrackFragment)?h:d).sn-l.startSN,t=l.fragments[e-1];t&&d.cc===t.cc&&(d=t,this.fragmentTracker.removeFragment(t))}else this.backtrackFragment&&o.len&&(this.backtrackFragment=null);if(d&&this.isLoopLoading(d,f)){if(!d.gap){const e=this.audioOnly&&!this.altAudio?O:M,t=(e===M?this.videoBuffer:this.mediaBuffer)||this.media;t&&this.afterBufferFlushed(t,e,bt)}d=this.getNextFragmentLoopLoading(d,l,o,bt,c)}d&&(!d.initSegment||d.initSegment.data||this.bitrateTest||(d=d.initSegment),this.loadFragment(d,a,f))}loadFragment(e,t,r){const n=this.fragmentTracker.getState(e);this.fragCurrent=e,n===Fr||n===Br?"initSegment"===e.sn?this._loadInitSegment(e,t):this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):(this.startFragRequested=!0,super.loadFragment(e,t,r)):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,bt)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(null!=t&&t.readyState){let r;const n=this.getAppendedFrag(t.currentTime);n&&n.start>1&&this.flushMainBuffer(0,n.start-1);const i=this.getLevelDetails();if(null!=i&&i.live){const e=this.getMainFwdBufferInfo();if(!e||e.len<2*i.targetduration)return}if(!t.paused&&e){const t=e[this.hls.nextLoadLevel],n=this.fragLastKbps;r=n&&this.fragCurrent?this.fragCurrent.duration*t.maxBitrate/(1e3*n)+1:0}else r=0;const a=this.getBufferedFrag(t.currentTime+r);if(a){const e=this.followingBufferedFrag(a);if(e){this.abortCurrentFrag();const t=e.maxStartPTS?e.maxStartPTS:e.start,r=e.duration,n=Math.max(a.end,t+Math.min(Math.max(r-this.config.maxFragLookUpTolerance,r*(this.couldBacktrack?.5:.125)),r*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(n,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case fn:case dn:case hn:case mn:case pn:this.state=cn}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const r=t.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),r.addEventListener("playing",this.onvplaying),r.addEventListener("seeked",this.onvseeked),this.gapController=new Ho(this.config,r,this.fragmentTracker,this.hls)}onMediaDetaching(){const{media:e}=this;e&&this.onvplaying&&this.onvseeked&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){const e=this.media,t=e?e.currentTime:null;m(t)&&this.log(`Media seeked to ${t.toFixed(3)}`);const r=this.getMainFwdBufferInfo();null!==r&&0!==r.len?this.tick():this.warn(`Main forward buffer length on "seeked" event ${r?r.len:"empty"})`)}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(E.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=this.fragLastKbps=0,this.levels=this.fragPlaying=this.backtrackFragment=this.levelLastLoaded=null,this.altAudio=this.audioOnly=this.startFragRequested=!1}onManifestParsed(e,t){let r=!1,n=!1;t.levels.forEach((e=>{const t=e.audioCodec;t&&(r=r||-1!==t.indexOf("mp4a.40.2"),n=n||-1!==t.indexOf("mp4a.40.5"))})),this.audioCodecSwitch=r&&n&&!function(){var e;const t=Zo();return"function"==typeof(null==t||null==(e=t.prototype)?void 0:e.changeType)}(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:r}=this;if(!r||this.state!==cn)return;const n=r[t.level];(!n.details||n.details.live&&this.levelLastLoaded!==n||this.waitForCdnTuneIn(n.details))&&(this.state=Tn)}onLevelLoaded(e,t){var r;const{levels:n}=this,i=t.level,a=t.details,o=a.totalduration;if(!n)return void this.warn(`Levels were reset while loading level ${i}`);this.log(`Level ${i} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""}, cc [${a.startCC}, ${a.endCC}] duration:${o}`);const s=n[i],l=this.fragCurrent;!l||this.state!==dn&&this.state!==hn||l.level!==t.level&&l.loader&&this.abortCurrentFrag();let u=0;if(a.live||null!=(r=s.details)&&r.live){var c;if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;u=this.alignPlaylists(a,s.details,null==(c=this.levelLastLoaded)?void 0:c.details)}if(s.details=a,this.levelLastLoaded=s,this.hls.trigger(E.LEVEL_UPDATED,{details:a,level:i}),this.state===Tn){if(this.waitForCdnTuneIn(a))return;this.state=cn}this.startFragRequested?a.live&&this.synchronizeToLiveEdge(a):this.setStartPosition(a,u),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:r,part:n,payload:i}=e,{levels:a}=this;if(!a)return void this.warn(`Levels were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);const o=a[r.level],s=o.details;if(!s)return this.warn(`Dropping fragment ${r.sn} of level ${r.level} after level details were reset`),void this.fragmentTracker.removeFragment(r);const l=o.videoCodec,u=s.PTSKnown||!s.live,c=null==(t=r.initSegment)?void 0:t.data,f=this._getAudioCodec(o),d=this.transmuxer=this.transmuxer||new Di(this.hls,bt,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),h=n?n.index:-1,g=-1!==h,m=new Vr(r.level,r.sn,r.stats.chunkCount,i.byteLength,h,g),p=this.initPTS[r.cc];d.push(i,c,f,l,r,n,s.totalduration,u,m,p)}onAudioTrackSwitching(e,t){const r=this.altAudio;if(!!!t.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const e=this.fragCurrent;e&&(this.log("Switching to main audio track, cancel main fragment load"),e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const e=this.hls;r&&(e.trigger(E.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),e.trigger(E.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const r=t.id,n=!!this.hls.audioTracks[r].url;if(n){const e=this.videoBuffer;e&&this.mediaBuffer!==e&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=e)}this.altAudio=n,this.tick()}onBufferCreated(e,t){const r=t.tracks;let n,i,a=!1;for(const o in r){const e=r[o];if("main"===e.id){if(i=o,n=e,"video"===o){const e=r[o];e&&(this.videoBuffer=e.buffer)}}else a=!0}a&&n?(this.log(`Alternate track found, use ${i}.buffered to schedule main fragment loading`),this.mediaBuffer=n.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:r,part:n}=t;if(r&&r.type!==bt)return;if(this.fragContextChanged(r))return this.warn(`Fragment ${r.sn}${n?" p: "+n.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}`),void(this.state===pn&&(this.state=cn));const i=n?n.stats:r.stats;this.fragLastKbps=Math.round(8*i.total/(i.buffering.end-i.loading.first)),"initSegment"!==r.sn&&(this.fragPrevious=r),this.fragBufferedComplete(r,n)}onError(e,t){var r;if(t.fatal)this.state=En;else switch(t.details){case T.FRAG_GAP:case T.FRAG_PARSING_ERROR:case T.FRAG_DECRYPT_ERROR:case T.FRAG_LOAD_ERROR:case T.FRAG_LOAD_TIMEOUT:case T.KEY_LOAD_ERROR:case T.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(bt,t);break;case T.LEVEL_LOAD_ERROR:case T.LEVEL_LOAD_TIMEOUT:case T.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==Tn||(null==(r=t.context)?void 0:r.type)!==_t||(this.state=cn);break;case T.BUFFER_APPEND_ERROR:case T.BUFFER_FULL_ERROR:if(!t.parent||"main"!==t.parent)return;if(t.details===T.BUFFER_APPEND_ERROR)return void this.resetLoadingState();this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case T.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}checkBuffer(){const{media:e,gapController:t}=this;if(e&&t&&e.readyState){if(this.loadedmetadata||!qr.getBuffered(e).length){const e=this.state!==cn?this.fragCurrent:null;t.poll(this.lastCurrentTime,e)}this.lastCurrentTime=e.currentTime}}onFragLoadEmergencyAborted(){this.state=cn,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==O||this.audioOnly&&!this.altAudio){const e=(t===M?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(e,t,bt),this.tick()}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let r=this.startPosition;if(r>=0&&t<r){if(e.seeking)return void this.log(`could not seek to ${r}, already seeking at ${t}`);const n=qr.getBuffered(e),i=(n.length?n.start(0):0)-r;i>0&&(i<this.config.maxBufferHole||i<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${i} to match buffer start`),r+=i,this.startPosition=r),this.log(`seek to target start position ${r} from current time ${t}`),e.currentTime=r}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then((r=>{const{hls:n}=this;if(!r||this.fragContextChanged(e))return;t.fragmentError=0,this.state=cn,this.startFragRequested=!1,this.bitrateTest=!1;const i=e.stats;i.parsing.start=i.parsing.end=i.buffering.start=i.buffering.end=self.performance.now(),n.trigger(E.FRAG_LOADED,r),e.bitrateTest=!1}))}_handleTransmuxComplete(e){var t;const r="main",{hls:n}=this,{remuxResult:i,chunkMeta:a}=e,o=this.getCurrentContext(a);if(!o)return void this.resetWhenMissingContext(a);const{frag:s,part:l,level:u}=o,{video:c,text:f,id3:d,initSegment:h}=i,{details:g}=u,p=this.altAudio?void 0:i.audio;if(this.fragContextChanged(s))this.fragmentTracker.removeFragment(s);else{if(this.state=mn,h){if(null!=h&&h.tracks){const e=s.initSegment||s;this._bufferInitSegment(u,h.tracks,e,a),n.trigger(E.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:r,tracks:h.tracks})}const e=h.initPTS,t=h.timescale;m(e)&&(this.initPTS[s.cc]={baseTime:e,timescale:t},n.trigger(E.INIT_PTS_FOUND,{frag:s,id:r,initPTS:e,timescale:t}))}if(c&&g&&"initSegment"!==s.sn){const e=g.fragments[s.sn-1-g.startSN],t=s.sn===g.startSN,r=!e||s.cc>e.cc;if(!1!==i.independent){const{startPTS:e,endPTS:n,startDTS:i,endDTS:o}=c;if(l)l.elementaryStreams[c.type]={startPTS:e,endPTS:n,startDTS:i,endDTS:o};else if(c.firstKeyFrame&&c.independent&&1===a.id&&!r&&(this.couldBacktrack=!0),c.dropped&&c.independent){const i=this.getMainFwdBufferInfo(),a=(i?i.end:this.getLoadPosition())+this.config.maxBufferHole,l=c.firstKeyFramePTS?c.firstKeyFramePTS:e;if(!t&&a<l-this.config.maxBufferHole&&!r)return void this.backtrack(s);r&&(s.gap=!0),s.setElementaryStreamInfo(c.type,s.start,n,s.start,o,!0)}else t&&e>2&&(s.gap=!0);s.setElementaryStreamInfo(c.type,e,n,i,o),this.backtrackFragment&&(this.backtrackFragment=s),this.bufferFragmentData(c,s,l,a,t||r)}else{if(!t&&!r)return void this.backtrack(s);s.gap=!0}}if(p){const{startPTS:e,endPTS:t,startDTS:r,endDTS:n}=p;l&&(l.elementaryStreams[O]={startPTS:e,endPTS:t,startDTS:r,endDTS:n}),s.setElementaryStreamInfo(O,e,t,r,n),this.bufferFragmentData(p,s,l,a)}if(g&&null!=d&&null!=(t=d.samples)&&t.length){const e={id:r,frag:s,details:g,samples:d.samples};n.trigger(E.FRAG_PARSING_METADATA,e)}if(g&&f){const e={id:r,frag:s,details:g,samples:f.samples};n.trigger(E.FRAG_PARSING_USERDATA,e)}}}_bufferInitSegment(e,t,r,n){if(this.state!==mn)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;const{audio:i,video:a,audiovideo:o}=t;if(i){let t=e.audioCodec;const r=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){t&&(t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5");const e=i.metadata;e&&"channelCount"in e&&1!==(e.channelCount||1)&&-1===r.indexOf("firefox")&&(t="mp4a.40.5")}t&&-1!==t.indexOf("mp4a.40.5")&&-1!==r.indexOf("android")&&"audio/mpeg"!==i.container&&(t="mp4a.40.2",this.log(`Android: force audio codec to ${t}`)),e.audioCodec&&e.audioCodec!==t&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${t}"`),i.levelCodec=t,i.id="main",this.log(`Init audio buffer, container:${i.container}, codecs[selected/level/parsed]=[${t||""}/${e.audioCodec||""}/${i.codec}]`)}a&&(a.levelCodec=e.videoCodec,a.id="main",this.log(`Init video buffer, container:${a.container}, codecs[level/parsed]=[${e.videoCodec||""}/${a.codec}]`)),o&&this.log(`Init audiovideo buffer, container:${o.container}, codecs[level/parsed]=[${e.codecs}/${o.codec}]`),this.hls.trigger(E.BUFFER_CODECS,t),Object.keys(t).forEach((e=>{const i=t[e].initSegment;null!=i&&i.byteLength&&this.hls.trigger(E.BUFFER_APPENDING,{type:e,data:i,frag:r,part:null,chunkMeta:n,parent:r.type})})),this.tickImmediate()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,bt)}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=cn}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&!1===e.seeking){const r=e.currentTime;if(qr.isBuffered(e,r)?t=this.getAppendedFrag(r):qr.isBuffered(e,r+.1)&&(t=this.getAppendedFrag(r+.1)),t){this.backtrackFragment=null;const e=this.fragPlaying,r=t.level;e&&t.sn===e.sn&&e.level===r||(this.fragPlaying=t,this.hls.trigger(E.FRAG_CHANGED,{frag:t}),e&&e.level===r||this.hls.trigger(E.LEVEL_SWITCHED,{level:r}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){const e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}get currentProgramDateTime(){const e=this.media;if(e){const t=e.currentTime,r=this.currentFrag;if(r&&m(t)&&m(r.programDateTime)){const e=r.programDateTime+1e3*(t-r.start);return new Date(e)}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class Yo{static get version(){return"1.5.11"}static isMSESupported(){return Go()}static isSupported(){return function(){if(!Go())return!1;const e=We();return"function"==typeof(null==e?void 0:e.isTypeSupported)&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some((t=>e.isTypeSupported(et(t,"video"))))||["mp4a.40.2","fLaC"].some((t=>e.isTypeSupported(et(t,"audio")))))}()}static getMediaSource(){return We()}static get Events(){return E}static get ErrorTypes(){return v}static get ErrorDetails(){return T}static get DefaultConfig(){return Yo.defaultConfig?Yo.defaultConfig:Mo}static set DefaultConfig(e){Yo.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this.started=!1,this._emitter=new Ci,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,this.triggeringException=void 0,function(e,t){if("object"==typeof console&&!0===e||"object"==typeof e){b(e,"debug","log","info","warn","error");try{A.log(`Debug logs enabled for "${t}" in hls.js version 1.5.11`)}catch(r){A=S}}else A=S}(e.debug||!1,"Hls instance");const t=this.config=function(e,t){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const r=Po(e),n=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach((e=>{const i=`${"level"===e?"playlist":e}LoadPolicy`,a=void 0===t[i],o=[];n.forEach((n=>{const s=`${e}Loading${n}`,l=t[s];if(void 0!==l&&a){o.push(s);const e=r[i].default;switch(t[i]={default:e},n){case"TimeOut":e.maxLoadTimeMs=l,e.maxTimeToFirstByteMs=l;break;case"MaxRetry":e.errorRetry.maxNumRetry=l,e.timeoutRetry.maxNumRetry=l;break;case"RetryDelay":e.errorRetry.retryDelayMs=l,e.timeoutRetry.retryDelayMs=l;break;case"MaxRetryTimeout":e.errorRetry.maxRetryDelayMs=l,e.timeoutRetry.maxRetryDelayMs=l}}})),o.length&&R.warn(`hls.js config: "${o.join('", "')}" setting(s) are deprecated, use "${i}": ${JSON.stringify(t[i])}`)})),f(f({},r),t)}(Yo.DefaultConfig,e);this.userConfig=e,t.progressive&&ko(t);const{abrController:r,bufferController:n,capLevelController:i,errorController:a,fpsController:o}=t,s=new a(this),l=this.abrController=new r(this),u=this.bufferController=new n(this),c=this.capLevelController=new i(this),d=new o(this),h=new Dt(this),g=new Ht(this),m=t.contentSteeringController,p=m?new m(this):null,y=this.levelController=new Fo(this,p),v=new Gr(this),T=new Bo(this.config),_=this.streamController=new Ko(this,v,T);c.setStreamController(_),d.setStreamController(_);const I=[h,y,_];p&&I.splice(1,0,p),this.networkControllers=I;const w=[l,u,c,d,g,v];this.audioTrackController=this.createController(t.audioTrackController,I);const C=t.audioStreamController;C&&I.push(new C(this,v,T)),this.subtitleTrackController=this.createController(t.subtitleTrackController,I);const D=t.subtitleStreamController;D&&I.push(new D(this,v,T)),this.createController(t.timelineController,w),T.emeController=this.emeController=this.createController(t.emeController,w),this.cmcdController=this.createController(t.cmcdController,w),this.latencyController=this.createController(Kt,w),this.coreComponents=w,I.push(s);const L=s.onErrorOut;"function"==typeof L&&this.on(E.ERROR,L,s)}createController(e,t){if(e){const r=new e(this);return t&&t.push(r),r}return null}on(e,t,r=this){this._emitter.on(e,t,r)}once(e,t,r=this){this._emitter.once(e,t,r)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,r=this,n){this._emitter.off(e,t,r,n)}listeners(e){return this._emitter.listeners(e)}emit(e,t,r){return this._emitter.emit(e,t,r)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(r){if(R.error("An internal error happened while handling event "+e+'. Error message: "'+r.message+'". Here is a stacktrace:',r),!this.triggeringException){this.triggeringException=!0;const t=e===E.ERROR;this.trigger(E.ERROR,{type:v.OTHER_ERROR,details:T.INTERNAL_EXCEPTION,fatal:t,event:e,error:r}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){R.log("destroy"),this.trigger(E.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach((e=>e.destroy())),this.networkControllers.length=0,this.coreComponents.forEach((e=>e.destroy())),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){R.log("attachMedia"),this._media=e,this.trigger(E.MEDIA_ATTACHING,{media:e})}detachMedia(){R.log("detachMedia"),this.trigger(E.MEDIA_DETACHING,void 0),this._media=null}loadSource(e){this.stopLoad();const t=this.media,r=this.url,n=this.url=u.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,R.log(`loadSource:${n}`),t&&r&&(r!==n||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(E.MANIFEST_LOADING,{url:e})}startLoad(e=-1){R.log(`startLoad(${e})`),this.started=!0,this.networkControllers.forEach((t=>{t.startLoad(e)}))}stopLoad(){R.log("stopLoad"),this.started=!1,this.networkControllers.forEach((e=>{e.stopLoad()}))}resumeBuffering(){this.started&&this.networkControllers.forEach((e=>{"fragmentLoader"in e&&e.startLoad(-1)}))}pauseBuffering(){this.networkControllers.forEach((e=>{"fragmentLoader"in e&&e.stopLoad()}))}swapAudioCodec(){R.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){R.log("recoverMediaError");const e=this._media;this.detachMedia(),e&&this.attachMedia(e)}removeLevel(e){this.levelController.removeLevel(e)}get levels(){const e=this.levelController.levels;return e||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){R.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){R.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){R.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){R.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return-1===e&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){R.log(`set startLevel:${e}`),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(R.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){(function(e){return Yt.indexOf(e)>-1})(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return-1===this.levelController.manualLevel}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const r=e.length;for(let n=0;n<r;n++)if(e[n].maxBitrate>=t)return n;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:r}=this;let n;if(n=-1===t&&null!=e&&e.length?e.length-1:t,r)for(let i=n;i--;){const t=e[i].attrs["HDCP-LEVEL"];if(t&&t<=r)return i}return n}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}setAudioOption(e){var t;return null==(t=this.audioTrackController)?void 0:t.setAudioOption(e)}setSubtitleOption(e){var t;return null==(t=this.subtitleTrackController)||t.setSubtitleOption(e),null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return!!e&&e.subtitleDisplay}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}Yo.defaultConfig=void 0;var qo={exports:{}};
/*! For license information please see dash.all.min.js.LICENSE.txt */self;var Vo=qo.exports=function(){var e={4593:function(e,t){var r,n,i,o,l,u=function(e){for(var t=[],r=0;r<e.length;++r){var n=e.charCodeAt(r);n<128?t.push(n):n<2048?(t.push(192|n>>6),t.push(128|63&n)):n<65536?(t.push(224|n>>12),t.push(128|63&n>>6),t.push(128|63&n)):(t.push(240|n>>18),t.push(128|63&n>>12),t.push(128|63&n>>6),t.push(128|63&n))}return t},c=function(e){for(var t=[],r=0;r<e.length;){var n=e[r++];n<128||(n<224?(n=(31&n)<<6,n|=63&e[r++]):n<240?(n=(15&n)<<12,n|=(63&e[r++])<<6,n|=63&e[r++]):(n=(7&n)<<18,n|=(63&e[r++])<<12,n|=(63&e[r++])<<6,n|=63&e[r++])),t.push(String.fromCharCode(n))}return t.join("")},f={};r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=function(e){for(var t=0,n=[],i=0|e.length/3;0<i--;){var a=(e[t]<<16)+(e[t+1]<<8)+e[t+2];t+=3,n.push(r.charAt(63&a>>18)),n.push(r.charAt(63&a>>12)),n.push(r.charAt(63&a>>6)),n.push(r.charAt(63&a))}return 2==e.length-t?(a=(e[t]<<16)+(e[t+1]<<8),n.push(r.charAt(63&a>>18)),n.push(r.charAt(63&a>>12)),n.push(r.charAt(63&a>>6)),n.push("=")):1==e.length-t&&(a=e[t]<<16,n.push(r.charAt(63&a>>18)),n.push(r.charAt(63&a>>12)),n.push("==")),n.join("")},i=function(){for(var e=[],t=0;t<r.length;++t)e[r.charCodeAt(t)]=t;return e["=".charCodeAt(0)]=0,e}(),o=function(e){for(var t=0,r=[],n=0|e.length/4;0<n--;){var a=(i[e.charCodeAt(t)]<<18)+(i[e.charCodeAt(t+1)]<<12)+(i[e.charCodeAt(t+2)]<<6)+i[e.charCodeAt(t+3)];r.push(255&a>>16),r.push(255&a>>8),r.push(255&a),t+=4}return r&&("="==e.charAt(t-2)?(r.pop(),r.pop()):"="==e.charAt(t-1)&&r.pop()),r},l={encode:function(e){for(var t=[],r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t},decode:function(e){for(var t=0;t<s.length;++t)a[t]=String.fromCharCode(a[t]);return a.join("")}},f.decodeArray=function(e){var t=o(e);return new Uint8Array(t)},f.encodeASCII=function(e){var t=l.encode(e);return n(t)},f.decodeASCII=function(e){var t=o(e);return l.decode(t)},f.encode=function(e){var t=u(e);return n(t)},f.decode=function(e){var t=o(e);return c(t)},t.decode=f.decode,t.decodeArray=f.decodeArray,t.encode=f.encode,t.encodeASCII=f.encodeASCII},452:function(e,t){!function(e){var t={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},r=function(e){var r=e;return t.hasOwnProperty(e)&&(r=t[e]),String.fromCharCode(r)},n=15,i=32,a={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},o={17:2,18:4,21:6,22:8,23:10,19:13,20:15},s={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},l={25:2,26:4,29:6,30:8,31:10,27:13,28:15},u=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],c={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(e){this.time=e},log:function(e,t){this.verboseFilter[e],this.verboseLevel}},f=function(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r].toString(16));return t},d=function(e,t,r,n,i){this.foreground=e||"white",this.underline=t||!1,this.italics=r||!1,this.background=n||"black",this.flash=i||!1};d.prototype={reset:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},setStyles:function(e){for(var t=["foreground","underline","italics","background","flash"],r=0;r<t.length;r++){var n=t[r];e.hasOwnProperty(n)&&(this[n]=e[n])}},isDefault:function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},equals:function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},copy:function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},toString:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}};var h=function(e,t,r,n,i,a){this.uchar=e||" ",this.penState=new d(t,r,n,i,a)};h.prototype={reset:function(){this.uchar=" ",this.penState.reset()},setChar:function(e,t){this.uchar=e,this.penState.copy(t)},setPenState:function(e){this.penState.copy(e)},equals:function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},copy:function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},isEmpty:function(){return" "===this.uchar&&this.penState.isDefault()}};var g=function(){this.chars=[];for(var e=0;e<i;e++)this.chars.push(new h);this.pos=0,this.currPenState=new d};g.prototype={equals:function(e){for(var t=!0,r=0;r<i;r++)if(!this.chars[r].equals(e.chars[r])){t=!1;break}return t},copy:function(e){for(var t=0;t<i;t++)this.chars[t].copy(e.chars[t])},isEmpty:function(){for(var e=!0,t=0;t<i;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},setCursor:function(e){this.pos!==e&&(this.pos=e),this.pos<0?(c.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>i&&(c.log("ERROR","Too large cursor position "+this.pos),this.pos=i)},moveCursor:function(e){var t=this.pos+e;if(e>1)for(var r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)},backSpace:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},insertChar:function(e){e>=144&&this.backSpace();var t=r(e);this.pos>=i?c.log("ERROR","Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))},clearFromPos:function(e){var t;for(t=e;t<i;t++)this.chars[t].reset()},clear:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},clearToEndOfRow:function(){this.clearFromPos(this.pos)},getTextString:function(){for(var e=[],t=!0,r=0;r<i;r++){var n=this.chars[r].uchar;" "!==n&&(t=!1),e.push(n)}return t?"":e.join("")},setPenStyles:function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}};var m=function(){this.rows=[];for(var e=0;e<n;e++)this.rows.push(new g);this.currRow=14,this.nrRollUpRows=null,this.reset()};m.prototype={reset:function(){for(var e=0;e<n;e++)this.rows[e].clear();this.currRow=14},equals:function(e){for(var t=!0,r=0;r<n;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t},copy:function(e){for(var t=0;t<n;t++)this.rows[t].copy(e.rows[t])},isEmpty:function(){for(var e=!0,t=0;t<n;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},backSpace:function(){this.rows[this.currRow].backSpace()},clearToEndOfRow:function(){this.rows[this.currRow].clearToEndOfRow()},insertChar:function(e){this.rows[this.currRow].insertChar(e)},setPen:function(e){this.rows[this.currRow].setPenStyles(e)},moveCursor:function(e){this.rows[this.currRow].moveCursor(e)},setCursor:function(e){c.log("INFO","setCursor: "+e),this.rows[this.currRow].setCursor(e)},setPAC:function(e){c.log("INFO","pacData = "+JSON.stringify(e));var t=e.row-1;this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.currRow=t;var r=this.rows[this.currRow];if(null!==e.indent){var n=e.indent,i=Math.max(n-1,0);r.setCursor(e.indent),e.color=r.chars[i].penState.foreground}var a={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(a)},setBkgData:function(e){c.log("INFO","bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)},setRollUpRows:function(e){this.nrRollUpRows=e},rollUp:function(){if(null!==this.nrRollUpRows){c.log("TEXT",this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),c.log("INFO","Rolling up")}else c.log("DEBUG","roll_up but nrRollUpRows not set yet")},getDisplayText:function(e){e=e||!1;for(var t=[],r="",i=-1,a=0;a<n;a++){var o=this.rows[a].getTextString();o&&(i=a+1,e?t.push("Row "+i+': "'+o+'"'):t.push(o.trim()))}return t.length>0&&(r=e?"["+t.join(" | ")+"]":t.join("\n")),r},getTextAndFormat:function(){return this.rows}};var p=function(e,t){this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new m,this.nonDisplayedMemory=new m,this.lastOutputScreen=new m,this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null};p.prototype={modes:["MODE_ROLL-UP","MODE_POP-ON","MODE_PAINT-ON","MODE_TEXT"],reset:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},getHandler:function(){return this.outputFilter},setHandler:function(e){this.outputFilter=e},setPAC:function(e){this.writeScreen.setPAC(e)},setBkgData:function(e){this.writeScreen.setBkgData(e)},setMode:function(e){e!==this.mode&&(this.mode=e,c.log("INFO","MODE="+e),"MODE_POP-ON"==this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},insertChars:function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var r=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";c.log("INFO",r+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(c.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},cc_RCL:function(){c.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},cc_BS:function(){c.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},cc_AOF:function(){},cc_AON:function(){},cc_DER:function(){c.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},cc_RU:function(e){c.log("INFO","RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},cc_FON:function(){c.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},cc_RDC:function(){c.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},cc_TR:function(){c.log("INFO","TR"),this.setMode("MODE_TEXT")},cc_RTD:function(){c.log("INFO","RTD"),this.setMode("MODE_TEXT")},cc_EDM:function(){c.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate()},cc_CR:function(){c.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate()},cc_ENM:function(){c.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},cc_EOC:function(){if(c.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,c.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate()},cc_TO:function(e){c.log("INFO","TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},cc_MIDROW:function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var r=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][r]}c.log("INFO","MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},outputDataUpdate:function(){var e=c.time;null!==e&&this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(e,this.displayedMemory),null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))},cueSplitAtTime:function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}};var y=function(e,t,r){this.field=e||1,this.outputs=[t,r],this.channels=[new p(1,t),new p(2,r)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}};y.prototype={getHandler:function(e){return this.channels[e].getHandler()},setHandler:function(e,t){this.channels[e].setHandler(t)},addData:function(e,t){var r,n,i,a=!1;this.lastTime=e,c.setTime(e);for(var o=0;o<t.length;o+=2)n=127&t[o],i=127&t[o+1],n>=16&&n<=31&&n===this.lastCmdA&&i===this.lastCmdB?(this.lastCmdA=null,this.lastCmdB=null,c.log("DEBUG","Repeated command ("+f([n,i])+") is dropped")):0!==n||0!==i?(c.log("DATA","["+f([t[o],t[o+1]])+"] -> ("+f([n,i])+")"),(r=this.parseCmd(n,i))||(r=this.parseMidrow(n,i)),r||(r=this.parsePAC(n,i)),r||(r=this.parseBackgroundAttributes(n,i)),r||(a=this.parseChars(n,i))&&(this.currChNr&&this.currChNr>=0?this.channels[this.currChNr-1].insertChars(a):c.log("WARNING","No channel found yet. TEXT-MODE?")),r?this.dataCounters.cmd+=2:a?this.dataCounters.char+=2:(this.dataCounters.other+=2,c.log("WARNING","Couldn't parse cleaned data "+f([n,i])+" orig: "+f([t[o],t[o+1]])))):this.dataCounters.padding+=2},parseCmd:function(e,t){var r;if(!((20===e||21===e||28===e||29===e)&&32<=t&&t<=47||(23===e||31===e)&&33<=t&&t<=35))return!1;r=20===e||21===e||23===e?1:2;var n=this.channels[r-1];return 20===e||21===e||28===e||29===e?32===t?n.cc_RCL():33===t?n.cc_BS():34===t?n.cc_AOF():35===t?n.cc_AON():36===t?n.cc_DER():37===t?n.cc_RU(2):38===t?n.cc_RU(3):39===t?n.cc_RU(4):40===t?n.cc_FON():41===t?n.cc_RDC():42===t?n.cc_TR():43===t?n.cc_RTD():44===t?n.cc_EDM():45===t?n.cc_CR():46===t?n.cc_ENM():47===t&&n.cc_EOC():n.cc_TO(t-32),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=r,!0},parseMidrow:function(e,t){var r=null;if((17===e||25===e)&&32<=t&&t<=47){if((r=17===e?1:2)!==this.currChNr)return c.log("ERROR","Mismatch channel in midrow parsing"),!1;var n=this.channels[r-1];return n.insertChars([32]),n.cc_MIDROW(t),c.log("DEBUG","MIDROW ("+f([e,t])+")"),this.lastCmdA=e,this.lastCmdB=t,!0}return!1},parsePAC:function(e,t){var r,n;if(!((17<=e&&e<=23||25<=e&&e<=31)&&64<=t&&t<=127||(16===e||24===e)&&64<=t&&t<=95))return!1;r=e<=23?1:2,n=64<=t&&t<=95?1===r?a[e]:s[e]:1===r?o[e]:l[e];var i=this.interpretPAC(n,t);return this.channels[r-1].setPAC(i),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=r,!0},interpretPAC:function(e,t){var r,n={color:null,italics:!1,indent:null,underline:!1,row:e};return r=t>95?t-96:t-64,n.underline=!(1&~r),r<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(n.italics=!0,n.color="white"):n.indent=4*Math.floor((r-16)/2),n},parseChars:function(e,t){var n,i=null,a=null,o=null;if(e>=25?(i=2,o=e-8):(i=1,o=e),17<=o&&o<=19?(n=17===o?t+80:18===o?t+112:t+144,c.log("INFO","Special char '"+r(n)+"' in channel "+i),a=[n],this.lastCmdA=e,this.lastCmdB=t):32<=e&&e<=127&&(a=0===t?[e]:[e,t],this.lastCmdA=null,this.lastCmdB=null),a){var s=f(a);c.log("DEBUG","Char codes =  "+s.join(","))}return a},parseBackgroundAttributes:function(e,t){var r,n,i;return((16===e||24===e)&&32<=t&&t<=47||(23===e||31===e)&&45<=t&&t<=47)&&(r={},16===e||24===e?(n=Math.floor((t-32)/2),r.background=u[n],t%2==1&&(r.background=r.background+"_semi")):45===t?r.background="transparent":(r.foreground="black",47===t&&(r.underline=!0)),i=e<24?1:2,this.channels[i-1].setBkgData(r),this.lastCmdA=e,this.lastCmdB=t,!0)},reset:function(){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].reset();this.lastCmdA=null,this.lastCmdB=null},cueSplitAtTime:function(e){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].cueSplitAtTime(e)}},e.logger=c,e.PenState=d,e.CaptionScreen=m,e.Cea608Parser=y,e.findCea608Nalus=function(e,t,r){for(var n=0,i=t,a=[],o=function(e,t,r,n){if(4!==e||t<8)return null;var i=r.getUint8(n),a=r.getUint16(n+1),o=r.getUint32(n+3),s=r.getUint8(n+7);return 181==i&&49==a&&1195456820==o&&3==s};i<t+r;){if(n=e.getUint32(i),6==(31&e.getUint8(i+4)))for(var s=i+5,l=-1;s<i+4+n-1;){l=0;for(var u=255;255===u;)l+=u=e.getUint8(s),s++;var c=0;for(u=255;255===u;)c+=u=e.getUint8(s),s++;o(l,c,e,s)&&a.push([s,c]),s+=c}i+=n+4}return a},e.extractCea608DataFromRange=function(e,t){var r=t[0],n=[[],[]];r+=8;var i=31&e.getUint8(r);r+=2;for(var a=0;a<i;a++){var o=e.getUint8(r),s=4&o,l=3&o;r++;var u=e.getUint8(r);r++;var c=e.getUint8(r);r++,s&&(127&u)+(127&c)!=0&&(0===l?(n[0].push(u),n[0].push(c)):1===l&&(n[1].push(u),n[1].push(c)))}return n}}(t)},8416:function(e,t,r){var n=r(1139),i=r(5448),a=r(6398),o=r(2032),s=(r(5530),"undefined"!=typeof window&&window||r.g),l=s.dashjs;l||(l=s.dashjs={}),l.MediaPlayer=n.Z,l.FactoryMaker=i.Z,l.Debug=a.Z,l.Version=(0,o.e)()},6398:function(e,t,r){var n=r(5595),i=r(8512),a=r(5448),o=1,s=2,l=3,u=4,c=5;function f(e){e=e||{};var t,r,a,f,d=this.context,h=(0,n.Z)(d).getInstance(),g=e.settings,m=[];function p(e){return e&&e.bind?e.bind(window.console):window.console.log.bind(window.console)}function y(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];S.apply(void 0,[o,this].concat(t))}function E(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];S.apply(void 0,[s,this].concat(t))}function v(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];S.apply(void 0,[l,this].concat(t))}function T(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];S.apply(void 0,[u,this].concat(t))}function _(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];S.apply(void 0,[c,this].concat(t))}function S(e,t){var n="",o=null;r&&(o=(new Date).getTime(),n+="["+(o-f)+"]"),a&&t&&t.getClassName&&(n+="["+t.getClassName()+"]",t.getType&&(n+="["+t.getType()+"]")),n.length>0&&(n+=" ");for(var s=arguments.length,l=new Array(s>2?s-2:0),u=2;u<s;u++)l[u-2]=arguments[u];Array.apply(null,l).forEach((function(e){n+=e+" "})),m[e]&&g&&g.get().debug.logLevel>=e&&m[e](n),g&&g.get().debug.dispatchEvent&&h.trigger(i.Z.LOG,{message:n,level:e})}return t={getLogger:function(e){return{fatal:y.bind(e),error:E.bind(e),warn:v.bind(e),info:T.bind(e),debug:_.bind(e)}},setLogTimestampVisible:function(e){r=e},setCalleeNameVisible:function(e){a=e}},r=!0,a=!0,f=(new Date).getTime(),"undefined"!=typeof window&&window.console&&(m[o]=p(window.console.error),m[s]=p(window.console.error),m[l]=p(window.console.warn),m[u]=p(window.console.info),m[c]=p(window.console.debug)),t}f.__dashjs_factory_name="Debug";var d=a.Z.getSingletonFactory(f);d.LOG_LEVEL_NONE=0,d.LOG_LEVEL_FATAL=o,d.LOG_LEVEL_ERROR=s,d.LOG_LEVEL_WARNING=l,d.LOG_LEVEL_INFO=u,d.LOG_LEVEL_DEBUG=c,a.Z.updateSingletonFactory(f.__dashjs_factory_name,d),t.Z=d},5595:function(e,t,r){var n=r(5448),i=r(8825);function a(){var e={};function t(t,r,n){var i=-1;return e[t]?(e[t].some((function(e,t){if(e&&e.callback===r&&(!n||n===e.scope))return i=t,!0})),i):i}var r={on:function(r,n,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!r)throw new Error("event type cannot be null or undefined");if(!n||"function"!=typeof n)throw new Error("listener must be a function: "+n);var o=a.priority||0;if(!(t(r,n,i)>=0)){e[r]=e[r]||[];var s={callback:n,scope:i,priority:o};i&&i.getStreamId&&(s.streamId=i.getStreamId()),i&&i.getType&&(s.mediaType=i.getType()),a&&a.mode&&(s.mode=a.mode),e[r].some((function(t,n){if(t&&o>t.priority)return e[r].splice(n,0,s),!0}))||e[r].push(s)}},off:function(r,n,i){if(r&&n&&e[r]){var a=t(r,n,i);a<0||(e[r][a]=null)}},trigger:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(t&&e[t]){if((r=r||{}).hasOwnProperty("type"))throw new Error("'type' is a reserved word for event dispatching");r.type=t,n.streamId&&(r.streamId=n.streamId),n.mediaType&&(r.mediaType=n.mediaType),e[t].filter((function(e){return!(!e||n.streamId&&e.streamId&&e.streamId!==n.streamId||n.mediaType&&e.mediaType&&e.mediaType!==n.mediaType||n.mode&&e.mode&&e.mode!==n.mode||!e.mode&&n.mode&&n.mode===i.Z.EVENT_MODE_ON_RECEIVE)})).forEach((function(e){return e&&e.callback.call(e.scope,r)}))}},reset:function(){e={}}};return r}a.__dashjs_factory_name="EventBus";var o=n.Z.getSingletonFactory(a);o.EVENT_PRIORITY_LOW=0,o.EVENT_PRIORITY_HIGH=5e3,n.Z.updateSingletonFactory(a.__dashjs_factory_name,o),t.Z=o},5448:function(e,t){var r=function(){var e,t=[],r={},n={};function i(e,r){for(var n in t){var i=t[n];if(i.context===e&&i.name===r)return i.instance}return null}function a(e,t){return t[e]}function o(e,t,r){e in r&&(r[e]=t)}function s(t,r,n){var i,a=t.__dashjs_factory_name,o=r[a];if(o){var s=o.instance;if(!o.override)return s.apply({context:r,factory:e},n);for(var l in i=t.apply({context:r},n),s=s.apply({context:r,factory:e,parent:i},n))i.hasOwnProperty(l)&&(i[l]=s[l])}else i=t.apply({context:r},n);return i.getClassName=function(){return a},i}return e={extend:function(e,t,r,n){!n[e]&&t&&(n[e]={instance:t,override:r})},getSingletonInstance:i,setSingletonInstance:function(e,r,n){for(var i in t){var a=t[i];if(a.context===e&&a.name===r)return void(t[i].instance=n)}t.push({name:r,context:e,instance:n})},deleteSingletonInstances:function(e){t=t.filter((function(t){return t.context!==e}))},getSingletonFactory:function(e){var n=a(e.__dashjs_factory_name,r);return n||(n=function(r){var n;return void 0===r&&(r={}),{getInstance:function(){return n||(n=i(r,e.__dashjs_factory_name)),n||(n=s(e,r,arguments),t.push({name:e.__dashjs_factory_name,context:r,instance:n})),n}}},r[e.__dashjs_factory_name]=n),n},getSingletonFactoryByName:function(e){return a(e,r)},updateSingletonFactory:function(e,t){o(e,t,r)},getClassFactory:function(e){var t=a(e.__dashjs_factory_name,n);return t||(t=function(t){return void 0===t&&(t={}),{create:function(){return s(e,t,arguments)}}},n[e.__dashjs_factory_name]=t),t},getClassFactoryByName:function(e){return a(e,n)},updateClassFactory:function(e,t){o(e,t,n)}},e}();t.Z=r},1264:function(e,t,r){var n=r(5448),i=r(703),a=r(6398),o=r(3393),s=r(7855),l=r(5595),u=r(8512);function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function d(){var e,t,r=this.context,n=(0,l.Z)(r).getInstance(),d={"streaming.delay.liveDelay":u.Z.SETTING_UPDATED_LIVE_DELAY,"streaming.delay.liveDelayFragmentCount":u.Z.SETTING_UPDATED_LIVE_DELAY_FRAGMENT_COUNT,"streaming.liveCatchup.enabled":u.Z.SETTING_UPDATED_CATCHUP_ENABLED,"streaming.liveCatchup.playbackRate.min":u.Z.SETTING_UPDATED_PLAYBACK_RATE_MIN,"streaming.liveCatchup.playbackRate.max":u.Z.SETTING_UPDATED_PLAYBACK_RATE_MAX},h={debug:{logLevel:a.Z.LOG_LEVEL_WARNING,dispatchEvent:!1},streaming:{abandonLoadTimeout:1e4,wallclockTimeUpdateInterval:100,manifestUpdateRetryInterval:100,liveUpdateTimeThresholdInMilliseconds:0,cacheInitSegments:!1,applyServiceDescription:!0,applyProducerReferenceTime:!0,applyContentSteering:!0,eventControllerRefreshDelay:100,enableManifestDurationMismatchFix:!0,parseInbandPrft:!1,enableManifestTimescaleMismatchFix:!1,capabilities:{filterUnsupportedEssentialProperties:!0,useMediaCapabilitiesApi:!1},timeShiftBuffer:{calcFromSegmentTimeline:!1,fallbackToSegmentTimeline:!0},metrics:{maxListDepth:100},delay:{liveDelayFragmentCount:NaN,liveDelay:NaN,useSuggestedPresentationDelay:!0},protection:{keepProtectionMediaKeys:!1,ignoreEmeEncryptedEvent:!1,detectPlayreadyMessageFormat:!0},buffer:{enableSeekDecorrelationFix:!1,fastSwitchEnabled:!0,flushBufferAtTrackSwitch:!1,reuseExistingSourceBuffers:!0,bufferPruningInterval:10,bufferToKeep:20,bufferTimeAtTopQuality:30,bufferTimeAtTopQualityLongForm:60,initialBufferLevel:NaN,stableBufferTime:12,longFormContentDurationThreshold:600,stallThreshold:.3,useAppendWindow:!0,setStallState:!0,avoidCurrentTimeRangePruning:!1,useChangeTypeForTrackSwitch:!0,mediaSourceDurationInfinity:!0,resetSourceBuffersForTrackSwitch:!1},gaps:{jumpGaps:!0,jumpLargeGaps:!0,smallGapLimit:1.5,threshold:.3,enableSeekFix:!0,enableStallFix:!1,stallSeek:.1},utcSynchronization:{enabled:!0,useManifestDateHeaderTimeSource:!0,backgroundAttempts:2,timeBetweenSyncAttempts:30,maximumTimeBetweenSyncAttempts:600,minimumTimeBetweenSyncAttempts:2,timeBetweenSyncAttemptsAdjustmentFactor:2,maximumAllowedDrift:100,enableBackgroundSyncAfterSegmentDownloadError:!0,defaultTimingSource:{scheme:"urn:mpeg:dash:utc:http-xsdate:2014",value:"https://time.akamai.com/?iso&ms"}},scheduling:{defaultTimeout:500,lowLatencyTimeout:0,scheduleWhilePaused:!0},text:{defaultEnabled:!0,dispatchForManualRendering:!1,extendSegmentedCues:!0,imsc:{displayForcedOnlyMode:!1,enableRollUp:!0},webvtt:{customRenderingEnabled:!1}},liveCatchup:{maxDrift:NaN,playbackRate:{min:NaN,max:NaN},playbackBufferMin:.5,enabled:null,mode:o.Z.LIVE_CATCHUP_MODE_DEFAULT},lastBitrateCachingInfo:{enabled:!0,ttl:36e4},lastMediaSettingsCachingInfo:{enabled:!0,ttl:36e4},saveLastMediaSettingsForCurrentStreamingSession:!0,cacheLoadThresholds:{video:50,audio:5},trackSwitchMode:{audio:o.Z.TRACK_SWITCH_MODE_ALWAYS_REPLACE,video:o.Z.TRACK_SWITCH_MODE_NEVER_REPLACE},selectionModeForInitialTrack:o.Z.TRACK_SELECTION_MODE_HIGHEST_SELECTION_PRIORITY,fragmentRequestTimeout:2e4,fragmentRequestProgressTimeout:-1,manifestRequestTimeout:1e4,retryIntervals:(e={},f(e,s.w.MPD_TYPE,500),f(e,s.w.XLINK_EXPANSION_TYPE,500),f(e,s.w.MEDIA_SEGMENT_TYPE,1e3),f(e,s.w.INIT_SEGMENT_TYPE,1e3),f(e,s.w.BITSTREAM_SWITCHING_SEGMENT_TYPE,1e3),f(e,s.w.INDEX_SEGMENT_TYPE,1e3),f(e,s.w.MSS_FRAGMENT_INFO_SEGMENT_TYPE,1e3),f(e,s.w.LICENSE,1e3),f(e,s.w.OTHER_TYPE,1e3),f(e,"lowLatencyReductionFactor",10),e),retryAttempts:(t={},f(t,s.w.MPD_TYPE,3),f(t,s.w.XLINK_EXPANSION_TYPE,1),f(t,s.w.MEDIA_SEGMENT_TYPE,3),f(t,s.w.INIT_SEGMENT_TYPE,3),f(t,s.w.BITSTREAM_SWITCHING_SEGMENT_TYPE,3),f(t,s.w.INDEX_SEGMENT_TYPE,3),f(t,s.w.MSS_FRAGMENT_INFO_SEGMENT_TYPE,3),f(t,s.w.LICENSE,3),f(t,s.w.OTHER_TYPE,3),f(t,"lowLatencyMultiplyFactor",5),t),abr:{movingAverageMethod:o.Z.MOVING_AVERAGE_SLIDING_WINDOW,ABRStrategy:o.Z.ABR_STRATEGY_DYNAMIC,additionalAbrRules:{insufficientBufferRule:!0,switchHistoryRule:!0,droppedFramesRule:!0,abandonRequestsRule:!0},abrRulesParameters:{abandonRequestsRule:{graceTimeThreshold:500,abandonMultiplier:1.8,minLengthToAverage:5}},bandwidthSafetyFactor:.9,useDefaultABRRules:!0,useDeadTimeLatency:!0,limitBitrateByPortal:!1,usePixelRatioInLimitBitrateByPortal:!1,maxBitrate:{audio:-1,video:-1},minBitrate:{audio:-1,video:-1},maxRepresentationRatio:{audio:1,video:1},initialBitrate:{audio:-1,video:-1},initialRepresentationRatio:{audio:-1,video:-1},autoSwitchBitrate:{audio:!0,video:!0},fetchThroughputCalculationMode:o.Z.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING},cmcd:{enabled:!1,sid:null,cid:null,rtp:null,rtpSafetyFactor:5,mode:o.Z.CMCD_MODE_QUERY,enabledKeys:["br","d","ot","tb","bl","dl","mtp","nor","nrr","su","bs","rtp","cid","pr","sf","sid","st","v"]},cmsd:{enabled:!1,abr:{applyMb:!1,etpWeightRatio:0}}},errors:{recoverAttempts:{mediaErrorDecode:5}}},g=i.Z.clone(h);function m(e,t,r){for(var a in e)e.hasOwnProperty(a)&&t.hasOwnProperty(a)&&("object"!==c(e[a])||e[a]instanceof Array||null===e[a]?(t[a]=i.Z.clone(e[a]),d[r+a]&&n.trigger(d[r+a])):m(e[a],t[a],r.slice()+a+"."))}return{get:function(){return g},update:function(e){"object"===c(e)&&m(e,g,"")},reset:function(){g=i.Z.clone(h)}}}d.__dashjs_factory_name="Settings";var h=n.Z.getSingletonFactory(d);t.Z=h},703:function(e,t,r){var n=r(3875),i=r.n(n),a=r(1067);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t;return t=[{key:"mixin",value:function(t,r,n){var i,a={};if(t)for(var s in r)r.hasOwnProperty(s)&&(i=r[s],s in t&&(t[s]===i||s in a&&a[s]===i)||("object"===o(t[s])&&null!==t[s]?t[s]=e.mixin(t[s],i,n):t[s]=n(i)));return t}},{key:"clone",value:function(t){if(!t||"object"!==o(t))return t;var r;if(t instanceof Array){r=[];for(var n=0,i=t.length;n<i;++n)n in t&&r.push(e.clone(t[n]))}else r={};return e.mixin(r,t,e.clone)}},{key:"addAditionalQueryParameterToUrl",value:function(e,t){try{if(!t||0===t.length)return e;var r=new URL(e);return t.forEach((function(e){e.key&&e.value&&r.searchParams.set(e.key,e.value)})),r.href}catch(n){return e}}},{key:"parseHttpHeaders",value:function(e){var t={};if(!e)return t;for(var r=e.trim().split("\r\n"),n=0,i=r.length;n<i;n++){var a=r[n],o=a.indexOf(": ");o>0&&(t[a.substring(0,o)]=a.substring(o+2))}return t}},{key:"generateUuid",value:function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?r:3&r|8).toString(16)}))}},{key:"generateHashCode",value:function(e){var t=0;if(0===e.length)return t;for(var r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return t}},{key:"getRelativeUrl",value:function(e,t){try{var r=new URL(e),n=new URL(t);if(r.protocol=n.protocol,r.origin!==n.origin)return t;var a=i().relative(r.pathname.substr(0,r.pathname.lastIndexOf("/")),n.pathname.substr(0,n.pathname.lastIndexOf("/"))),o=0===a.length?1:0;return a+=n.pathname.substr(n.pathname.lastIndexOf("/")+o,n.pathname.length-1),n.pathname.length<a.length?n.pathname:a}catch(s){return t}}},{key:"parseUserAgent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{var t=null===e&&"undefined"!=typeof navigator?navigator.userAgent.toLowerCase():"";return(0,a.UAParser)(t)}catch(r){return{}}}},{key:"stringHasProtocol",value:function(e){return/(http(s?)):\/\//i.test(e)}}],t&&s(e,t),e}();t.Z=l},2032:function(e,t,r){function n(){return"4.7.4"}r.d(t,{e:function(){return n}})},2230:function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t;return(t=[{key:"extend",value:function(e,t){if(e){var r=!!t&&t.override,n=!!t&&t.publicOnly;for(var i in e)!e.hasOwnProperty(i)||this[i]&&!r||n&&-1===e[i].indexOf("public_")||(this[i]=e[i])}}}])&&r(e.prototype,t),e}();t.Z=n},4351:function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var s=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(s,e);var t,r,n=(t=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=o(t);if(r){var i=o(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return a(this,e)});function s(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(e=n.call(this)).ATTEMPT_BACKGROUND_SYNC="attemptBackgroundSync",e.BUFFERING_COMPLETED="bufferingCompleted",e.BUFFER_CLEARED="bufferCleared",e.BYTES_APPENDED_END_FRAGMENT="bytesAppendedEndFragment",e.BUFFER_REPLACEMENT_STARTED="bufferReplacementStarted",e.CHECK_FOR_EXISTENCE_COMPLETED="checkForExistenceCompleted",e.CMSD_STATIC_HEADER="cmsdStaticHeader",e.CURRENT_TRACK_CHANGED="currentTrackChanged",e.DATA_UPDATE_COMPLETED="dataUpdateCompleted",e.INBAND_EVENTS="inbandEvents",e.INITIAL_STREAM_SWITCH="initialStreamSwitch",e.INIT_FRAGMENT_LOADED="initFragmentLoaded",e.INIT_FRAGMENT_NEEDED="initFragmentNeeded",e.INTERNAL_MANIFEST_LOADED="internalManifestLoaded",e.ORIGINAL_MANIFEST_LOADED="originalManifestLoaded",e.LOADING_COMPLETED="loadingCompleted",e.LOADING_PROGRESS="loadingProgress",e.LOADING_DATA_PROGRESS="loadingDataProgress",e.LOADING_ABANDONED="loadingAborted",e.MANIFEST_UPDATED="manifestUpdated",e.MEDIA_FRAGMENT_LOADED="mediaFragmentLoaded",e.MEDIA_FRAGMENT_NEEDED="mediaFragmentNeeded",e.QUOTA_EXCEEDED="quotaExceeded",e.SEGMENT_LOCATION_BLACKLIST_ADD="segmentLocationBlacklistAdd",e.SEGMENT_LOCATION_BLACKLIST_CHANGED="segmentLocationBlacklistChanged",e.SERVICE_LOCATION_BASE_URL_BLACKLIST_ADD="serviceLocationBlacklistAdd",e.SERVICE_LOCATION_BASE_URL_BLACKLIST_CHANGED="serviceLocationBlacklistChanged",e.SERVICE_LOCATION_LOCATION_BLACKLIST_ADD="serviceLocationLocationBlacklistAdd",e.SERVICE_LOCATION_LOCATION_BLACKLIST_CHANGED="serviceLocationLocationBlacklistChanged",e.SET_FRAGMENTED_TEXT_AFTER_DISABLED="setFragmentedTextAfterDisabled",e.SET_NON_FRAGMENTED_TEXT="setNonFragmentedText",e.SOURCE_BUFFER_ERROR="sourceBufferError",e.STREAMS_COMPOSED="streamsComposed",e.STREAM_BUFFERING_COMPLETED="streamBufferingCompleted",e.STREAM_REQUESTING_COMPLETED="streamRequestingCompleted",e.TEXT_TRACKS_QUEUE_INITIALIZED="textTracksQueueInitialized",e.TIME_SYNCHRONIZATION_COMPLETED="timeSynchronizationComplete",e.UPDATE_TIME_SYNC_OFFSET="updateTimeSyncOffset",e.URL_RESOLUTION_FAILED="urlResolutionFailed",e.VIDEO_CHUNK_RECEIVED="videoChunkReceived",e.WALLCLOCK_TIME_UPDATED="wallclockTimeUpdated",e.XLINK_ELEMENT_LOADED="xlinkElementLoaded",e.XLINK_READY="xlinkReady",e.SEEK_TARGET="seekTarget",e.SETTING_UPDATED_LIVE_DELAY="settingUpdatedLiveDelay",e.SETTING_UPDATED_LIVE_DELAY_FRAGMENT_COUNT="settingUpdatedLiveDelayFragmentCount",e.SETTING_UPDATED_CATCHUP_ENABLED="settingUpdatedCatchupEnabled",e.SETTING_UPDATED_PLAYBACK_RATE_MIN="settingUpdatedPlaybackRateMin",e.SETTING_UPDATED_PLAYBACK_RATE_MAX="settingUpdatedPlaybackRateMax",e}return s}(r(8342).Z);t.Z=s},8512:function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(l,e);var t,r,n=(t=l,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=s(t);if(r){var i=s(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return o(this,e)});function l(){return i(this,l),n.apply(this,arguments)}return l}(r(4351).Z),u=new l;t.Z=u},8342:function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t;return(t=[{key:"extend",value:function(e,t){if(e){var r=!!t&&t.override,n=!!t&&t.publicOnly;for(var i in e)!e.hasOwnProperty(i)||this[i]&&!r||n&&-1===e[i].indexOf("public_")||(this[i]=e[i])}}}])&&r(e.prototype,t),e}();t.Z=n},9326:function(e,t,r){var n=r(3186),i=r(7855),a=r(5448),o=r(8825),s=r(7387),l=r(1553);function u(e){var t,r,a,u,c,f=(e=e||{}).eventBus,d=e.debug,h=e.urlUtils,g=e.type,m=e.streamInfo,p=e.segmentsController,y=e.timelineConverter,E=e.baseURLController;function v(){return g}function T(){a=null}function _(e,t,r){var n,i,a=E.resolve(r.path),o={};return a&&t!==a.url&&h.isRelative(t)?(n=a.url,i=a.serviceLocation,o=a.queryParams,t&&(n=h.resolve(t,n))):n=t,!h.isRelative(n)&&(e.url=n,e.serviceLocation=i,e.queryParams=o,!0)}function S(e,t){if(null==t)return null;var r=new n.Z,a=t.representation,o=a.adaptation.period.mpd.manifest.Period_asArray[a.adaptation.period.index].AdaptationSet_asArray[a.adaptation.index].Representation_asArray[a.index].bandwidth,l=t.media;return l=(0,s.vi)(l,"Number",t.replacementNumber),l=(0,s.vi)(l,"Time",t.replacementTime),l=(0,s.vi)(l,"Bandwidth",o),l=(0,s.Aj)(l,a.id),l=(0,s.eR)(l),r.mediaType=v(),r.type=i.w.MEDIA_SEGMENT_TYPE,r.range=t.mediaRange,r.startTime=t.presentationStartTime,r.mediaStartTime=t.mediaStartTime,r.duration=t.duration,r.timescale=a.timescale,r.availabilityStartTime=t.availabilityStartTime,r.availabilityEndTime=t.availabilityEndTime,r.availabilityTimeComplete=a.availabilityTimeComplete,r.wallStartTime=t.wallStartTime,r.quality=a.index,r.index=t.index,r.mediaInfo=e,r.adaptationIndex=a.adaptation.index,r.representationId=a.id,_(r,l,a)?r:void 0}function A(e,t,n){var i=null;if(!t||!t.segmentInfoType)return i;var o=p.getSegmentByTime(t,n);return o&&(a=o,r.debug("Index for time "+n+" is "+o.index),i=S(e,o)),i}function b(e,t,n){var i=null,o=p.getSegmentByIndex(t,n,a?a.mediaStartTime:-1);if(o)i=S(e,o),a=o;else{if(u&&!c)return r.debug(v()+" No segment found at index: "+n+". Wait for next loop"),null;c=!0}return i}function R(){r.debug("Dynamic stream complete"),c=!0}return t={getCurrentIndex:function(){return a?a.index:-1},getInitRequest:function(e,t){return t?function(e,t,r){var a=new n.Z,o=t.adaptation.period,l=o.start;if(a.mediaType=r,a.type=i.w.INIT_SEGMENT_TYPE,a.range=t.range,a.availabilityStartTime=y.calcAvailabilityStartTimeFromPresentationTime(l,t,u),a.availabilityEndTime=y.calcAvailabilityEndTimeFromPresentationTime(l+o.duration,t,u),a.quality=t.index,a.mediaInfo=e,a.representationId=t.id,_(a,t.initialization,t))return a.url=(0,s.vi)(a.url,"Bandwidth",t.bandwidth),a}(e,t,v()):null},getNextSegmentRequest:function(e,t){return t&&t.segmentInfoType?b(e,t,a?a.index+1:0):null},getNextSegmentRequestIdempotent:function(e,t){var r=a?a.index+1:0,n=p.getSegmentByIndex(t,r,a?a.mediaStartTime:-1);return n?S(e,n):null},getSegmentRequestForTime:A,getStreamId:function(){return m.id},getStreamInfo:function(){return m},getType:v,getValidTimeAheadOfTargetTime:function(e,t,r,n){try{if(isNaN(e)||!t||!r)return NaN;if(e<0&&(e=0),isNaN(n)&&(n=.5),A(t,r,e))return e;if(r.adaptation.period.start+r.adaptation.period.duration<e)return NaN;for(var i=isFinite(r.adaptation.period.duration)?r.adaptation.period.start+r.adaptation.period.duration:e+30,a=Math.min(e+n,i),o=NaN,s=null;a<=i;){var l=null;if(a<=i&&(l=A(t,r,a)),l){o=a,s=l;break}a+=n}if(s){var u=s.startTime+s.duration;return e>s.startTime&&u-e>n?e:!isNaN(s.startTime)&&e<s.startTime&&o>s.startTime?s.startTime+.001:Math.min(u-n,o)}return o}catch(c){return NaN}},initialize:function(e){u=e,c=!1,p.initialize(e)},isLastSegmentRequested:function(e,t){if(!e||!a)return!1;if(c)return!0;if(!isFinite(e.adaptation.period.duration))return!1;if(a.presentationStartTime+a.duration>t)return!1;if(e.mediaFinishedInformation&&!isNaN(e.mediaFinishedInformation.numberOfSegments)&&!isNaN(a.index)&&a.index>=e.mediaFinishedInformation.numberOfSegments-1){if(!u||e.segmentInfoType===l.Z.SEGMENT_TEMPLATE)return!0;if(u&&e.segmentInfoType===l.Z.SEGMENT_LIST&&e.adaptation.period.nextPeriodId)return!0}return!!(u&&e.adaptation.period.nextPeriodId&&e.segmentInfoType===l.Z.SEGMENT_TIMELINE&&e.mediaFinishedInformation&&!isNaN(e.mediaFinishedInformation.mediaTimeOfLastSignaledSegment)&&a&&!isNaN(a.mediaStartTime)&&!isNaN(a.duration)&&a.mediaStartTime+a.duration>=e.mediaFinishedInformation.mediaTimeOfLastSignaledSegment-.05)},repeatSegmentRequest:function(e,t){return t&&t.segmentInfoType?b(e,t,a?a.index:0):null},reset:function(){T(),f.off(o.Z.DYNAMIC_TO_STATIC,R,t)}},r=d.getLogger(t),T(),f.on(o.Z.DYNAMIC_TO_STATIC,R,t),t}u.__dashjs_factory_name="DashHandler",t.Z=a.Z.getClassFactory(u)},1553:function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}var t;return(t=[{key:"init",value:function(){this.BASE_URL="BaseURL",this.SEGMENT_BASE="SegmentBase",this.SEGMENT_TEMPLATE="SegmentTemplate",this.SEGMENT_LIST="SegmentList",this.SEGMENT_URL="SegmentURL",this.SEGMENT_TIMELINE="SegmentTimeline",this.SEGMENT_PROFILES="segmentProfiles",this.ADAPTATION_SET="AdaptationSet",this.REPRESENTATION="Representation",this.REPRESENTATION_INDEX="RepresentationIndex",this.SUB_REPRESENTATION="SubRepresentation",this.INITIALIZATION="Initialization",this.INITIALIZATION_MINUS="initialization",this.MPD="MPD",this.PERIOD="Period",this.ASSET_IDENTIFIER="AssetIdentifier",this.EVENT_STREAM="EventStream",this.ID="id",this.PROFILES="profiles",this.SERVICE_LOCATION="serviceLocation",this.RANGE="range",this.INDEX="index",this.MEDIA="media",this.BYTE_RANGE="byteRange",this.INDEX_RANGE="indexRange",this.MEDIA_RANGE="mediaRange",this.VALUE="value",this.CONTENT_TYPE="contentType",this.MIME_TYPE="mimeType",this.BITSTREAM_SWITCHING="BitstreamSwitching",this.BITSTREAM_SWITCHING_MINUS="bitstreamSwitching",this.CODECS="codecs",this.DEPENDENCY_ID="dependencyId",this.MEDIA_STREAM_STRUCTURE_ID="mediaStreamStructureId",this.METRICS="Metrics",this.METRICS_MINUS="metrics",this.REPORTING="Reporting",this.WIDTH="width",this.HEIGHT="height",this.SAR="sar",this.FRAMERATE="frameRate",this.AUDIO_SAMPLING_RATE="audioSamplingRate",this.MAXIMUM_SAP_PERIOD="maximumSAPPeriod",this.START_WITH_SAP="startWithSAP",this.MAX_PLAYOUT_RATE="maxPlayoutRate",this.CODING_DEPENDENCY="codingDependency",this.SCAN_TYPE="scanType",this.FRAME_PACKING="FramePacking",this.AUDIO_CHANNEL_CONFIGURATION="AudioChannelConfiguration",this.CONTENT_PROTECTION="ContentProtection",this.ESSENTIAL_PROPERTY="EssentialProperty",this.ESSENTIAL_PROPERTY_ASARRAY="EssentialProperty_asArray",this.SUPPLEMENTAL_PROPERTY="SupplementalProperty",this.SUPPLEMENTAL_PROPERTY_ASARRAY="SupplementalProperty_asArray",this.INBAND_EVENT_STREAM="InbandEventStream",this.PRODUCER_REFERENCE_TIME="ProducerReferenceTime",this.INBAND="inband",this.TYPE="type",this.ACCESSIBILITY="Accessibility",this.ROLE="Role",this.RATING="Rating",this.CONTENT_COMPONENT="ContentComponent",this.SUBSET="Subset",this.LANG="lang",this.VIEWPOINT="Viewpoint",this.VIEWPOINT_ASARRAY="Viewpoint_asArray",this.ROLE_ASARRAY="Role_asArray",this.REPRESENTATION_ASARRAY="Representation_asArray",this.PRODUCERREFERENCETIME_ASARRAY="ProducerReferenceTime_asArray",this.ACCESSIBILITY_ASARRAY="Accessibility_asArray",this.AUDIOCHANNELCONFIGURATION_ASARRAY="AudioChannelConfiguration_asArray",this.CONTENTPROTECTION_ASARRAY="ContentProtection_asArray",this.MAIN="main",this.DYNAMIC="dynamic",this.STATIC="static",this.MEDIA_PRESENTATION_DURATION="mediaPresentationDuration",this.MINIMUM_UPDATE_PERIOD="minimumUpdatePeriod",this.CODEC_PRIVATE_DATA="codecPrivateData",this.BANDWITH="bandwidth",this.SOURCE_URL="sourceURL",this.TIMESCALE="timescale",this.DURATION="duration",this.START_NUMBER="startNumber",this.PRESENTATION_TIME_OFFSET="presentationTimeOffset",this.AVAILABILITY_START_TIME="availabilityStartTime",this.AVAILABILITY_END_TIME="availabilityEndTime",this.TIMESHIFT_BUFFER_DEPTH="timeShiftBufferDepth",this.MAX_SEGMENT_DURATION="maxSegmentDuration",this.PRESENTATION_TIME="presentationTime",this.MIN_BUFFER_TIME="minBufferTime",this.MAX_SUBSEGMENT_DURATION="maxSubsegmentDuration",this.START="start",this.AVAILABILITY_TIME_OFFSET="availabilityTimeOffset",this.AVAILABILITY_TIME_COMPLETE="availabilityTimeComplete",this.CENC_DEFAULT_KID="cenc:default_KID",this.DVB_PRIORITY="dvb:priority",this.DVB_WEIGHT="dvb:weight",this.DVB_URL="dvb:url",this.DVB_MIMETYPE="dvb:mimeType",this.DVB_FONTFAMILY="dvb:fontFamily",this.SUGGESTED_PRESENTATION_DELAY="suggestedPresentationDelay",this.SERVICE_DESCRIPTION="ServiceDescription",this.SERVICE_DESCRIPTION_SCOPE="Scope",this.SERVICE_DESCRIPTION_LATENCY="Latency",this.SERVICE_DESCRIPTION_PLAYBACK_RATE="PlaybackRate",this.SERVICE_DESCRIPTION_OPERATING_QUALITY="OperatingQuality",this.SERVICE_DESCRIPTION_OPERATING_BANDWIDTH="OperatingBandwidth",this.PATCH_LOCATION="PatchLocation",this.PATCH_LOCATION_AS_ARRAY="PatchLocation_asArray",this.LOCATION="Location",this.LOCATION_AS_ARRAY="Location_asArray",this.PUBLISH_TIME="publishTime",this.ORIGINAL_PUBLISH_TIME="originalPublishTime",this.ORIGINAL_MPD_ID="mpdId",this.WALL_CLOCK_TIME="wallClockTime",this.PRESENTATION_TIME="presentationTime",this.LABEL="Label",this.GROUP_LABEL="GroupLabel",this.CONTENT_STEERING="ContentSteering",this.CONTENT_STEERING_AS_ARRAY="ContentSteering_asArray",this.DEFAULT_SERVICE_LOCATION="defaultServiceLocation",this.QUERY_BEFORE_START="queryBeforeStart",this.CLIENT_REQUIREMENT="clientRequirement",this.TTL="ttl",this.CONTENT_STEERING_RESPONSE={VERSION:"VERSION",TTL:"TTL",RELOAD_URI:"RELOAD-URI",PATHWAY_PRIORITY:"PATHWAY-PRIORITY",PATHWAY_CLONES:"PATHWAY-CLONES",BASE_ID:"BASE-ID",ID:"ID",URI_REPLACEMENT:"URI-REPLACEMENT",HOST:"HOST",PARAMS:"PARAMS"},this.PRODUCER_REFERENCE_TIME_TYPE={ENCODER:"encoder",CAPTURED:"captured",APPLICATION:"application"},this.SEGMENT_ALIGNMENT="segmentAlignment",this.SUB_SEGMENT_ALIGNMENT="subsegmentAlignment"}}])&&r(e.prototype,t),e}());t.Z=n},7802:function(e,t,r){var n=r(5448),i=r(1724),a=r(3636),o=r(1736),s=r(5246);function l(e){e=e||{};var t,r,n=this.context,l=e.dashConstants,u=e.type,c=e.segmentBaseController;function f(e){return e?e.segments?r[l.SEGMENT_BASE]:r[e.segmentInfoType]:null}return t={initialize:function(t){r[l.SEGMENT_TIMELINE]=(0,i.Z)(n).create(e,t),r[l.SEGMENT_TEMPLATE]=(0,a.Z)(n).create(e,t),r[l.SEGMENT_LIST]=(0,o.Z)(n).create(e,t),r[l.SEGMENT_BASE]=(0,s.Z)(n).create(e,t)},updateInitData:function(e,t){return t?Promise.resolve():c.getSegmentBaseInitSegment({representation:e,mediaType:u})},updateSegmentData:function(e,t){return t?Promise.resolve():c.getSegmentList({mimeType:e.mimeType,representation:e,mediaType:u})},getSegmentByIndex:function(e,t,r){var n=f(e);return n?n.getSegmentByIndex(e,t,r):null},getSegmentByTime:function(e,t){var r=f(e);return r?r.getSegmentByTime(e,t):null},getMediaFinishedInformation:function(e){var t=f(e);return t?t.getMediaFinishedInformation(e):{numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN}}},r={},t}l.__dashjs_factory_name="SegmentsController";var u=n.Z.getClassFactory(l);t.Z=u},1736:function(e,t,r){var n=r(5448),i=r(3393),a=r(7387);function o(e,t){var r=(e=e||{}).timelineConverter;function n(){if(!r||!r.hasOwnProperty("calcPeriodRelativeTimeFromMpdRelativeTime"))throw new Error(i.Z.MISSING_CONFIG_ERROR)}function o(e,i){if(n(),!e)return null;var o=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentList,s=o.SegmentURL_asArray.length,l=e&&!isNaN(e.startNumber)?e.startNumber:1,u=Math.max(l-1,0),c=Math.max(i-u,0),f=null;if(c<s){var d=o.SegmentURL_asArray[c];(f=(0,a.NF)(r,t,e,i))&&(f.replacementTime=(l+i-1)*e.segmentDuration,f.media=d.media?d.media:"",f.mediaRange=d.mediaRange,f.indexRange=d.indexRange)}return f}return{getSegmentByIndex:o,getSegmentByTime:function(e,t){if(n(),!e)return null;var i=e.segmentDuration;if(isNaN(i))return null;var a=r.calcPeriodRelativeTimeFromMpdRelativeTime(e,t);return o(e,Math.floor(a/i))},getMediaFinishedInformation:function(e){var t={numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN};if(!e)return t;var r=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentList,n=e&&!isNaN(e.startNumber)?e.startNumber:1,i=Math.max(n-1,0);return t.numberOfSegments=i+r.SegmentURL_asArray.length,t}}}o.__dashjs_factory_name="ListSegmentsGetter";var s=n.Z.getClassFactory(o);t.Z=s},5246:function(e,t,r){var n=r(5448),i=r(3393);function a(e){var t=(e=e||{}).timelineConverter;function r(){if(!t||!t.hasOwnProperty("calcPeriodRelativeTimeFromMpdRelativeTime"))throw new Error(i.Z.MISSING_CONFIG_ERROR)}function n(e,t){if(r(),!e)return null;var n,i=e.segments?e.segments.length:-1;if(t<i&&(n=e.segments[t])&&n.index===t)return n;for(var a=0;a<i;a++)if((n=e.segments[a])&&n.index===t)return n;return null}return{getSegmentByIndex:n,getSegmentByTime:function(e,t){return r(),n(e,function(e,t){if(!e)return-1;var r,n,i,a,o,s=e.segments,l=s?s.length:null,u=-1;if(s&&l>0)for(o=0;o<l;o++)if(i=(n=s[o]).presentationStartTime,t+(r=(a=n.duration)/2)>=i&&t-r<i+a){u=n.index;break}return u}(e,t))},getMediaFinishedInformation:function(e){var t={numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN};return e&&e.segments?(t.numberOfSegments=e.segments.length,t):t}}}a.__dashjs_factory_name="SegmentBaseGetter";var o=n.Z.getClassFactory(a);t.Z=o},7387:function(e,t,r){r.d(t,{Aj:function(){return o},NF:function(){return c},TJ:function(){return f},eR:function(){return a},vi:function(){return s}});var n=r(2011);function i(e,t){for(;e.length<t;)e="0"+e;return e}function a(e){return e?e.split("$$").join("$"):e}function o(e,t){if(!t||!e||-1===e.indexOf("$RepresentationID$"))return e;var r=t.toString();return e.split("$RepresentationID$").join(r)}function s(e,t,r){var n,a,o,s,l,u,c=t.length,f=2;if(!e)return e;for(;;){if((n=e.indexOf("$"+t))<0)return e;if((a=e.indexOf("$",n+c))<0)return e;if((o=e.indexOf("%0",n+c))>n&&o<a)switch(s=e.charAt(a-1),l=parseInt(e.substring(o+f,a-1),10),s){case"d":case"i":case"u":u=i(r.toString(),l);break;case"x":u=i(r.toString(16),l);break;case"X":u=i(r.toString(16),l).toUpperCase();break;case"o":u=i(r.toString(8),l);break;default:return e}else u=r;e=e.substring(0,n)+u+e.substring(a+1)}}function l(e,t,r,i,a,o,s,l){var u,c=new n.Z;return c.representation=e,c.duration=t,c.presentationStartTime=r,c.mediaStartTime=i,c.availabilityStartTime=a.calcAvailabilityStartTimeFromPresentationTime(o,e,s),c.availabilityEndTime=a.calcAvailabilityEndTimeFromPresentationTime(o+t,e,s),c.wallStartTime=a.calcWallTimeForSegment(c,s),c.replacementNumber=(u=l,c.representation.startNumber+u),c.index=l,c}function u(e,t,r,n){var i=t.adaptation.period;if(isFinite(i.duration)&&i.start+i.duration<=r.presentationStartTime)return!1;if(n){if("INF"===t.availabilityTimeOffset)return!0;var a=e.getClientReferenceTime();return r.availabilityStartTime.getTime()<=a&&(!isFinite(r.availabilityEndTime)||r.availabilityEndTime.getTime()>=a)}return!0}function c(e,t,r,n){var i,a,o;i=r.segmentDuration,isNaN(i)&&(i=r.adaptation.period.duration),a=parseFloat((r.adaptation.period.start+n*i).toFixed(5)),o=parseFloat((a+i).toFixed(5));var s=l(r,i,a,e.calcMediaTimeFromPresentationTime(a,r),e,o,t,n);return u(e,r,s,t)?s:null}function f(e,t,r,n,i,a,o,c,f,d){var h,g,m=n/a,p=i/a;return h=e.calcPresentationTimeFromMediaTime(m,r),u(e,r,g=l(r,p,h,m,e,h+p,t,f),t)?(g.replacementTime=d||n,o=s(o,"Number",g.replacementNumber),o=s(o,"Time",g.replacementTime),g.media=o,g.mediaRange=c,g):null}},3636:function(e,t,r){var n=r(5448),i=r(3393),a=r(7387);function o(e,t){var r=(e=e||{}).timelineConverter;function n(){if(!r||!r.hasOwnProperty("calcPeriodRelativeTimeFromMpdRelativeTime"))throw new Error(i.Z.MISSING_CONFIG_ERROR)}function o(e,i){if(n(),!e)return null;var o=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentTemplate;i=Math.max(i,0);var s=(0,a.NF)(r,t,e,i);if(s){s.replacementTime=Math.round((i-1)*e.segmentDuration*e.timescale,10);var l=o.media;l=(0,a.vi)(l,"Number",s.replacementNumber),l=(0,a.vi)(l,"Time",s.replacementTime),s.media=l}return s}return{getSegmentByIndex:o,getSegmentByTime:function(e,t){if(n(),!e)return null;var i=e.segmentDuration;if(isNaN(i))return null;var a=r.calcPeriodRelativeTimeFromMpdRelativeTime(e,t);return o(e,Math.floor(a/i))},getMediaFinishedInformation:function(e){var t={numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN};if(!e)return t;var r=e.segmentDuration;return isNaN(r)?t.numberOfSegments=1:t.numberOfSegments=Math.ceil(e.adaptation.period.duration/r),t}}}o.__dashjs_factory_name="TemplateSegmentsGetter";var s=n.Z.getClassFactory(o);t.Z=s},1724:function(e,t,r){var n=r(5448),i=r(3393),a=r(7387);function o(e,t){var r=(e=e||{}).timelineConverter,n=e.dashMetrics;function o(){if(!r)throw new Error(i.Z.MISSING_CONFIG_ERROR)}function s(e,t){var r,n,i,a,o,s,u,c=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentTemplate||e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentList,f=c.SegmentTimeline,d=c.SegmentURL_asArray,h=0,g=-1;u=e.timescale;var m=!1;for(i=0,a=(r=f.S_asArray).length;i<a&&!m;i++)for(s=0,(n=r[i]).hasOwnProperty("r")&&(s=n.r),n.hasOwnProperty("t")&&(h=n.t),s<0&&(s=l(e,r[i+1],n,u,h/u)),o=0;o<=s&&!m;o++)(m=t(h,c,d,n,u,++g,i))&&(e.segmentDuration=n.d/u),h+=n.d}function l(e,t,i,a,o){var s;if(t&&t.hasOwnProperty("t"))s=t.t/a;else try{var l=0;if(isNaN(e.adaptation.period.start)||isNaN(e.adaptation.period.duration)||!isFinite(e.adaptation.period.duration)){var u=n.getCurrentDVRInfo();l=isNaN(u.end)?0:u.end}else l=e.adaptation.period.start+e.adaptation.period.duration;s=r.calcMediaTimeFromPresentationTime(l,e),e.segmentDuration=i.d/a}catch(c){s=0}return Math.max(Math.ceil((s-o)/(i.d/a))-1,0)}return{getSegmentByIndex:function(e,n,i){if(o(),!e)return null;var l=null,u=!1;return s(e,(function(n,o,s,c,f,d,h){if(u||i<0){var g=o.media,m=c.mediaRange;return s&&(g=s[h].media||"",m=s[h].mediaRange),l=(0,a.TJ)(r,t,e,n,c.d,f,g,m,d,c.tManifest),!0}return n>=i*f-.5*c.d&&(u=!0),!1})),l},getSegmentByTime:function(e,n){if(o(),!e)return null;void 0===n&&(n=null);var i=null,l=r.calcMediaTimeFromPresentationTime(n,e);return s(e,(function(n,o,s,u,c,f,d){var h=parseFloat((l*c).toPrecision(15));if(h<n+u.d&&h>=n){var g=o.media,m=u.mediaRange;return s&&(g=s[d].media||"",m=s[d].mediaRange),i=(0,a.TJ)(r,t,e,n,u.d,c,g,m,f,u.tManifest),!0}return!1})),i},getMediaFinishedInformation:function(e){if(!e)return 0;var t,r,n,i,a,o,s,u=(e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentTemplate||e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentList).SegmentTimeline,c=0,f=0,d=0;for(s=e.timescale,i=(t=u.S_asArray).length,n=0;n<i;n++)for(o=0,(r=t[n]).hasOwnProperty("r")&&(o=r.r),r.hasOwnProperty("t")&&(f=(c=r.t)/s),o<0&&(o=l(e,t[n+1],r,s,f)),a=0;a<=o;a++)d++,f=(c+=r.d)/s;return{numberOfSegments:d,mediaTimeOfLastSignaledSegment:f}}}}o.__dashjs_factory_name="TimelineSegmentsGetter";var s=n.Z.getClassFactory(o);t.Z=s},2011:function(e,t){t.Z=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.indexRange=null,this.index=null,this.mediaRange=null,this.media=null,this.duration=NaN,this.replacementTime=null,this.replacementNumber=NaN,this.mediaStartTime=NaN,this.presentationStartTime=NaN,this.availabilityStartTime=NaN,this.availabilityEndTime=NaN,this.wallStartTime=NaN,this.representation=null}},2610:function(e,t){t.Z=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.schemeIdUri="",this.value=""}},1139:function(e,t,r){r.d(t,{Z:function(){return Ja}});var n=r(452),i=r.n(n),a=r(3393),o=r(1553),s=r(3860),l=r(5595),u=r(8512),c=r(5448),f=r(6398),d=r(8825);function h(){var e,t,r,n,i,o,c,h,g,m,p,y,E,v,T,_,S,A,b,R,I,w,C,D,L,N=this.context,O=(0,l.Z)(N).getInstance();function M(){F(),v=!1,m=0,p=0,S=0,C=!1,A=!0,b=!1,D=!1,R=NaN,_=NaN,c&&(O.off(u.Z.DATA_UPDATE_COMPLETED,Q,e),O.off(u.Z.LOADING_PROGRESS,Ee,e),O.off(u.Z.MANIFEST_UPDATED,Se,e),O.off(u.Z.STREAMS_COMPOSED,Ae,e),O.off(d.Z.PLAYBACK_ENDED,me,e),O.off(d.Z.STREAM_INITIALIZING,Te,e),O.off(d.Z.REPRESENTATION_SWITCH,_e,e),O.off(d.Z.BUFFER_LEVEL_STATE_CHANGED,te,e),X(),c.removeEventListener("canplay",J),c.removeEventListener("canplaythrough",ee),c.removeEventListener("play",re),c.removeEventListener("waiting",ne),c.removeEventListener("playing",ie),c.removeEventListener("pause",ae),c.removeEventListener("error",pe),c.removeEventListener("seeking",oe),c.removeEventListener("seeked",se),c.removeEventListener("timeupdate",le),c.removeEventListener("progress",ue),c.removeEventListener("ratechange",ce),c.removeEventListener("loadedmetadata",fe),c.removeEventListener("loadeddata",de),c.removeEventListener("stalled",ve),c.removeEventListener("ended",he),c.removeEventListener("volumechange",ge)),g=null,c=null,y=null,E=null}function P(){return parseFloat((k(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)-G()).toFixed(5))}function k(e){var t=e||y;return t.start+t.duration}function x(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];y&&c&&c.getElement()?(e&&E&&Z(G()),c.play()):v=!0}function F(){y&&c&&c.pause()}function U(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];y&&c&&c.getElement()&&e!==(isNaN(R)?c.getTime():R)&&((I=!0===n)||(R=e),t.info("Requesting seek to time: "+e+(I?" (internal)":"")),E&&i&&Z(e),c.setCurrentTime(e,r))}function B(){if(y&&c&&E){var e=r&&r.hasVideoTrack()?a.Z.VIDEO:a.Z.AUDIO,t=i.getCurrentDVRInfo(e);return t&&t.range?t.range.end:0}}function Z(e){var t=new Date(h.getClientReferenceTime()),r=o.getRegularPeriods()[0],n=h.calcPresentationTimeFromWallTime(t,r);m=n-e}function G(){return y&&c?c.getTime():null}function H(){return y&&c?c.isPaused():null}function K(){return y&&c?c.isSeeking():null}function Y(){return y&&c?c.isStalled():null}function q(){return y&&c?c.getPlaybackRate():null}function V(){return y&&c?c.getEnded():null}function j(){return E}function $(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!H()&&E&&0!==c.getReadyState()&&!K()&&!C){e||(e=r.hasVideoTrack()?a.Z.VIDEO:a.Z.AUDIO);var n=G(),i=z(n,e);!isNaN(i)&&i!==n&&!K()&&(Y()||w||1===c.getReadyState())&&(t.debug("UpdateCurrentTime: Seek to actual time: ".concat(i," from currentTime: ").concat(n)),U(i,!1,!1))}}function z(e,t){var r=i.getCurrentDVRInfo(t),n=r?r.range:null;return n?e>n.end?Math.max(n.end-m,n.start):e>0&&e+.25<n.start&&Math.abs(e-n.start)<31536e4?b?Math.max(n.end-m,n.start):n.start:e:NaN}function W(){null===g&&(g=setInterval((function(){!function(){if(O.trigger(u.Z.WALLCLOCK_TIME_UPDATED,{isDynamic:E,time:new Date}),j()){var e=Date.now();(isNaN(_)||e>_+L.get().streaming.liveUpdateTimeThresholdInMilliseconds)&&(r.addDVRMetric(),H()?(t=Date.now(),(!T||t>T+500)&&(T=t,le())):$(),_=e)}var t}()}),L.get().streaming.wallclockTimeUpdateInterval))}function X(){clearInterval(g),g=null}function Q(e){var t=o.convertRepresentationToRepresentationInfo(e.currentRepresentation),r=t?t.mediaInfo.streamInfo:null;null!==r&&y.id===r.id&&(y=r)}function J(){O.trigger(u.Z.CAN_PLAY)}function ee(){O.trigger(u.Z.CAN_PLAY_THROUGH)}function te(e){e.streamId===r.getActiveStreamInfo().id&&(w=e.state===s.Z.BUFFER_EMPTY,L.get().streaming.buffer.setStallState&&c.setStallState(e.mediaType,e.state===s.Z.BUFFER_EMPTY))}function re(){t.info("Native video element event: play"),$(),W(),O.trigger(u.Z.PLAYBACK_STARTED,{startTime:G()})}function ne(){t.info("Native video element event: waiting"),O.trigger(u.Z.PLAYBACK_WAITING,{playingTime:G()})}function ie(){t.info("Native video element event: playing"),I=!1,O.trigger(u.Z.PLAYBACK_PLAYING,{playingTime:G()})}function ae(){t.info("Native video element event: pause"),O.trigger(u.Z.PLAYBACK_PAUSED,{ended:V()})}function oe(){if(!I){var e=G();isNaN(R)||R===e||(e=R),R=NaN,t.info("Seeking to: "+e),W(),O.trigger(u.Z.PLAYBACK_SEEKING,{seekTime:e,streamId:y.id})}}function se(){t.info("Native video element event: seeked"),I=!1,O.trigger(u.Z.PLAYBACK_SEEKED)}function le(){y&&O.trigger(u.Z.PLAYBACK_TIME_UPDATED,{timeToEnd:P(),time:G(),streamId:y.id})}function ue(){O.trigger(u.Z.PLAYBACK_PROGRESS,{streamId:y.id})}function ce(){var e=q();t.info("Native video element event: ratechange: ",e),O.trigger(u.Z.PLAYBACK_RATE_CHANGED,{playbackRate:e})}function fe(){t.info("Native video element event: loadedmetadata"),O.trigger(u.Z.PLAYBACK_METADATA_LOADED),W()}function de(){t.info("Native video element event: loadeddata"),O.trigger(u.Z.PLAYBACK_LOADED_DATA)}function he(){t.info("Native video element event: ended"),F(),X();var e=r?r.getActiveStreamInfo():null;e&&O.trigger(u.Z.PLAYBACK_ENDED,{isLast:e.isLast})}function ge(){O.trigger(u.Z.PLAYBACK_VOLUME_CHANGED)}function me(e){if(g&&e.isLast){t.info("onPlaybackEnded -- PLAYBACK_ENDED but native video element didn't fire ended");var r=e.seekTime?e.seekTime:k();c.setCurrentTime(r),F(),X()}}function pe(e){var t=e.target||e.srcElement;O.trigger(u.Z.PLAYBACK_ERROR,{error:t.error})}function ye(){E=!1}function Ee(e){if(!1===e.stream&&b&&!isNaN(e.request.duration)){var r=1.2*e.request.duration;r>m&&(t.warn("Browser does not support fetch API with StreamReader. Increasing live delay to be 20% higher than segment duration:",r.toFixed(2)),m=r,p=r)}}function ve(e){O.trigger(u.Z.PLAYBACK_STALLED,{e:e})}function Te(e){var r;(r=e.mediaInfo)&&r.supplementalProperties&&r.supplementalProperties[a.Z.SUPPLEMENTAL_PROPERTY_DVB_LL_SCHEME]&&"true"===r.supplementalProperties[a.Z.SUPPLEMENTAL_PROPERTY_DVB_LL_SCHEME].value&&(t.debug("Low Latency critical SupplementalProperty set: Enabling low Latency"),b=!0)}function _e(e){var t=r.getActiveStreamInfo();e&&t&&e.currentRepresentation&&e.streamId&&e.streamId===t.id&&e.mediaType&&(e.mediaType===a.Z.VIDEO||e.mediaType===a.Z.AUDIO)&&(A=e.currentRepresentation.availabilityTimeComplete,(b=!A)&&!D&&(D=!0))}function Se(){C=!0}function Ae(){C=!1}return e={initialize:function(t,r){y=t,!0!==r&&(c.addEventListener("canplay",J),c.addEventListener("canplaythrough",ee),c.addEventListener("play",re),c.addEventListener("waiting",ne),c.addEventListener("playing",ie),c.addEventListener("pause",ae),c.addEventListener("error",pe),c.addEventListener("seeking",oe),c.addEventListener("seeked",se),c.addEventListener("timeupdate",le),c.addEventListener("progress",ue),c.addEventListener("ratechange",ce),c.addEventListener("loadedmetadata",fe),c.addEventListener("loadeddata",de),c.addEventListener("stalled",ve),c.addEventListener("ended",he),c.addEventListener("volumechange",ge),E=y.manifestInfo.isDynamic,w=!1,I=!1,O.on(u.Z.DATA_UPDATE_COMPLETED,Q,e),O.on(u.Z.LOADING_PROGRESS,Ee,e),O.on(u.Z.MANIFEST_UPDATED,Se,e),O.on(u.Z.STREAMS_COMPOSED,Ae,e),O.on(d.Z.PLAYBACK_ENDED,me,e,{priority:l.Z.EVENT_PRIORITY_HIGH}),O.on(d.Z.STREAM_INITIALIZING,Te,e),O.on(d.Z.REPRESENTATION_SWITCH,_e,e),O.on(d.Z.BUFFER_LEVEL_STATE_CHANGED,te,e),O.on(d.Z.DYNAMIC_TO_STATIC,ye,e),v&&(v=!1,x()))},setConfig:function(e){e&&(e.streamController&&(r=e.streamController),e.serviceDescriptionController&&(n=e.serviceDescriptionController),e.dashMetrics&&(i=e.dashMetrics),e.adapter&&(o=e.adapter),e.videoModel&&(c=e.videoModel),e.timelineConverter&&(h=e.timelineConverter),e.settings&&(L=e.settings))},getTimeToStreamEnd:P,getBufferLevel:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=null;return r.getActiveStreamProcessors().forEach((function(r){if(!e||0===e.length||-1===e.indexOf(r.getType())){var n=r.getBufferLevel();t=null===t?n:Math.min(t,n)}})),t},getPlaybackStalled:function(){return w},getTime:G,getLowLatencyModeEnabled:function(){return b},getInitialCatchupModeActivated:function(){return D},getIsManifestUpdateInProgress:function(){return C},getPlaybackRate:q,getPlayedRanges:function(){return y&&c?c.getPlayedRanges():null},getEnded:V,getIsDynamic:j,getStreamController:function(){return r},computeAndSetLiveDelay:function(e,t){var r,i,a,s=!isNaN(e)&&isFinite(e)?e:NaN,l=o.getSuggestedPresentationDelay(),u=n.getServiceDescriptionSettings();return r=isNaN(L.get().streaming.delay.liveDelay)?null===L.get().streaming.delay.liveDelayFragmentCount||isNaN(L.get().streaming.delay.liveDelayFragmentCount)||isNaN(s)?u&&!isNaN(u.liveDelay)&&u.liveDelay>0?u.liveDelay:!0===L.get().streaming.delay.useSuggestedPresentationDelay&&null!==l&&!isNaN(l)&&l>0?l:isNaN(s)?t&&!isNaN(t.minBufferTime)?4*t.minBufferTime:4*y.manifestInfo.minBufferTime:4*s:s*L.get().streaming.delay.liveDelayFragmentCount:L.get().streaming.delay.liveDelay,null!==(a=o.getAvailabilityStartTime())&&(S=a),i=t&&t.dvrWindowSize>0?Math.min(r,t.dvrWindowSize):r,m=i,p=i,i},getLiveDelay:function(){return m},getOriginalLiveDelay:function(){return p},getCurrentLiveLatency:function(){if(!E||isNaN(S))return NaN;var e=G();if(isNaN(e)||0===e)return 0;var t=(new Date).getTime()+1e3*h.getClientTimeOffset();return Math.max(((t-S-1e3*e)/1e3).toFixed(3),0)},play:x,isPaused:H,isStalled:Y,pause:F,isSeeking:K,getStreamEndTime:k,seek:U,seekToOriginalLive:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=B();0!==n&&U(n-(m=p),e,t,r)},seekToCurrentLive:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=B();0!==n&&U(n-m,e,t,r)},reset:M,updateCurrentTime:$,getAvailabilityStartTime:function(){return S}},t=(0,f.Z)(N).getInstance().getLogger(e),M(),e}h.__dashjs_factory_name="PlaybackController";var g=c.Z.getSingletonFactory(h),m=r(3186),p="loading",y="executed",E="failed";function v(e){var t,r,n,i,a=(e=e||{}).eventBus,o=e.events,s=e.dashMetrics,l=e.fragmentLoader,u=e.debug,c=e.streamInfo,f=e.type;function d(e){var t;return!!e&&(t=!1,n.some((function(r){if(a=e,o=r,!isNaN(a.index)&&a.startTime===o.startTime&&a.adaptationIndex===o.adaptationIndex&&a.type===o.type||(n=e,i=r,isNaN(n.index)&&isNaN(i.index)&&n.quality===i.quality)||function(e,t){return e.action===m.Z.ACTION_COMPLETE&&e.action===t.action}(e,r))return t=!0;var n,i,a,o})),t)}function h(e){return isNaN(e.duration)?.25:Math.min(e.duration/8,.5)}function g(e){n=n.filter((function(t){var r=h(t);return isNaN(t.startTime)||void 0!==e&&t.startTime>=e-r}))}function v(e,t){t<=e+.5||(n=n.filter((function(r){var n=h(r);return isNaN(r.startTime)||r.startTime>=t-n||isNaN(r.duration)||r.startTime+r.duration<=e+n})))}function T(e,t,r){for(var n=e.length-1;n>=0;n--){var i=e[n],a=i.startTime,o=a+i.duration;if(r=isNaN(r)?h(i):r,!isNaN(a)&&!isNaN(o)&&t+r>=a&&t-r<o||isNaN(a)&&isNaN(t))return i}return null}function _(e,t){s.addSchedulingInfo(e,t),s.addRequestsQueue(e.mediaType,i,n)}function S(e){e.sender===l&&(i.splice(i.indexOf(e.request),1),e.response&&!e.error&&n.push(e.request),_(e.request,e.error?E:y),a.trigger(o.FRAGMENT_LOADING_COMPLETED,{request:e.request,response:e.response,error:e.error,sender:this},{streamId:c.id,mediaType:f}))}function A(e){e.sender===l&&a.trigger(o.FRAGMENT_LOADING_PROGRESS,{request:e.request,response:e.response,error:e.error,sender:this},{streamId:c.id,mediaType:f})}function b(e){e.sender===l&&a.trigger(o.FRAGMENT_LOADING_ABANDONED,{request:e.request},{streamId:c.id,mediaType:f})}function R(){n=[],i=[]}return t={getStreamId:function(){return c.id},getType:function(){return f},getRequests:function(e){var t=e?e.state instanceof Array?e.state:[e.state]:[],r=[];return t.forEach((function(t){var a,o,s=function(e){var t;switch(e){case p:t=i;break;case y:t=n;break;default:t=[]}return t}(t);r=r.concat((a=s,(o=e).hasOwnProperty("time")?[T(a,o.time,o.threshold)]:a.filter((function(e){for(var t in o)if("state"!==t&&o.hasOwnProperty(t)&&e[t]!=o[t])return!1;return!0}))))})),r},isFragmentLoaded:d,isFragmentLoadedOrPending:function(e){var t,r=!1,n=0;if(!(r=d(e)))for(n=0;n<i.length;n++)t=i[n],e.url===t.url&&e.startTime===t.startTime&&(r=!0);return r},removeExecutedRequestsBeforeTime:g,removeExecutedRequestsAfterTime:function(e){n=n.filter((function(t){return isNaN(t.startTime)||void 0!==e&&t.startTime<e}))},syncExecutedRequestsWithBufferedRange:function(e,t){if(e&&0!==e.length){for(var r=0,n=0,i=e.length;n<i;n++)v(r,e.start(n)),r=e.end(n);t>0&&v(r,t)}else g()},abortRequests:function(){r.debug("abort requests"),l.abort(),i=[]},executeRequest:function(e){var t;e.action===m.Z.ACTION_DOWNLOAD?(_(e,p),i.push(e),t=e,a.trigger(o.FRAGMENT_LOADING_STARTED,{request:t},{streamId:c.id,mediaType:f}),l.load(t)):r.warn("Unknown request action.")},reset:function(){a.off(o.LOADING_COMPLETED,S,this),a.off(o.LOADING_DATA_PROGRESS,A,this),a.off(o.LOADING_ABANDONED,b,this),l&&l.reset(),R()},resetInitialSettings:R,addExecutedRequest:function(e){n.push(e)}},r=u.getLogger(t),R(),a.on(o.LOADING_COMPLETED,S,t),a.on(o.LOADING_DATA_PROGRESS,A,t),a.on(o.LOADING_ABANDONED,b,t),t}v.__dashjs_factory_name="FragmentModel";var T=c.Z.getClassFactory(v);T.FRAGMENT_MODEL_LOADING=p,T.FRAGMENT_MODEL_EXECUTED=y,T.FRAGMENT_MODEL_CANCELED="canceled",T.FRAGMENT_MODEL_FAILED=E,c.Z.updateClassFactory(v.__dashjs_factory_name,T);var _=T,S=r(5459);function A(e){return(A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function R(e,t){return!t||"object"!==A(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function I(e){return(I=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var w=new(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=I(t);if(r){var i=I(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return R(this,e)});function i(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(e=n.call(this)).MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE=10,e.MANIFEST_LOADER_LOADING_FAILURE_ERROR_CODE=11,e.XLINK_LOADER_LOADING_FAILURE_ERROR_CODE=12,e.SEGMENT_BASE_LOADER_ERROR_CODE=15,e.TIME_SYNC_FAILED_ERROR_CODE=16,e.FRAGMENT_LOADER_LOADING_FAILURE_ERROR_CODE=17,e.FRAGMENT_LOADER_NULL_REQUEST_ERROR_CODE=18,e.URL_RESOLUTION_FAILED_GENERIC_ERROR_CODE=19,e.APPEND_ERROR_CODE=20,e.REMOVE_ERROR_CODE=21,e.DATA_UPDATE_FAILED_ERROR_CODE=22,e.CAPABILITY_MEDIASOURCE_ERROR_CODE=23,e.CAPABILITY_MEDIAKEYS_ERROR_CODE=24,e.DOWNLOAD_ERROR_ID_MANIFEST_CODE=25,e.DOWNLOAD_ERROR_ID_SIDX_CODE=26,e.DOWNLOAD_ERROR_ID_CONTENT_CODE=27,e.DOWNLOAD_ERROR_ID_INITIALIZATION_CODE=28,e.DOWNLOAD_ERROR_ID_XLINK_CODE=29,e.MANIFEST_ERROR_ID_PARSE_CODE=31,e.MANIFEST_ERROR_ID_NOSTREAMS_CODE=32,e.TIMED_TEXT_ERROR_ID_PARSE_CODE=33,e.MANIFEST_ERROR_ID_MULTIPLEXED_CODE=34,e.MEDIASOURCE_TYPE_UNSUPPORTED_CODE=35,e.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE="parsing failed for ",e.MANIFEST_LOADER_LOADING_FAILURE_ERROR_MESSAGE="Failed loading manifest: ",e.XLINK_LOADER_LOADING_FAILURE_ERROR_MESSAGE="Failed loading Xlink element: ",e.SEGMENTS_UPDATE_FAILED_ERROR_MESSAGE="Segments update failed",e.SEGMENTS_UNAVAILABLE_ERROR_MESSAGE="no segments are available yet",e.SEGMENT_BASE_LOADER_ERROR_MESSAGE="error loading segment ranges from sidx",e.TIME_SYNC_FAILED_ERROR_MESSAGE="Failed to synchronize client and server time",e.FRAGMENT_LOADER_NULL_REQUEST_ERROR_MESSAGE="request is null",e.URL_RESOLUTION_FAILED_GENERIC_ERROR_MESSAGE="Failed to resolve a valid URL",e.APPEND_ERROR_MESSAGE="chunk is not defined",e.REMOVE_ERROR_MESSAGE="Removing data from the SourceBuffer",e.DATA_UPDATE_FAILED_ERROR_MESSAGE="Data update failed",e.CAPABILITY_MEDIASOURCE_ERROR_MESSAGE="mediasource is not supported",e.CAPABILITY_MEDIAKEYS_ERROR_MESSAGE="mediakeys is not supported",e.TIMED_TEXT_ERROR_MESSAGE_PARSE="parsing error :",e.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE="Error creating source buffer of type : ",e}return i}(r(2230).Z)),C=r(1264),D=r(7855);function L(e){var t,r,n,i,o,s,l=this.context,c=(0,C.Z)(l).getInstance(),d=e.textController,h=e.eventBus,g=[],m=[],p=!1,y=e.mediaSource,E=null;function v(e){return new Promise((function(t){O((function(){i.changeType&&i.changeType(e),t()}))}))}function T(e){return i=d.getTextSourceBuffer(e),Promise.resolve()}function _(){if("function"==typeof i.addEventListener)try{i.addEventListener("updateend",L,!1),i.addEventListener("error",N,!1),i.addEventListener("abort",N,!1)}catch(e){s=setInterval(L,50)}else s=setInterval(L,50)}function A(e){return new Promise((function(t){i&&c.get().streaming.buffer.useAppendWindow?O((function(){try{if(!i)return void t();var r=y.duration,a=0;e&&!isNaN(e.start)&&!isNaN(e.duration)&&isFinite(e.duration)&&(r=e.start+e.duration),e&&!isNaN(e.start)&&(a=e.start),i.appendWindowEnd===r&&i.appendWindowStart===a||(i.appendWindowStart=0,i.appendWindowEnd=r+.01,i.appendWindowStart=Math.max(a-.1,0),n.debug("Updated append window for ".concat(o.type,". Set start to ").concat(i.appendWindowStart," and end to ").concat(i.appendWindowEnd))),t()}catch(s){n.warn("Failed to set append window"),t()}})):t()}))}function b(e){return new Promise((function(t){i?O((function(){try{i.timestampOffset===e||isNaN(e)||(i.timestampOffset=e,n.debug("Set MSE timestamp offset to ".concat(e))),t()}catch(r){t()}})):t()}))}function R(){if(!p&&m.length>0){p=!0;var e=m[0];m.splice(0,1);var t=function(){p=!1,m.length>0&&R.call(this),e&&e.data&&e.data.segmentType&&e.data.segmentType!==D.w.INIT_SEGMENT_TYPE&&delete e.data.bytes,e.promise.resolve({chunk:e.data})};try{E=e.request,0===e.data.bytes.byteLength?t.call(this):(i.appendBuffer?i.appendBuffer(e.data.bytes):i.append(e.data.bytes,e.data),O(t.bind(this)))}catch(r){n.fatal('SourceBuffer append failed "'+r+'"'),m.length>0?R():p=!1,delete e.data.bytes,e.promise.reject({chunk:e.data,error:new S.Z(r.code,r.message)})}}}function I(){g.length>0&&(i.updating||(g.shift()(),I()))}function L(){i.updating||I()}function N(e){var t,n,i=e.target||{};t=u.Z.SOURCE_BUFFER_ERROR,n={error:i,lastRequestAppended:E},h.trigger(t,n,{streamId:o.streamInfo.id,mediaType:r})}function O(e){g.push(e),i.updating||I()}return t={getType:function(){return r},getAllBufferRanges:function(){try{return i.buffered}catch(e){return n.error("getAllBufferRanges exception: "+e.message),null}},getBuffer:function(){return i},append:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new Promise((function(n,i){e?(m.push({data:e,promise:{resolve:n,reject:i},request:r}),O(R.bind(t))):i({chunk:e,error:new S.Z(w.APPEND_ERROR_CODE,w.APPEND_ERROR_MESSAGE)})}))},remove:function(e){return new Promise((function(t,r){var n=e.start,a=e.end;n>=0&&a>n?O((function(){try{i.remove(n,a),O((function(){t({from:n,to:a,unintended:!1}),e.resolve&&e.resolve()}))}catch(o){r({from:n,to:a,unintended:!1,error:new S.Z(w.REMOVE_ERROR_CODE,w.REMOVE_ERROR_MESSAGE)}),e.reject&&e.reject(o)}})):t()}))},abort:function(){return new Promise((function(e){try{m=[],"open"===y.readyState?O((function(){try{i&&i.abort(),e()}catch(t){e()}})):i&&i.setTextTrack&&"ended"===y.readyState?(i.abort(),e()):e()}catch(t){e()}}))},reset:function(){if(i){try{g=[],function(){try{"function"==typeof i.removeEventListener&&(i.removeEventListener("updateend",L,!1),i.removeEventListener("error",N,!1),i.removeEventListener("abort",N,!1)),clearInterval(s)}catch(e){n.error(e)}}(),p=!1,m=[],i.getClassName&&"TextSourceBuffer"===i.getClassName()||(n.debug("Removing sourcebuffer from media source"),y.removeSourceBuffer(i))}catch(e){}i=null}E=null},updateTimestampOffset:b,initializeForStreamSwitch:function(e,t,n){r=(o=e).type;var a=o.codec;i=n.getBuffer(),_();var s=[];return s.push(new Promise((function(e){O((function(){var t=i.appendWindowStart,r=i.appendWindowEnd;i&&(i.abort(),i.appendWindowStart=t,i.appendWindowEnd=r),e()}))}))),s.push(A(o.streamInfo)),c.get().streaming.buffer.useChangeTypeForTrackSwitch&&s.push(v(a)),t&&void 0!==t.MSETimeOffset&&s.push(b(t.MSETimeOffset)),Promise.all(s)},initializeForFirstUse:function(e,t,n){r=(o=t).type;var s=o.codec;try{if(s.match(/application\/mp4;\s*codecs="(stpp|wvtt).*"/i))return T(e);i=y.addSourceBuffer(s),_();var l=[];return l.push(A(o.streamInfo)),n&&void 0!==n.MSETimeOffset&&l.push(b(n.MSETimeOffset)),Promise.all(l)}catch(u){return o.type==a.Z.TEXT&&!o.isFragmented||-1!==s.indexOf('codecs="stpp')||-1!==s.indexOf('codecs="vtt')||-1!==s.indexOf("text/vtt")?T(e):Promise.reject(u)}},updateAppendWindow:A,changeType:v},n=(0,f.Z)(l).getInstance().getLogger(t),t}L.__dashjs_factory_name="SourceBufferSink";var N=c.Z.getClassFactory(L);function O(e){var t,r,n,i=this.context,a=[],o=e;function s(e,t){return a=a.filter((function(r){return!((isNaN(t)||r.start<t)&&(isNaN(e)||r.end>e))})),Promise.resolve()}return t={getAllBufferRanges:function(){for(var e=[],t=0;t<a.length;t++){var r=a[t];0===e.length||r.start>e[e.length-1].end?e.push({start:r.start,end:r.end}):e[e.length-1].end=r.end}var n={start:function(t){return e[t].start},end:function(t){return e[t].end}};return Object.defineProperty(n,"length",{get:function(){return e.length}}),n},append:function(e){return"InitializationSegment"!==e.segmentType?(a.push(e),a.sort((function(e,t){return e.start-t.start})),n=null):n=e,r.debug("PreBufferSink appended chunk s: "+e.start+"; e: "+e.end),o&&o({chunk:e}),Promise.resolve()},remove:s,abort:function(){return Promise.resolve()},discharge:function(e,t){var r,i,o=(r=e,i=t,a.filter((function(e){return(isNaN(i)||e.start<i)&&(isNaN(r)||e.end>r)})));return n&&(o.push(n),n=null),s(e,t),o},reset:function(){a=[],n=null,o=null},updateTimestampOffset:function(){return Promise.resolve()},waitForUpdateEnd:function(e){e()},getBuffer:function(){return this}},r=(0,f.Z)(i).getInstance().getLogger(t),t}O.__dashjs_factory_name="PreBufferSink";var M=c.Z.getClassFactory(O);function P(){var e={};return{save:function(t){var r=t.streamId,n=t.representationId;e[r]=e[r]||{},e[r][n]=t},extract:function(t,r){return e&&e[t]&&e[t][r]?e[t][r]:null},reset:function(){e={}}}}P.__dashjs_factory_name="InitCache";var k=c.Z.getSingletonFactory(P),x=.01,F="BufferController";function U(e){e=e||{};var t,r,n,i,o,c,h,g,m,p,y,E,v,T,A,b,R,I,C,L,O,P=this.context,U=(0,l.Z)(P).getInstance(),B=e.errHandler,Z=e.fragmentModel,G=e.representationController,H=e.adapter,K=e.textController,Y=e.abrController,q=e.playbackController,V=e.streamInfo,j=e.type,$=e.settings;function z(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new Promise((function(r,n){c=e,m&&t&&"function"==typeof m.discharge?(p=m,X(t).then((function(){r()})).catch((function(e){n(e)}))):r()}))}function W(e){return H.convertRepresentationToRepresentationInfo(G.getRepresentationForQuality(e))}function X(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return new Promise((function(r,n){I&&e?c?(y=!1,J(e,t).then((function(e){r(e)})).catch((function(e){n(e)}))):(y=!0,Q().then((function(e){r(e)})).catch((function(e){n(e)}))):r(null)}))}function Q(){var e=this;return new Promise((function(t,r){var n=Y.getQualityFor(j,V.id);m=M(P).create(ie.bind(e)),Te(W(n)).then((function(){t(m)})).catch((function(){r()}))}))}function J(e,t){return new Promise((function(n,i){var o,s,l,u,f=Y.getQualityFor(j,V.id);m=N(P).create({mediaSource:c,textController:K,eventBus:U}),(o=e,s=t,l=f,u=W(l),s&&s[j]&&(j===a.Z.VIDEO||j===a.Z.AUDIO)?m.initializeForStreamSwitch(o,u,s[j]):m.initializeForFirstUse(V,o,u)).then((function(){return Te(W(f))})).then((function(){n(m)})).catch((function(e){r.fatal("Caught error on create SourceBuffer: "+e),B.error(new S.Z(w.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,w.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+j)),i(e)}))}))}function ee(e){$.get().streaming.cacheInitSegments&&(r.info("Init fragment finished loading saving to",j+"'s init cache"),I.save(e.chunk)),r.debug("Append Init fragment",j," with representationId:",e.chunk.representationId," and quality:",e.chunk.quality,", data size:",e.chunk.bytes.byteLength),re(e.chunk)}function te(e){re(e.chunk,e.request)}function re(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;m&&(m.append(e,t).then((function(e){ie(e)})).catch((function(e){ie(e)})),e.mediaInfo.type===a.Z.VIDEO&&Ce(u.Z.VIDEO_CHUNK_RECEIVED,{chunk:e}))}function ne(e){if(e&&e.length>0)for(var t=0,n=e.length;t<n;t++)r.debug("Buffered range: "+e.start(t)+" - "+e.end(t)+", currentTime = ",q.getTime())}function ie(e){if(e.error)return 22===e.error.code&&function(){if(R=!0,o=.8*Re(),r.warn("Quota exceeded, Critical Buffer: "+o),o>0){var e=Math.max(.2*o,1),t=o-e,n=Math.min($.get().streaming.buffer.bufferTimeAtTopQuality,.9*t),i=Math.min($.get().streaming.buffer.bufferTimeAtTopQualityLongForm,.9*t),a={streaming:{buffer:{bufferToKeep:parseFloat(e.toFixed(5)),bufferTimeAtTopQuality:parseFloat(n.toFixed(5)),bufferTimeAtTopQualityLongForm:parseFloat(i.toFixed(5))}}};$.update(a)}}(),void(22!==e.error.code&&we()||(r.warn("Clearing playback buffer to overcome quota exceed situation"),Ce(u.Z.QUOTA_EXCEEDED,{criticalBufferLevel:o,quotaExceededTime:e.chunk.start}),ye(pe())));if(m&&(fe(),R=!1,(T=e.chunk)&&T.endFragment)){T&&!isNaN(T.index)&&(h=Math.max(T.index,h),de());var t=m.getAllBufferRanges();T.segmentType===D.w.MEDIA_SEGMENT_TYPE&&(ne(t),se(),function(){if(!isNaN(O)&&!y)if(j===a.Z.AUDIO||j===a.Z.VIDEO){var e=q.getTime(),t=ce(e,0),r=ce(O,0);if(t&&r&&t.start===r.start)O=NaN;else{var n=G.getCurrentRepresentation().segmentDuration,i=ce(O,n);i&&($.get().streaming.buffer.enableSeekDecorrelationFix&&Math.abs(e-O)>n?O<=i.end&&q.seek(Math.max(O,i.start),!1,!0):e<i.start&&q.seek(i.start,!1,!0))}}else O=NaN}());var n=!1;E&&(E.indexOf(T)>0&&(n=!0),E=null),T&&!n&&Ce(u.Z.BYTES_APPENDED_END_FRAGMENT,{quality:T.quality,startTime:T.start,index:T.index,bufferedRanges:t,segmentType:T.segmentType,mediaType:j})}}function ae(){return new Promise((function(e,t){var r=oe();if(!r||0===r.length)return se(),void e();ye(r).then((function(){e()})).catch((function(e){t(e)}))}))}function oe(e){var t=[],n=m.getAllBufferRanges();if(!n||0===n.length)return t;if(!e&&0!==e||isNaN(e))t.push({start:n.start(0),end:n.end(n.length-1)+.5});else{var i=function(e,t){var r=$.get().streaming.buffer.bufferToKeep,n=t.start(0);if(e-n>r){var i=Math.max(0,e-r),a=Z.getRequests({state:_.FRAGMENT_MODEL_EXECUTED,time:e,threshold:x})[0];if(a&&(i=Math.min(a.startTime,i)),i>0)return{start:n,end:i}}return null}(e,n),a=function(e,t){var n=t.end(t.length-1)+.5,i=Ie(e),a=V.manifestInfo.duration>=$.get().streaming.buffer.longFormContentDurationThreshold?$.get().streaming.buffer.bufferTimeAtTopQualityLongForm:$.get().streaming.buffer.bufferTimeAtTopQuality,o=isNaN(i)?e:Math.min(i,e+a);if(o>=t.end(t.length-1))return null;var s=Z.getRequests({state:_.FRAGMENT_MODEL_EXECUTED,time:e,threshold:x})[0];if(s&&(o=Math.max(s.startTime+s.duration,o)),$.get().streaming.buffer.avoidCurrentTimeRangePruning)for(var l=0;l<t.length;l++)if(t.start(l)<=e&&e<=t.end(l)&&t.start(l)<=o&&o<=t.end(l)){var u=o;o=l+1<t.length?t.start(l+1):t.end(l)+1,r.debug("Buffered range ["+t.start(l)+", "+t.end(l)+"] overlaps with targetTime "+e+" and range to be pruned ["+u+", "+n+"], using ["+o+", "+n+"] instead"+(o<n?"":" (no actual pruning)"));break}return o<t.end(t.length-1)?{start:o,end:n}:null}(e,n);i&&t.push(i),a&&t.push(a)}return t}function se(){(!L||j===a.Z.TEXT&&K.isTextEnabled())&&fe()}function le(){he()}function ue(){he(),O=NaN}function ce(e,t){if(!m)return null;var r,n,i=m.getAllBufferRanges(),a=0,o=0,s=null,l=null,u=0,c=isNaN(t)?.15:t;if(null!=i){for(n=0,r=i.length;n<r;n++)if(a=i.start(n),o=i.end(n),null===s)u=Math.abs(a-e),(e>=a&&e<o||u<=c)&&(s=a,l=o);else{if(!((u=a-l)<=c))break;l=o}if(null!==s)return{start:s,end:l}}return null}function fe(){if(q){var e=q.getTime()||0;y&&(e=isNaN(O)?0:O);var t=$.get().streaming.gaps.jumpGaps&&!isNaN($.get().streaming.gaps.smallGapLimit)?$.get().streaming.gaps.smallGapLimit:NaN;i=Math.max((r=e,n=t,$.get().streaming.gaps.jumpGaps&&(n=$.get().streaming.gaps.smallGapLimit),null===(a=ce(r,n))?0:a.end-r),0),Ce(u.Z.BUFFER_LEVEL_UPDATED,{mediaType:j,bufferLevel:i}),he()}var r,n,a}function de(){var e=h>=g-1,t=q.getTimeToStreamEnd(V)-i<1e-5;!e&&!t||n||(be(!0),r.debug("checkIfBufferingCompleted trigger BUFFERING_COMPLETED for stream id ".concat(V.id," and type ").concat(j)))}function he(){j!==a.Z.AUDIO&&j!==a.Z.VIDEO||((!q.getLowLatencyModeEnabled()&&i<$.get().streaming.buffer.stallThreshold||0===i)&&!n?ge(s.Z.BUFFER_EMPTY):(n||i>=$.get().streaming.buffer.stallThreshold||q.getLowLatencyModeEnabled()&&i>0)&&ge(s.Z.BUFFER_LOADED))}function ge(e){v===e||e===s.Z.BUFFER_EMPTY&&0===q.getTime()||j===a.Z.TEXT&&!K.isTextEnabled()||(v=e,Ce(u.Z.BUFFER_LEVEL_STATE_CHANGED,{state:e}),Ce(e===s.Z.BUFFER_LOADED?u.Z.BUFFER_LOADED:u.Z.BUFFER_EMPTY),r.debug(e===s.Z.BUFFER_LOADED?"Got enough buffer to start":"Waiting for more buffer before starting playback"))}function me(){m&&j!==a.Z.TEXT&&(n||ye(pe()))}function pe(){var e=[],t=m.getAllBufferRanges();if(!t||0===t.length)return e;var r=q.getTime(),n=Math.max(0,r-$.get().streaming.buffer.bufferToKeep),i=Z.getRequests({state:_.FRAGMENT_MODEL_EXECUTED,time:r,threshold:x})[0];if(i)n=Math.min(i.startTime,n);else if(0===r&&q.getIsDynamic())return[];if(t.start(0)<=n){for(var a={start:0,end:n},o=0;o<t.length&&t.end(o)<=n;o++)a.end=t.end(o);a.start<a.end&&e.push(a)}return e}function ye(e){return new Promise((function(t,r){if(e&&m&&0!==e.length){var n=[];e.forEach((function(e){var t;n.push((t=e,new Promise((function(e,r){t.resolve=e,t.reject=r,C.push(t)}))))})),b||Ee(),Promise.all(n).then((function(){t()})).catch((function(e){r(e)}))}else t()}))}function Ee(){try{if(0===C.length||!m)return r.debug("Nothing to prune, halt pruning"),C=[],void(b=!1);var e=m.getBuffer();if(!e||!e.buffered||0===e.buffered.length)return r.debug("SourceBuffer is empty (or does not exist), halt pruning"),C=[],void(b=!1);var t=C.shift();r.debug("".concat(j,": Removing buffer from: ").concat(t.start," to ").concat(t.end)),b=!0,q.getTime()<t.end&&be(!1),m.remove(t).then((function(e){ve(e)})).catch((function(e){ve(e)}))}catch(n){b=!1}}function ve(e){r.debug("onRemoved buffer from:",e.from,"to",e.to),m&&(ne(m.getAllBufferRanges()),0===C.length&&(b=!1,fe()),e.unintended&&(r.warn("Detected unintended removal from:",e.from,"to",e.to,"setting streamprocessor time to",e.from),Ce(u.Z.SEEK_TARGET,{time:e.from})),b?Ee():(L?L=!1:fe(),Ce(u.Z.BUFFER_CLEARED,{from:e.from,to:e.to,unintended:e.unintended,hasEnoughSpaceToAppend:we(),quotaExceeded:R})))}function Te(e){return new Promise((function(t){e&&void 0!==e.MSETimeOffset&&m&&m.updateTimestampOffset?m.updateTimestampOffset(e.MSETimeOffset).then((function(){t()})).catch((function(){t()})):t()}))}function _e(){return m&&!n?m.updateAppendWindow(V):Promise.resolve()}function Se(){++A*($.get().streaming.wallclockTimeUpdateInterval/1e3)>=$.get().streaming.buffer.bufferPruningInterval&&(A=0,me())}function Ae(){he()}function be(e){(n=e)?Ce(u.Z.BUFFERING_COMPLETED):g=Number.POSITIVE_INFINITY}function Re(){try{var e,t,r=m.getAllBufferRanges(),n=0;if(!r)return n;for(t=0,e=r.length;t<e;t++)n+=r.end(t)-r.start(t);return n}catch(i){return 0}}function Ie(e){try{var t=e,r=m.getAllBufferRanges();if(!r||0===r.length)return NaN;for(var n=0;t===e&&n<r.length;){var i=r.start(n),a=r.end(n);t>=i&&t<=a&&(t=a),n+=1}return t===e?NaN:t}catch(o){}}function we(){var e=Re();return isNaN(e)||e<o}function Ce(e,t){var r=t||{};U.trigger(e,r,{streamId:V.id,mediaType:j})}function De(e,t){if(o=Number.POSITIVE_INFINITY,v=void 0,g=Number.POSITIVE_INFINITY,h=0,T=null,n=!1,b=!1,R=!1,i=0,A=0,C=[],O=NaN,y=!1,m){var r=m;m=null,e||t||r.abort().then((function(){r.reset(t),r=null}))}L=!1}return t={initialize:function(e){z(e),U.on(u.Z.INIT_FRAGMENT_LOADED,ee,t),U.on(u.Z.MEDIA_FRAGMENT_LOADED,te,t),U.on(u.Z.WALLCLOCK_TIME_UPDATED,Se,t),U.on(d.Z.PLAYBACK_PLAYING,ue,t),U.on(d.Z.PLAYBACK_PROGRESS,se,t),U.on(d.Z.PLAYBACK_TIME_UPDATED,se,t),U.on(d.Z.PLAYBACK_RATE_CHANGED,Ae,t),U.on(d.Z.PLAYBACK_STALLED,le,t)},getStreamId:function(){return V.id},getType:function(){return j},getBufferControllerType:function(){return F},createBufferSink:X,dischargePreBuffer:function(){if(m&&p&&"function"==typeof p.discharge){var e=p.getAllBufferRanges();if(e.length>0){for(var t="Beginning "+j+"PreBuffer discharge, adding buffer for:",n=0;n<e.length;n++)t+=" start: "+e.start(n)+", end: "+e.end(n)+";";r.debug(t)}else r.debug("PreBuffer discharge requested, but there were no media segments in the PreBuffer.");E=[];for(var i=p.discharge(),a=null,o=0;o<i.length;o++){var s=i[o];if(s.segmentType!==D.w.INIT_SEGMENT_TYPE){var l=I.extract(s.streamId,s.representationId);l&&a!==l&&(E.push(l),m.append(l),a=l)}E.push(s),m.append(s)}p.reset(),p=null}},getBuffer:function(){return m},getBufferLevel:function(){return i},getRangeAt:ce,hasBufferAtTime:function(e){try{var t=m.getAllBufferRanges();if(!t||0===t.length)return!1;for(var n=0;n<t.length;){var i=t.start(n),a=t.end(n);if(e>=i&&e<=a)return!0;n+=1}return!1}catch(o){return r.error(o),!1}},pruneBuffer:me,setMediaSource:z,getMediaSource:function(){return c},appendInitSegmentFromCache:function(e){var t=I.extract(V.id,e);return!!t&&(r.info("Append Init fragment",j," with representationId:",t.representationId," and quality:",t.quality,", data size:",t.bytes.byteLength),re(t),!0)},getIsBufferingCompleted:function(){return n},setIsBufferingCompleted:be,getIsPruningInProgress:function(){return b},reset:function(e,t){U.off(u.Z.INIT_FRAGMENT_LOADED,ee,this),U.off(u.Z.MEDIA_FRAGMENT_LOADED,te,this),U.off(u.Z.WALLCLOCK_TIME_UPDATED,Se,this),U.off(d.Z.PLAYBACK_PLAYING,ue,this),U.off(d.Z.PLAYBACK_PROGRESS,se,this),U.off(d.Z.PLAYBACK_TIME_UPDATED,se,this),U.off(d.Z.PLAYBACK_RATE_CHANGED,Ae,this),U.off(d.Z.PLAYBACK_STALLED,le,this),De(e,t)},prepareForPlaybackSeek:function(){return n&&be(!1),m.abort()},prepareForReplacementTrackSwitch:function(e){return new Promise((function(t,r){m.abort().then((function(){return _e()})).then((function(){return $.get().streaming.buffer.useChangeTypeForTrackSwitch?m.changeType(e):Promise.resolve()})).then((function(){return ae()})).then((function(){be(!1),t()})).catch((function(e){r(e)}))}))},prepareForNonReplacementTrackSwitch:function(e){return new Promise((function(t,r){_e().then((function(){return $.get().streaming.buffer.useChangeTypeForTrackSwitch?m.changeType(e):Promise.resolve()})).then((function(){t()})).catch((function(e){r(e)}))}))},prepareForForceReplacementQualitySwitch:function(e){return new Promise((function(t,r){m.abort().then((function(){return _e()})).then((function(){return ae()})).then((function(){return Te(e)})).then((function(){be(!1),t()})).catch((function(e){r(e)}))}))},updateAppendWindow:_e,getAllRangesWithSafetyFactor:oe,getContinuousBufferTimeForTargetTime:Ie,clearBuffers:ye,pruneAllSafely:ae,updateBufferTimestampOffset:Te,setSeekTarget:function(e){O=e},segmentRequestingCompleted:function(e){isNaN(e)||(g=e,de())}},r=(0,f.Z)(P).getInstance().getLogger(t),I=k(P).getInstance(),De(),t}U.__dashjs_factory_name=F;var B=c.Z.getClassFactory(U),Z="NotFragmentedTextBufferController";function G(e){e=e||{};var t,r,n,i,a,o,s=this.context,c=(0,l.Z)(s).getInstance(),f=e.textController,d=e.errHandler,h=e.streamInfo,g=e.type;function m(e){i=e}function p(e){var t,n;r!==e&&(r=e)&&(t=u.Z.BUFFERING_COMPLETED,n={},c.trigger(t,n,{streamId:h.id,mediaType:g}))}function y(e){e.chunk.bytes&&!r&&(o.save(e.chunk),a.append(e.chunk),p(!0))}return t={initialize:function(e){m(e)},getStreamId:function(){return h.id},getType:function(){return g},getBufferControllerType:function(){return Z},createBufferSink:function(e){return new Promise((function(t,r){try{(a=N(s).create({mediaSource:i,textController:f,eventBus:c})).initializeForFirstUse(h,e),n||(a.getBuffer()&&"function"==typeof a.getBuffer().initialize&&a.getBuffer().initialize(),n=!0),t(a)}catch(o){d.error(new S.Z(w.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,w.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+g)),r(o)}}))},dischargePreBuffer:function(){},getBuffer:function(){return a},getBufferLevel:function(){return 0},getRangeAt:function(){return null},pruneBuffer:function(){},hasBufferAtTime:function(){return!0},getAllRangesWithSafetyFactor:function(){return[]},getContinuousBufferTimeForTargetTime:function(){return Number.POSITIVE_INFINITY},setMediaSource:m,getMediaSource:function(){return i},appendInitSegmentFromCache:function(e){return null!==o.extract(h.id,e)},getIsBufferingCompleted:function(){return r},setIsBufferingCompleted:p,getIsPruningInProgress:function(){return!1},reset:function(e){c.off(u.Z.INIT_FRAGMENT_LOADED,y,t),!e&&a&&(a.abort(),a.reset(),a=null)},clearBuffers:function(){return Promise.resolve()},prepareForPlaybackSeek:function(){return Promise.resolve()},prepareForReplacementTrackSwitch:function(){return r=!1,Promise.resolve()},setSeekTarget:function(){},updateAppendWindow:function(){return Promise.resolve()},pruneAllSafely:function(){return Promise.resolve()},updateBufferTimestampOffset:function(){return Promise.resolve()},segmentRequestingCompleted:function(){}},n=!1,i=null,r=!1,o=k(s).getInstance(),c.on(u.Z.INIT_FRAGMENT_LOADED,y,t),t}G.__dashjs_factory_name=Z;var H=c.Z.getClassFactory(G);function K(e){e=e||{};var t,r,n,i,o,c,h,g,m,p,y,E,v,T=this.context,S=(0,l.Z)(T).getInstance(),A=e.dashMetrics,b=e.mediaPlayerModel,R=e.fragmentModel,I=e.abrController,w=e.playbackController,C=e.textController,D=e.type,L=e.bufferController,N=e.representationController,O=e.settings;function M(){E=!0}function P(){E=!1}function k(e){if(!L.getIsBufferingCompleted()){x();var t=isNaN(e)?0:e;o=setTimeout(F,t)}}function x(){o&&(clearTimeout(o),o=null)}function F(){try{if(function(){try{return D===a.Z.TEXT&&!C.isTextEnabled()||w.isPaused()&&(!w.getStreamController().getInitialPlayback()||!w.getStreamController().getAutoPlay())&&!O.get().streaming.scheduling.scheduleWhilePaused}catch(e){return!1}}())return void x();if(function(){try{return!!E&&N.getCurrentRepresentationInfo()&&(isNaN(m)||p||(t=r.id,i=I.getMaxAllowedIndexFor(D,t),!(!isNaN(g)&&g==i||(n.info("Top quality "+D+" index has changed from "+g+" to "+i),g=i,0)))||(e=N.getCurrentRepresentationInfo(),!D||!e||A.getCurrentBufferLevel(D)<U()))}catch(e){return!1}var e,t,i}()){var e=!1;v&&(e=I.checkPlaybackQuality(D,r.id)),e||(i=N.getCurrentRepresentationInfo(),y||i.quality!==m||p?(p?(n.debug("Switch track for "+D+", representation id = "+i.id),p=!1):n.debug("Quality has changed, get init request for representationid = "+i.id),S.trigger(u.Z.INIT_FRAGMENT_NEEDED,{representationId:i.id,sender:t},{streamId:r.id,mediaType:D}),v=!1,y=!1):(n.debug("Media segment needed for ".concat(D," and stream id ").concat(r.id)),S.trigger(u.Z.MEDIA_FRAGMENT_NEEDED,{},{streamId:r.id,mediaType:D}),v=!0))}else k(w.getLowLatencyModeEnabled()?O.get().streaming.scheduling.lowLatencyTimeout:O.get().streaming.scheduling.defaultTimeout)}catch(o){k(w.getLowLatencyModeEnabled()?O.get().streaming.scheduling.lowLatencyTimeout:O.get().streaming.scheduling.defaultTimeout)}var i}function U(){var e=NaN,t=N.getCurrentRepresentationInfo();return D&&t?e=D===a.Z.TEXT?function(){try{if(C.isTextEnabled()){var e=N.getCurrentRepresentationInfo();if(isNaN(e.fragmentDuration)){var t=A.getCurrentSchedulingInfo(s.Z.SCHEDULING_INFO);return t?t.duration:0}return e.fragmentDuration}return 0}catch(r){return 0}}():D===a.Z.AUDIO&&c?function(){try{var e=A.getCurrentBufferLevel(a.Z.VIDEO),t=N.getCurrentRepresentationInfo();return isNaN(t.fragmentDuration)?e+1:Math.max(e+1,t.fragmentDuration)}catch(r){return 0}}():function(){try{var e=N.getCurrentRepresentationInfo().mediaInfo.streamInfo;return I.isPlayingAtTopQuality(e)?e.manifestInfo.duration>=O.get().streaming.buffer.longFormContentDurationThreshold?O.get().streaming.buffer.bufferTimeAtTopQualityLongForm:O.get().streaming.buffer.bufferTimeAtTopQuality:b.getStableBufferTime()}catch(t){return b.getStableBufferTime()}}():e}function B(){Z(!0)}function Z(e){if(w&&R){var t=R.getRequests({state:_.FRAGMENT_MODEL_EXECUTED,time:w.getTime(),threshold:0})[0];t&&w.getTime()>=t.startTime&&((!h.mediaInfo||t.mediaInfo.type===h.mediaInfo.type&&t.mediaInfo.index!==h.mediaInfo.index)&&e&&S.trigger(u.Z.TRACK_CHANGE_RENDERED,{mediaType:D,oldMediaInfo:h.mediaInfo,newMediaInfo:t.mediaInfo,streamId:r.id}),t.quality===h.quality&&t.adaptationIndex===h.adaptationIndex||!e||(n.debug("Quality change rendered for streamId ".concat(r.id," and type ").concat(D)),S.trigger(u.Z.QUALITY_CHANGE_RENDERED,{mediaType:D,oldQuality:h.quality,newQuality:t.quality,streamId:r.id})),h={mediaInfo:t.mediaInfo,quality:t.quality,adaptationIndex:t.adaptationIndex})}}function G(){R.abortRequests(),x()}function H(){O.get().streaming.scheduling.scheduleWhilePaused||k()}function K(e){A.updatePlayListTraceMetrics({playbackspeed:e.playbackRate.toString()})}function Y(){v=!0,i=0,m=NaN,h={mediaInfo:void 0,quality:NaN,adaptationIndex:NaN},g=NaN,p=!1,y=!1,E=!0}return t={initialize:function(e){c=e,S.on(u.Z.URL_RESOLUTION_FAILED,G,t),S.on(d.Z.PLAYBACK_STARTED,H,t),S.on(d.Z.PLAYBACK_RATE_CHANGED,K,t),S.on(d.Z.PLAYBACK_TIME_UPDATED,B,t),S.on(d.Z.MANAGED_MEDIA_SOURCE_START_STREAMING,M,t),S.on(d.Z.MANAGED_MEDIA_SOURCE_END_STREAMING,P,t)},getType:function(){return D},getStreamId:function(){return r.id},setTimeToLoadDelay:function(e){i=e},getTimeToLoadDelay:function(){return i},setSwitchTrack:function(e){p=e},getSwitchTrack:function(){return p},startScheduleTimer:k,clearScheduleTimer:x,reset:function(){S.off(u.Z.URL_RESOLUTION_FAILED,G,t),S.off(d.Z.PLAYBACK_STARTED,H,t),S.off(d.Z.PLAYBACK_RATE_CHANGED,K,t),S.off(d.Z.PLAYBACK_TIME_UPDATED,B,t),S.off(d.Z.MANAGED_MEDIA_SOURCE_START_STREAMING,M,t),S.off(d.Z.MANAGED_MEDIA_SOURCE_END_STREAMING,P,t),x(),Z(!1),Y(),r=null},getBufferTarget:U,getPlaybackController:function(){return w},setCheckPlaybackQuality:function(e){v=e},setInitSegmentRequired:function(e){y=e},setLastInitializedQuality:function(e){m=e}},n=(0,f.Z)(T).getInstance().getLogger(t),Y(),r=e.streamInfo,t}K.__dashjs_factory_name="ScheduleController";var Y=c.Z.getClassFactory(K),q=r(7387);function V(e){var t,r,n,i,o,s,l=(e=e||{}).eventBus,u=e.events,c=e.abrController,f=e.dashMetrics,h=e.playbackController,g=e.timelineConverter,m=e.type,p=e.streamInfo,y=e.dashConstants,E=e.segmentsController,v=e.isDynamic,T=e.adapter;function _(){return m}function S(){return n}function A(){return s}function b(){r=null,n=!0,i=[],o=null}function R(e){return new Promise((function(t,r){var n=e.hasInitialization(),a=e.hasSegments(),o=[];o.push(E.updateInitData(e,n)),o.push(E.updateSegmentData(e,a)),Promise.all(o).then((function(r){var n,a,o;r[0]&&!r[0].error&&(a=e,o=r[0],e=o&&!o.error&&o.representation?o.representation:a),r[1]&&!r[1].error&&(e=function(e,t){if(t&&!t.error){var r,n,i,a,o=t.segments,s=[],l=0;for(r=0,n=o?o.length:0;r<n;r++)i=o[r],(a=(0,q.TJ)(g,v,e,i.startTime,i.duration,i.timescale,i.media,i.mediaRange,l))&&(s.push(a),a=null,l++);return s.length>0&&(e.segments=s),e}}(e,r[1])),(n=e).mediaFinishedInformation=E.getMediaFinishedInformation(n),function(e){if(S()){var t,r,n=f.getCurrentManifestUpdate(),a=!1;if(n){for(var o=0;o<n.representationInfo.length;o++)if((t=n.representationInfo[o]).index===e.index&&t.mediaType===_()){a=!0;break}a||f.addManifestUpdateRepresentationInfo(e,_())}if(function(){for(var e=0,t=i.length;e<t;e++){var r=i[e].segmentInfoType;if(!i[e].hasInitialization()||(r===y.SEGMENT_BASE||r===y.BASE_URL)&&!i[e].segments)return!1}return!0}()){c.setPlaybackQuality(m,p,(r=s,i.indexOf(r)));var l=f.getCurrentDVRInfo(m);l&&f.updateManifestUpdateInfo({latency:l.range.end-h.getTime()}),f.getCurrentRepresentationSwitch(A().adaptation.type)||I(),C()}}}(e),t()})).catch((function(e){r(e)}))}))}function I(){!function(){if(!(c&&f&&h&&g))throw new Error(a.Z.MISSING_CONFIG_ERROR)}();var e=new Date,t=A(),r=1e3*h.getTime();t&&f.addRepresentationSwitch(t.adaptation.type,e,r,t.id),l.trigger(d.Z.REPRESENTATION_SWITCH,{mediaType:m,streamId:p.id,currentRepresentation:t,numberOfRepresentations:i.length},{streamId:p.id,mediaType:m})}function w(e){return null==e||e>=i.length?null:i[e]}function C(e){n=!1,l.trigger(u.DATA_UPDATE_COMPLETED,{data:r,currentRepresentation:s,error:e},{streamId:p.id,mediaType:m})}function D(e){s=e,o=T.convertRepresentationToRepresentationInfo(s)}function L(e){if(e.newDuration){var t=A();t&&t.adaptation.period&&(t.adaptation.period.duration=e.newDuration)}}return t={getStreamId:function(){return p.id},getType:_,getData:function(){return r},isUpdating:S,updateData:function(e,t,o,s,l){return new Promise((function(u,c){if(n=!0,i=t,r=e,D(w(l)),o!==a.Z.VIDEO&&o!==a.Z.AUDIO&&(o!==a.Z.TEXT||!s))return C(),void u();for(var f=[],d=0,h=i.length;d<h;d++){var g=i[d];f.push(R(g))}Promise.all(f).then((function(){D(w(l)),u()})).catch((function(e){c(e)}))}))},getCurrentRepresentation:A,getCurrentRepresentationInfo:function(){return o},getRepresentationForQuality:w,prepareQualityChange:function(e){D(w(e)),I()},reset:function(){l.off(d.Z.MANIFEST_VALIDITY_CHANGED,L,t),b()}},b(),l.on(d.Z.MANIFEST_VALIDITY_CHANGED,L,t),t}V.__dashjs_factory_name="RepresentationController";var j=c.Z.getClassFactory(V),$=r(3106),z=r(9326),W=r(7473),X=r(2594);function Q(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var J=function e(){Q(this,e),this.start=null,this.mstart=null,this.starttype=null,this.trace=[]};J.INITIAL_PLAYOUT_START_REASON="initial_playout",J.SEEK_START_REASON="seek",J.RESUME_FROM_PAUSE_START_REASON="resume",J.METRICS_COLLECTION_START_REASON="metrics_collection_start";var ee=function e(){Q(this,e),this.representationid=null,this.subreplevel=null,this.start=null,this.mstart=null,this.duration=null,this.playbackspeed=null,this.stopreason=null};ee.REPRESENTATION_SWITCH_STOP_REASON="representation_switch",ee.REBUFFERING_REASON="rebuffering",ee.USER_REQUEST_STOP_REASON="user_request",ee.END_OF_PERIOD_STOP_REASON="end_of_period",ee.END_OF_CONTENT_STOP_REASON="end_of_content",ee.METRICS_COLLECTION_STOP_REASON="metrics_collection_end",ee.FAILURE_STOP_REASON="failure";var te=r(7802);function re(){return{ntpToUTC:function(e){var t=new Date(Date.UTC(1900,0,1,0,0,0));return new Date(t.getTime()+e).getTime()}}}re.__dashjs_factory_name="TimeUtils";var ne=c.Z.getSingletonFactory(re);function ie(e){e=e||{};var t,r,n,i,c,h,g,m,p,y,E,v,T,A,b,R=this.context,I=(0,l.Z)(R).getInstance(),C=e.streamInfo,L=e.type,N=e.errHandler,O=e.mimeType,M=e.timelineConverter,P=e.adapter,k=e.manifestModel,x=e.mediaPlayerModel,F=e.fragmentModel,U=e.abrController,Z=e.playbackController,G=e.mediaController,K=e.textController,q=e.dashMetrics,V=e.settings,Q=e.boxParser,J=e.segmentBlacklistController;function re(){return C.id}function ie(){return L}function ae(){return P.getIsTextTrack(m.getData())}function oe(){c=[],i=null,A=0,p=!1,y=!1,E=!1,b=null}function se(e){return!isNaN(e)&&!isNaN(C.duration)&&isFinite(C.duration)&&e>=C.start+C.duration}function le(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.sender)if(Z.getIsManifestUpdateInProgress())he();else if((!ae()||K.isTextEnabled())&&h&&e.representationId&&!h.appendInitSegmentFromCache(e.representationId)){var r=m.getCurrentRepresentation();if(0===r.range)return void ue();var n=v?v.getInitRequest(i,r):null;n?F.executeRequest(n):t&&(g.setInitSegmentRequired(!0),he())}}function ue(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(Z.getIsManifestUpdateInProgress()||h.getIsPruningInProgress())he();else{var r=de();r?(p=!1,y=!1,ce(r)):fe(t)}}function ce(e){var t,n;isNaN(e.startTime+e.duration)||(A=e.startTime+e.duration),e.delayLoadingTime=(new Date).getTime()+g.getTimeToLoadDelay(),g.setTimeToLoadDelay(0),n=(t=e).url,t.range&&(n=n.concat("_",t.range)),J.contains(n)?(r.warn("Fragment request url ".concat(e.url," for stream id ").concat(C.id," and media type ").concat(L," is on the ignore list and will be skipped")),he()):(r.debug("Next fragment request url for stream id ".concat(C.id," and media type ").concat(L," is ").concat(e.url)),F.executeRequest(e))}function fe(e){var t,a=m.getCurrentRepresentation();if(!V.get().streaming.gaps.enableSeekFix||!p&&0!==Z.getTime()||(n?n&&a.segmentInfoType===o.Z.SEGMENT_TIMELINE&&(t=v.getValidTimeAheadOfTargetTime(A,i,a,V.get().streaming.gaps.threshold)):t=v.getValidTimeAheadOfTargetTime(A,i,a,V.get().streaming.gaps.threshold),isNaN(t)||t===A)){if(v.isLastSegmentRequested(a,A)){var s=v.getCurrentIndex();return r.debug("Segment requesting for stream ".concat(C.id," has finished")),I.trigger(u.Z.STREAM_REQUESTING_COMPLETED,{segmentIndex:s},{streamId:C.id,mediaType:L}),h.segmentRequestingCompleted(s),void g.clearScheduleTimer()}e&&he()}else Z.isSeeking()||0===Z.getTime()?(r.warn("Adjusting playback time ".concat(t," because of gap in the manifest. Seeking by ").concat(t-A)),Z.seek(t,!1,!1)):(r.warn("Adjusting buffering time ".concat(t," because of gap in the manifest. Adjusting time by ").concat(t-A)),ke(t),e&&he())}function de(){var e,t=Ce();if(isNaN(A)||ie()===a.Z.TEXT&&!K.isTextEnabled())return null;if(v){var r=m&&t?m.getRepresentationForQuality(t.quality):null;e=p?v.getSegmentRequestForTime(i,r,A):y?v.repeatSegmentRequest(i,r):v.getNextSegmentRequest(i,r)}return e}function he(){g.startScheduleTimer(Z.getLowLatencyModeEnabled()?V.get().streaming.scheduling.lowLatencyTimeout:V.get().streaming.scheduling.defaultTimeout)}function ge(e){e.error||h.getIsBufferingCompleted()||h.updateBufferTimestampOffset(e.currentRepresentation)}function me(e){q.addBufferState(L,e.state,g.getBufferTarget()),e.state!==s.Z.BUFFER_EMPTY||Z.isSeeking()||(r.info("Buffer is empty! Stalling!"),q.pushPlayListTraceMetrics(new Date,ee.REBUFFERING_REASON))}function pe(e){F.syncExecutedRequestsWithBufferedRange(h.getBuffer().getAllBufferRanges(),C.duration),e.quotaExceeded&&e.from>Z.getTime()&&ke(e.from),e.hasEnoughSpaceToAppend&&e.quotaExceeded&&g.startScheduleTimer()}function ye(e){if(e&&e.lastRequestAppended&&e.lastRequestAppended.url){var t=e.lastRequestAppended.url;e.lastRequestAppended.range&&(t=t.concat("_",e.lastRequestAppended.range)),r.warn("Blacklisting segment with url ".concat(t)),J.add(t)}}function Ee(e){if(r.debug("Appended bytes for ".concat(e.mediaType," and stream id ").concat(e.streamId)),e.segmentType===D.w.INIT_SEGMENT_TYPE){var t=e.quality;g.setLastInitializedQuality(t),r.info("["+L+"] lastInitializedRepresentationInfo changed to "+e.quality)}b?ve(b):g.startScheduleTimer(0)}function ve(e){var t=F.getRequests({state:_.FRAGMENT_MODEL_LOADING});if(t&&t.length>0)return r.debug("Preparing for default quality switch: Waiting for ongoing segment request to be finished before applying switch."),void(b=e);h.updateBufferTimestampOffset(e).then((function(){g.setCheckPlaybackQuality(!1),i.segmentAlignment||i.subSegmentAlignment?g.startScheduleTimer():Me(),b=null,E=!1})).catch((function(){b=null,E=!1}))}function Te(e){r.info("onFragmentLoadingAbandoned request: "+e.request.url+" has been aborted"),Z.isSeeking()||g.getSwitchTrack()||E||(r.info("onFragmentLoadingAbandoned request: "+e.request.url+" has to be downloaded again, origin is not seeking process or switch track call"),e.request&&e.request.isInitializationRequest()?g.setInitSegmentRequired(!0):ke(e.request.startTime+e.request.duration/2),g.startScheduleTimer(0))}function _e(e){var t;r.info("OnFragmentLoadingCompleted for stream id "+C.id+" and media type "+L+" - Url:",e.request?e.request.url:"undefined",e.request.range?", Range:"+e.request.range:""),ae()&&g.startScheduleTimer(0),e.error&&e.request.serviceLocation&&(t=e,r.info("Fragment loading completed with an error"),t&&t.request&&t.request.type&&(t.request.type===D.w.INIT_SEGMENT_TYPE?le({representationId:t.request.representationId,sender:{}},!1):t.request.type===D.w.MEDIA_SEGMENT_TYPE&&(ke(t.request.startTime+t.request.duration/2),ue({},!1))))}function Se(){ke(Z.getTime()),we().startScheduleTimer()}function Ae(e){var t=e.currentTrackInfo;if(t){var r=c.find((function(e){return e.index===t.index&&e.lang===t.lang}));r&&Ie(r).then((function(){h.setIsBufferingCompleted(!1),ke(Z.getTime()),g.setInitSegmentRequired(!0),g.startScheduleTimer()}))}}function be(e){ke(e.quotaExceededTime),g.clearScheduleTimer()}function Re(){return h?h.getBuffer():null}function Ie(e){e===i||e&&i&&e.type!==i.type||(i=e);var t=P.getRealAdaptation(C,i),r=P.getVoRepresentations(i);if(m){var o,s=m.getData(),l=U.getMaxAllowedIndexFor(L,C.id),u=U.getMinAllowedIndexFor(L,C.id),c=null;return null!==s&&s.id===t.id||L===a.Z.TEXT?o=U.getQualityFor(L,C.id):(c=U.getThroughputHistory().getAverageThroughput(L,n)||U.getInitialBitrateFor(L,C.id),o=U.getQualityForBitrate(i,c,C.id)),void 0!==u&&o<u&&(o=u),o>l&&(o=l),m.updateData(t,r,L,i.isFragmented,o)}return Promise.resolve()}function we(){return g}function Ce(e){var t;return void 0!==e?((0,$.SE)(e),t=m?m.getRepresentationForQuality(e):null):t=m?m.getCurrentRepresentation():null,P.convertRepresentationToRepresentationInfo(t)}function De(){return!!h&&h.getIsBufferingCompleted()}function Le(e){if(V.get().streaming.enableManifestTimescaleMismatchFix){var t=e.chunk,r=t.bytes,n=Ce(t.quality),i=m&&n?m.getRepresentationForQuality(n.quality):null;n&&i&&(i.timescale=Q.getMediaTimescaleFromMoov(r))}}function Ne(e){var t,r,n,i,a=e.chunk,s=a.bytes,l=a.quality,c=Ce(l),f=m&&c?m.getRepresentationForQuality(c.quality):null;if(c&&f){var h;if(V.get().streaming.parseInbandPrft&&e.request.type===D.w.MEDIA_SEGMENT_TYPE){var g=(t=h=h||Q.parse(s),r=f.timescale,n=t.getBoxes("prft"),i=[],n.forEach((function(e){i.push(function(e,t){var r="unknown";switch(e.flags){case 0:r=o.Z.PRODUCER_REFERENCE_TIME_TYPE.ENCODER;break;case 16:r=o.Z.PRODUCER_REFERENCE_TIME_TYPE.APPLICATION;break;case 24:r=o.Z.PRODUCER_REFERENCE_TIME_TYPE.CAPTURED}var n=1e3*e.ntp_timestamp_sec+e.ntp_timestamp_frac/Math.pow(2,32)*1e3;return{type:r,ntpTimestamp:n=ne(R).getInstance().ntpToUTC(n),mediaTime:e.media_time/t}}(e,r))})),i);g&&g.length&&I.trigger(d.Z.INBAND_PRFT,{data:g},{streamId:C.id,mediaType:L})}var p=P.getEventsFor(c.mediaInfo,null,C),y=P.getEventsFor(c,f,C);if(p&&p.length>0||y&&y.length>0){var E=F.getRequests({state:_.FRAGMENT_MODEL_EXECUTED,quality:l,index:a.index})[0],v=function(e,t,r,n){try{for(var i={},a=[],o=r.concat(n),s=0,l=o.length;s<l;s++)i[o[s].schemeIdUri+"/"+o[s].value]=o[s];var u=e.getBoxes("emsg");if(!u||0===u.length)return a;for(var c=e.getBox("sidx"),f=!c||isNaN(c.earliest_presentation_time)||isNaN(c.timescale)?t&&!isNaN(t.mediaStartTime)?t.mediaStartTime:0:c.earliest_presentation_time/c.timescale,d=Math.max(f,0),h=m.getCurrentRepresentation(),g=0,p=u.length;g<p;g++){var y=P.getEvent(u[g],i,d,h);y&&a.push(y)}return a}catch(E){return[]}}(h=h||Q.parse(s),E,p,y);I.trigger(u.Z.INBAND_EVENTS,{events:v},{streamId:C.id})}}}function Oe(){var e=Z.getTime();V.get().streaming.buffer.flushBufferAtTrackSwitch&&Z.seek(e+.001,!1,!0),ke(e),h.setSeekTarget(e),g.startScheduleTimer()}function Me(){var e=Z.getTime(),t=h.getContinuousBufferTimeForTargetTime(e);ke(isNaN(t)?e:t),g.startScheduleTimer()}function Pe(e){e&&!isNaN(e.time)&&(ke(e.time),h.setSeekTarget(e.time))}function ke(e){A=e,p=!0}return t={initialize:function(r,i,s){var l,c;T=(0,te.Z)(R).create({events:u.Z,eventBus:I,streamInfo:C,timelineConverter:M,dashConstants:o.Z,segmentBaseController:e.segmentBaseController,type:L}),v=(0,z.Z)(R).create({streamInfo:C,type:L,timelineConverter:M,dashMetrics:q,mediaPlayerModel:x,baseURLController:e.baseURLController,errHandler:N,segmentsController:T,settings:V,boxParser:Q,events:u.Z,eventBus:I,errors:w,debug:(0,f.Z)(R).getInstance(),requestModifier:(0,W.Z)(R).getInstance(),dashConstants:o.Z,constants:a.Z,urlUtils:(0,X.Z)(R).getInstance()}),n=C.manifestInfo.isDynamic,v.initialize(n),U.registerStreamType(L,t),m=j(R).create({streamInfo:C,type:L,abrController:U,dashMetrics:q,playbackController:Z,timelineConverter:M,dashConstants:o.Z,events:u.Z,eventBus:I,errors:w,isDynamic:n,adapter:P,segmentsController:T}),c=s,(h=(l=L)?l!==a.Z.TEXT||c?B(R).create({streamInfo:C,type:l,mediaPlayerModel:x,manifestModel:k,fragmentModel:F,errHandler:N,mediaController:G,representationController:m,adapter:P,textController:K,abrController:U,playbackController:Z,settings:V}):H(R).create({streamInfo:C,type:l,mimeType:O,fragmentModel:F,textController:K,errHandler:N,settings:V}):(N.error(new S.Z(w.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,w.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+"not properly defined")),null))&&h.initialize(r),(g=Y(R).create({streamInfo:C,type:L,mimeType:O,adapter:P,dashMetrics:q,mediaPlayerModel:x,fragmentModel:F,abrController:U,playbackController:Z,textController:K,mediaController:G,bufferController:h,representationController:m,settings:V})).initialize(i),A=0,p=!1,y=!1},getStreamId:re,getType:ie,isUpdating:function(){return!!m&&m.isUpdating()},getBufferController:function(){return h},dischargePreBuffer:function(){h.dischargePreBuffer()},getFragmentModel:function(){return F},getScheduleController:we,getRepresentationController:function(){return m},getRepresentationInfo:Ce,getBufferLevel:function(){return h?h.getBufferLevel():0},isBufferingCompleted:De,createBufferSinks:function(e){var t=Re();return t?Promise.resolve(t):h?h.createBufferSink(i,e):Promise.resolve(null)},updateStreamInfo:function(e){return C=e,De()?Promise.resolve():h.updateAppendWindow()},getStreamInfo:function(){return C},selectMediaInfo:Ie,clearMediaInfoArray:function(){c=[]},addMediaInfo:function(e){-1===c.indexOf(e)&&c.push(e)},prepareTrackSwitch:function(){return new Promise((function(e){r.debug("Preparing track switch for type ".concat(L));var t=L===a.Z.TEXT||V.get().streaming.trackSwitchMode[L]===a.Z.TRACK_SWITCH_MODE_ALWAYS_REPLACE&&Z.getTimeToStreamEnd(C)>V.get().streaming.buffer.stallThreshold;if(h.getIsBufferingCompleted()&&!t)return h.prepareForNonReplacementTrackSwitch(i.codec).then((function(){I.trigger(u.Z.BUFFERING_COMPLETED,{},{streamId:C.id,mediaType:L})})).catch((function(){I.trigger(u.Z.BUFFERING_COMPLETED,{},{streamId:C.id,mediaType:L})})),void e();g.clearScheduleTimer(),g.setSwitchTrack(!0),t?(I.trigger(u.Z.BUFFER_REPLACEMENT_STARTED,{mediaType:L,streamId:C.id},{mediaType:L,streamId:C.id}),F.abortRequests(),h.prepareForReplacementTrackSwitch(i.codec).then((function(){var e=Ce();return h.updateBufferTimestampOffset(e)})).then((function(){Oe(),e()})).catch((function(){Oe(),e()}))):h.prepareForNonReplacementTrackSwitch(i.codec).then((function(){Me(),e()})).catch((function(){Me(),e()}))}))},prepareQualityChange:function(e){b&&r.warn("Canceling queued representation switch to ".concat(b.quality," for ").concat(L)),r.debug("Preparing quality switch for type ".concat(L));var t=e.newQuality;E=!0,g.clearScheduleTimer(),m.prepareQualityChange(t);var n,i=Ce(t);e.reason&&e.reason.forceReplace?(n=i,F.abortRequests(),I.trigger(u.Z.BUFFER_REPLACEMENT_STARTED,{mediaType:L,streamId:C.id},{mediaType:L,streamId:C.id}),g.setCheckPlaybackQuality(!1),h.prepareForForceReplacementQualitySwitch(n).then((function(){Oe(),b=null,E=!1})).catch((function(){Oe(),b=null,E=!1}))):e&&e.reason&&e.reason.forceAbandon?function(e){h.updateBufferTimestampOffset(e).then((function(){F.abortRequests(),y=!0,g.setCheckPlaybackQuality(!1),g.startScheduleTimer(),E=!1,b=null})).catch((function(){b=null,E=!1}))}(i):V.get().streaming.buffer.fastSwitchEnabled?function(e){var t=Z.getTime(),r=1.5*(isNaN(e.fragmentDuration)?1:e.fragmentDuration),n=F.getRequests({state:_.FRAGMENT_MODEL_EXECUTED,time:t+r,threshold:0})[0];if(n&&!ae()){var i=h.getBufferLevel(),a=U.getAbandonmentStateFor(C.id,L);n.quality<e.quality&&i>=r&&a!==s.Z.ABANDON_LOAD?h.updateBufferTimestampOffset(e).then((function(){F.abortRequests(),ke(t+r),g.setCheckPlaybackQuality(!1),g.startScheduleTimer(),E=!1})).catch((function(){E=!1})):ve(e)}else ve(e)}(i):ve(i),q.pushPlayListTraceMetrics(new Date,ee.REPRESENTATION_SWITCH_STOP_REASON),q.createPlaylistTraceMetrics(i.id,1e3*Z.getTime(),Z.getPlaybackRate())},getMediaInfo:function(){return i},getMediaSource:function(){return h.getMediaSource()},setMediaSource:function(e){return h.setMediaSource(e,i)},getBuffer:Re,setExplicitBufferingTime:ke,finalisePlayList:function(e,t){q.pushPlayListTraceMetrics(e,t)},probeNextRequest:function(){var e=Ce(),t=m&&e?m.getRepresentationForQuality(e.quality):null;return v.getNextSegmentRequestIdempotent(i,t)},prepareInnerPeriodPlaybackSeeking:function(e){return new Promise((function(t){if(h.hasBufferAtTime(e.seekTime))return h.pruneBuffer(),se(h.getContinuousBufferTimeForTargetTime(e.seekTime))&&h.setIsBufferingCompleted(!0),void t();g.clearScheduleTimer(),F.abortRequests(),h.prepareForPlaybackSeek().then((function(){var t=h.getAllRangesWithSafetyFactor(e.seekTime);return h.clearBuffers(t)})).then((function(){var r=h.getContinuousBufferTimeForTargetTime(e.seekTime);if(se(r))h.setIsBufferingCompleted(!0),t();else{var n=isNaN(r)?e.seekTime:r;ke(n),h.setSeekTarget(n);var i=[];i.push(h.updateAppendWindow());var a=Ce();i.push(h.updateBufferTimestampOffset(a)),Promise.all(i).then((function(){g.setInitSegmentRequired(!0),g.setCheckPlaybackQuality(!1),g.startScheduleTimer(),t()}))}})).catch((function(e){r.error(e)}))}))},prepareOuterPeriodPlaybackSeeking:function(){return new Promise((function(e,t){try{g.clearScheduleTimer(),F.abortRequests(),h.prepareForPlaybackSeek().then((function(){return h.pruneAllSafely()})).then((function(){e()}))}catch(r){t(r)}}))},reset:function(e,r){v&&v.reset(),h&&(h.reset(e,r),h=null),g&&(g.reset(),g=null),m&&(m.reset(),m=null),T&&(T=null),U&&U.unRegisterStreamType(re(),L),I.off(u.Z.DATA_UPDATE_COMPLETED,ge,t),I.off(u.Z.INIT_FRAGMENT_NEEDED,le,t),I.off(u.Z.MEDIA_FRAGMENT_NEEDED,ue,t),I.off(u.Z.INIT_FRAGMENT_LOADED,Le,t),I.off(u.Z.MEDIA_FRAGMENT_LOADED,Ne,t),I.off(u.Z.BUFFER_LEVEL_STATE_CHANGED,me,t),I.off(u.Z.BUFFER_CLEARED,pe,t),I.off(u.Z.SEEK_TARGET,Pe,t),I.off(u.Z.FRAGMENT_LOADING_ABANDONED,Te,t),I.off(u.Z.FRAGMENT_LOADING_COMPLETED,_e,t),I.off(u.Z.SET_FRAGMENTED_TEXT_AFTER_DISABLED,Se,t),I.off(u.Z.SET_NON_FRAGMENTED_TEXT,Ae,t),I.off(u.Z.QUOTA_EXCEEDED,be,t),I.off(u.Z.SOURCE_BUFFER_ERROR,ye,t),I.off(u.Z.BYTES_APPENDED_END_FRAGMENT,Ee,t),oe(),L=null,C=null}},r=(0,f.Z)(R).getInstance().getLogger(t),oe(),I.on(u.Z.DATA_UPDATE_COMPLETED,ge,t,{priority:l.Z.EVENT_PRIORITY_HIGH}),I.on(u.Z.INIT_FRAGMENT_NEEDED,le,t),I.on(u.Z.MEDIA_FRAGMENT_NEEDED,ue,t),I.on(u.Z.INIT_FRAGMENT_LOADED,Le,t),I.on(u.Z.MEDIA_FRAGMENT_LOADED,Ne,t),I.on(u.Z.BUFFER_LEVEL_STATE_CHANGED,me,t),I.on(u.Z.BUFFER_CLEARED,pe,t),I.on(u.Z.SEEK_TARGET,Pe,t),I.on(u.Z.FRAGMENT_LOADING_ABANDONED,Te,t),I.on(u.Z.FRAGMENT_LOADING_COMPLETED,_e,t),I.on(u.Z.QUOTA_EXCEEDED,be,t),I.on(u.Z.SET_FRAGMENTED_TEXT_AFTER_DISABLED,Se,t),I.on(u.Z.SET_NON_FRAGMENTED_TEXT,Ae,t),I.on(u.Z.SOURCE_BUFFER_ERROR,ye,t),I.on(u.Z.BYTES_APPENDED_END_FRAGMENT,Ee,t),t}ie.__dashjs_factory_name="StreamProcessor";var ae=c.Z.getClassFactory(ie),oe=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.streamId=null,this.mediaInfo=null,this.segmentType=null,this.quality=NaN,this.index=NaN,this.bytes=null,this.start=NaN,this.end=NaN,this.duration=NaN,this.representationId=null,this.endFragment=null},se=r(9032);function le(e,t){if(e){if("string"==typeof e)return ue(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ue(e,t):void 0}}function ue(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ce(e){e=e||{};var t,r=this.context,n=e.requestModifier,i=e.lowLatencyThroughputModel,o=e.boxParser,s=(0,C.Z)(r).getInstance();function l(e){var r,l=new Date,f=e.request,d=new Headers;if(f.range&&d.append("Range","bytes="+f.range),e.headers)for(var h in e.headers){var g=e.headers[h];g&&d.append(h,g)}f.requestStartDate||(f.requestStartDate=l),n&&n.modifyRequestHeader&&n.modifyRequestHeader({setRequestHeader:function(e,t){d.append(e,t)}},{url:e.url}),"function"==typeof window.AbortController&&(r=new AbortController,e.abortController=r,r.signal.onabort=e.onabort);var m={method:e.method,headers:d,credentials:e.withCredentials?"include":void 0,signal:r?r.signal:void 0},p=s.get().streaming.abr.fetchThroughputCalculationMode,y=Date.now(),E=0;new Promise((function(e){if(p===a.Z.ABR_FETCH_THROUGHPUT_CALCULATION_AAST&&i&&(E=i.getThroughputCapacityDelayMS(f,1e3*t.getCurrentBufferLevel(f.mediaType))))return setTimeout(e,E);e()})).then((function(){var r=Date.now();fetch(e.url,m).then((function(n){e.response||(e.response={}),e.response.status=n.status,e.response.statusText=n.statusText,e.response.responseURL=n.url,n.ok||e.onerror();var s,l="",d=function(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=le(e))){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(n.headers.keys());try{for(d.s();!(s=d.n()).done;){var h=s.value;l+=h+": "+n.headers.get(h)+"\r\n"}}catch(k){d.e(k)}finally{d.f()}if(e.response.responseHeaders=l,!n.body)return n.arrayBuffer().then((function(t){e.response.response=t;var r={loaded:t.byteLength,total:t.byteLength,stream:!1};e.progress(r),e.onload(),e.onend()}));var g,m,v,T,_=parseInt(n.headers.get("Content-Length"),10),S=0,A=!1,b=new Uint8Array,R=0;if(p===a.Z.ABR_FETCH_THROUGHPUT_CALCULATION_AAST&&i){var I=r,w=0,C=(T=2,function(e){if(Array.isArray(e))return e}(v=n.body.tee())||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(l){i=!0,a=l}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return r}}(v,T)||le(v,T)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),D=C[0],L=C[1];g=D.getReader(),m=[],g.read().then((function n(a){var o=a.value,s=a.done;if(w=Date.now(),o&&o.length){var u=w-I,c=o.length;m.push({chunkDownloadTimeRelativeMS:w-r,chunkDownloadDurationMS:u,chunkBytes:c,kbps:Math.round(8*c/(u/1e3)),bufferLevel:t.getCurrentBufferLevel(f.mediaType)})}if(s){var d=w-r,h=m.reduce((function(e,t){return e+t.chunkBytes}),0);return i.addMeasurement(f,d,m,y,E,l),void e.progress({loaded:h,total:h,lengthComputable:!0,time:i.getEstimatedDownloadDurationMS(f),stream:!0})}return I=Date.now(),g.read().then(n)})),e.reader=L.getReader()}else e.reader=n.body.getReader();var N=[],O=[],M=[],P=!0;u(e,(function t(r){var n=r.value;if(r.done){if(b){if(p!==a.Z.ABR_FETCH_THROUGHPUT_CALCULATION_AAST){var i=null,s=null;p===a.Z.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING?(i=function(e,t){try{var r,n;r=e.filter((function(t,r){return r<e.length-1})),n=t.filter((function(e,r){return r<t.length-1}));var i=[];if(r.length>1){for(var a=0,o=0,s=0;s<r.length;s++)if(r[s]&&n[s]){var l=n[s].ts-r[s].ts;if(l>1)i.push(8*n[s].bytes/l),o=0;else{0===o&&(o=r[s].ts,a=0);var u=n[s].ts-o;u>1?(a+=n[s].bytes,i.push(8*a/u),o=0):a+=n[s].bytes}}if(i.length>0)return i.reduce((function(e,t){return e+t}),0)/i.length}return null}catch(c){return null}}(O,M))&&(s=8*S/i):p===a.Z.ABR_FETCH_THROUGHPUT_CALCULATION_DOWNLOADED_DATA&&(s=c(N,S)),e.progress({loaded:S,total:isNaN(_)?S:_,lengthComputable:!0,time:s,stream:!0})}e.response.response=b.buffer}return e.onload(),void e.onend()}if(n&&n.length>0){b=function(e,t){if(0===e.length)return t;var r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}(b,n),S+=n.length,N.push({ts:Date.now(),bytes:n.length}),p===a.Z.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING&&P&&o.findLastTopIsoBoxCompleted(["moof"],b,R).found&&(P=!1,O.push({ts:performance.now(),bytes:n.length}));var l=o.findLastTopIsoBoxCompleted(["moov","mdat"],b,R);if(l.found){var f,d=l.lastCompletedOffset+l.size;p!==a.Z.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING||P||(P=!0,M.push({ts:performance.now(),bytes:b.length})),d===b.length?(f=b,b=new Uint8Array):(f=new Uint8Array(b.subarray(0,d)),b=b.subarray(d)),e.progress({data:f.buffer,lengthComputable:!1,noTrace:!0}),R=0}else R=l.lastCompletedOffset,A||(e.progress({lengthComputable:!1,noTrace:!0}),A=!0)}u(e,t)}))})).catch((function(t){e.onerror&&e.onerror(t)}))}))}function u(e,t){e.reader.read().then(t).catch((function(t){e.onerror&&200===e.response.status&&e.onerror(t)}))}function c(e,t){try{if((e=e.filter((function(r){return r.bytes>t/4/e.length}))).length>1){var r=0,n=(e[e.length-1].ts-e[0].ts)/e.length;return e.forEach((function(t,i){var a=e[i+1];if(a){var o=a.ts-t.ts;r+=o<n?o:0}})),r}return null}catch(i){return null}}return{load:function(e){n&&n.modifyRequest?(0,W.k)(e,n).then((function(){return l(e)})):l(e)},abort:function(e){if(e.abortController)e.abortController.abort();else if(e.reader)try{e.reader.cancel(),e.onabort()}catch(t){}},calculateDownloadedTime:c,setup:function(e){t=e.dashMetrics}}}ce.__dashjs_factory_name="FetchLoader";var fe=c.Z.getClassFactory(ce),de=r(1180);function he(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ge=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.index=-1,this.adaptation=null,this.segmentInfoType=null,this.initialization=null,this.codecs=null,this.mimeType=null,this.codecPrivateData=null,this.segmentDuration=NaN,this.timescale=1,this.startNumber=1,this.indexRange=null,this.range=null,this.presentationTimeOffset=0,this.MSETimeOffset=NaN,this.mediaFinishedInformation={numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN},this.bandwidth=NaN,this.width=NaN,this.height=NaN,this.scanType=null,this.maxPlayoutRate=NaN,this.availabilityTimeOffset=0,this.availabilityTimeComplete=!0,this.frameRate=null}var t;return(t=[{key:"hasInitialization",value:function(){return null!==this.initialization||null!==this.range}},{key:"hasSegments",value:function(){return this.segmentInfoType!==o.Z.BASE_URL&&this.segmentInfoType!==o.Z.SEGMENT_BASE&&!this.indexRange}}])&&he(e.prototype,t),e}(),me=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.period=null,this.index=-1,this.type=null},pe=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.index=-1,this.duration=NaN,this.start=NaN,this.mpd=null,this.nextPeriodId=null};pe.DEFAULT_ID="defaultId";var ye=pe,Ee=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.manifest=null,this.suggestedPresentationDelay=0,this.availabilityStartTime=null,this.availabilityEndTime=Number.POSITIVE_INFINITY,this.timeShiftBufferDepth=Number.POSITIVE_INFINITY,this.maxSegmentDuration=Number.POSITIVE_INFINITY,this.publishTime=null,this.minimumUpdatePeriod=NaN,this.mediaPresentationDuration=NaN},ve=r(2610),Te=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type="",this.duration=NaN,this.presentationTime=NaN,this.id=NaN,this.messageData="",this.eventStream=null,this.presentationTimeDelta=NaN},_e=function e(t,r,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t||"",this.serviceLocation=r||t||"",this.dvbPriority=n||1,this.dvbWeight=i||1,this.availabilityTimeOffset=0,this.availabilityTimeComplete=!0,this.queryParams={}};_e.DEFAULT_DVB_PRIORITY=1,_e.DEFAULT_DVB_WEIGHT=1;var Se=_e,Ae=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.adaptionSet=null,this.representation=null,this.period=null,this.timescale=1,this.value="",this.schemeIdUri="",this.presentationTimeOffset=0},be=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.inband=!1,this.type="encoder",this.applicationScheme=null,this.wallClockTime=null,this.presentationTime=NaN,this.UTCTiming=null},Re=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.defaultServiceLocation=null,this.defaultServiceLocationArray=[],this.queryBeforeStart=!1,this.serverUrl=null,this.clientRequirement=!0};function Ie(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var we=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.schemeIdUri=null,this.value=null,this.id=null}var t;return(t=[{key:"init",value:function(e){return e&&(this.schemeIdUri=e.schemeIdUri?e.schemeIdUri:null,this.value=e.value?e.value:null,this.id=e.id?e.id:null,e[o.Z.DVB_URL]&&(this.dvbUrl=e[o.Z.DVB_URL]),e[o.Z.DVB_MIMETYPE]&&(this.dvbMimeType=e[o.Z.DVB_MIMETYPE]),e[o.Z.DVB_FONTFAMILY]&&(this.dvbFontFamily=e[o.Z.DVB_FONTFAMILY])),this}}])&&Ie(e.prototype,t),e}(),Ce=r(3101),De=r.n(Ce);function Le(){return{areEqual:function(e,t){return De()(e,t)}}}Le.__dashjs_factory_name="ObjectUtils";var Ne=c.Z.getSingletonFactory(Le),Oe=r(7803),Me=function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t||"",this.serviceLocation=r||null,this.queryParams={}},Pe=function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t||"",this.serviceLocation=r||null,this.ttl=n||NaN,this.queryParams={}};function ke(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function xe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ke(Object(r),!0).forEach((function(t){Fe(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ke(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Fe(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ue(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=Be(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function Be(e,t){if(e){if("string"==typeof e)return Ze(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ze(e,t):void 0}}function Ze(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Ge(){var e,t,r,n,i=this.context,s=(0,X.Z)(i).getInstance(),l=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e};function u(e,t){if(!e)throw new Error("adaptation is not defined");if(!t)throw new Error("type is not defined");if(e.Representation_asArray&&e.Representation_asArray.length){var r=v(e.Representation_asArray[0]);if(r&&r.length>0&&Oe.Y.indexOf(r[0].schemeIdUri)>=0)return t===a.Z.IMAGE}if(e.ContentComponent_asArray&&e.ContentComponent_asArray.length>0){if(e.ContentComponent_asArray.length>1)return t===a.Z.MUXED;if(e.ContentComponent_asArray[0].contentType===t)return!0}var n=t===a.Z.TEXT?new RegExp("(ttml|vtt|wvtt|stpp)"):new RegExp(t);if(e.Representation_asArray&&e.Representation_asArray.length){var i=e.Representation_asArray[0].codecs;if(n.test(i))return!0}if(e.hasOwnProperty(o.Z.MIME_TYPE))return n.test(e.mimeType);if(e.Representation_asArray)for(var s,l=0;l<e.Representation_asArray.length;l++)if((s=e.Representation_asArray[l]).hasOwnProperty(o.Z.MIME_TYPE))return n.test(s.mimeType);return!1}function c(e){if(!e)throw new Error("adaptation is not defined");if(e.hasOwnProperty(o.Z.SEGMENT_TEMPLATE)||e.hasOwnProperty(o.Z.SEGMENT_TIMELINE)||e.hasOwnProperty(o.Z.SEGMENT_LIST)||e.hasOwnProperty(o.Z.SEGMENT_BASE))return!0;if(e.Representation_asArray&&e.Representation_asArray.length>0){var t=e.Representation_asArray[0];if(t.hasOwnProperty(o.Z.SEGMENT_TEMPLATE)||t.hasOwnProperty(o.Z.SEGMENT_TIMELINE)||t.hasOwnProperty(o.Z.SEGMENT_LIST)||t.hasOwnProperty(o.Z.SEGMENT_BASE))return!0}return!1}function d(e){return u(e,a.Z.VIDEO)}function h(e){return u(e,a.Z.TEXT)}function g(e){return u(e,a.Z.IMAGE)}function m(e){return e&&Array.isArray(e.Representation_asArray)&&e.Representation_asArray.sort((function(e,t){return e.bandwidth-t.bandwidth})),e}function p(e,t){return e&&e.Period_asArray&&l(t)&&e.Period_asArray[t]?e.Period_asArray[t].AdaptationSet_asArray:[]}function y(e){return e&&e.Period_asArray?e.Period_asArray:[]}function E(e){var t=!1;return e&&e.hasOwnProperty("type")&&(t=e.type===o.Z.DYNAMIC),t}function v(e){return e&&e.EssentialProperty_asArray&&e.EssentialProperty_asArray.length?e.EssentialProperty_asArray.map((function(e){return{schemeIdUri:e.schemeIdUri,value:e.value}})):null}function T(e){if(!e||!e.S_asArray)return NaN;var t=e.S_asArray[0],r=e.S_asArray[1];return t.hasOwnProperty("d")?t.d:r.t-t.t}function _(e,t){if(!e)throw new Error("Period cannot be null or undefined");var r=ye.DEFAULT_ID+"_"+t;return e.hasOwnProperty(o.Z.ID)&&e.id.length>0&&"__proto__"!==e.id&&(r=e.id),r}function A(e,t,r){var n,i=[];if(!e)return i;for(n=0;n<e.length;n++){var s=new Ae;if(s.timescale=1,s.representation=t,!e[n].hasOwnProperty(a.Z.SCHEME_ID_URI))throw new Error("Invalid EventStream. SchemeIdUri has to be set");s.schemeIdUri=e[n].schemeIdUri,e[n].hasOwnProperty(o.Z.TIMESCALE)&&(s.timescale=e[n].timescale),e[n].hasOwnProperty(o.Z.VALUE)&&(s.value=e[n].value),i.push(s),s.period=r}return i}function b(e){var t=[],r=e.BaseURL_asArray||[e.baseUri],n=!1;return r.some((function(r){if(r){var i=new Se,a=r.__text||r;return s.isRelative(a)&&(n=!0,e.baseUri&&(a=s.resolve(a,e.baseUri))),i.url=a,r.hasOwnProperty(o.Z.SERVICE_LOCATION)&&r.serviceLocation.length?i.serviceLocation=r.serviceLocation:i.serviceLocation=a,r.hasOwnProperty(o.Z.DVB_PRIORITY)&&(i.dvbPriority=r[o.Z.DVB_PRIORITY]),r.hasOwnProperty(o.Z.DVB_WEIGHT)&&(i.dvbWeight=r[o.Z.DVB_WEIGHT]),r.hasOwnProperty(o.Z.AVAILABILITY_TIME_OFFSET)&&(i.availabilityTimeOffset=r[o.Z.AVAILABILITY_TIME_OFFSET]),r.hasOwnProperty(o.Z.AVAILABILITY_TIME_COMPLETE)&&(i.availabilityTimeComplete="false"!==r[o.Z.AVAILABILITY_TIME_COMPLETE]),t.push(i),n}})),t}function R(e){var t=new Re;return t.serverUrl=e.__text,e.hasOwnProperty(o.Z.DEFAULT_SERVICE_LOCATION)&&(t.defaultServiceLocation=e[o.Z.DEFAULT_SERVICE_LOCATION],t.defaultServiceLocationArray=t.defaultServiceLocation.split(" ")),e.hasOwnProperty(o.Z.QUERY_BEFORE_START)&&(t.queryBeforeStart="true"===e[o.Z.QUERY_BEFORE_START].toLowerCase()),e.hasOwnProperty(o.Z.CLIENT_REQUIREMENT)&&(t.clientRequirement="false"!==e[o.Z.CLIENT_REQUIREMENT].toLowerCase()),t}return e={getIsTypeOf:u,getIsText:h,getIsFragmented:c,getProducerReferenceTimesForAdaptation:function(e){var t=e&&e.hasOwnProperty(o.Z.PRODUCERREFERENCETIME_ASARRAY)?e[o.Z.PRODUCERREFERENCETIME_ASARRAY]:[];(e&&e.hasOwnProperty(o.Z.REPRESENTATION_ASARRAY)?e[o.Z.REPRESENTATION_ASARRAY]:[]).forEach((function(e){var r;e.hasOwnProperty(o.Z.PRODUCERREFERENCETIME_ASARRAY)&&t.push.apply(t,function(e){if(Array.isArray(e))return Ze(e)}(r=e[o.Z.PRODUCERREFERENCETIME_ASARRAY])||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(r)||Be(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}));var r=[];return t.forEach((function(e){var t=new be;e.hasOwnProperty(o.Z.ID)&&(t[o.Z.ID]=e[o.Z.ID],e.hasOwnProperty(o.Z.WALL_CLOCK_TIME)&&(t[o.Z.WALL_CLOCK_TIME]=e[o.Z.WALL_CLOCK_TIME],e.hasOwnProperty(o.Z.PRESENTATION_TIME)&&(t[o.Z.PRESENTATION_TIME]=e[o.Z.PRESENTATION_TIME],e.hasOwnProperty(o.Z.INBAND)&&(t[o.Z.INBAND]="false"!==e[o.Z.INBAND]),e.hasOwnProperty(o.Z.TYPE)&&(t[o.Z.TYPE]=e[o.Z.TYPE]),r.push(t))))})),r},getLanguageForAdaptation:function(e){var t="";return e&&e.hasOwnProperty(o.Z.LANG)&&(t=e.lang),t},getViewpointForAdaptation:function(e){return e&&e.hasOwnProperty(o.Z.VIEWPOINT_ASARRAY)&&e[o.Z.VIEWPOINT_ASARRAY].length?e[o.Z.VIEWPOINT_ASARRAY].map((function(e){return(new we).init(e)})):[]},getRolesForAdaptation:function(e){return e&&e.hasOwnProperty(o.Z.ROLE_ASARRAY)&&e[o.Z.ROLE_ASARRAY].length?e[o.Z.ROLE_ASARRAY].map((function(e){return(new we).init(e)})):[]},getAccessibilityForAdaptation:function(e){return e&&e.hasOwnProperty(o.Z.ACCESSIBILITY_ASARRAY)&&e[o.Z.ACCESSIBILITY_ASARRAY].length?e[o.Z.ACCESSIBILITY_ASARRAY].map((function(e){return(new we).init(e)})):[]},getAudioChannelConfigurationForAdaptation:function(e){return e&&e.hasOwnProperty(o.Z.AUDIOCHANNELCONFIGURATION_ASARRAY)&&e[o.Z.AUDIOCHANNELCONFIGURATION_ASARRAY].length?e[o.Z.AUDIOCHANNELCONFIGURATION_ASARRAY].map((function(e){return(new we).init(e)})):[]},getAudioChannelConfigurationForRepresentation:function(e){return e&&e.hasOwnProperty(o.Z.AUDIOCHANNELCONFIGURATION_ASARRAY)&&e[o.Z.AUDIOCHANNELCONFIGURATION_ASARRAY].length?e[o.Z.AUDIOCHANNELCONFIGURATION_ASARRAY].map((function(e){return(new we).init(e)})):[]},getAdaptationForIndex:function(e,t,r){var n=p(t,r);return n.length>0&&l(e)?n[e]:null},getIndexForAdaptation:function(e,t,r){if(!e)return-1;for(var n=p(t,r),a=0;a<n.length;a++)if(Ne(i).getInstance().areEqual(n[a],e))return a;return-1},getAdaptationForId:function(e,t,r){var n,i,a=p(t,r);for(n=0,i=a.length;n<i;n++)if(a[n].hasOwnProperty(o.Z.ID)&&a[n].id===e)return a[n];return null},getAdaptationsForType:function(e,t,r){var n,i,a=p(e,t),o=[];for(n=0,i=a.length;n<i;n++)u(a[n],r)&&o.push(m(a[n]));return o},getRealPeriods:y,getRealPeriodForIndex:function(e,t){var r=y(t);return r.length>0&&l(e)?r[e]:null},getCodec:function(e,t,r){var n=null;if(e&&e.Representation_asArray&&e.Representation_asArray.length>0){var i=l(t)&&t>=0&&t<e.Representation_asArray.length?e.Representation_asArray[t]:e.Representation_asArray[0];i&&(n=i.mimeType+';codecs="'+i.codecs+'"',r&&void 0!==i.width&&(n+=';width="'+i.width+'";height="'+i.height+'"'))}return n&&(n=n.replace(/\sprofiles=[^;]*/g,"")),n},getSelectionPriority:function(e){try{var t=e&&void 0!==e.selectionPriority?parseInt(e.selectionPriority):1;return isNaN(t)?1:t}catch(r){return 1}},getMimeType:function(e){return e&&e.Representation_asArray&&e.Representation_asArray.length>0?e.Representation_asArray[0].mimeType:null},getKID:function(e){return e&&e.hasOwnProperty(o.Z.CENC_DEFAULT_KID)?e[o.Z.CENC_DEFAULT_KID]:null},getLabelsForAdaptation:function(e){if(!e||!Array.isArray(e.Label_asArray))return[];for(var t=[],r=0;r<e.Label_asArray.length;r++)t.push({lang:e.Label_asArray[r].lang,text:e.Label_asArray[r].__text||e.Label_asArray[r]});return t},getContentProtectionData:function(e){return e&&e.hasOwnProperty(o.Z.CONTENTPROTECTION_ASARRAY)&&0!==e.ContentProtection_asArray.length?e.ContentProtection_asArray:null},getIsDynamic:E,getId:function(e){return e&&e[o.Z.ID]||null},hasProfile:function(e,t){var r=!1;return e&&e.profiles&&e.profiles.length>0&&(r=-1!==e.profiles.indexOf(t)),r},getDuration:function(e){return e&&e.hasOwnProperty(o.Z.MEDIA_PRESENTATION_DURATION)?e.mediaPresentationDuration:e&&"dynamic"==e.type?Number.POSITIVE_INFINITY:Number.MAX_SAFE_INTEGER||Number.MAX_VALUE},getBandwidth:function(e){return e&&e.bandwidth?e.bandwidth:NaN},getManifestUpdatePeriod:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=NaN;return e&&e.hasOwnProperty(o.Z.MINIMUM_UPDATE_PERIOD)&&(r=e.minimumUpdatePeriod),isNaN(r)?r:Math.max(r-t,1)},getPublishTime:function(e){return e&&e.hasOwnProperty(o.Z.PUBLISH_TIME)?new Date(e[o.Z.PUBLISH_TIME]):null},getRepresentationCount:function(e){return e&&Array.isArray(e.Representation_asArray)?e.Representation_asArray.length:0},getBitrateListForAdaptation:function(e){var t=m(e);return(t&&Array.isArray(t.Representation_asArray)?t.Representation_asArray:[]).map((function(e){return{bandwidth:e.bandwidth,width:e.width||0,height:e.height||0,scanType:e.scanType||null,id:e.id||null}}))},getRepresentationFor:function(e,t){return t&&t.Representation_asArray&&t.Representation_asArray.length>0&&l(e)?t.Representation_asArray[e]:null},getRepresentationsForAdaptation:function(e){var t,r,n,i,a=[],s=function(e){if(e&&e.period&&l(e.period.index)){var t=e.period.mpd.manifest.Period_asArray[e.period.index];if(t&&t.AdaptationSet_asArray&&l(e.index))return m(t.AdaptationSet_asArray[e.index])}}(e);if(s&&s.Representation_asArray){if(e&&e.period&&l(e.period.index)){var u=b(e.period.mpd.manifest);u&&(r=u[0])}for(var f=0,d=s.Representation_asArray.length;f<d;++f){var g=s.Representation_asArray[f],p=new ge;if(p.index=f,p.adaptation=e,g.hasOwnProperty(o.Z.ID)&&(p.id=g.id),g.hasOwnProperty(o.Z.CODECS)&&(p.codecs=g.codecs),g.hasOwnProperty(o.Z.MIME_TYPE)&&(p.mimeType=g[o.Z.MIME_TYPE]),g.hasOwnProperty(o.Z.CODEC_PRIVATE_DATA)&&(p.codecPrivateData=g.codecPrivateData),g.hasOwnProperty(o.Z.BANDWITH)&&(p.bandwidth=g.bandwidth),g.hasOwnProperty(o.Z.WIDTH)&&(p.width=g.width),g.hasOwnProperty(o.Z.HEIGHT)&&(p.height=g.height),g.hasOwnProperty(o.Z.SCAN_TYPE)&&(p.scanType=g.scanType),g.hasOwnProperty(o.Z.MAX_PLAYOUT_RATE)&&(p.maxPlayoutRate=g.maxPlayoutRate),g.hasOwnProperty(o.Z.SEGMENT_BASE)?(t=g.SegmentBase,p.segmentInfoType=o.Z.SEGMENT_BASE):g.hasOwnProperty(o.Z.SEGMENT_LIST)?(t=g.SegmentList).hasOwnProperty(o.Z.SEGMENT_TIMELINE)?p.segmentInfoType=o.Z.SEGMENT_TIMELINE:p.segmentInfoType=o.Z.SEGMENT_LIST:g.hasOwnProperty(o.Z.SEGMENT_TEMPLATE)?((t=g.SegmentTemplate).hasOwnProperty(o.Z.SEGMENT_TIMELINE)?p.segmentInfoType=o.Z.SEGMENT_TIMELINE:p.segmentInfoType=o.Z.SEGMENT_TEMPLATE,t.hasOwnProperty(o.Z.INITIALIZATION_MINUS)&&(p.initialization=t.initialization.split("$Bandwidth$").join(g.bandwidth).split("$RepresentationID$").join(g.id))):p.segmentInfoType=o.Z.BASE_URL,p.essentialProperties=v(g),t){if(t.hasOwnProperty(o.Z.INITIALIZATION)){var y=t.Initialization;y.hasOwnProperty(o.Z.SOURCE_URL)&&(p.initialization=y.sourceURL),y.hasOwnProperty(o.Z.RANGE)&&(p.range=y.range)}else h(s)&&c(s)&&s.mimeType&&-1===s.mimeType.indexOf("application/mp4")&&(p.range=0);t.hasOwnProperty(o.Z.TIMESCALE)&&(p.timescale=t.timescale),t.hasOwnProperty(o.Z.DURATION)?p.segmentDuration=t.duration/p.timescale:g.hasOwnProperty(o.Z.SEGMENT_TEMPLATE)&&(t=g.SegmentTemplate).hasOwnProperty(o.Z.SEGMENT_TIMELINE)&&(p.segmentDuration=T(t.SegmentTimeline)/p.timescale),t.hasOwnProperty(o.Z.MEDIA)&&(p.media=t.media),t.hasOwnProperty(o.Z.START_NUMBER)&&(p.startNumber=t.startNumber),t.hasOwnProperty(o.Z.INDEX_RANGE)&&(p.indexRange=t.indexRange),t.hasOwnProperty(o.Z.PRESENTATION_TIME_OFFSET)&&(p.presentationTimeOffset=t.presentationTimeOffset/p.timescale),t.hasOwnProperty(o.Z.AVAILABILITY_TIME_OFFSET)?p.availabilityTimeOffset=t.availabilityTimeOffset:r&&void 0!==r.availabilityTimeOffset&&(p.availabilityTimeOffset=r.availabilityTimeOffset),t.hasOwnProperty(o.Z.AVAILABILITY_TIME_COMPLETE)?p.availabilityTimeComplete="false"!==t.availabilityTimeComplete:r&&void 0!==r.availabilityTimeComplete&&(p.availabilityTimeComplete=r.availabilityTimeComplete)}p.MSETimeOffset=(i=(n=p).presentationTimeOffset,n.adaptation.period.start-i),p.path=[e.period.index,e.index,f],a.push(p)}}return a},getAdaptationsForPeriod:function(e){var r,n,i,s=e&&l(e.index)?e.mpd.manifest.Period_asArray[e.index]:null,c=[];if(s&&s.AdaptationSet_asArray)for(i=0;i<s.AdaptationSet_asArray.length;i++)n=s.AdaptationSet_asArray[i],r=new me,n.hasOwnProperty(o.Z.ID)&&(r.id=n.id),r.index=i,r.period=e,u(n,a.Z.MUXED)?r.type=a.Z.MUXED:u(n,a.Z.AUDIO)?r.type=a.Z.AUDIO:d(n)?r.type=a.Z.VIDEO:h(n)?r.type=a.Z.TEXT:g(n)?r.type=a.Z.IMAGE:t.warn("Unknown Adaptation stream type"),c.push(r);return c},getRegularPeriods:function(e){var n,i,s=!!e&&E(e.manifest),l=[],u=null,c=null,f=null,d=null;for(i=0,n=e&&e.manifest&&e.manifest.Period_asArray?e.manifest.Period_asArray.length:0;i<n;i++)(c=e.manifest.Period_asArray[i]).hasOwnProperty(o.Z.START)?(d=new ye).start=c.start:null!==u&&u.hasOwnProperty(o.Z.DURATION)&&null!==f?(d=new ye).start=parseFloat((f.start+f.duration).toFixed(5)):0!==i||s||((d=new ye).start=0),null!==f&&isNaN(f.duration)&&(null!==d?f.duration=parseFloat((d.start-f.start).toFixed(5)):t.warn("First period duration could not be calculated because lack of start and duration period properties. This will cause timing issues during playback")),null!==d&&(d.id=_(c,i),d.index=i,d.mpd=e,c.hasOwnProperty(o.Z.DURATION)&&(d.duration=c.duration),f&&(f.nextPeriodId=d.id),l.push(d),u=c,f=d),c=null,d=null;return 0===l.length||null!==f&&isNaN(f.duration)&&(f.duration=parseFloat((function(e){!function(){if(!r||!r.hasOwnProperty("error"))throw new Error(a.Z.MISSING_CONFIG_ERROR)}();var t,n=E(e.mpd.manifest);return e.mpd.manifest.mediaPresentationDuration?t=e.mpd.manifest.mediaPresentationDuration:e.duration?t=e.duration:n?t=Number.POSITIVE_INFINITY:r.error(new S.Z(w.MANIFEST_ERROR_ID_PARSE_CODE,"Must have @mediaPresentationDuration on MPD or an explicit @duration on the last period.",e)),t}(f)-f.start).toFixed(5))),l},getMpd:function(e){var t=new Ee;return e&&(t.manifest=e,e.hasOwnProperty(o.Z.AVAILABILITY_START_TIME)?t.availabilityStartTime=new Date(e.availabilityStartTime.getTime()):e.loadedTime&&(t.availabilityStartTime=new Date(e.loadedTime.getTime())),e.hasOwnProperty(o.Z.AVAILABILITY_END_TIME)&&(t.availabilityEndTime=new Date(e.availabilityEndTime.getTime())),e.hasOwnProperty(o.Z.MINIMUM_UPDATE_PERIOD)&&(t.minimumUpdatePeriod=e.minimumUpdatePeriod),e.hasOwnProperty(o.Z.MEDIA_PRESENTATION_DURATION)&&(t.mediaPresentationDuration=e.mediaPresentationDuration),e.hasOwnProperty(o.Z.SUGGESTED_PRESENTATION_DELAY)&&(t.suggestedPresentationDelay=e.suggestedPresentationDelay),e.hasOwnProperty(o.Z.TIMESHIFT_BUFFER_DEPTH)&&(t.timeShiftBufferDepth=e.timeShiftBufferDepth),e.hasOwnProperty(o.Z.MAX_SEGMENT_DURATION)&&(t.maxSegmentDuration=e.maxSegmentDuration),e.hasOwnProperty(o.Z.PUBLISH_TIME)&&(t.publishTime=new Date(e.publishTime))),t},getEventsForPeriod:function(e){var t,r,i=e&&e.mpd&&e.mpd.manifest?e.mpd.manifest:null,s=i?i.Period_asArray:null,u=s&&e&&l(e.index)?s[e.index].EventStream_asArray:null,c=[];if(u)for(t=0;t<u.length;t++){var f=new Ae;if(f.period=e,f.timescale=1,!u[t].hasOwnProperty(a.Z.SCHEME_ID_URI))throw new Error("Invalid EventStream. SchemeIdUri has to be set");for(f.schemeIdUri=u[t][a.Z.SCHEME_ID_URI],u[t].hasOwnProperty(o.Z.TIMESCALE)&&(f.timescale=u[t][o.Z.TIMESCALE]),u[t].hasOwnProperty(o.Z.VALUE)&&(f.value=u[t][o.Z.VALUE]),u[t].hasOwnProperty(o.Z.PRESENTATION_TIME_OFFSET)&&(f.presentationTimeOffset=u[t][o.Z.PRESENTATION_TIME_OFFSET]),r=0;u[t].Event_asArray&&r<u[t].Event_asArray.length;r++){var d=u[t].Event_asArray[r],h=new Te;h.presentationTime=0,h.eventStream=f,d.hasOwnProperty(o.Z.PRESENTATION_TIME)&&(h.presentationTime=d.presentationTime);var g=f.presentationTimeOffset?f.presentationTimeOffset/f.timescale:0;h.calculatedPresentationTime=h.presentationTime/f.timescale+e.start-g,d.hasOwnProperty(o.Z.DURATION)&&(h.duration=d.duration/f.timescale),d.hasOwnProperty(o.Z.ID)?h.id=d.id:h.id=null,d.Signal&&d.Signal.Binary?h.messageData=n.decodeArray(d.Signal.Binary.toString()):h.messageData=d.messageData||d.__cdata||d.__text,c.push(h)}}return c},getEssentialPropertiesForAdaptation:function(e){var t={};if(e&&e.hasOwnProperty(o.Z.ESSENTIAL_PROPERTY_ASARRAY)){var r,n=Ue(e.EssentialProperty_asArray);try{for(n.s();!(r=n.n()).done;){var i=r.value;i.hasOwnProperty(a.Z.SCHEME_ID_URI)&&(t[i[a.Z.SCHEME_ID_URI]]=xe({},i))}}catch(s){n.e(s)}finally{n.f()}}return t},getEssentialPropertiesAsArrayForAdaptation:function(e){return e&&e.hasOwnProperty(o.Z.ESSENTIAL_PROPERTY_ASARRAY)&&e.EssentialProperty_asArray.length?e.EssentialProperty_asArray.map((function(e){return(new we).init(e)})):[]},getEssentialPropertiesForRepresentation:v,getEventStreamForAdaptationSet:function(e,t,r){var n,i,a;return e&&e.Period_asArray&&t&&t.period&&l(t.period.index)&&(i=e.Period_asArray[t.period.index])&&i.AdaptationSet_asArray&&l(t.index)&&(a=i.AdaptationSet_asArray[t.index])&&(n=a.InbandEventStream_asArray),A(n,null,r)},getEventStreamForRepresentation:function(e,t,r){var n,i,a,o;return e&&e.Period_asArray&&t&&t.adaptation&&t.adaptation.period&&l(t.adaptation.period.index)&&(i=e.Period_asArray[t.adaptation.period.index])&&i.AdaptationSet_asArray&&l(t.adaptation.index)&&(a=i.AdaptationSet_asArray[t.adaptation.index])&&a.Representation_asArray&&l(t.index)&&(o=a.Representation_asArray[t.index])&&(n=o.InbandEventStream_asArray),A(n,t,r)},getUTCTimingSources:function(e){var t=E(e),r=!!e&&e.hasOwnProperty(o.Z.AVAILABILITY_START_TIME),n=e?e.UTCTiming_asArray:null,i=[];return(t||r)&&n&&n.forEach((function(e){var t=new ve.Z;e.hasOwnProperty(a.Z.SCHEME_ID_URI)&&(t.schemeIdUri=e.schemeIdUri,e.hasOwnProperty(o.Z.VALUE)&&(t.value=e.value.toString(),i.push(t)))})),i},getBaseURLsFromElement:b,getRepresentationSortFunction:function(){return function(e,t){return e.bandwidth-t.bandwidth}},getContentSteering:function(e){if(e&&e.hasOwnProperty(o.Z.CONTENT_STEERING_AS_ARRAY))return R(e[o.Z.CONTENT_STEERING_AS_ARRAY][0])},getLocation:function(e){return e&&e.hasOwnProperty(o.Z.LOCATION_AS_ARRAY)?e[o.Z.LOCATION_AS_ARRAY].map((function(e){var t=e.__text||e,r=e.hasOwnProperty(o.Z.SERVICE_LOCATION)?e[o.Z.SERVICE_LOCATION]:null;return new Me(t,r)})):[]},getPatchLocation:function(e){return e&&e.hasOwnProperty(o.Z.PATCH_LOCATION_AS_ARRAY)?e[o.Z.PATCH_LOCATION_AS_ARRAY].map((function(e){var t=e.__text||e,r=e.hasOwnProperty(o.Z.SERVICE_LOCATION)?e[o.Z.SERVICE_LOCATION]:null,n=e.hasOwnProperty(o.Z.TTL)?1e3*parseFloat(e[o.Z.TTL]):NaN;return new Pe(t,r,n)})):[]},getSuggestedPresentationDelay:function(e){return e&&e.hasOwnProperty(o.Z.SUGGESTED_PRESENTATION_DELAY)?e.suggestedPresentationDelay:null},getAvailabilityStartTime:function(e){return e&&e.hasOwnProperty(o.Z.AVAILABILITY_START_TIME)&&null!==e.availabilityStartTime?e.availabilityStartTime.getTime():null},getServiceDescriptions:function(e){var t=[];if(e&&e.hasOwnProperty(o.Z.SERVICE_DESCRIPTION)){var r,n=Ue(e.ServiceDescription_asArray);try{for(n.s();!(r=n.n()).done;){var i=r.value,a=null,s=null,l=null,u=null,c=null,f=null,d=null;for(var h in i)i.hasOwnProperty(h)&&(h===o.Z.ID?a=i[h]:h===o.Z.SERVICE_DESCRIPTION_SCOPE?s=i[h].schemeIdUri:h===o.Z.SERVICE_DESCRIPTION_LATENCY?l={target:parseInt(i[h].target),max:parseInt(i[h].max),min:parseInt(i[h].min),referenceId:parseInt(i[h].referenceId)}:h===o.Z.SERVICE_DESCRIPTION_PLAYBACK_RATE?u={max:parseFloat(i[h].max),min:parseFloat(i[h].min)}:h===o.Z.SERVICE_DESCRIPTION_OPERATING_QUALITY?c={mediaType:i[h].mediaType,max:parseInt(i[h].max),min:parseInt(i[h].min),target:parseInt(i[h].target),type:i[h].type,maxQualityDifference:parseInt(i[h].maxQualityDifference)}:h===o.Z.SERVICE_DESCRIPTION_OPERATING_BANDWIDTH?f={mediaType:i[h].mediaType,max:parseInt(i[h].max),min:parseInt(i[h].min),target:parseInt(i[h].target)}:h===o.Z.CONTENT_STEERING&&(d=R(i[h])));t.push({id:a,schemeIdUri:s,latency:l,playbackRate:u,operatingQuality:c,operatingBandwidth:f,contentSteering:d})}}catch(g){n.e(g)}finally{n.f()}}return t},getSegmentAlignment:function(e){return!(!e||!e.hasOwnProperty(o.Z.SEGMENT_ALIGNMENT))&&"true"===e[o.Z.SEGMENT_ALIGNMENT]},getSubSegmentAlignment:function(e){return!(!e||!e.hasOwnProperty(o.Z.SUB_SEGMENT_ALIGNMENT))&&"true"===e[o.Z.SUB_SEGMENT_ALIGNMENT]},getSupplementalPropertiesForAdaptation:function(e){var t={};if(e&&e.hasOwnProperty(o.Z.SUPPLEMENTAL_PROPERTY_ASARRAY)){var r,n=Ue(e.SupplementalProperty_asArray);try{for(n.s();!(r=n.n()).done;){var i=r.value;i.hasOwnProperty(a.Z.SCHEME_ID_URI)&&(t[i[a.Z.SCHEME_ID_URI]]=xe({},i))}}catch(s){n.e(s)}finally{n.f()}}return t},getSupplementalPropertiesAsArrayForAdaptation:function(e){return e&&e.hasOwnProperty(o.Z.SUPPLEMENTAL_PROPERTY_ASARRAY)&&e.SupplementalProperty_asArray.length?e.SupplementalProperty_asArray.map((function(e){return(new we).init(e)})):[]},getSupplementalPropertiesForRepresentation:function(e){var t={};if(e&&e.hasOwnProperty(o.Z.SUPPLEMENTAL_PROPERTY_ASARRAY)){var r,n=Ue(e.SupplementalProperty_asArray);try{for(n.s();!(r=n.n()).done;){var i=r.value;i.hasOwnProperty(a.Z.SCHEME_ID_URI)&&(t[i[a.Z.SCHEME_ID_URI]]=xe({},i))}}catch(s){n.e(s)}finally{n.f()}}return t},getSupplementalPropertiesAsArrayForRepresentation:function(e){return e&&e.hasOwnProperty(o.Z.SUPPLEMENTAL_PROPERTY_ASARRAY)&&e.SupplementalProperty_asArray.length?e.SupplementalProperty_asArray.map((function(e){return(new we).init(e)})):[]},setConfig:function(e){e&&(e.errHandler&&(r=e.errHandler),e.BASE64&&(n=e.BASE64))}},t=(0,f.Z)(i).getInstance().getLogger(e),e}Ge.__dashjs_factory_name="DashManifestModel";var He=c.Z.getSingletonFactory(Ge),Ke=r(703);function Ye(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return qe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?qe(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function qe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Ve(){var e,t,r,n,i,o,s,u,c,f,h=this.context,g=(0,l.Z)(h).getInstance(),m=(0,C.Z)(h).getInstance();function p(){r={pr:1,nor:null,st:null,sf:null,sid:"".concat(Ke.Z.generateUuid()),cid:null},c={},u={},f={},E()}function y(){E()}function E(){if(o){var e=o.getStreamController();if(e&&"function"==typeof e.getActiveStream){var t=e.getActiveStream();t&&(s=t.getProcessors())}}}function v(e,t){var r,n={},i=Ye(t);try{for(i.s();!(r=i.n()).done;){var a=r.value;e[a]&&(n[a]=e[a])}}catch(o){i.e(o)}finally{i.f()}return n}function T(e){var t=m.get().streaming.cmcd.enabledKeys;return e.filter((function(e){return t.includes(e)}))}function _(e){try{return e.type===D.w.MPD_TYPE?((h=S()).ot="m",h):e.type===D.w.MEDIA_SEGMENT_TYPE?(d=e.mediaType,f.hasOwnProperty(d)||(f[d]=!1),u.hasOwnProperty(d)||(u[d]=!1),c.hasOwnProperty(d)||(c[d]=!1),function(e){var t,l=S(),d=function(e){try{var t=e.quality,r=e.mediaInfo.bitrateList;return parseInt(r[t].bandwidth/1e3)}catch(n){return null}}(e),h=function(e){try{return isNaN(e.duration)?NaN:Math.round(1e3*e.duration)}catch(t){return null}}(e),g=function(e){try{return 100*parseInt(n.getThroughputHistory().getSafeAverageThroughput(e)/100)}catch(t){return null}}(e.mediaType),p=function(e){try{var t=r.pr,n=i.getCurrentBufferLevel(e);return isNaN(t)||isNaN(n)?null:100*parseInt(n/t*10)}catch(a){return null}}(e.mediaType),y=A(e.mediaType),E=function(e){try{var t=n.getTopBitrateInfoFor(e);return Math.round(t.bitrate/1e3)}catch(r){return null}}(e.mediaType),v=r.pr,T=function(e){if(s&&0!==s.length){var t,r=Ye(s);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(n.getType()===e)return n.probeNextRequest()}}catch(i){r.e(i)}finally{r.f()}}}(e.mediaType);e.mediaType===a.Z.VIDEO&&(t="v"),e.mediaType===a.Z.AUDIO&&(t="a"),e.mediaType===a.Z.TEXT&&(t="application/mp4"===e.mediaInfo.mimeType?"tt":"c");var _=m.get().streaming.cmcd.rtp;return _||(_=function(e){try{var t=o.getPlaybackRate();t||(t=1);var r=e.quality,n=e.mediaType,i=e.mediaInfo,a=e.duration;if(!i)return NaN;var s=A(n);0===s&&(s=500);var l=i.bitrateList[r].bandwidth*a/1e3/(s/t/1e3),u=m.get().streaming.cmcd.rtpSafetyFactor&&!isNaN(m.get().streaming.cmcd.rtpSafetyFactor)?m.get().streaming.cmcd.rtpSafetyFactor:5;return 100*(parseInt(l*u/100)+1)}catch(c){return NaN}}(e)),isNaN(_)||(l.rtp=_),T&&(e.url!==T.url?l.nor=encodeURIComponent(Ke.Z.getRelativeUrl(e.url,T.url)):T.range&&(l.nrr=T.range)),d&&(l.br=d),t&&(l.ot=t),isNaN(h)||(l.d=h),isNaN(g)||(l.mtp=g),isNaN(p)||(l.dl=p),isNaN(y)||(l.bl=y),isNaN(E)||(l.tb=E),isNaN(v)||1===v||(l.pr=v),c[e.mediaType]&&(l.bs=!0,c[e.mediaType]=!1),!u[e.mediaType]&&f[e.mediaType]||(l.su=!0,u[e.mediaType]=!1,f[e.mediaType]=!0),l}(e)):e.type===D.w.INIT_SEGMENT_TYPE?((l=S()).ot="i",l.su=!0,l):e.type===D.w.OTHER_TYPE||e.type===D.w.XLINK_EXPANSION_TYPE?function(){var e=S();return e.ot="o",e}():e.type===D.w.LICENSE?((t=S()).ot="k",t):null}catch(l){return null}var t,l,d,h}function S(){var e={},t=m.get().streaming.cmcd.cid?m.get().streaming.cmcd.cid:r.cid;return e.v=1,e.sid=m.get().streaming.cmcd.sid?m.get().streaming.cmcd.sid:r.sid,e.sid="".concat(e.sid),t&&(e.cid="".concat(t)),isNaN(r.pr)||1===r.pr||null===r.pr||(e.pr=r.pr),r.st&&(e.st=r.st),r.sf&&(e.sf=r.sf),e}function A(e){try{var t=i.getCurrentBufferLevel(e);return isNaN(t)?null:100*parseInt(10*t)}catch(r){return null}}function b(e){try{r.pr=e.playbackRate}catch(t){}}function R(t){try{var n=e.getIsDynamic(t.data)?"l":"v",i=t.protocol&&"MSS"===t.protocol?"s":"d";r.st="".concat(n),r.sf="".concat(i)}catch(a){}}function I(e){try{e.state&&e.mediaType&&e.state===d.Z.BUFFER_EMPTY&&(c[e.mediaType]||(c[e.mediaType]=!0),u[e.mediaType]||(u[e.mediaType]=!0))}catch(t){}}function w(){for(var e in c)c.hasOwnProperty(e)&&(c[e]=!0);for(var t in u)u.hasOwnProperty(t)&&(u[t]=!0)}function L(e){try{if(!e)return null;var t=Object.keys(e).sort((function(e,t){return e.localeCompare(t)})),r=t.length,n=t.reduce((function(t,n,i){return"v"===n&&1===e[n]||("string"==typeof e[n]&&"ot"!==n&&"sf"!==n&&"st"!==n?t+="".concat(n,"=").concat(JSON.stringify(e[n])):t+="".concat(n,"=").concat(e[n]),i<r-1&&(t+=",")),t}),"");return(n=n.replace(/=true/g,"")).replace(/,\s*$/,"")}catch(i){return null}}return t={getQueryParameter:function(e){try{if(m.get().streaming.cmcd&&m.get().streaming.cmcd.enabled){var t=_(e),r=L(function(e){try{var t=m.get().streaming.cmcd.enabledKeys;return Object.keys(e).filter((function(e){return t.includes(e)})).reduce((function(t,r){return t[r]=e[r],t}),{})}catch(r){return e}}(t));return g.trigger(de.Z.CMCD_DATA_GENERATED,{url:e.url,mediaType:e.mediaType,cmcdData:t,cmcdString:r}),{key:"CMCD",value:r}}return null}catch(n){return null}},getHeaderParameters:function(e){try{if(m.get().streaming.cmcd&&m.get().streaming.cmcd.enabled){var t=_(e),r=v(t,T(["br","d","ot","tb"])),n=v(t,T(["bl","dl","mtp","nor","nrr","su"])),i=v(t,T(["bs","rtp"])),a=v(t,T(["cid","pr","sf","sid","st","v"])),o={"CMCD-Object":L(r),"CMCD-Request":L(n),"CMCD-Status":L(i),"CMCD-Session":L(a)};return g.trigger(de.Z.CMCD_DATA_GENERATED,{url:e.url,mediaType:e.mediaType,cmcdData:t,headers:o}),o}return null}catch(s){return null}},setConfig:function(e){e&&(e.abrController&&(n=e.abrController),e.dashMetrics&&(i=e.dashMetrics),e.playbackController&&(o=e.playbackController))},reset:function(){g.off(d.Z.PLAYBACK_RATE_CHANGED,b,this),g.off(d.Z.MANIFEST_LOADED,R,this),g.off(d.Z.BUFFER_LEVEL_STATE_CHANGED,I,t),g.off(d.Z.PLAYBACK_SEEKED,w,t),p()},initialize:function(){g.on(d.Z.PLAYBACK_RATE_CHANGED,b,t),g.on(d.Z.MANIFEST_LOADED,R,t),g.on(d.Z.BUFFER_LEVEL_STATE_CHANGED,I,t),g.on(d.Z.PLAYBACK_SEEKED,w,t),g.on(d.Z.PERIOD_SWITCH_COMPLETED,y,t)}},e=He(h).getInstance(),p(),t}Ve.__dashjs_factory_name="CmcdModel";var je=c.Z.getSingletonFactory(Ve);function $e(e){return($e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ze(e,t){ze=function(e,t){return new a(e,void 0,t)};var r=Xe(RegExp),n=RegExp.prototype,i=new WeakMap;function a(e,t,n){var a=r.call(this,e,t);return i.set(a,n||i.get(e)),a}function o(e,t){var r=i.get(t);return Object.keys(r).reduce((function(t,n){return t[n]=e[r[n]],t}),Object.create(null))}return We(a,r),a.prototype.exec=function(e){var t=n.exec.call(this,e);return t&&(t.groups=o(t,this)),t},a.prototype[Symbol.replace]=function(e,t){if("string"==typeof t){var r=i.get(this);return n[Symbol.replace].call(this,e,t.replace(/\$<([^>]+)>/g,(function(e,t){return"$"+r[t]})))}if("function"==typeof t){var a=this;return n[Symbol.replace].call(this,e,(function(){var e=[];return e.push.apply(e,arguments),"object"!==$e(e[e.length-1])&&e.push(o(e,a)),t.apply(this,e)}))}return n[Symbol.replace].call(this,e,t)},ze.apply(this,arguments)}function We(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&et(e,t)}function Xe(e){var t="function"==typeof Map?new Map:void 0;return Xe=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return Qe(e,arguments,tt(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),et(n,e)},Xe(e)}function Qe(e,t,r){return(Qe=Je()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&et(i,r.prototype),i}).apply(null,arguments)}function Je(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function et(e,t){return(et=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function tt(e){return(tt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var rt="static",nt="dynamic",it="cmsd-",at=it+rt,ot=it+nt,st="stream",lt=["mb","st","sf","v"],ut={video:"v",audio:"a",text:"tt",stream:st},ct=/^[-0-9]/;function ft(){var e,t,r,n,i=this.context,a=(0,l.Z)(i).getInstance();function o(){r={},n={}}function s(e){e&&Object.keys(e).forEach((function(t){lt.includes(t)||delete e[t]}))}function c(e){return!e||"false"!==e.toLowerCase()&&(ct.test(e)?parseInt(e,10):e.replace(/["]+/g,""))}function d(e){try{for(var r={},n=e.split(","),i=0;i<n.length;i++){var a=n[i].split("="),o=a[0],s=c(a[1]);r[o]=s}return r}catch(l){t.error("Failed to parse CMSD-Static response header value:",l)}}function h(e){try{for(var r={},n=e.split(","),i=n[n.length-1].split(";"),a=1;a<i.length;a++){var o=i[a].split("="),s=o[0],l=c(o[1]);r[s]=l}return r}catch(u){return t.error("Failed to parse CMSD-Dynamic response header value:",u),[]}}function g(e){return ut[e]||"o"}function m(e,t,i){var a=e===rt?r:n,o=a[t]||{},s=a[st]||{};return o[i]||s[i]}return e={setConfig:function(){},initialize:function(){},reset:function(){o()},parseResponseHeaders:function(e,t){for(var i=null,o=null,l=e.split("\r\n"),c=l.length-1;c>=0;c--){var f=l[c].match(ze(/^((?:(?!:)[\s\S])*):[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*(.*)$/,{key:1,value:2}));if(f&&f.groups){var m=f.groups.key.toLowerCase(),p=f.groups.value;switch(m){case at:i=d(p),a.trigger(u.Z.CMSD_STATIC_HEADER,i);break;case ot:o||(o=h(p))}}}var y=st;return i&&i.ot?y=i.ot:t&&(y=g(t)),s(r[y]),s(n[y]),i&&(r[y]=Object.assign(r[y]||{},i)),o&&(n[y]=Object.assign(n[y]||{},o)),{static:i,dynamic:o}},getMaxBitrate:function(e){var t=g(e);return m(nt,t,"mb")||-1},getEstimatedThroughput:function(e){var t=g(e);return m(nt,t,"etp")||null},getResponseDelay:function(e){var t=g(e);return m(nt,t,"rd")||null},getRoundTripTime:function(e){var t=g(e);return m(nt,t,"rtt")||null}},t=(0,f.Z)(i).getInstance().getLogger(e),o(),e}ft.__dashjs_factory_name="CmsdModel";var dt=c.Z.getSingletonFactory(ft);function ht(){var e,t,r=this.context,n={};function i(){t=(0,f.Z)(r).getInstance().getLogger(e)}function a(e){for(var t={},r=0,n=0,i=0,a=0,o=e.length,s=0;s<o;++s)r+=e[s].chunkDownloadTimeRelativeMS,n+=e[s].bufferLevel,i+=e[s].chunkDownloadTimeRelativeMS*e[s].bufferLevel,a+=e[s].chunkDownloadTimeRelativeMS*e[s].chunkDownloadTimeRelativeMS;return t.m=(i-r*n/o)/(a-r*r/o),t.b=n/o-t.m*r/o,function(e){return t.m*e+t.b}}function o(e){var t,r=!0,n=e.reduce((function(e,t){return e+t.bufferLevelAtSegmentEnd}),0)/e.length;return e.forEach((function(e){Math.abs(e.bufferLevelAtSegmentEnd/e.bufferLevelAtSegmentStart)<.95&&(r=!1),e.bufferLevelAtSegmentEnd/n<.8&&(r=!1),t?t>e.bitrate&&(r=!1):t=e.bitrate})),r}return e={setup:i,addMeasurement:function(e,t,r,i,o){e&&e.mediaType&&!n[e.mediaType]&&(n[e.mediaType]=[]);var s=e.mediaInfo.bitrateList.find((function(t){return t.id===e.representationId}));n[e.mediaType].push({index:e.index,repId:e.representationId,mediaType:e.mediaType,requestTimeMS:i,adjustedAvailabilityStartTimeMS:e.availabilityStartTime.getTime(),segDurationMS:1e3*e.duration,chunksDurationMS:r.reduce((function(e,t){return e+t.chunkDownloadDurationMS}),0),segmentBytes:r.reduce((function(e,t){return e+t.chunkBytes}),0),bitrate:s&&s.bandwidth,bitrateList:e.mediaInfo.bitrateList,chunkMeasurements:r,fetchDownloadDurationMS:t,throughputCapacityDelayMS:o,getEstimatedBufferLevel:a(r.slice(1))}),n[e.mediaType].length>10&&n[e.mediaType].shift()},getThroughputCapacityDelayMS:function(e,t){var r=n[e.mediaType]&&n[e.mediaType].slice(-3);return!r||r.length<3?0:o(r)?t/4>250?250:t/4:0},getEstimatedDownloadDurationMS:function(e){var r=n[e.mediaType].slice(-1).pop(),i=n[e.mediaType].slice(-3),a=r.chunkMeasurements.slice(-1).pop().chunkDownloadTimeRelativeMS;r.bufferLevelAtSegmentStart=r.getEstimatedBufferLevel(a/2),r.bufferLevelAtSegmentEnd=r.getEstimatedBufferLevel(a);var s=o(i),l=s?.6:.8;if(r.isBufferStable&&1.05*r.segDurationMS<r.fetchDownloadDurationMS)return r.fetchDownloadDurationMS;if(!s||r.segDurationMS<r.fetchDownloadDurationMS)return.8*r.fetchDownloadDurationMS;if(r.adjustedAvailabilityStartTimeMS<=r.requestTimeMS+r.throughputCapacityDelayMS-r.segDurationMS)return.8*r.fetchDownloadDurationMS;for(var u=r.requestTimeMS+r.throughputCapacityDelayMS-r.adjustedAvailabilityStartTimeMS,c=0,f=0,d=0,h=0;h<r.chunkMeasurements.length;h++){var g=r.chunkMeasurements[h];if(u<f+g.chunkDownloadDurationMS)break;f+=g.chunkDownloadDurationMS,c+=g.chunkBytes,d++}if(u<0&&t.warn("request time was before adjusted availibitly start time"),c&&f&&d>.2*r.chunkMeasurements.length){var m=c/f,p=r.segmentBytes/m;return r.fetchDownloadDurationMS<p?r.fetchDownloadDurationMS*l:p*l}var y=r.bitrate;return r.bitrateList.some((function(e){if(e.bandwidth>r.bitrate)return y=e.bandwidth,!0})),y===r.bitrate?r.fetchDownloadDurationMS*l:l*r.segmentBytes*8*1e3/y}},i(),e}ht.__dashjs_factory_name="LowLatencyThroughputModel";var gt=c.Z.getSingletonFactory(ht),mt=r(5717);function pt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function yt(e){e=e||{};var t,r,n,i,o,s,c,d,h,g,m,p=this.context,y=e.errHandler,E=e.dashMetrics,v=e.mediaPlayerModel,T=e.requestModifier,_=e.boxParser,A=e.errors,b=e.requestTimeout||0,R=(0,l.Z)(p).getInstance(),I=(0,C.Z)(p).getInstance();function w(e,t){var l,f=e.request,m=[],A=!0,C=!0,L=new Date,N=L,O=0,M=null,P=null;if(!T||!E||!y)throw new Error("config object is not correct or missing");var k,x=function(e){f.requestStartDate=L,f.requestEndDate=new Date,f.firstByteDate=f.firstByteDate||L,f.fileLoaderType=P;var t=l.response?l.response.responseURL:null,r=l.response?l.response.status:null,n=l.response&&l.response.getAllResponseHeaders?l.response.getAllResponseHeaders():l.response?l.response.responseHeaders:null,i=n&&I.get().streaming.cmsd&&I.get().streaming.cmsd.enabled?c.parseResponseHeaders(n,f.mediaType):null;E.addHttpRequest(f,t,r,n,e?m:null,i)},F=function(e){C=!1,x(e),f.type===D.w.MPD_TYPE&&(E.addManifestUpdate(f),R.trigger(u.Z.MANIFEST_LOADING_FINISHED,{request:f}))},U=function(){if(M&&(clearTimeout(M),M=null),-1!==r.indexOf(l)&&(r.splice(r.indexOf(l),1),C))if(F(!1),t>0){try{I.get().streaming.utcSynchronization.enableBackgroundSyncAfterSegmentDownloadError&&f.type===D.w.MEDIA_SEGMENT_TYPE&&v.getRetryAttemptsForType(D.w.MEDIA_SEGMENT_TYPE)===t&&R.trigger(u.Z.ATTEMPT_BACKGROUND_SYNC)}catch(a){}t--;var n={config:e};i.push(n),n.timeout=setTimeout((function(){-1!==i.indexOf(n)&&(i.splice(i.indexOf(n),1),w(e,t))}),v.getRetryIntervalsForType(f.type))}else{if(f.type===D.w.MSS_FRAGMENT_INFO_SEGMENT_TYPE)return;y.error(new S.Z(o[f.type],f.url+" is not available",{request:f,response:l.response})),e.error&&e.error(f,"error",l.response.statusText,l.response),e.complete&&e.complete(f,l.response.statusText)}};f.hasOwnProperty("availabilityTimeComplete")&&!1===f.availabilityTimeComplete&&window.fetch&&"arraybuffer"===f.responseType&&f.type===D.w.MEDIA_SEGMENT_TYPE?((k=fe(p).create({requestModifier:T,lowLatencyThroughputModel:h,boxParser:_})).setup({dashMetrics:E}),P=a.Z.FILE_LOADER_TYPES.FETCH):(k=(0,se.Z)(p).create({requestModifier:T}),P=a.Z.FILE_LOADER_TYPES.XHR);var B=null,Z=T.modifyRequestURL?T.modifyRequestURL(f.url):f.url;if(I.get().streaming.cmcd&&I.get().streaming.cmcd.enabled){var G=I.get().streaming.cmcd.mode;if(G===a.Z.CMCD_MODE_QUERY){var H=function(e){try{var t=[],r=s.getQueryParameter(e);return r&&t.push(r),t}catch(n){return[]}}(f);Z=Ke.Z.addAditionalQueryParameterToUrl(Z,H)}else G===a.Z.CMCD_MODE_HEADER&&(B=s.getHeaderParameters(f))}var K=d.getXHRWithCredentialsForType(f.type);if(f.queryParams){var Y=Object.keys(f.queryParams).map((function(e){return{key:e,value:f.queryParams[e]}}));Z=Ke.Z.addAditionalQueryParameterToUrl(Z,Y)}f.url=Z,l={url:Z,method:D.w.GET,withCredentials:K,request:f,onload:function(){l.response.status>=200&&l.response.status<=299&&(F(!0),e.success&&e.success(l.response.response,l.response.statusText,l.response.responseURL),e.complete&&e.complete(f,l.response.statusText))},onend:U,onerror:U,progress:function(t){var r=new Date;A&&(A=!1,(!t.lengthComputable||t.lengthComputable&&t.total!==t.loaded)&&(f.firstByteDate=r)),t.lengthComputable&&(f.bytesLoaded=t.loaded,f.bytesTotal=t.total),t.noTrace||(m.push({s:N,d:t.time?t.time:r.getTime()-N.getTime(),b:[t.loaded?t.loaded-O:0]}),N=r,O=t.loaded),M&&(clearTimeout(M),M=null),I.get().streaming.fragmentRequestProgressTimeout>0&&(M=setTimeout((function(){g.warn("Abort request "+l.url+" due to progress timeout"),l.response.onabort=null,l.loader.abort(l),U()}),I.get().streaming.fragmentRequestProgressTimeout)),e.progress&&t&&e.progress(t)},onabort:function(){x(!0),M&&(clearTimeout(M),M=null),e.abort&&e.abort(f)},ontimeout:function(e){var t;if(e.lengthComputable){var r=e.loaded/e.total*100;t="Request timeout: loaded: "+e.loaded+", out of: "+e.total+" : "+r.toFixed(3)+"% Completed"}else t="Request timeout: non-computable download size";g.warn(t)},loader:k,timeout:b,headers:B};var q=(new Date).getTime();if(isNaN(f.delayLoadingTime)||q>=f.delayLoadingTime)r.push(l),k.load(l);else{var V={httpRequest:l};n.push(V),V.delayTimeout=setTimeout((function(){if(-1!==n.indexOf(V)){n.splice(n.indexOf(V),1);try{N=L=new Date,r.push(V.httpRequest),k.load(V.httpRequest)}catch(e){V.httpRequest.onerror()}}}),f.delayLoadingTime-q)}}return t={load:function(e){e.request?w(e,v.getRetryAttemptsForType(e.request.type)):e.error&&e.error(e.request,"error")},abort:function(){i.forEach((function(e){clearTimeout(e.timeout),e.config.request&&e.config.abort&&e.config.abort(e.config.request)})),i=[],n.forEach((function(e){return clearTimeout(e.delayTimeout)})),n=[],r.forEach((function(e){e.request.type!==D.w.MSS_FRAGMENT_INFO_SEGMENT_TYPE&&(e.onloadend=e.onerror=e.onprogress=void 0,e.loader.abort(e))})),r=[]}},g=(0,f.Z)(p).getInstance().getLogger(t),r=[],n=[],i=[],s=je(p).getInstance(),c=dt(p).getInstance(),h=gt(p).getInstance(),d=(0,mt.Z)(p).getInstance(),pt(m={},D.w.MPD_TYPE,A.DOWNLOAD_ERROR_ID_MANIFEST_CODE),pt(m,D.w.XLINK_EXPANSION_TYPE,A.DOWNLOAD_ERROR_ID_XLINK_CODE),pt(m,D.w.INIT_SEGMENT_TYPE,A.DOWNLOAD_ERROR_ID_INITIALIZATION_CODE),pt(m,D.w.MEDIA_SEGMENT_TYPE,A.DOWNLOAD_ERROR_ID_CONTENT_CODE),pt(m,D.w.INDEX_SEGMENT_TYPE,A.DOWNLOAD_ERROR_ID_CONTENT_CODE),pt(m,D.w.BITSTREAM_SWITCHING_SEGMENT_TYPE,A.DOWNLOAD_ERROR_ID_CONTENT_CODE),pt(m,D.w.OTHER_TYPE,A.DOWNLOAD_ERROR_ID_CONTENT_CODE),o=m,t}yt.__dashjs_factory_name="HTTPLoader";var Et=c.Z.getClassFactory(yt);function vt(){var e;function t(){e={}}function r(){t()}return r(),{getLoader:function(t){for(var r in e)if(e.hasOwnProperty(r)&&t.startsWith(r))return e[r];return Et},registerLoader:function(t,r){e[t]=r},unregisterLoader:function(t){e[t]&&delete e[t]},unregisterAllLoader:t,reset:r}}vt.__dashjs_factory_name="SchemeLoaderFactory";var Tt=c.Z.getSingletonFactory(vt);function _t(e){e=e||{};var t,r,n=this.context;return t=Tt(n).getInstance(),{load:function(i){if(!r){var a=t.getLoader(i&&i.request?i.request.url:null);r=a(n).create({errHandler:e.errHandler,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,dashMetrics:e.dashMetrics,boxParser:e.boxParser?e.boxParser:null,constants:e.constants?e.constants:null,dashConstants:e.dashConstants?e.dashConstants:null,urlUtils:e.urlUtils?e.urlUtils:null,requestTimeout:isNaN(e.requestTimeout)?0:e.requestTimeout,errors:e.errors})}r.load(i)},abort:function(){r&&r.abort()}}}_t.__dashjs_factory_name="URLLoader";var St=c.Z.getClassFactory(_t);function At(e){return(At="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function bt(e,t){return(bt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Rt(e,t){return!t||"object"!==At(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function It(e){return(It=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var wt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&bt(e,t)}(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=It(t);if(r){var i=It(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return Rt(this,e)});function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(t=n.call(this,e)).checkForExistenceOnly=!0,t}return i}(m.Z);function Ct(e){e=e||{};var t,r,n=this.context,i=e.eventBus,o=e.events,s=e.urlUtils,l=e.errors,u=e.streamId;return t={checkForExistence:function(e){var t=function(t){i.trigger(o.CHECK_FOR_EXISTENCE_COMPLETED,{request:e,exists:t})};if(e){var n=new wt(e.url);r.load({request:n,success:function(){t(!0)},error:function(){t(!1)}})}else t(!1)},load:function(e){var n=function(r,n){i.trigger(o.LOADING_COMPLETED,{request:e,response:r||null,error:n||null,sender:t})};e?r.load({request:e,progress:function(r){i.trigger(o.LOADING_PROGRESS,{request:e,stream:r.stream,streamId:u}),r.data&&i.trigger(o.LOADING_DATA_PROGRESS,{request:e,response:r.data||null,error:null,sender:t})},success:function(e){n(e)},error:function(e,t,r){n(void 0,new S.Z(l.FRAGMENT_LOADER_LOADING_FAILURE_ERROR_CODE,r,t))},abort:function(e){e&&i.trigger(o.LOADING_ABANDONED,{mediaType:e.mediaType,request:e,sender:t})}}):n(void 0,new S.Z(l.FRAGMENT_LOADER_NULL_REQUEST_ERROR_CODE,l.FRAGMENT_LOADER_NULL_REQUEST_ERROR_MESSAGE))},abort:function(){r&&r.abort()},reset:function(){r&&(r.abort(),r=null)}},r=St(n).create({errHandler:e.errHandler,errors:l,dashMetrics:e.dashMetrics,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,urlUtils:s,constants:a.Z,boxParser:e.boxParser,dashConstants:e.dashConstants,requestTimeout:e.settings.get().streaming.fragmentRequestTimeout}),t}Ct.__dashjs_factory_name="FragmentLoader";var Dt=c.Z.getClassFactory(Ct);function Lt(){return{modifyResponseAsync:function(e){return Promise.resolve(e)}}}Lt.__dashjs_factory_name="SegmentResponseModifier";var Nt=c.Z.getSingletonFactory(Lt);function Ot(e){e=e||{};var t,r,n,i=this.context,o=(0,l.Z)(i).getInstance(),s=e.errHandler,c=e.mediaPlayerModel,h=e.dashMetrics,g=(0,f.Z)(i).getInstance(),m=Nt(i).getInstance(),p=e.streamInfo;function y(){return p.id}function E(){for(var e in n)n[e].reset();n={}}function v(e){if(e.sender){var t=e.request,n=e.response,i=t.isInitializationRequest(),s=t.mediaInfo.streamInfo;if(e.error&&(t.mediaType===a.Z.AUDIO||t.mediaType===a.Z.VIDEO||t.mediaType===a.Z.TEXT&&t.mediaInfo.isFragmented)&&o.trigger(u.Z.SERVICE_LOCATION_BASE_URL_BLACKLIST_ADD,{entry:e.request.serviceLocation}),n&&s){var l=(c=n,f=t,d=p.id,h=e.type!==u.Z.FRAGMENT_LOADING_PROGRESS,(g=new oe).streamId=d,g.mediaInfo=f.mediaInfo,g.segmentType=f.type,g.start=f.startTime,g.duration=f.duration,g.end=g.start+g.duration,g.bytes=c,g.index=f.index,g.quality=f.quality,g.representationId=f.representationId,g.endFragment=h,g);m.modifyResponseAsync(l).then((function(e){o.trigger(i?u.Z.INIT_FRAGMENT_LOADED:u.Z.MEDIA_FRAGMENT_LOADED,{chunk:e,request:t},{streamId:s.id,mediaType:t.mediaType})})).catch((function(e){r.error(e),o.trigger(i?u.Z.INIT_FRAGMENT_LOADED:u.Z.MEDIA_FRAGMENT_LOADED,{chunk:l,request:t},{streamId:s.id,mediaType:t.mediaType})}))}else r.warn("No "+t.mediaType+" bytes to push or stream is inactive.")}var c,f,d,h,g}return t={getStreamId:y,getModel:function(t){var r=n[t];return r||(r=_(i).create({streamInfo:p,type:t,dashMetrics:h,fragmentLoader:Dt(i).create({dashMetrics:h,mediaPlayerModel:c,errHandler:s,requestModifier:(0,W.Z)(i).getInstance(),settings:e.settings,boxParser:e.boxParser,eventBus:o,events:u.Z,errors:w,dashConstants:e.dashConstants,urlUtils:e.urlUtils,streamId:y()}),debug:g,eventBus:o,events:u.Z}),n[t]=r),r},reset:function(){o.off(d.Z.FRAGMENT_LOADING_COMPLETED,v,this),o.off(d.Z.FRAGMENT_LOADING_PROGRESS,v,this),E()}},r=g.getLogger(t),E(),o.on(d.Z.FRAGMENT_LOADING_COMPLETED,v,t),o.on(d.Z.FRAGMENT_LOADING_PROGRESS,v,t),t}Ot.__dashjs_factory_name="FragmentController";var Mt=c.Z.getClassFactory(Ot),Pt=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=null,this.width=null,this.height=null,this.x=null,this.y=null},kt=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mediaType=null,this.bitrate=null,this.width=null,this.height=null,this.scanType=null,this.qualityIndex=NaN};function xt(e){var t,r,n=this.context,i=e.streamInfo;function o(e){r.setTrackByIndex(e)}function s(){r&&r.reset()}return t={getStreamId:function(){return i.id},initialize:function(){r.addTracks();var e=r.getTracks();e&&e.length>0&&o(0)},provide:function(e,t){if("function"==typeof t){var n,i,a=r.getCurrentTrack();if(!a||a.segmentDuration<=0||null==e)t(null);else{(i=r.getThumbnailRequestForTime(e))&&(a.segmentDuration=i.duration),n=e%a.segmentDuration;var o=Math.floor(n*a.tilesHor*a.tilesVert/a.segmentDuration),s=new Pt;if(s.width=Math.floor(a.widthPerTile),s.height=Math.floor(a.heightPerTile),s.x=Math.floor(o%a.tilesHor)*a.widthPerTile,s.y=Math.floor(o/a.tilesHor)*a.heightPerTile,"readThumbnail"in a)return a.readThumbnail(e,(function(e){s.url=e,t(s)}));if(i)s.url=i.url,a.segmentDuration=NaN;else{var l=Math.floor(e/a.segmentDuration);s.url=(c=l+(u=a).startNumber,f=(0,q.vi)(u.templateUrl,"Number",c),f=(0,q.vi)(f,"Time",(c-1)*u.segmentDuration*u.timescale),f=(0,q.vi)(f,"Bandwidth",u.bandwidth),(0,q.eR)(f))}t(s)}}var u,c,f},setTrackByIndex:o,getCurrentTrackIndex:function(){return r.getCurrentTrackIndex()},getBitrateList:function(){var e=r.getTracks(),t=0;return e.map((function(e){var r=new kt;return r.mediaType=a.Z.IMAGE,r.qualityIndex=t++,r.bitrate=e.bitrate,r.width=e.width,r.height=e.height,r}))},reset:s},s(),r=(0,Oe.Z)(n).create({streamInfo:i,adapter:e.adapter,baseURLController:e.baseURLController,timelineConverter:e.timelineConverter,debug:e.debug,eventBus:e.eventBus,events:e.events,dashConstants:e.dashConstants,dashMetrics:e.dashMetrics,segmentBaseController:e.segmentBaseController}),t}xt.__dashjs_factory_name="ThumbnailController";var Ft=c.Z.getClassFactory(xt),Ut=r(7417);function Bt(e){var t;e=e||{};var r=[],n=(0,l.Z)(this.context).getInstance(),i=e.updateEventName,a=e.addBlacklistEventName;function o(e){-1===r.indexOf(e)&&(r.push(e),n.trigger(i,{entry:e}))}return t={add:o,contains:function(e){return!!(r.length&&e&&e.length)&&-1!==r.indexOf(e)},reset:function(){r=[]}},a&&n.on(a,(function(e){o(e.entry)}),t),t}Bt.__dashjs_factory_name="BlackListController";var Zt=c.Z.getClassFactory(Bt),Gt=[a.Z.VIDEO,a.Z.AUDIO,a.Z.TEXT,a.Z.MUXED,a.Z.IMAGE];function Ht(e){e=e||{};var t,r,n,i,s,c,d,h,g,m,p,y,E,v,T,_,A,b,R=this.context,I=(0,l.Z)(R).getInstance(),C=(0,X.Z)(R).getInstance(),D=e.manifestModel,L=e.mediaPlayerModel,N=e.dashMetrics,O=e.manifestUpdater,M=e.adapter,P=e.timelineConverter,k=e.capabilities,x=e.errHandler,F=e.abrController,U=e.playbackController,B=e.eventController,Z=e.mediaController,G=e.protectionController,H=e.textController,K=e.videoModel,Y=e.streamInfo,q=e.settings;function V(e,t){return new Promise((function(i,o){re(),m=!0,ie();var s=K.getElement(),l=[];Gt.forEach((function(t){(t!==a.Z.TEXT||e)&&(t!==a.Z.VIDEO||!s||s&&/^VIDEO$/i.test(s.nodeName))&&l.push(j(t,e))})),Promise.all(l).then((function(){return e=t,new Promise((function(t){var r={},i=n.map((function(t){return t.createBufferSinks(e)}));Promise.all(i).then((function(e){e.forEach((function(e){e&&(r[e.getType()]=e)})),t(r)})).catch((function(){t(r)}))}));var e})).then((function(t){if(m=!1,0===n.length){var a="No streams to play.";x.error(new S.Z(w.MANIFEST_ERROR_ID_NOSTREAMS_CODE,a,D.getValue())),r.fatal(a)}else oe();e&&H.createTracks(Y),i(t)})).catch((function(e){o(e)}))}))}function j(t,i){var s,l=M.getAllMediaInfoForType(Y,t),c=[],f=null;if(!l||0===l.length)return r.info("No "+t+" data."),Promise.resolve();t===a.Z.VIDEO&&(d=!0),t===a.Z.AUDIO&&(h=!0);for(var g=0,m=l.length;g<m;g++)f=l[g],t===a.Z.TEXT&&f.isEmbedded&&(H.addEmbeddedTrack(Y,f),c.push(f)),$(f)&&Z.addTrack(f);if(c.length>0&&(Z.setInitialMediaSettingsForType(t,Y),H.addMediaInfosToBuffer(Y,t,c)),0===(l=l.filter((function(e){return!e.isEmbedded}))).length)return Promise.resolve();if(t===a.Z.IMAGE)return(y=Ft(R).create({streamInfo:Y,adapter:M,baseURLController:e.baseURLController,timelineConverter:e.timelineConverter,debug:_,eventBus:I,events:u.Z,dashConstants:o.Z,dashMetrics:e.dashMetrics,segmentBaseController:e.segmentBaseController})).initialize(),Promise.resolve();I.trigger(u.Z.STREAM_INITIALIZING,{streamInfo:Y,mediaInfo:f}),Z.setInitialMediaSettingsForType(t,Y);var v=function(t,r){var i=t&&t.length>0?t[0]:null,o=p.getModel(i?i.type:null),s=i?i.type:null,l=i?i.mimeType:null,u=i?i.isFragmented:null,c=ae(R).create({streamInfo:Y,type:s,mimeType:l,timelineConverter:P,adapter:M,manifestModel:D,mediaPlayerModel:L,fragmentModel:o,dashMetrics:e.dashMetrics,baseURLController:e.baseURLController,segmentBaseController:e.segmentBaseController,abrController:F,playbackController:U,mediaController:Z,textController:H,errHandler:x,settings:q,boxParser:T,segmentBlacklistController:E});c.initialize(r,d,u),n.push(c);for(var f=0;f<t.length;f++)c.addMediaInfo(t[f]);return s===a.Z.TEXT&&H.addMediaInfosToBuffer(Y,s,t,o),c}(l,i);return(s=Z.getCurrentTrackFor(t,Y.id))?(F.updateTopQualityIndex(s),v.selectMediaInfo(t===a.Z.TEXT&&s.isEmbedded?l[0]:s)):Promise.resolve()}function $(e){var t,n=e?e.type:null;return n===a.Z.MUXED?(t="Multiplexed representations are intentionally not supported, as they are not compliant with the DASH-AVC/264 guidelines",r.fatal(t),x.error(new S.Z(w.MANIFEST_ERROR_ID_MULTIPLEXED_CODE,t,D.getValue())),!1):!(n!==a.Z.TEXT&&n!==a.Z.IMAGE&&e.contentProtection&&!k.supportsEncryptedMedia()&&(x.error(new S.Z(w.CAPABILITY_MEDIAKEYS_ERROR_CODE,w.CAPABILITY_MEDIAKEYS_ERROR_MESSAGE)),1))}function z(e){for(var t=n?n.length:0,r=0;r<t;r++){var i=n[r].getFragmentModel();i.abortRequests(),i.resetInitialSettings(),n[r].reset(!1,e)}H&&H.deactivateStream(Y),n=[],s=!1,c=!1,pe(!1),Q(!1),I.trigger(u.Z.STREAM_DEACTIVATED,{streamInfo:Y})}function W(e){z(e),i=!1,d=!1,h=!1,g={},m=!1,A=!1,b=[]}function Q(e){A=e}function J(){return Y?Y.start:NaN}function ee(){return Y?Y.id:null}function te(){return Y}function re(){if(!K||!F)throw new Error(a.Z.MISSING_CONFIG_ERROR)}function ne(e){e.error&&(x.error(e.error),r.fatal(e.error.message))}function ie(){if(B){var e=M.getEventsFor(Y);e&&e.length>0&&B.addInlineEvents(e,Y.id)}}function oe(){for(var e=n.length,t=g.audio||g.video?new S.Z(w.DATA_UPDATE_FAILED_ERROR_CODE,w.DATA_UPDATE_FAILED_ERROR_MESSAGE):null,r=0;r<e;r++)if(n[r].isUpdating()||m)return;if(G){G.clearMediaInfoArray();for(var o=0;o<e&&n[o];o++){var s=n[o].getType(),l=n[o].getMediaInfo();if(s===a.Z.AUDIO||s===a.Z.VIDEO||s===a.Z.TEXT&&l.isFragmented){var c=n[o].getMediaInfo();c&&G.initializeForMedia(c)}}G.handleKeySystemFromManifest()}t?x.error(t):i||(i=!0,K.waitForReadyState(a.Z.VIDEO_ELEMENT_READY_STATES.HAVE_METADATA,(function(){I.trigger(u.Z.STREAM_INITIALIZED,{streamInfo:Y})})))}function se(){var e=de(),t=e.length;if(0!==t){for(var n=0;n<t;n++)if(!e[n].isBufferingCompleted()&&(e[n].getType()===a.Z.AUDIO||e[n].getType()===a.Z.VIDEO))return void r.debug("onBufferingCompleted - One streamProcessor has finished but",e[n].getType(),"one is not buffering completed");r.debug("onBufferingCompleted - trigger STREAM_BUFFERING_COMPLETED"),c=!0,I.trigger(u.Z.STREAM_BUFFERING_COMPLETED,{streamInfo:Y},{streamInfo:Y})}else r.warn("onBufferingCompleted - can't trigger STREAM_BUFFERING_COMPLETED because no streamProcessor is defined")}function le(e){g[e.mediaType]=e.error,oe()}function ue(e){B&&B.addInbandEvents(e.events,Y.id)}function ce(e){return e&&e.type?fe(e.type):null}function fe(e){return e?de().filter((function(t){return t.getType()===e}))[0]:null}function de(){for(var e,t,r=[],i=0;i<n.length;i++)(e=(t=n[i]).getType())!==a.Z.AUDIO&&e!==a.Z.VIDEO&&e!==a.Z.TEXT||r.push(t);return r}function he(e,t){var r=te(),n=t.getStreamInfo();if(!n||!r)return!0;var i=M.getAdaptationForType(n.index,e,n),a=M.getAdaptationForType(r.index,e,r);return i&&a?!(!ge(a)&&ge(i)):!i&&!a}function ge(e){return!!e&&!!(e.ContentProtection||e.Representation_asArray&&e.Representation_asArray.length>0&&e.Representation_asArray[0].ContentProtection)}function me(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!e||!e.hasOwnProperty("getStreamInfo"))return!1;var n=e.getStreamInfo(),i=r?r.getStreamInfo():te();if(!n||!i)return!1;var a=M.getAdaptationForType(n.index,t,n),o=M.getAdaptationForType(i.index,t,i);if(!a||!o)return!a&&!o;var s=a&&o&&a.mimeType===o.mimeType,l=o.Representation_asArray.map((function(e){return e.codecs})),u=a.Representation_asArray.map((function(e){return e.codecs})),c=u.some((function(e){return l.indexOf(e)>-1})),f=u.some((function(e){return l.some((function(t){return k.codecRootCompatibleWithCodec(t,e)}))}));return c||f&&s}function pe(e){v=e}function ye(){return v}return t={initialize:function(){I.on(u.Z.BUFFERING_COMPLETED,se,t),I.on(u.Z.DATA_UPDATE_COMPLETED,le,t),I.on(u.Z.INBAND_EVENTS,ue,t),G&&(I.on(u.Z.KEY_ERROR,ne,t),I.on(u.Z.SERVER_CERTIFICATE_UPDATED,ne,t),I.on(u.Z.LICENSE_REQUEST_COMPLETE,ne,t),I.on(u.Z.KEY_SYSTEM_SELECTED,ne,t),I.on(u.Z.KEY_SESSION_CREATED,ne,t),I.on(u.Z.KEY_STATUSES_CHANGED,ne,t)),H.initializeForStream(Y),I.trigger(u.Z.STREAM_UPDATED,{streamInfo:Y})},getStreamId:function(){return Y?Y.id:null},activate:function(e,t){return new Promise((function(r,n){if(!s)return ye()?(s=!0,I.trigger(u.Z.STREAM_ACTIVATED,{streamInfo:Y}),void r(t)):void(i=e,a=t,V(i,a)).then((function(e){s=!0,I.trigger(u.Z.STREAM_ACTIVATED,{streamInfo:Y}),r(e)})).catch((function(e){n(e)}));var i,a;r(t)}))},deactivate:z,getIsActive:function(){return s},getDuration:function(){return Y?Y.duration:NaN},getStartTime:J,getId:ee,getStreamInfo:te,getHasAudioTrack:function(){return h},getHasVideoTrack:function(){return d},startPreloading:function(e,t){return new Promise((function(i,a){ye()?a():(r.info("[startPreloading] Preloading next stream with id ".concat(ee())),pe(!0),V(e,t).then((function(){for(var e=0;e<n.length&&n[e];e++)n[e].setExplicitBufferingTime(J()),n[e].getScheduleController().startScheduleTimer();i()})).catch((function(){pe(!1),a()})))}))},initializeForTextWithMediaSource:function(e){return new Promise((function(t,r){j(a.Z.TEXT,e).then((function(){return(e=fe(a.Z.TEXT))?e.createBufferSinks():Promise.resolve();var e})).then((function(){H.createTracks(Y),t()})).catch((function(e){r(e)}))}))},getThumbnailController:function(){return y},getBitrateListFor:function(e){if(re(),e===a.Z.IMAGE)return y?y.getBitrateList():[];var t=function(e){for(var t=null,r=0;r<n.length;r++)if((t=n[r]).getType()===e)return t.getMediaInfo();return null}(e);return F.getBitrateList(t)},updateData:function(e){return new Promise((function(t){m=!0,Y=e,B&&ie();for(var r=[],i=0,a=n.length;i<a;i++){var o=n[i],s=o.getMediaInfo();r.push(o.updateStreamInfo(Y));var l=M.getAllMediaInfoForType(Y,o.getType());if(l=l.filter((function(e){return!e.isEmbedded}))){o.clearMediaInfoArray();for(var c=0;c<l.length;c++){var f=l[c];o.addMediaInfo(l[c]),M.areMediaInfosEqual(s,f)&&(F.updateTopQualityIndex(f),r.push(o.selectMediaInfo(f)))}}}Promise.all(r).then((function(){for(r=[];b.length>0;){var e=b.pop(),t=e.newMediaInfo,n=ce(e.oldMediaInfo);if(!n)return;r.push(n.prepareTrackSwitch()),r.push(n.selectMediaInfo(t))}return Promise.all(r)})).then((function(){m=!1,oe(),I.trigger(u.Z.STREAM_UPDATED,{streamInfo:Y}),t()}))}))},reset:function(e){p&&(p.reset(),p=null),F&&Y&&F.clearDataForStream(Y.id),E&&(E.reset(),E=null),W(e),Y=null,I.off(u.Z.DATA_UPDATE_COMPLETED,le,t),I.off(u.Z.BUFFERING_COMPLETED,se,t),I.off(u.Z.INBAND_EVENTS,ue,t),G&&(I.off(u.Z.KEY_ERROR,ne,t),I.off(u.Z.SERVER_CERTIFICATE_UPDATED,ne,t),I.off(u.Z.LICENSE_REQUEST_COMPLETE,ne,t),I.off(u.Z.KEY_SYSTEM_SELECTED,ne,t),I.off(u.Z.KEY_SESSION_CREATED,ne,t),I.off(u.Z.KEY_STATUSES_CHANGED,ne,t))},getProcessors:de,setMediaSource:function(e){return new Promise((function(t,i){for(var a=[],o=0;o<n.length;)$(n[o].getMediaInfo())?(a.push(n[o].setMediaSource(e)),o++):(n[o].reset(),n.splice(o,1));Promise.all(a).then((function(){for(var e=0;e<n.length;e++)n[e].dischargePreBuffer();if(0===n.length){var i="No streams to play.";x.error(new S.Z(w.MANIFEST_ERROR_ID_NOSTREAMS_CODE,i+"nostreams",D.getValue())),r.fatal(i)}t()})).catch((function(e){r.error(e),i(e)}))}))},isMediaCodecCompatible:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return me(e,a.Z.VIDEO,t)&&me(e,a.Z.AUDIO,t)},isProtectionCompatible:function(e){return!e||he(a.Z.VIDEO,e)&&he(a.Z.AUDIO,e)},getPreloaded:ye,getIsEndedEventSignaled:function(){return A},setIsEndedEventSignaled:Q,getAdapter:function(){return M},getHasFinishedBuffering:function(){return c},setPreloaded:pe,startScheduleControllers:function(){for(var e=n.length,t=0;t<e&&n[t];t++)n[t].getScheduleController().startScheduleTimer()},prepareTrackChange:function(e){if(s&&Y){c=!1;var t=e.newMediaInfo,n=D.getValue();M.setCurrentMediaInfo(Y.id,t.type,t);var i=ce(t);if(i){var o=U.getTime();r.info("Stream -  Process track changed at current time "+o),n.refreshManifestOnSwitchTrack?(b.push(e),O.getIsUpdating()||(r.debug("Stream -  Refreshing manifest for switch track"),O.refreshManifest())):i.selectMediaInfo(t).then((function(){t.type!==a.Z.VIDEO&&t.type!==a.Z.AUDIO||F.updateTopQualityIndex(t),i.prepareTrackSwitch()}))}}},prepareQualityChange:function(e){var t=fe(e.mediaType);t&&t.prepareQualityChange(e)}},function(){try{_=(0,f.Z)(R).getInstance(),r=_.getLogger(t),W(),T=(0,Ut.Z)(R).getInstance(),E=Zt(R).create({updateEventName:u.Z.SEGMENT_LOCATION_BLACKLIST_CHANGED,addBlacklistEventName:u.Z.SEGMENT_LOCATION_BLACKLIST_ADD}),p=Mt(R).create({streamInfo:Y,mediaPlayerModel:L,dashMetrics:N,errHandler:x,settings:q,boxParser:T,dashConstants:o.Z,urlUtils:C})}catch(e){throw e}}(),t}Ht.__dashjs_factory_name="Stream";var Kt=c.Z.getClassFactory(Ht),Yt=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t||null,this.type=D.w.CONTENT_STEERING_TYPE,this.responseType="json"},qt=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.version=null,this.ttl=300,this.reloadUri=null,this.pathwayPriority=[],this.pathwayClones=[]};function Vt(){var e,t,r,n,i,a,s,l,u,c,h,g,m,p,y,E=this.context,v=(0,X.Z)(E).getInstance();function T(e){R(e,"baseUrl")}function _(e){R(e,"location")}function S(e){if(e&&e.request&&e.request.serviceLocation&&e.request.requestStartDate&&e.request.requestEndDate&&!isNaN(e.request.bytesTotal)){var t=e.request.serviceLocation,r=e.request.requestEndDate.getTime()-e.request.requestStartDate.getTime();b(t,parseInt(8*e.request.bytesTotal/r*1e3))}}function A(e){e&&e.httpRequest&&e.httpRequest._serviceLocation&&!isNaN(e.throughput)&&b(e.httpRequest._serviceLocation,1e3*e.throughput)}function b(e,t){i[e]||(i[e]=[]),i[e].push(t),i[e].length>4&&i[e].shift()}function R(e,t){if(e&&e.request&&e.request.serviceLocation){var r=e.request.serviceLocation;-1===n[t].all.indexOf(r)&&n[t].all.push(r),n[t].current=r}}function I(){var e=h.getValue(),t=y.getContentSteering(e);return t||(t=m.getServiceDescriptionSettings().contentSteering),t}function C(){return new Promise((function(e){try{var a=I();if(!a||!a.serverUrl)return void e();var l=function(e){var t=e.serverUrl;r&&r.reloadUri&&(t=v.isRelative(r.reloadUri)?v.resolve(r.reloadUri,e.serverUrl):r.reloadUri);var a=[],o=n.baseUrl.all.concat(n.location.all);if(o.length>0){var s=o.map((function(e){return{serviceLocation:e,throughput:function(e){if(!e||!i[e]||0===i[e].length)return-1;var t=i[e].reduce((function(e,t){return e+t}))/i[e].length;return parseInt(t)}(e)}}));s.sort((function(e,t){return t.throughput-e.throughput}));var l="",u="";s.forEach((function(e,t){0!==t&&(l="".concat(l,","),e.throughput>-1&&(u="".concat(u,","))),l="".concat(l).concat(e.serviceLocation),e.throughput>-1&&(u="".concat(u).concat(e.throughput))})),a.push({key:"_DASH_pathway",value:'"'.concat(l,'"')}),a.push({key:"_DASH_throughput",value:u})}return Ke.Z.addAditionalQueryParameterToUrl(t,a)}(a),u=new Yt(l);s.load({request:u,success:function(t){var n;(n=t)&&n[o.Z.CONTENT_STEERING_RESPONSE.VERSION]&&1===parseInt(n[o.Z.CONTENT_STEERING_RESPONSE.VERSION])&&((r=new qt).version=n[o.Z.CONTENT_STEERING_RESPONSE.VERSION],n[o.Z.CONTENT_STEERING_RESPONSE.TTL]&&!isNaN(n[o.Z.CONTENT_STEERING_RESPONSE.TTL])&&(r.ttl=n[o.Z.CONTENT_STEERING_RESPONSE.TTL]),n[o.Z.CONTENT_STEERING_RESPONSE.RELOAD_URI]&&(r.reloadUri=n[o.Z.CONTENT_STEERING_RESPONSE.RELOAD_URI]),n[o.Z.CONTENT_STEERING_RESPONSE.PATHWAY_PRIORITY]&&(r.pathwayPriority=n[o.Z.CONTENT_STEERING_RESPONSE.PATHWAY_PRIORITY]),n[o.Z.CONTENT_STEERING_RESPONSE.PATHWAY_CLONES]&&(r.pathwayClones=n[o.Z.CONTENT_STEERING_RESPONSE.PATHWAY_CLONES],r.pathwayClones=r.pathwayClones.filter((function(e){return(t=e)[o.Z.CONTENT_STEERING_RESPONSE.BASE_ID]&&t[o.Z.CONTENT_STEERING_RESPONSE.ID]&&t[o.Z.CONTENT_STEERING_RESPONSE.URI_REPLACEMENT]&&t[o.Z.CONTENT_STEERING_RESPONSE.URI_REPLACEMENT][o.Z.CONTENT_STEERING_RESPONSE.HOST];var t}))),N()),p.trigger(d.Z.CONTENT_STEERING_REQUEST_COMPLETED,{currentSteeringResponseData:r,url:l}),e()},error:function(n,i,a,o){!function(e,n){try{switch(t.warn("Error fetching data from content steering server",e),n.status){case 410:break;case 429:var i=n&&n.getResponseHeader?n.getResponseHeader("retry-after"):null;null!==i&&(r||(r={}),r.ttl=parseInt(i)),N();break;default:N()}}catch(a){t.error(a)}}(n,o),e(n)},complete:function(){n.baseUrl.all=D(n.baseUrl),n.location.all=D(n.location)}})}catch(c){e(c)}}))}function D(e){return e.all&&0!==e.all.length&&e.current?e.all.filter((function(t){return t===e.current})):[]}function L(e){try{var n=[];return e&&0!==e.length&&r&&r.pathwayClones&&0!==r.pathwayClones.length?(r.pathwayClones.forEach((function(t){var r=e.filter((function(e){return t[o.Z.CONTENT_STEERING_RESPONSE.BASE_ID]===e.serviceLocation})),i=null;if(r&&r.length>0&&(i=r[0]),i){var a=new URL(i.url),s=t[o.Z.CONTENT_STEERING_RESPONSE.URI_REPLACEMENT][o.Z.CONTENT_STEERING_RESPONSE.HOST];s=Ke.Z.stringHasProtocol(s)?s:"".concat(a.protocol,"//").concat(s);var l={synthesizedUrl:"".concat(s).concat(a.pathname),serviceLocation:t[o.Z.CONTENT_STEERING_RESPONSE.ID],queryParams:t[o.Z.CONTENT_STEERING_RESPONSE.URI_REPLACEMENT][o.Z.CONTENT_STEERING_RESPONSE.PARAMS],reference:i};n.push(l)}})),n):n}catch(i){return t.error(i),[]}}function N(){r&&r.ttl&&!isNaN(r.ttl)&&(a&&clearTimeout(a),a=setTimeout((function(){C()}),1e3*r.ttl))}function O(){a&&clearTimeout(a),a=null}function M(){r=null,i={},n={baseUrl:{current:null,all:[]},location:{current:null,all:[]}},O()}return e={reset:function(){M(),p.off(d.Z.FRAGMENT_LOADING_STARTED,T,e),p.off(d.Z.MANIFEST_LOADING_STARTED,_,e),p.off(d.Z.MANIFEST_LOADING_FINISHED,S,e),p.off(d.Z.THROUGHPUT_MEASUREMENT_STORED,A,e)},setConfig:function(e){e&&(e.adapter&&(y=e.adapter),e.errHandler&&(l=e.errHandler),e.dashMetrics&&(u=e.dashMetrics),e.mediaPlayerModel&&(c=e.mediaPlayerModel),e.requestModifier&&(g=e.requestModifier),e.manifestModel&&(h=e.manifestModel),e.serviceDescriptionController&&(m=e.serviceDescriptionController),e.eventBus&&(p=e.eventBus))},loadSteeringData:C,getCurrentSteeringResponseData:function(){return r},shouldQueryBeforeStart:function(){var e=I();return!!e&&e.queryBeforeStart},getSteeringDataFromManifest:I,stopSteeringRequestTimer:O,getSynthesizedBaseUrlElements:function(e){try{return L(e).map((function(e){var t=new Se(e.synthesizedUrl,e.serviceLocation);return t.queryParams=e.queryParams,t.dvbPriority=e.reference.dvbPriority,t.dvbWeight=e.reference.dvbWeight,t.availabilityTimeOffset=e.reference.availabilityTimeOffset,t.availabilityTimeComplete=e.reference.availabilityTimeComplete,t}))}catch(r){return t.error(r),[]}},getSynthesizedLocationElements:function(e){try{return L(e).map((function(e){var t=new Me(e.synthesizedUrl,e.serviceLocation);return t.queryParams=e.queryParams,t}))}catch(r){return t.error(r),[]}},initialize:function(){s=St(E).create({errHandler:l,dashMetrics:u,mediaPlayerModel:c,requestModifier:g,errors:w}),p.on(d.Z.FRAGMENT_LOADING_STARTED,T,e),p.on(d.Z.MANIFEST_LOADING_STARTED,_,e),p.on(d.Z.MANIFEST_LOADING_FINISHED,S,e),p.on(d.Z.THROUGHPUT_MEASUREMENT_STORED,A,e)}},t=(0,f.Z)(E).getInstance().getLogger(e),M(),e}Vt.__dashjs_factory_name="ContentSteeringController";var jt=c.Z.getSingletonFactory(Vt);function $t(){var e,t,r,n=this.context,i=(0,C.Z)(n).getInstance();return e={select:function(e){if(!e||0===e.length)return null;var n,a,o=null;return i.get().streaming.applyContentSteering&&(n=e,o=(a=r.getCurrentSteeringResponseData())&&a.pathwayPriority&&a.pathwayPriority.length>0?function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=0,i=null,a=function(){var a=e[n],o=r.findIndex((function(e){return e.serviceLocation&&e.serviceLocation===a}));if(-1!==o&&!t.contains(r[o].serviceLocation))return i=r[o],"break";n+=1};n<e.length&&"break"!==a(););return i}(a.pathwayPriority,n):null),o||(o=function(e){return e[0]}(e)),o},setConfig:function(e){e.blacklistController&&(t=e.blacklistController),e.contentSteeringController&&(r=e.contentSteeringController)},reset:function(){t.reset()}},t=Zt(n).create({updateEventName:u.Z.SERVICE_LOCATION_LOCATION_BLACKLIST_CHANGED,addBlacklistEventName:u.Z.SERVICE_LOCATION_LOCATION_BLACKLIST_ADD}),r=jt(n).getInstance(),e}$t.__dashjs_factory_name="LocationSelector";var zt=c.Z.getClassFactory($t);function Wt(){var e,t,r,n,i,a,s,c,h,g,m,p,y,E,v=this.context,T=(0,l.Z)(v).getInstance(),_=(0,X.Z)(v).getInstance();function S(){r=NaN,s=!1,i=!0,a=!1,A()}function A(){null!==n&&(clearTimeout(n),n=null)}function b(e){A(),a||(isNaN(e)&&!isNaN(r)&&(e=1e3*r),isNaN(e)||(t.debug("Refresh manifest in "+e+" milliseconds."),n=setTimeout(D,e)))}function R(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];s=!0;var t=h.getValue(),r=t.url,n=null,i=m.getPatchLocation(t),a=g.select(i),o=null;if(a&&!e)r=a.url,n=a.serviceLocation,o=a.queryParams;else{var l=I(t),u=g.select(l);u&&(r=u.url,n=u.serviceLocation,o=u.queryParams)}_.isRelative(r)&&(r=_.resolve(r,t.url)),c.load(r,n,o)}function I(e){var t=m.getLocation(e),r=y.getSynthesizedLocationElements(t);return t.concat(r)}function C(e){if(e){if(m.getIsPatch(e)){var n=e;e=h.getValue();var l=m.isPatchValid(e,n),c=l;if(l){var f=m.getPublishTime(e);c=m.applyPatchToManifest(e,n);var d=m.getPublishTime(e);c=f.getTime()!=d.getTime()}if(!c)return t.debug("Patch provided is invalid, performing full manifest refresh"),void R(!0);e.loadedTime=new Date}}else(e=h.getValue()).loadedTime=new Date;if(h.getValue()&&h.getValue().type===o.Z.DYNAMIC&&e.type===o.Z.STATIC)return T.trigger(u.Z.DYNAMIC_TO_STATIC),s=!1,void(a=!0);h.setValue(e);var g=new Date,p=(g.getTime()-e.loadedTime.getTime())/1e3;1e3*(r=m.getManifestUpdatePeriod(e,p))>2147483647&&(r=2147483.647),T.trigger(u.Z.MANIFEST_UPDATED,{manifest:e}),t.info("Manifest has been refreshed at "+g+"["+g.getTime()/1e3+"] "),i||b()}function D(){i||(s?b(E.get().streaming.manifestUpdateRetryInterval):R())}function L(e){e.error?e.error.code===w.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE&&p.error(e.error):C(e.manifest)}function N(){i=!1,b()}function O(){(i=!E.get().streaming.scheduling.scheduleWhilePaused)&&A()}function M(){s=!1}return e={initialize:function(){S(),T.on(u.Z.STREAMS_COMPOSED,M,this),T.on(d.Z.PLAYBACK_STARTED,N,this),T.on(d.Z.PLAYBACK_PAUSED,O,this),T.on(u.Z.INTERNAL_MANIFEST_LOADED,L,this)},setManifest:function(e){C(e)},refreshManifest:R,getIsUpdating:function(){return s},setConfig:function(e){e&&(e.manifestModel&&(h=e.manifestModel),e.adapter&&(m=e.adapter),e.manifestLoader&&(c=e.manifestLoader),e.errHandler&&(p=e.errHandler),e.locationSelector&&(g=e.locationSelector),e.settings&&(E=e.settings),e.contentSteeringController&&(y=e.contentSteeringController))},reset:function(){T.off(d.Z.PLAYBACK_STARTED,N,this),T.off(d.Z.PLAYBACK_PAUSED,O,this),T.off(u.Z.STREAMS_COMPOSED,M,this),T.off(u.Z.INTERNAL_MANIFEST_LOADED,L,this),S()}},t=(0,f.Z)(v).getInstance().getLogger(e),g=zt(v).create(),e}Wt.__dashjs_factory_name="ManifestUpdater";var Xt=c.Z.getClassFactory(Wt);function Qt(){var e,t,r,n,i,a,o,s,c,d,h,g,m,p,y,E,v=this.context,T=(0,l.Z)(v).getInstance(),_=(0,X.Z)(v).getInstance();function A(){s=[],c=[],d=null,h=null,m=null,g=NaN,r=!1,n=!1,p=i.get().streaming.utcSynchronization.timeBetweenSyncAttempts}function b(){i.get().streaming.utcSynchronization.enabled&&!r&&!n&&m&&m.value&&m.schemeIdUri&&!isNaN(g)&&!isNaN(i.get().streaming.utcSynchronization.backgroundAttempts)&&(h&&(Date.now()-h)/1e3<30||(s=[],n=!0,R(isNaN(i.get().streaming.utcSynchronization.backgroundAttempts)?2:i.get().streaming.utcSynchronization.backgroundAttempts)))}function R(e){try{if(e<=0)return void Z();var t=Date.now();a[m.schemeIdUri](m.value,(function(r){var n=Date.now(),i=C(t,n,r);s.push(i),R(e-1)}),(function(){Z()}))}catch(r){Z()}}function I(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||0;if(!c||0===c.length||e>=c.length)L();else{var t=c[e];if(t)if(a.hasOwnProperty(t.schemeIdUri)){var r=(new Date).getTime();a[t.schemeIdUri](t.value,(function(e){var n=(new Date).getTime(),i=C(r,n,e);m=t,L(i)}),(function(){I(e+1)}))}else I(e+1);else L()}}function C(e,t,r){return r-(t-(t-e)/2)}function L(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN,t=isNaN(e);t&&i.get().streaming.utcSynchronization.useManifestDateHeaderTimeSource?U():B(t,e)}function N(e){var t,r,n,i=Date.parse(e);return isNaN(i)&&(n=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+\-])([0-9]{2})([0-9]{2}))?/.exec(e),t=Date.UTC(parseInt(n[1],10),parseInt(n[2],10)-1,parseInt(n[3],10),parseInt(n[4],10),parseInt(n[5],10),n[6]&&(parseInt(n[6],10)||0),n[7]&&1e3*parseFloat(n[7])||0),n[9]&&n[10]&&(r=60*parseInt(n[9],10)+parseInt(n[10],10),t+=("+"===n[8]?-1:1)*r*60*1e3),i=new Date(t).getTime()),i}function O(e){return Date.parse(e)}function M(e){return Date.parse(e)}function P(e,t,r){r()}function k(e,t,r){var n=N(e);isNaN(n)?r():t(n)}function x(e,t,r,n,i){var a,o,s=!1,l=new XMLHttpRequest,u=i?D.w.HEAD:D.w.GET,c=t.match(/\S+/g);if(t=c.shift(),a=function(){s||(s=!0,c.length?x(e,c.join(" "),r,n,i):n())},o=function(){var t,n;200===l.status&&(t=i?l.getResponseHeader("Date"):l.response,n=e(t),isNaN(n)||(r(n),s=!0))},_.isRelative(t)){var f=E.resolve();f&&(t=_.resolve(t,f.url))}l.open(u,t),l.timeout=5e3,l.onload=o,l.onloadend=a,l.send()}function F(e,t,r){x(M,e,t,r,!0)}function U(){var e=o.getLatestMPDRequestHeaderValueByID("Date"),t=null!==e?new Date(e).getTime():Number.NaN;isNaN(t)?B(!0):B(!1,t-Date.now())}function B(e,n){if(isNaN(g)||isNaN(n)||e||function(e){try{var r,n=G(e),a=isNaN(p)?30:p,o=isNaN(i.get().streaming.utcSynchronization.timeBetweenSyncAttemptsAdjustmentFactor)?2:i.get().streaming.utcSynchronization.timeBetweenSyncAttemptsAdjustmentFactor,s=isNaN(i.get().streaming.utcSynchronization.maximumTimeBetweenSyncAttempts)?600:i.get().streaming.utcSynchronization.maximumTimeBetweenSyncAttempts,l=isNaN(i.get().streaming.utcSynchronization.minimumTimeBetweenSyncAttempts)?2:i.get().streaming.utcSynchronization.minimumTimeBetweenSyncAttempts;n?(r=Math.min(a*o,s),t.debug("Increasing timeBetweenSyncAttempts to ".concat(r))):(r=Math.max(a/o,l),t.debug("Decreasing timeBetweenSyncAttempts to ".concat(r))),p=r}catch(u){}}(n),!e&&!isNaN(n)){d=Date.now(),r=!1;var a=isNaN(g);g=n,a&&b(),t.debug("Completed UTC sync. Setting client - server offset to ".concat(n))}e&&(m=null,r=!1,y.error(new S.Z(w.TIME_SYNC_FAILED_ERROR_CODE,w.TIME_SYNC_FAILED_ERROR_MESSAGE))),T.trigger(u.Z.UPDATE_TIME_SYNC_OFFSET,{offset:n}),T.trigger(u.Z.TIME_SYNCHRONIZATION_COMPLETED)}function Z(){if(s&&0!==s.length){var e=s.reduce((function(e,t){return e+t}),0)/s.length;G(e)?t.debug("Completed background UTC sync. Offset is within allowed threshold and is not adjusted."):(t.debug("Completed background UTC sync. Setting client - server offset to ".concat(e)),g=e,T.trigger(u.Z.UPDATE_TIME_SYNC_OFFSET,{offset:g})),n=!1,h=Date.now()}}function G(e){try{if(isNaN(g))return!0;var t=i.get().streaming.utcSynchronization.maximumAllowedDrift&&!isNaN(i.get().streaming.utcSynchronization.maximumAllowedDrift)?i.get().streaming.utcSynchronization.maximumAllowedDrift:100;return e>=g-t&&e<=g+t}catch(r){return!0}}return e={initialize:function(){A(),a={"urn:mpeg:dash:utc:http-head:2014":F,"urn:mpeg:dash:utc:http-xsdate:2014":x.bind(null,N),"urn:mpeg:dash:utc:http-iso:2014":x.bind(null,O),"urn:mpeg:dash:utc:direct:2014":k,"urn:mpeg:dash:utc:http-head:2012":F,"urn:mpeg:dash:utc:http-xsdate:2012":x.bind(null,N),"urn:mpeg:dash:utc:http-iso:2012":x.bind(null,O),"urn:mpeg:dash:utc:direct:2012":k,"urn:mpeg:dash:utc:http-ntp:2014":P,"urn:mpeg:dash:utc:ntp:2014":P,"urn:mpeg:dash:utc:sntp:2014":P}},attemptSync:function(e,t){c=e,r||(function(e){try{if(!e||!i.get().streaming.utcSynchronization.enabled)return!1;var t=isNaN(p)?30:p;return!(d&&t&&!isNaN(t))||(Date.now()-d)/1e3>=t}catch(r){return!0}}(t)?(r=!0,I()):T.trigger(u.Z.TIME_SYNCHRONIZATION_COMPLETED))},setConfig:function(e){e&&(e.dashMetrics&&(o=e.dashMetrics),e.baseURLController&&(E=e.baseURLController),e.errHandler&&(y=e.errHandler),e.settings&&(i=e.settings))},reset:function(){A(),T.off(u.Z.ATTEMPT_BACKGROUND_SYNC,b,e)}},t=(0,f.Z)(v).getInstance().getLogger(e),T.on(u.Z.ATTEMPT_BACKGROUND_SYNC,b,e),e}Qt.__dashjs_factory_name="TimeSyncController";var Jt=c.Z.getSingletonFactory(Qt);Jt.HTTP_TIMEOUT_MS=5e3,c.Z.updateSingletonFactory(Qt.__dashjs_factory_name,Jt);var er=Jt;function tr(){var e,t,r,n,i,a=this.context,o=(0,l.Z)(a).getInstance();return e={attachMediaSource:function(e){var r=window.URL.createObjectURL(t);return e.setSource(r),"managedMediaSource"===n&&(e.setDisableRemotePlayback(!0),t.addEventListener("startstreaming",(function(){o.trigger(d.Z.MANAGED_MEDIA_SOURCE_START_STREAMING)})),t.addEventListener("endstreaming",(function(){o.trigger(d.Z.MANAGED_MEDIA_SOURCE_END_STREAMING)}))),r},createMediaSource:function(){var e="WebKitMediaSource"in window,r="MediaSource"in window;return"ManagedMediaSource"in window?(t=new ManagedMediaSource,n="managedMediaSource",i.info("Created ManagedMediaSource")):r?(t=new MediaSource,n="mediaSource",i.info("Created MediaSource")):e&&(t=new WebKitMediaSource,i.info("Created WebkitMediaSource")),t},detachMediaSource:function(e){e.setSource(null)},setConfig:function(e){e&&e.settings&&(r=e.settings)},setDuration:function e(n){t&&"open"===t.readyState&&(null===n&&isNaN(n)||t.duration!==n&&(n!==1/0||r.get().streaming.buffer.mediaSourceDurationInfinity||(n=Math.pow(2,32)),function(e){for(var t=e.sourceBuffers,r=0;r<t.length;r++)if(t[r].updating)return!0;return!1}(t)?setTimeout(e.bind(null,n),50):(i.info("Set MediaSource duration:"+n),t.duration=n)))},setSeekable:function(e,r){t&&"function"==typeof t.setLiveSeekableRange&&"function"==typeof t.clearLiveSeekableRange&&"open"===t.readyState&&e>=0&&e<r&&(t.clearLiveSeekableRange(),t.setLiveSeekableRange(e,r))},signalEndOfStream:function(e){if(e&&"open"===e.readyState){for(var t=e.sourceBuffers,r=0;r<t.length;r++){if(t[r].updating)return;if(0===t[r].buffered.length)return}i.info("call to mediaSource endOfStream"),e.endOfStream()}}},i=(0,f.Z)(a).getInstance().getLogger(e),e}tr.__dashjs_factory_name="MediaSourceController";var rr=c.Z.getSingletonFactory(tr);function nr(){var e,t,r,n,i,a,o,s,u,c,h,g="urn:mpeg:dash:event:2012",m="discarded",p="updated",y="added",E=this.context,v=(0,l.Z)(E).getInstance();function T(){if(!o||!s)throw new Error("setConfig function has to be called previously")}function _(){h=!1,r={},n={},i=null,c=!1,a=Date.now()/1e3}function S(){try{if(!c){c=!0;var e=s.getTime(),i=e-a;i=a>0?Math.max(0,i):0,A(n,i,e),A(r,i,e),b(n),b(r),a=e,c=!1}}catch(o){c=!1,t.error(o)}}function A(e,r,n){try{C(e,(function(i){if(void 0!==i){var a=isNaN(i.duration)?0:i.duration;i.calculatedPresentationTime<=n&&i.calculatedPresentationTime+r+a>=n?L(i,d.Z.EVENT_MODE_ON_START):(D(n,a+r,i.calculatedPresentationTime)||function(e){try{var r=e.eventStream.period.start+e.eventStream.period.duration;return e.calculatedPresentationTime>r}catch(n){return t.error(n),!1}}(i))&&(t.debug("Removing event ".concat(i.id," from period ").concat(i.eventStream.period.id," as it is expired or invalid")),function(e,r){try{var n=r.eventStream.schemeIdUri,i=r.eventStream.period.id,a=r.eventStream.value,o=r.id;e[i][n]=e[i][n].filter((function(e){return a&&e.eventStream.value&&e.eventStream.value!==a||e.id!==o})),0===e[i][n].length&&delete e[i][n]}catch(s){t.error(s)}}(e,i))}}))}catch(i){t.error(i)}}function b(e){try{for(var r in e)e.hasOwnProperty(r)&&0===Object.keys(e[r]).length&&delete e[r]}catch(n){t.error(n)}}function R(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=e.eventStream.schemeIdUri,i=e.eventStream.value,a=e.id,o=m;t[n]||(t[n]=[]);var s=t[n].findIndex((function(e){return(!i||e.eventStream.value&&e.eventStream.value===i)&&e.id===a}));if(-1===s)t[n].push(e),e.triggeredReceivedEvent=!1,e.triggeredStartEvent=!1,o=y;else if(r){var l=t[n][s];e.triggeredReceivedEvent=l.triggeredReceivedEvent,e.triggeredStartEvent=l.triggeredStartEvent,t[n][s]=e,o=p}return o}function I(e){try{if(1==e.eventStream.value){var r,n=e.calculatedPresentationTime;r=4294967295==e.calculatedPresentationTime?NaN:e.calculatedPresentationTime+e.duration,v.trigger(d.Z.MANIFEST_VALIDITY_CHANGED,{id:e.id,validUntil:n,newDuration:r,newManifestValidAfter:NaN},{mode:d.Z.EVENT_MODE_ON_START})}}catch(i){t.error(i)}}function w(e){try{var r=s.getTime();C(e,(function(e){var t=e.eventStream&&e.eventStream.period&&!isNaN(e.eventStream.period.duration)?e.eventStream.period.duration:NaN,n=e.eventStream&&e.eventStream.period&&!isNaN(e.eventStream.period.start)?e.eventStream.period.start:NaN;if(!isNaN(t)&&!isNaN(n)){var i=e.calculatedPresentationTime;Math.abs(i-r)<300&&L(e,d.Z.EVENT_MODE_ON_START)}}))}catch(n){t.error(n)}}function C(e,r){try{if(e)for(var n=Object.keys(e),i=0;i<n.length;i++)for(var a=e[n[i]],o=Object.keys(a),s=0;s<o.length;s++)a[o[s]].forEach((function(e){void 0!==e&&r(e)}))}catch(l){t.error(l)}}function D(e,r,n){try{return e-r>n}catch(i){return t.error(i),!1}}function L(e,r){try{var n=s.getTime(),i=e.id;if(r===d.Z.EVENT_MODE_ON_RECEIVE&&!e.triggeredReceivedEvent)return t.debug("Received event ".concat(i)),e.triggeredReceivedEvent=!0,void v.trigger(e.eventStream.schemeIdUri,{event:e},{mode:r});e.triggeredStartEvent||(e.eventStream.schemeIdUri===g&&1==e.eventStream.value?0===e.duration&&0===e.presentationTimeDelta||(t.debug("Starting manifest refresh event ".concat(i," at ").concat(n)),function(){try{T(),o.refreshManifest()}catch(e){t.error(e)}}()):"urn:mpeg:dash:event:callback:2015"===e.eventStream.schemeIdUri&&1==e.eventStream.value?(t.debug("Starting callback event ".concat(i," at ").concat(n)),function(e){try{(0,se.Z)(E).create({}).load({method:"get",url:e,request:{responseType:"arraybuffer"}})}catch(r){t.error(r)}}(e.messageData)):(t.debug("Starting event ".concat(i," from period ").concat(e.eventStream.period.id," at ").concat(n)),v.trigger(e.eventStream.schemeIdUri,{event:e},{mode:r})),e.triggeredStartEvent=!0)}catch(a){t.error(a)}}return e={addInlineEvents:function(e,n){try{if(T(),r[n]||(r[n]={}),e)for(var i=0;i<e.length;i++){var a=e[i];if(!D(s.getTime(),isNaN(a.duration)?0:a.duration,a.calculatedPresentationTime)){var o=R(a,r[n],!0);o===y?(t.debug("Added inline event with id ".concat(a.id," from period ").concat(n)),L(a,d.Z.EVENT_MODE_ON_RECEIVE)):o===p&&t.debug("Updated inline event with id ".concat(a.id," from period ").concat(n))}}}catch(l){throw l}},addInbandEvents:function(e,r){try{T(),n[r]||(n[r]={});for(var i=0;i<e.length;i++){var a=e[i];D(s.getTime(),isNaN(a.duration)?0:a.duration,a.calculatedPresentationTime)||(R(a,n[r],!1)===y?(a.eventStream.schemeIdUri===g&&I(a),t.debug("Added inband event with id ".concat(a.id," from period ").concat(r)),L(a,d.Z.EVENT_MODE_ON_RECEIVE)):t.debug("Inband event with scheme_id_uri ".concat(a.eventStream.schemeIdUri,", value ").concat(a.eventStream.value,", period id ").concat(r," and event id ").concat(a.id," was ignored because it has been added before.")))}S()}catch(o){throw o}},getInbandEvents:function(){return n},getInlineEvents:function(){return r},start:function(){try{T(),t.debug("Start Event Controller");var e=u.get().streaming.eventControllerRefreshDelay;h||isNaN(e)||(h=!0,i=setInterval(S,e))}catch(r){throw r}},setConfig:function(e){try{if(!e)return;e.manifestUpdater&&(o=e.manifestUpdater),e.playbackController&&(s=e.playbackController),e.settings&&(u=e.settings)}catch(t){throw t}},reset:function(){(function(){try{null!==i&&h&&(clearInterval(i),i=null,h=!1,function(){try{w(n),w(r)}catch(e){t.error(e)}}())}catch(e){throw e}})(),_()}},t=(0,f.Z)(E).getInstance().getLogger(e),_(),e}nr.__dashjs_factory_name="EventController";var ir=c.Z.getSingletonFactory(nr),ar={LEVELS:{SUGGESTION:"Suggestion",WARNING:"Warning",ERROR:"Error"},EVENTS:{NO_UTC_TIMING_ELEMENT:{key:"NO_UTC_TIMING_ELEMENT",message:"No UTCTiming element is present in the manifest. You may experience playback failures. For a detailed validation use https://conformance.dashif.org/"},NON_COMPLIANT_SMPTE_IMAGE_ATTRIBUTE:{key:"NON_COMPLIANT_SMPTE_IMAGE_ATTRIBUTE",message:'SMPTE 2052-1:2013 defines the attribute name as "imageType" and does not define "imagetype"'},INVALID_DVR_WINDOW:{key:"INVALID_DVR_WINDOW",message:"No valid segment found when applying a specification compliant DVR window calculation. Using SegmentTimeline entries as a fallback."}}};function or(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function sr(){var e,t,r,n,i,o,c,h,g,m,p,y,E,v,T,_,A,b,R,I,C,D,L,N,O,M,P,x,F,U,B,Z,G,H,K,Y,q,V,j,$,z,W,X,Q,te,re,ne,ie,ae=this.context,oe=(0,l.Z)(ae).getInstance();function se(){if(!(o&&o.hasOwnProperty("load")&&C&&C.hasOwnProperty("initialize")&&C.hasOwnProperty("reset")&&C.hasOwnProperty("getClientTimeOffset")&&c&&I&&g&&G))throw new Error(a.Z.MISSING_CONFIG_ERROR)}function le(){if(!i||!i.hasOwnProperty("setManifest"))throw new Error("initialize function has to be called previously")}function ue(){!function(){try{var e=h.getStreamsInfo();if(!L&&0===e.length)throw new Error("There are no periods in the MPD");L&&e.length>0&&g.updateManifestUpdateInfo({currentTime:G.getTime(),buffered:Z.getBufferRange(),presentationStartTime:e[0].start,clientTimeOffset:C.getClientTimeOffset()}),D.length>0&&(0!==(o=e).length?D=D.filter((function(e){var r=o.filter((function(t){return t.id===e.getId()})).length>0||e.getId()===L.getId();return r||(t.debug("Removing stream ".concat(e.getId())),e.reset(!0)),r})):t.warn("No periods included in the current manifest. Skipping the filtering of outdated stream objects."));for(var r=[],n=0,i=e.length;n<i;n++){var a=e[n];r.push(fe(a)),g.addManifestUpdateStreamInfo(a)}Promise.all(r).then((function(){return new Promise((function(t,r){L?t():de(e,t,r)}))})).then((function(){oe.trigger(u.Z.STREAMS_COMPOSED),Oe()})).catch((function(e){throw e}))}catch(o){I.error(new S.Z(w.MANIFEST_ERROR_ID_NOSTREAMS_CODE,o.message+" nostreamscomposed",c.getValue())),U=!0,Xe()}var o}()}function ce(){te=!0}function fe(e){var t=$e(e.id);return t?t.updateData(e):(t=Kt(ae).create({manifestModel:c,mediaPlayerModel:K,dashMetrics:g,manifestUpdater:i,adapter:h,timelineConverter:C,capabilities:r,capabilitiesFilter:n,errHandler:I,baseURLController:E,segmentBaseController:v,textController:O,abrController:_,playbackController:G,eventController:b,mediaController:A,protectionController:N,videoModel:Z,streamInfo:e,settings:Q}),D.push(t),t.initialize(),Promise.resolve())}function de(e,r,n){try{be();var i=g.getCurrentDVRInfo().range;if(i.end<i.start){re&&clearTimeout(re);var a=Math.min(1e3*(-1*(i.end-i.start)+2),2147483647);return t.debug("Waiting for ".concat(a," ms before playback can start")),oe.trigger(u.Z.AST_IN_FUTURE,{delay:a}),void(re=setTimeout((function(){de(e,r,n)}),a))}Q.get().streaming.applyProducerReferenceTime&&H.calculateProducerReferenceTimeOffsets(e);var o=e[0].manifestInfo;if(Q.get().streaming.applyServiceDescription&&H.applyServiceDescription(o),h.getIsDynamic()){var s=Ze(e,o);G.computeAndSetLiveDelay(s,o)}(Q.get().streaming.applyContentSteering&&y.shouldQueryBeforeStart()?y.loadSteeringData():Promise.resolve()).then((function(){var e=c.getValue();e&&E.update(e),he(),r()})).catch((function(e){t.error(e),he(),r()}))}catch(l){n(l)}}function he(){var e=function(){var e;if(h.getIsDynamic()){var r=g.getCurrentDVRInfo();e=(r&&r.range?r.range.end:0)-G.getOriginalLiveDelay();var n=r?r.range:null;if(n){if(isNaN(ne)&&-1===ne.toString().indexOf("posix:")){var i=Fe(!0);isNaN(i)||(t.info("Start time from URI parameters: ".concat(i)),e=Math.min(e,i))}else{t.info("Start time provided by the app: ".concat(ne));var a=Ue(!0,ne);isNaN(a)||(e=Math.min(e,a))}var o=Q.get().streaming.timeShiftBuffer.calcFromSegmentTimeline?.1:0;e=Math.max(e,n.start+o)}}else if(e=Je()[0].getStreamInfo().start,isNaN(ne)){var s=Fe(!1);isNaN(s)||(t.info("Start time from URI parameters: ".concat(s)),e=Math.max(e,s))}else{t.info("Start time provided by the app: ".concat(ne));var l=Ue(!1,ne);isNaN(l)||(e=Math.max(e,l))}return e}(),r=Ae(e),n=null!==r?r:D[0];oe.trigger(u.Z.INITIAL_STREAM_SWITCH,{startTime:e}),ge(n,null,e),$||($=setInterval((function(){!x&&G.getTimeToStreamEnd()<=0&&!G.isSeeking()&&oe.trigger(u.Z.PLAYBACK_ENDED,{isLast:je().isLast})}),200))}function ge(e,r,n){try{if(x||!e||r===e&&e.getIsActive())return;x=!0,oe.trigger(u.Z.PERIOD_SWITCH_STARTED,{fromStreamInfo:r?r.getStreamInfo():null,toStreamInfo:e.getStreamInfo()});var i=!1;L=e,r&&(i=_e(e,r),r.deactivate(i)),n=isNaN(n)?!i&&r?e.getStreamInfo().start:NaN:n,t.info("Switch to stream ".concat(e.getId(),". Seektime is ").concat(n,", current playback time is ").concat(G.getTime(),". Seamless period switch is set to ").concat(i)),W=W.filter((function(e){return e.getId()!==L.getId()})),G.initialize(je(),!!r),Z.getElement()?me(n,i,!1):pe(n,i)}catch(a){x=!1}}function me(e,r){var n,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];function a(){if(B&&"open"===B.readyState){t.debug("MediaSource is open!"),window.URL.revokeObjectURL(n),B.removeEventListener("sourceopen",a),B.removeEventListener("webkitsourceopen",a),xe();var o=g.getCurrentDVRInfo();m.setSeekable(o.range.start,o.range.end),i?(isNaN(e)||G.seek(e,!0,!0),L.setMediaSource(B).then((function(){L.initializeForTextWithMediaSource(B)}))):pe(e,r)}}function o(){B.addEventListener("sourceopen",a,!1),B.addEventListener("webkitsourceopen",a,!1),n=m.attachMediaSource(Z),t.debug("MediaSource attached to element.  Waiting on open...")}B?r?pe(e,r):(m.detachMediaSource(Z),o()):(B=m.createMediaSource(),o())}function pe(e,t){L.activate(B,t?z:void 0,e).then((function(t){if(t){var r=Object.keys(t);r.length>0&&t[r[0]].getBuffer().changeType&&(X=!0),z=t}isNaN(e)||(oe.trigger(u.Z.SEEK_TARGET,{time:e},{streamId:L.getId()}),G.seek(e,!1,!0),L.startScheduleControllers()),x=!1,oe.trigger(u.Z.PERIOD_SWITCH_COMPLETED,{toStreamInfo:je()})}))}function ye(e){var t,r,n,i,a=Ae(e.seekTime);a&&a!==L?a&&a!==L&&(Ee(),r=a,n=(t=e)&&!isNaN(t.seekTime)?t.seekTime:NaN,i=L.getProcessors().map((function(e){return e.prepareOuterPeriodPlaybackSeeking(t)})),Promise.all(i).then((function(){ge(r,L,n)})).catch((function(e){I.error(e)}))):(Ee(),function(e){L.getProcessors().forEach((function(t){return t.prepareInnerPeriodPlaybackSeeking(e)})),Ye(ee.USER_REQUEST_STOP_REASON)}(e)),qe(J.SEEK_START_REASON)}function Ee(){ve()}function ve(){W&&W.length>0&&(W.forEach((function(e){e.deactivate(!0)})),W=[])}function Te(e){if(e.newMediaInfo.streamInfo.id===L.getId()){if(ve(),Q.get().streaming.buffer.resetSourceBuffersForTrackSwitch&&e.oldMediaInfo&&e.oldMediaInfo.codec!==e.newMediaInfo.codec){var t=G.getTime();return L.deactivate(!1),void me(t,!1,!1)}L.prepareTrackChange(e)}}function _e(e,t){try{return Q.get().streaming.buffer.reuseExistingSourceBuffers&&(t.isProtectionCompatible(e)||te)&&(X&&Q.get().streaming.buffer.useChangeTypeForTrackSwitch||t.isMediaCodecCompatible(e,t))}catch(r){return!1}}function Se(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;B&&!e.getPreloaded()&&_e(e,t)&&e.startPreloading(B,z).then((function(){W.push(e)}))}function Ae(e){if(isNaN(e))return null;for(var t=D.length,r=0;r<t;r++){var n=D[r];if(e<parseFloat((n.getStartTime()+n.getDuration()).toFixed(5)))return n}return null}function be(){try{var e=h.getIsDynamic(),t=h.getStreamsInfo()[0].manifestInfo,r=G.getTime(),n=C.calcTimeShiftBufferWindow(D,e),i=Pe();if(void 0===n.start||void 0===n.end)return;i&&0!==i.length?i.forEach((function(e){g.addDVRInfo(e.getType(),r,t,n)})):g.addDVRInfo(a.Z.VIDEO,r,t,n)}catch(o){}}function Re(e){if(V&&P){var t=K.getInitialBufferLevel(),r=[a.Z.TEXT];(isNaN(t)||t<=G.getBufferLevel(r)||h.getIsDynamic()&&t>G.getLiveDelay())&&(V=!1,qe(J.INITIAL_PLAYOUT_START_REASON),G.play())}e&&e.mediaType&&g.addBufferLevel(e.mediaType,new Date,1e3*e.bufferLevel)}function Ie(e){e.streamInfo.id===L.getId()&&e.reason&&e.reason.forceReplace&&ve(),$e(e.streamInfo.id).prepareQualityChange(e)}function we(){if(h.getIsDynamic()&&0!==G.getOriginalLiveDelay()&&L){var e=h.getStreamsInfo();if(e.length>0){var t=e[0].manifestInfo,r=Ze(e,t);G.computeAndSetLiveDelay(r,t)}}}function Ce(){if(He()){var e=Z.getPlaybackQuality();e&&g.addDroppedFrames(e)}}function De(){t.debug("[onPlaybackStarted]"),!V&&q&&qe(J.RESUME_FROM_PAUSE_START_REASON),V&&(V=!1),j&&(j=!1,Q.get().streaming.applyContentSteering&&!y.shouldQueryBeforeStart()&&y.loadSteeringData()),q=!1}function Le(e){t.debug("[onPlaybackPaused]"),e.ended||(q=!0,Ye(ee.USER_REQUEST_STOP_REASON))}function Ne(e){t.debug("Stream with id ".concat(e.streamInfo.id," finished buffering"));var r=e.streamInfo.isLast;B&&r?(t.info("[onStreamBufferingCompleted] calls signalEndOfStream of mediaSourceController."),m.signalEndOfStream(B)):Oe()}function Oe(){if(L&&L.getHasFinishedBuffering())for(var e=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{var t=e||L||null;if(t){var r=t.getStreamInfo();return D.filter((function(e){var t=e.getStreamInfo();return t.start>r.start&&r.id!==t.id}))}}catch(n){return[]}}(L),t=0;t<e.length;){var r=e[t],n=0===t?L:e[t-1];!r.getPreloaded()&&n.getHasFinishedBuffering()&&B&&Se(r,n),t+=1}}function Me(){$&&(clearInterval($),$=null)}function Pe(){return L?L.getProcessors():[]}function ke(e){if(L&&!L.getIsEndedEventSignaled()){L.setIsEndedEventSignaled(!0);var r=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||L||null;if(!e)return null;for(var t=e.getStreamInfo(),r=t.start,n=0,i=-1,a=NaN;n<D.length;){var o=D[n].getStreamInfo(),s=o.start-r;s>0&&(isNaN(a)||s<a)&&t.id!==o.id&&(a=s,i=n),n+=1}return i>=0?D[i]:null}();r?(t.debug("StreamController onEnded, found next stream with id ".concat(r.getStreamInfo().id,". Switching from ").concat(L.getStreamInfo().id," to ").concat(r.getStreamInfo().id)),ge(r,L,NaN)):(t.debug("StreamController no next stream found"),L.setIsEndedEventSignaled(!1)),Ye(r?ee.END_OF_PERIOD_STOP_REASON:ee.END_OF_CONTENT_STOP_REASON)}e&&e.isLast&&(Me(),y.stopSteeringRequestTimer())}function xe(e){var t=e||je().manifestInfo.duration;m.setDuration(t)}function Fe(e){var t=T.getURIFragmentData();if(!t||!t.t)return NaN;var r=Je()[0].getStreamInfo().start;return t.t=t.t.split(",")[0],Be(e,t.t,r)}function Ue(e,t){var r=0;return e||(r=Je()[0].getStreamInfo().start),Be(e,t,r)}function Be(e,t,r){var n=h.getRegularPeriods()[0],i=t.toString(),a=-1!==i.indexOf("posix:")?"now"===i.substring(6)?Date.now()/1e3:parseFloat(i.substring(6)):NaN;return e&&!isNaN(a)?C.calcPresentationTimeFromWallTime(new Date(1e3*a),n):parseFloat(i)+r}function Ze(e,t){try{var r=NaN;if(t&&!isNaN(t.maxFragmentDuration)&&isFinite(t.maxFragmentDuration))return t.maxFragmentDuration;if(e&&1===e.length){var n=e[0],i=[a.Z.VIDEO,a.Z.AUDIO,a.Z.TEXT].reduce((function(e,t){var r=h.getMediaInfoForType(n,t);return r&&!1!==r.isFragmented&&e.push(r),e}),[]).reduce((function(e,t){var r=h.getVoRepresentations(t);return r&&r.length>0&&r.forEach((function(t){t&&e.push(t)})),e}),[]).reduce((function(e,t){var r=h.convertRepresentationToRepresentationInfo(t);return r&&r.fragmentDuration&&!isNaN(r.fragmentDuration)&&e.push(r.fragmentDuration),e}),[]);r=Math.max.apply(Math,function(e){if(Array.isArray(e))return or(e)}(o=i)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(o)||function(e,t){if(e){if("string"==typeof e)return or(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?or(e,t):void 0}}(o)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}return isFinite(r)?r:NaN}catch(s){return NaN}var o}function Ge(e){if(e.error)U=!0,Xe();else{t.info("Manifest updated... updating data system wide.");var r=e.manifest;h.updatePeriods(r);var i=h.getUTCTimingSources();!h.getIsDynamic()||i&&0!==i.length||oe.trigger(d.Z.CONFORMANCE_VIOLATION,{level:ar.LEVELS.WARNING,event:ar.EVENTS.NO_UTC_TIMING_ELEMENT});var a=h.getIsDynamic()?i.concat(Y.getUTCTimingSources()):i;n.filterUnsupportedFeatures(r).then((function(){E.initialize(r),p.attemptSync(a,h.getIsDynamic())}))}}function He(){return!!L&&L.getHasVideoTrack()}function Ke(){return!!L&&L.getHasAudioTrack()}function Ye(e,t){t=t||new Date,Pe().forEach((function(r){r.finalisePlayList(t,e)})),g.addPlayList()}function qe(e){g.createPlaylistMetrics(1e3*G.getTime(),e)}function Ve(e){if(e.error){var r="";switch(e.error.code){case 1:r="MEDIA_ERR_ABORTED";break;case 2:r="MEDIA_ERR_NETWORK";break;case 3:r="MEDIA_ERR_DECODE",ie.counts.mediaErrorDecode+=1;break;case 4:r="MEDIA_ERR_SRC_NOT_SUPPORTED";break;case 5:r="MEDIA_ERR_ENCRYPTED";break;default:r="UNKNOWN"}"MEDIA_ERR_DECODE"===r&&Q.get().errors.recoverAttempts.mediaErrorDecode>=ie.counts.mediaErrorDecode?function(){t.warn("A MEDIA_ERR_DECODE occured: Resetting the MediaSource");var e=G.getTime();L.deactivate(!1),t.warn("MediaSource has been resetted. Resuming playback from time ".concat(e)),me(e,!1,!1)}():(F=!0,e.error.message&&(r+=" ("+e.error.message+")"),e.error.msExtendedCode&&(r+=" (0x"+(e.error.msExtendedCode>>>0).toString(16).toUpperCase()+")"),t.fatal("Video Element Error: "+r),e.error&&t.fatal(e.error),I.error(new S.Z(e.error.code,r)),Xe())}}function je(){return L?L.getStreamInfo():null}function $e(e){for(var t=0,r=D.length;t<r;t++)if(D[t].getId()===e)return D[t];return null}function ze(e){isNaN(e.newDuration)||xe(e.newDuration)}function We(){D=[],ne=NaN,N=null,x=!1,L=null,F=!1,U=!1,V=!0,j=!0,q=!1,P=!0,$=null,te=!1,X=!1,W=[],re=null,ie={counts:{mediaErrorDecode:0}}}function Xe(){se(),p.reset(),Ye(F||U?ee.FAILURE_STOP_REASON:ee.USER_REQUEST_STOP_REASON);for(var t=0,r=D?D.length:0;t<r;t++)D[t].reset(F);oe.off(d.Z.PLAYBACK_TIME_UPDATED,Ce,e),oe.off(d.Z.PLAYBACK_SEEKING,ye,e),oe.off(d.Z.PLAYBACK_ERROR,Ve,e),oe.off(d.Z.PLAYBACK_STARTED,De,e),oe.off(d.Z.PLAYBACK_PAUSED,Le,e),oe.off(d.Z.PLAYBACK_ENDED,ke,e),oe.off(d.Z.METRIC_ADDED,Qe,e),oe.off(d.Z.MANIFEST_VALIDITY_CHANGED,ze,e),oe.off(d.Z.BUFFER_LEVEL_UPDATED,Re,e),oe.off(d.Z.QUALITY_CHANGE_REQUESTED,Ie,e),u.Z.KEY_SESSION_UPDATED&&oe.off(u.Z.KEY_SESSION_UPDATED,ce,e),oe.off(u.Z.MANIFEST_UPDATED,Ge,e),oe.off(u.Z.STREAM_BUFFERING_COMPLETED,Ne,e),oe.off(u.Z.TIME_SYNCHRONIZATION_COMPLETED,ue,e),oe.off(u.Z.CURRENT_TRACK_CHANGED,Te,e),oe.off(u.Z.SETTING_UPDATED_LIVE_DELAY,we,e),oe.off(u.Z.SETTING_UPDATED_LIVE_DELAY_FRAGMENT_COUNT,we,e),E.reset(),i.reset(),b.reset(),g.clearAllCurrentMetrics(),c.setValue(null),o.reset(),C.reset(),R.reset(),B&&(m.detachMediaSource(Z),B=null),Z=null,N&&(N=null,M=null,c.getValue()&&oe.trigger(u.Z.PROTECTION_DESTROYED,{data:c.getValue().url})),Me(),oe.trigger(u.Z.STREAM_TEARDOWN_COMPLETE),We()}function Qe(e){if(e.metric===s.Z.DVR_INFO){var t=Ke()?a.Z.AUDIO:a.Z.VIDEO;e.mediaType===t&&m.setSeekable(e.value.range.start,e.value.range.end)}}function Je(){return D}return e={initialize:function(t,r){se(),P=t,M=r,C.initialize(),(i=Xt(ae).create()).setConfig({manifestModel:c,adapter:h,manifestLoader:o,errHandler:I,settings:Q,contentSteeringController:y}),i.initialize(),(b=ir(ae).getInstance()).setConfig({manifestUpdater:i,playbackController:G,settings:Q}),b.start(),p.setConfig({dashMetrics:g,baseURLController:E,errHandler:I,settings:Q}),p.initialize(),m.setConfig({settings:Q}),N&&(oe.trigger(u.Z.PROTECTION_CREATED,{controller:N}),N.setMediaElement(Z.getElement()),M&&N.setProtectionData(M)),oe.on(d.Z.PLAYBACK_TIME_UPDATED,Ce,e),oe.on(d.Z.PLAYBACK_SEEKING,ye,e),oe.on(d.Z.PLAYBACK_ERROR,Ve,e),oe.on(d.Z.PLAYBACK_STARTED,De,e),oe.on(d.Z.PLAYBACK_PAUSED,Le,e),oe.on(d.Z.PLAYBACK_ENDED,ke,e),oe.on(d.Z.METRIC_ADDED,Qe,e),oe.on(d.Z.MANIFEST_VALIDITY_CHANGED,ze,e),oe.on(d.Z.BUFFER_LEVEL_UPDATED,Re,e),oe.on(d.Z.QUALITY_CHANGE_REQUESTED,Ie,e),u.Z.KEY_SESSION_UPDATED&&oe.on(u.Z.KEY_SESSION_UPDATED,ce,e),oe.on(u.Z.MANIFEST_UPDATED,Ge,e),oe.on(u.Z.STREAM_BUFFERING_COMPLETED,Ne,e),oe.on(u.Z.TIME_SYNCHRONIZATION_COMPLETED,ue,e),oe.on(u.Z.CURRENT_TRACK_CHANGED,Te,e),oe.on(u.Z.SETTING_UPDATED_LIVE_DELAY,we,e),oe.on(u.Z.SETTING_UPDATED_LIVE_DELAY_FRAGMENT_COUNT,we,e)},getActiveStreamInfo:je,addDVRMetric:be,hasVideoTrack:He,hasAudioTrack:Ke,getStreamById:$e,getStreamForTime:Ae,getTimeRelativeToStreamId:function(e,t){for(var r=null,n=0,i=0,a=null,o=0;o<D.length;o++){if(i=(r=D[o]).getStartTime(),a=r.getDuration(),Number.isFinite(i)&&(n=i),r.getId()===t)return e-n;Number.isFinite(a)&&(n+=a)}return null},load:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:NaN;se(),ne=t,o.load(e)},loadWithManifest:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:NaN;le(),ne=t,i.setManifest(e)},getActiveStreamProcessors:Pe,setConfig:function(e){e&&(e.capabilities&&(r=e.capabilities),e.capabilitiesFilter&&(n=e.capabilitiesFilter),e.manifestLoader&&(o=e.manifestLoader),e.manifestModel&&(c=e.manifestModel),e.mediaPlayerModel&&(K=e.mediaPlayerModel),e.customParametersModel&&(Y=e.customParametersModel),e.protectionController&&(N=e.protectionController),e.adapter&&(h=e.adapter),e.dashMetrics&&(g=e.dashMetrics),e.errHandler&&(I=e.errHandler),e.timelineConverter&&(C=e.timelineConverter),e.videoModel&&(Z=e.videoModel),e.playbackController&&(G=e.playbackController),e.serviceDescriptionController&&(H=e.serviceDescriptionController),e.contentSteeringController&&(y=e.contentSteeringController),e.textController&&(O=e.textController),e.abrController&&(_=e.abrController),e.mediaController&&(A=e.mediaController),e.settings&&(Q=e.settings),e.baseURLController&&(E=e.baseURLController),e.uriFragmentModel&&(T=e.uriFragmentModel),e.segmentBaseController&&(v=e.segmentBaseController),e.manifestUpdater&&(i=e.manifestUpdater))},setProtectionData:function(e){M=e,N&&N.setProtectionData(M)},getIsStreamSwitchInProgress:function(){return x},switchToVideoElement:function(e){L&&(G.initialize(je()),me(e,!1,!0))},getHasMediaOrInitialisationError:function(){return F||U},getStreams:Je,getActiveStream:function(){return L},getInitialPlayback:function(){return V},getAutoPlay:function(){return P},refreshManifest:function(){i.getIsUpdating()||i.refreshManifest()},reset:Xe},t=(0,f.Z)(ae).getInstance().getLogger(e),p=er(ae).getInstance(),m=rr(ae).getInstance(),R=k(ae).getInstance(),We(),e}sr.__dashjs_factory_name="StreamController";var lr=c.Z.getSingletonFactory(sr);function ur(){var e,t,r,n,i,o,s,c,d,h,g,m,p=this.context,y=(0,l.Z)(p).getInstance();function E(){m.debug("Stopping the gap controller"),i&&(clearInterval(i),i=null),function(){y.off(u.Z.WALLCLOCK_TIME_UPDATED,A,this),y.off(u.Z.INITIAL_STREAM_SWITCH,S,this),y.off(u.Z.PLAYBACK_SEEKING,v,this),y.off(u.Z.BUFFER_REPLACEMENT_STARTED,T,e),y.off(u.Z.TRACK_CHANGE_RENDERED,_,e)}(),i=null,o=NaN,n=0,h=null,g={}}function v(){h&&(clearTimeout(h),h=null)}function T(e){try{if(e.streamId!==c.getActiveStreamInfo().id||e.mediaType!==a.Z.VIDEO&&e.mediaType!==a.Z.AUDIO)return;e.streamId===c.getActiveStreamInfo().id&&(g[e.mediaType]=!0)}catch(t){m.error(t)}}function _(e){e&&e.mediaType&&(g[e.mediaType]=!1)}function S(){i||function(){try{i||(m.debug("Starting the gap controller"),i=setInterval((function(){b()&&C(s.getTime())}),100))}catch(e){}}()}function A(){if(b(r.get().streaming.gaps.enableSeekFix)&&++n>=10){var e=s.getTime();t===e?C(e,!0):(t=e,o=NaN),n=0}}function b(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!c.getActiveStream())return!1;var t=Object.keys(g).some((function(e){return g[e]})),n=!!e&&R();return!t&&r.get().streaming.gaps.jumpGaps&&c.getActiveStreamProcessors().length>0&&(!s.isSeeking()||n)&&!s.isPaused()&&!c.getIsStreamSwitchInProgress()&&!c.getHasMediaOrInitialisationError()}function R(){var e=c.getActiveStream(),t=parseFloat((e.getStartTime()+e.getDuration()).toFixed(5));return s.getTime()+r.get().streaming.gaps.threshold>=t}function I(e,t){try{if(!e||e.length<=1&&t>0)return NaN;for(var n=NaN,i=0;isNaN(n)&&i<e.length;){var a=i>0?e.end(i-1):0;t<e.start(i)&&a-t<r.get().streaming.gaps.threshold&&(n=i),i+=1}return n}catch(o){return null}}function w(e,t){for(var r=0,n=e.length;r<n;r++)if(t>=e.start(r)&&t<=e.end(r))return!0;return!1}function C(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=r.get().streaming.gaps.enableStallFix,a=r.get().streaming.gaps.stallSeek,l=r.get().streaming.gaps.smallGapLimit,u=r.get().streaming.gaps.jumpLargeGaps,f=d.getBufferRange(),g=NaN,p=!1;if(t=I(f,e),!isNaN(t)){var y=f.start(t),E=y-e;E>0&&(E<=l||u)&&(g=y)}var v=s.getTimeToStreamEnd();if(isNaN(g)&&n&&isFinite(v)&&!isNaN(v)&&v<l&&(g=parseFloat(s.getStreamEndTime().toFixed(5)),p=!0),i&&isNaN(g)&&n&&isNaN(t)&&w(f,e)&&(0===a?(m.warn("Toggle play pause to break stall"),d.pause(),d.play()):(m.warn("Jumping ".concat(a,"s to break stall")),g=e+a)),g>0&&o!==g&&g>e&&!h){var T=g-e;if(p){var _=c.getStreamForTime(g),S=_&&!!_.getPreloaded();m.warn("Jumping to end of stream because of gap from ".concat(e," to ").concat(g,". Gap duration: ").concat(T)),s.seek(g,!0,S)}else{var A=s.getIsDynamic(),b=t>0?f.end(t-1):e,R=A?1e3*Math.max(0,T-.1):0;h=window.setTimeout((function(){s.seek(g,!0,!0),m.warn("Jumping gap occuring in period ".concat(c.getActiveStream().getStreamId()," starting at ").concat(b," and ending at ").concat(g,". Jumping by: ").concat(g-b)),h=null}),R)}o=g}}return e={reset:E,setConfig:function(e){e&&(e.settings&&(r=e.settings),e.playbackController&&(s=e.playbackController),e.streamController&&(c=e.streamController),e.videoModel&&(d=e.videoModel))},initialize:function(){!function(){y.on(u.Z.WALLCLOCK_TIME_UPDATED,A,this),y.on(u.Z.INITIAL_STREAM_SWITCH,S,this),y.on(u.Z.PLAYBACK_SEEKING,v,this),y.on(u.Z.BUFFER_REPLACEMENT_STARTED,T,e),y.on(u.Z.TRACK_CHANGE_RENDERED,_,e)}()}},m=(0,f.Z)(p).getInstance().getLogger(e),E(),e}ur.__dashjs_factory_name="GapController";var cr=c.Z.getSingletonFactory(ur);function fr(){var e,t,r,n,i,o,c,h,g,m,p=this.context,y=(0,l.Z)(p).getInstance();function E(){t=!1;var e=Ke.Z.parseUserAgent();r=e&&e.browser&&e.browser.name&&"safari"===e.browser.name.toLowerCase()}function v(){t=!1}function T(e){if(e.streamId===o.getActiveStreamInfo().id&&g){var t=c.getLiveDelay();c.getBufferLevel()>t/2&&(g=!1)}}function _(e){e.streamId===o.getActiveStreamInfo().id&&(g=e.state===s.Z.BUFFER_EMPTY)}function S(){h.getCatchupModeEnabled()||n.setPlaybackRate(1)}function A(){c.getIsDynamic()&&h.getCatchupModeEnabled()&&(h.getCatchupPlaybackRates().max>0||h.getCatchupPlaybackRates().min<0)&&!c.isPaused()&&!c.isSeeking()&&function(){try{return!(!c.getTime()>0||t)&&(R()===a.Z.LIVE_CATCHUP_MODE_LOLP?function(e,t){try{return Math.abs(b())>0||e<t}catch(r){return!1}}(c.getBufferLevel(),i.get().streaming.liveCatchup.playbackBufferMin):function(){try{return Math.abs(b())>0}catch(e){return!1}}())}catch(e){return!1}}()&&function(){if(!t&&n){var e,o=n.getPlaybackRate(),s=h.getCatchupPlaybackRates(),l=c.getBufferLevel(),u=b(),f=h.getCatchupMaxDrift();if(!isNaN(f)&&f>0&&u>f)m.info("[CatchupController]: Low Latency catchup mechanism. Latency too high, doing a seek to live point"),t=!0,c.seekToCurrentLive(!0,!1);else{var d=c.getCurrentLiveLatency(),p=c.getLiveDelay();e=R()===a.Z.LIVE_CATCHUP_MODE_LOLP?function(e,t,r,n,i){var a;if(i<n){var o=Math.abs(e.min),s=5*(i-n);a=1-o+2*o/(1+Math.pow(Math.E,-s)),m.debug("[LoL+ playback control_buffer-based] bufferLevel: "+i+", newRate: "+a)}else{if(Math.abs(t-r)<=.02*r)a=1;else{var l=t-r,u=l<0?Math.abs(e.min):e.max,c=5*l;a=1-u+2*u/(1+Math.pow(Math.E,-c))}m.debug("[LoL+ playback control_latency-based] latency: "+t+", newRate: "+a)}return a}(s,d,p,i.get().streaming.liveCatchup.playbackBufferMin,l):function(e,t,r,n){if(g)return 1;var i=t-r,a=i<0?Math.abs(e.min):e.max,o=5*i,s=1-a+2*a/(1+Math.pow(Math.E,-o));return c.getPlaybackStalled()&&n<=r/2&&i>0&&(s=1),s}(s,d,p,l);var y=r?.25:.02/(.5/s.max);e&&Math.abs(o-e)>=y&&(m.debug("[CatchupController]: Setting playback rate to ".concat(e)),n.setPlaybackRate(e))}}}()}function b(){return c.getCurrentLiveLatency()-c.getLiveDelay()}function R(){var e=i.get().streaming.liveCatchup.playbackBufferMin;return i.get().streaming.liveCatchup.mode!==a.Z.LIVE_CATCHUP_MODE_LOLP||null===e||isNaN(e)?a.Z.LIVE_CATCHUP_MODE_DEFAULT:a.Z.LIVE_CATCHUP_MODE_LOLP}function I(){h.getCatchupPlaybackRates(!0)}return e={reset:function(){y.off(d.Z.BUFFER_LEVEL_UPDATED,T,e),y.off(d.Z.BUFFER_LEVEL_STATE_CHANGED,_,e),y.off(d.Z.PLAYBACK_PROGRESS,A,e),y.off(d.Z.PLAYBACK_TIME_UPDATED,A,e),y.off(d.Z.PLAYBACK_SEEKED,v,e),y.off(u.Z.SETTING_UPDATED_CATCHUP_ENABLED,S,e),y.off(u.Z.SETTING_UPDATED_PLAYBACK_RATE_MIN,I,e),y.off(u.Z.SETTING_UPDATED_PLAYBACK_RATE_MAX,I,e),y.off(d.Z.STREAM_INITIALIZED,I,e),E(),n.setPlaybackRate(1,!0)},setConfig:function(e){e&&(e.settings&&(i=e.settings),e.videoModel&&(n=e.videoModel),e.streamController&&(o=e.streamController),e.playbackController&&(c=e.playbackController),e.mediaPlayerModel&&(h=e.mediaPlayerModel))},initialize:function(){y.on(d.Z.BUFFER_LEVEL_UPDATED,T,e),y.on(d.Z.BUFFER_LEVEL_STATE_CHANGED,_,e),y.on(d.Z.PLAYBACK_PROGRESS,A,e),y.on(d.Z.PLAYBACK_TIME_UPDATED,A,e),y.on(d.Z.PLAYBACK_SEEKED,v,e),y.on(u.Z.SETTING_UPDATED_CATCHUP_ENABLED,S,e),y.on(u.Z.SETTING_UPDATED_PLAYBACK_RATE_MIN,I,e),y.on(u.Z.SETTING_UPDATED_PLAYBACK_RATE_MAX,I,e),y.on(d.Z.STREAM_INITIALIZED,I,e),I()}},m=(0,f.Z)(p).getInstance().getLogger(e),E(),e}fr.__dashjs_factory_name="CatchupController";var dr=c.Z.getSingletonFactory(fr),hr=[a.Z.SERVICE_DESCRIPTION_DVB_LL_SCHEME],gr="video",mr="audio";function pr(){var e,t,r,n,i,s=this.context;function l(){t={liveDelay:NaN,liveCatchup:{maxDrift:NaN,playbackRate:{min:NaN,max:NaN}},minBitrate:{},maxBitrate:{},initialBitrate:{},contentSteering:null},r=[]}function u(e,r,i){try{t[e][r]=i/1e3}catch(a){n.error(a)}}return e={getServiceDescriptionSettings:function(){return t},getProducerReferenceTimeOffsets:function(){return r},calculateProducerReferenceTimeOffsets:function(e){try{var t=[];if(e&&e.length>0){var s=[a.Z.VIDEO,a.Z.AUDIO,a.Z.TEXT],l=i.getAvailabilityStartTime()/1e3;e.forEach((function(e){var r=s.reduce((function(t,r){return t.concat(i.getAllMediaInfoForType(e,r))}),[]).reduce((function(t,r){return i.getProducerReferenceTimes(e,r).forEach((function(n){var a=i.getVoRepresentations(r);if(a&&a.length>0&&a[0].adaptation&&a[0].segmentInfoType===o.Z.SEGMENT_TEMPLATE){var s=a[0],u=new Date(n[o.Z.WALL_CLOCK_TIME]).getTime()/1e3-(n[o.Z.PRESENTATION_TIME]/s[o.Z.TIMESCALE]-s[o.Z.PRESENTATION_TIME_OFFSET]+e.start),c=l-u;t.push({id:n[o.Z.ID],to:c})}})),t}),[]);t=t.concat(r)}))}r=t}catch(u){n.error(u),r=[]}},applyServiceDescription:function(e){if(e&&e.serviceDescriptions){var i=e.serviceDescriptions.filter((function(e){return hr.includes(e.schemeIdUri)})),o=e.serviceDescriptions.filter((function(e){return null==e.schemeIdUri})),s=i.length>0?i[i.length-1]:o[o.length-1];s&&(s.latency&&s.latency.target>0&&function(e){var i,o;if(e.schemeIdUri,a.Z.SERVICE_DESCRIPTION_DVB_LL_SCHEME,i={liveDelay:(o=e).latency.target/1e3,maxDrift:!isNaN(o.latency.max)&&o.latency.max>o.latency.target?(o.latency.max-o.latency.target+500)/1e3:NaN,referenceId:o.latency.referenceId||NaN},r.length>0){var s=function(e){var t,n=0,i=r.filter((function(t){return t.id===e.referenceId}));return 0===i.length?(n=r.length>0?r[0].to:0,t=r[0].id||NaN):(n=i[0].to||0,t=i[0].id||NaN),{to:n,id:t}}(i),l=s.to,u=s.id;t.liveDelay=i.liveDelay-l,t.liveCatchup.maxDrift=i.maxDrift,n.debug("\n                Found latency properties coming from service description. Applied time offset of ".concat(l," from ProducerReferenceTime element with id ").concat(u,".\n                Live Delay: ").concat(i.liveDelay-l,", Live catchup max drift: ").concat(i.maxDrift,"\n            "))}else t.liveDelay=i.liveDelay,t.liveCatchup.maxDrift=i.maxDrift,n.debug("Found latency properties coming from service description: Live Delay: ".concat(i.liveDelay,", Live catchup max drift: ").concat(i.maxDrift))}(s),s.playbackRate&&(c=(l=s).playbackRate.min?Math.round(1e3*(l.playbackRate.min-1))/1e3:NaN,f=l.playbackRate.max?Math.round(1e3*(l.playbackRate.max-1))/1e3:NaN,t.liveCatchup.playbackRate.min=c,t.liveCatchup.playbackRate.max=f,n.debug("Found latency properties coming from service description: Live catchup min playback rate: ".concat(c)),n.debug("Found latency properties coming from service description: Live catchup max playback rate: ".concat(f))),s.operatingQuality,s.operatingBandwidth&&function(e){if(e&&e.operatingBandwidth&&e.operatingBandwidth.mediaType&&"all"!==e.operatingBandwidth.mediaType){var t={};t.minBandwidth=e.operatingBandwidth.min,t.maxBandwidth=e.operatingBandwidth.max,t.targetBandwidth=e.operatingBandwidth.target;var r=[];e.operatingBandwidth.mediaType===gr||e.operatingBandwidth.mediaType===mr?r.push(e.operatingBandwidth.mediaType):"any"===e.operatingBandwidth.mediaType&&(r.push(mr),r.push(gr)),r.forEach((function(e){isNaN(t.minBandwidth)||u("minBitrate",e,t.minBandwidth),isNaN(t.maxBandwidth)||u("maxBitrate",e,t.maxBandwidth),isNaN(t.targetBandwidth)||u("initialBitrate",e,t.targetBandwidth)}))}}(s),s.contentSteering&&function(e){t.contentSteering=e.contentSteering}(s))}var l,c,f},reset:function(){l()},setConfig:function(e){e&&e.adapter&&(i=e.adapter)}},n=(0,f.Z)(s).getInstance().getLogger(e),l(),e}pr.__dashjs_factory_name="ServiceDescriptionController";var yr=c.Z.getSingletonFactory(pr),Er=r(3973),vr=r.n(Er),Tr=r(3039);function _r(){var e,t,r,n,i,o,s,c,d=this.context,h=(0,l.Z)(d).getInstance();function g(e,t){return e&&r[t]&&r[t][e]?r[t][e].list:[]}function m(e,t){return e&&r[t]&&r[t][e]?r[t][e].current:null}function p(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e&&e.streamInfo){var i=e.type,s=e.streamInfo.id,l=m(i,s);if(r[s]&&r[s][i]&&(r[s][i].current=e,r[s][i].current&&(i!==a.Z.TEXT&&!v(e,l)||i===a.Z.TEXT&&e.isFragmented)&&h.trigger(u.Z.CURRENT_TRACK_CHANGED,{oldMediaInfo:l,newMediaInfo:e,switchMode:n.get().streaming.trackSwitchMode[i]},{streamId:s}),!t)){var f=_(e);if(!f||!r[s][i].storeLastSettings)return;f.roles&&(f.role=f.roles[0],delete f.roles),f.accessibility&&(f.accessibility=f.accessibility[0]),f.audioChannelConfiguration&&(f.audioChannelConfiguration=f.audioChannelConfiguration[0]),o[i]=f,c.setSavedMediaSettings(i,f)}}}function y(e,t){e&&t&&(i[e]=t)}function E(e){return e?i[e]:null}function v(e,t){if(!e&&!t)return!0;if(!e||!t)return!1;var r=e.id===t.id,n=e.viewpoint===t.viewpoint,i=JSON.stringify(e.viewpointsWithSchemeIdUri)===JSON.stringify(t.viewpointsWithSchemeIdUri),a=e.lang===t.lang,o=e.codec===t.codec,s=e.roles.toString()===t.roles.toString(),l=JSON.stringify(e.rolesWithSchemeIdUri)===JSON.stringify(t.rolesWithSchemeIdUri),u=e.accessibility.toString()===t.accessibility.toString(),c=JSON.stringify(e.accessibilitiesWithSchemeIdUri)===JSON.stringify(t.accessibilitiesWithSchemeIdUri),f=e.audioChannelConfiguration.toString()===t.audioChannelConfiguration.toString(),d=JSON.stringify(e.audioChannelConfigurationsWithSchemeIdUri)===JSON.stringify(t.audioChannelConfigurationsWithSchemeIdUri);return r&&o&&n&&i&&a&&s&&l&&u&&c&&f&&d}function T(){r={},o={},i={audio:null,video:null,text:null}}function _(e){var t={lang:e.lang,viewpoint:e.viewpoint,roles:e.roles,accessibility:e.accessibility,audioChannelConfiguration:e.audioChannelConfiguration,codec:e.codec};return t.lang||t.viewpoint||t.role&&t.role.length>0||t.accessibility&&t.accessibility.length>0||t.audioChannelConfiguration&&t.audioChannelConfiguration.length>0?t:null}function S(e,t,r){var n=[];return e.forEach((function(e){t(r,e)&&n.push(e)})),0!==n.length?n:e}function A(e,t){try{return!e.lang||e.lang instanceof RegExp?t.lang.match(e.lang):""!==t.lang&&(0,Tr.extendedFilter)(t.lang,vr()(e.lang)).length>0}catch(r){return!1}}function b(e,t){return void 0===e.index||null===e.index||t.index===e.index}function R(e,t){return!e.viewpoint||e.viewpoint===t.viewpoint}function I(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return!e.role||!!t.roles.filter((function(t){return t===e.role}))[0]||t.type===a.Z.AUDIO&&r}function w(e,t){return e.accessibility?!!t.accessibility.filter((function(t){return t===e.accessibility}))[0]:!t.accessibility.length}function C(e,t){return!e.audioChannelConfiguration||!!t.audioChannelConfiguration.filter((function(t){return t===e.audioChannelConfiguration}))[0]}function D(e,t){return!e.codec||e.codec===t.codec}function L(e){var t,r=0,n=[];return e.forEach((function(e){(t=Math.max.apply(Math,e.bitrateList.map((function(e){return e.bandwidth}))))>r?(r=t,n=[e]):t===r&&n.push(e)})),n}function N(e){var t,r=1/0,n=[];return e.forEach((function(e){var i=e.bitrateList.reduce((function(e,t){var r=Math.max(1,t.width*t.height);return e+t.bandwidth/r}),0);(t=i/e.bitrateList.length)<r?(r=t,n=[e]):t===r&&n.push(e)})),n}function O(e){var t,r=0,n=[];return e.forEach((function(e){(t=e.representationCount)>r?(r=t,n=[e]):t===r&&n.push(e)})),n}function M(e,r){if(e===a.Z.TEXT)return r[0];var i,o,l,u,c=n.get().streaming.selectionModeForInitialTrack,f=s.getCustomInitialTrackSelectionFunction();if(f&&"function"==typeof f)i=f(r);else switch(c){case a.Z.TRACK_SELECTION_MODE_HIGHEST_SELECTION_PRIORITY:o=0,l=[],r.forEach((function(e){isNaN(e.selectionPriority)||(e.selectionPriority>o?(o=e.selectionPriority,l=[e]):e.selectionPriority===o&&l.push(e))})),(u=l).length>1&&(u=L(u)),u.length>1&&(u=O(u)),i=u;break;case a.Z.TRACK_SELECTION_MODE_HIGHEST_BITRATE:i=function(e){var t=L(e);return t.length>1&&(t=O(t)),t}(r);break;case a.Z.TRACK_SELECTION_MODE_FIRST_TRACK:i=P(r);break;case a.Z.TRACK_SELECTION_MODE_HIGHEST_EFFICIENCY:i=function(e){var t=N(e);return t.length>1&&(t=L(t)),t}(r);break;case a.Z.TRACK_SELECTION_MODE_WIDEST_RANGE:i=function(e){var t=O(e);return t.length>1&&(t=L(e)),t}(r);break;default:t.warn("Track selection mode ".concat(c," is not supported. Falling back to TRACK_SELECTION_MODE_FIRST_TRACK")),i=P(r)}return i.length>0?i[0]:r[0]}function P(e){return e[0]}return e={setInitialMediaSettingsForType:function(e,t){var r=o[e]||E(e),n=g(e,t.id),i=[];r||((r=c.getSavedMediaSettings(e))&&delete r.codec,y(e,r)),n&&0!==n.length&&(r&&(i=S(i=Array.from(n),A,r),i=S(i,b,r),i=S(i,R,r),e===a.Z.AUDIO&&o[e]||(i=S(i,I,r)),i=S(i,w,r),i=S(i,C,r),i=S(i,D,r)),0===i.length?p(M(e,n),!0):i.length>1?p(M(e,i)):p(i[0]))},addTrack:function(e){if(e){var t=e.type;if((i=t)===a.Z.AUDIO||i===a.Z.VIDEO||i===a.Z.TEXT||i===a.Z.IMAGE){var i,o,s=e.streamInfo.id;r[s]||(r[s]={audio:{list:[],storeLastSettings:o=n.get().streaming.saveLastMediaSettingsForCurrentStreamingSession,current:null},video:{list:[],storeLastSettings:o,current:null},text:{list:[],storeLastSettings:o,current:null},image:{list:[],storeLastSettings:o,current:null}});for(var l=r[s][t].list,u=0,c=l.length;u<c;++u)if(v(l[u],e))return;l.push(e)}}},getTracksFor:g,getCurrentTrackFor:m,isCurrentTrack:function(e){if(!e)return!1;var t=e.type,n=e.streamInfo.id;return r[n]&&r[n][t]&&v(r[n][t].current,e)},setTrack:p,selectInitialTrack:M,setInitialSettings:y,getInitialSettings:E,getTracksWithHighestBitrate:L,getTracksWithHighestEfficiency:N,getTracksWithWidestRange:O,isTracksEqual:v,matchSettings:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{var n=!1;if(e.lang){if(e.lang instanceof RegExp)n=t.lang.match(e.lang);else if(""!==t.lang){var i=vr()(e.lang);i&&(n=(0,Tr.extendedFilter)(t.lang,i).length>0)}}else n=!0;var o=void 0===e.index||null===e.index||t.index===e.index,s=!e.viewpoint||e.viewpoint===t.viewpoint,l=!e.role||!!t.roles.filter((function(t){return t===e.role}))[0],u=!e.accessibility||!!t.accessibility.filter((function(t){return t===e.accessibility}))[0],c=!e.audioChannelConfiguration||!!t.audioChannelConfiguration.filter((function(t){return t===e.audioChannelConfiguration}))[0];return n&&o&&s&&(l||t.type===a.Z.AUDIO&&r)&&u&&c}catch(f){return!1}},matchSettingsLang:A,matchSettingsIndex:b,matchSettingsViewPoint:R,matchSettingsRole:I,matchSettingsAccessibility:w,matchSettingsAudioChannelConfig:C,saveTextSettingsDisabled:function(){c.setSavedMediaSettings(a.Z.TEXT,null)},setConfig:function(e){e&&(e.domStorage&&(c=e.domStorage),e.settings&&(n=e.settings),e.customParametersModel&&(s=e.customParametersModel))},reset:T},t=(0,f.Z)(d).getInstance().getLogger(e),T(),e}_r.__dashjs_factory_name="MediaController";var Sr=c.Z.getSingletonFactory(_r);c.Z.updateSingletonFactory(_r.__dashjs_factory_name,Sr);var Ar=Sr,br=NaN,Rr=function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.data={baseUrls:t||null,selectedIdx:r||br},this.children=[]};function Ir(){var e,t,r,n,i=this.context,a=Ne(i).getInstance();function o(e,t,r){var n=s(r);e[t]?a.areEqual(n,e[t].data.baseUrls)||(e[t].data.baseUrls=n,e[t].data.selectedIdx=br):e[t]=new Rr(n)}function s(e){var t=r.getBaseURLsFromElement(e),i=n.getSynthesizedBaseUrlElements(t);return i&&i.length>0&&(t=t.concat(i)),t}function l(e,r){var n=r||t;e(n.data),n.children&&n.children.forEach((function(t){return l(e,t)}))}function u(){t=new Rr}return e={reset:u,update:function(e){!function(e){!function(){if(!r||!r.hasOwnProperty("getBaseURLsFromElement")||!r.hasOwnProperty("getRepresentationSortFunction"))throw new Error("setConfig function has to be called previously")}();var n=s(e);a.areEqual(n,t.data.baseUrls)||(t.data.baseUrls=n,t.data.selectedIdx=br),e&&e.Period_asArray&&e.Period_asArray.forEach((function(e,n){o(t.children,n,e),e.AdaptationSet_asArray&&e.AdaptationSet_asArray.forEach((function(e,i){o(t.children[n].children,i,e),e.Representation_asArray&&e.Representation_asArray.sort(r.getRepresentationSortFunction()).forEach((function(e,r){o(t.children[n].children[i].children,r,e)}))}))}))}(e)},getForPath:function(e){var r=t,n=[r.data];return e&&e.forEach((function(e){(r=r.children[e])&&n.push(r.data)})),n.filter((function(e){return e.baseUrls.length}))},invalidateSelectedIndexes:function(e){l((function(t){isNaN(t.selectedIdx)||e===t.baseUrls[t.selectedIdx].serviceLocation&&(t.selectedIdx=br)}))},setConfig:function(e){e.adapter&&(r=e.adapter),e.contentSteeringController&&(n=e.contentSteeringController)},getBaseUrls:function(e){return s(e)}},u(),e}Ir.__dashjs_factory_name="BaseURLTreeModel";var wr=c.Z.getClassFactory(Ir);function Cr(e){var t=(e=e||{}).blacklistController;return{select:function(e){return e&&function(e){var t,r,n=0,i=[],a=0;if((r=e.sort((function(e,t){var r=e.dvbPriority-t.dvbPriority;return isNaN(r)?0:r})).filter((function(e,t,r){return!t||r[0].dvbPriority&&e.dvbPriority&&r[0].dvbPriority===e.dvbPriority}))).length)return r.length>1&&(r.forEach((function(e){n+=e.dvbWeight,i.push(n)})),t=Math.floor(Math.random()*(n-1)),i.every((function(e,r){return a=r,!(t<e)}))),r[a]}((r=[],e.filter((function(e){return!t.contains(e.serviceLocation)||(e.dvbPriority&&r.push(e.dvbPriority),!1)})).filter((function(e){return!r.length||!e.dvbPriority||-1===r.indexOf(e.dvbPriority)}))));var r}}}Cr.__dashjs_factory_name="DVBSelector";var Dr=c.Z.getClassFactory(Cr);function Lr(e){var t=(e=e||{}).blacklistController;return{select:function(e){var r,n=0;return e&&e.some((function(e,r){return n=r,!t.contains(e.serviceLocation)}))&&(r=e[n]),r}}}Lr.__dashjs_factory_name="BasicSelector";var Nr=c.Z.getClassFactory(Lr);function Or(){var e,t,r,n=this.context;function i(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=0,i=NaN,a=function(){var a=e[n],o=t.findIndex((function(e){return e.serviceLocation&&e.serviceLocation===a}));if(-1!==o&&!r.contains(t[o].serviceLocation))return i=o,"break";n+=1};n<e.length&&"break"!==a(););return i}return e={selectBaseUrlIndex:function(e){var r=NaN;if(isNaN(e.selectedIdx)){var n=t.getSteeringDataFromManifest();n&&n.defaultServiceLocationArray.length>0&&(r=i(n.defaultServiceLocationArray,e.baseUrls))}var a=t.getCurrentSteeringResponseData();return e.baseUrls&&e.baseUrls.length&&a&&a.pathwayPriority&&a.pathwayPriority.length&&(r=i(a.pathwayPriority,e.baseUrls)),r},setConfig:function(e){e.blacklistController&&(r=e.blacklistController),e.contentSteeringController&&(t=e.contentSteeringController)}},t=jt(n).getInstance(),e}Or.__dashjs_factory_name="ContentSteeringSelector";var Mr=c.Z.getClassFactory(Or);function Pr(){var e,t,r,n,i,a,o=this.context,s=(0,l.Z)(o).getInstance(),c=(0,C.Z)(o).getInstance();function f(){t.reset()}return e={chooseSelector:function(e){(0,$.PS)(e,"boolean"),a=e?n:r},select:function(e){if(e){if(c.get().streaming.applyContentSteering){var t=i.selectBaseUrlIndex(e);isNaN(t)||-1===t||(e.selectedIdx=t)}if(!isNaN(e.selectedIdx))return e.baseUrls[e.selectedIdx];var n=a.select(e.baseUrls);return n?(e.selectedIdx=e.baseUrls.indexOf(n),n):(s.trigger(u.Z.URL_RESOLUTION_FAILED,{error:new S.Z(w.URL_RESOLUTION_FAILED_GENERIC_ERROR_CODE,w.URL_RESOLUTION_FAILED_GENERIC_ERROR_MESSAGE)}),void(a===r&&f()))}},reset:f,setConfig:function(e){e.selector&&(a=e.selector),e.contentSteeringSelector&&(i=e.contentSteeringSelector)}},t=Zt(o).create({updateEventName:u.Z.SERVICE_LOCATION_BASE_URL_BLACKLIST_CHANGED,addBlacklistEventName:u.Z.SERVICE_LOCATION_BASE_URL_BLACKLIST_ADD}),r=Nr(o).create({blacklistController:t}),n=Dr(o).create({blacklistController:t}),(i=Mr(o).create()).setConfig({blacklistController:t}),a=r,e}Pr.__dashjs_factory_name="BaseURLSelector";var kr=c.Z.getClassFactory(Pr);function xr(){var e,t,r,n,i,a=this.context,o=(0,l.Z)(a).getInstance(),s=(0,X.Z)(a).getInstance();function c(e){r.update(e),n.chooseSelector(t.getIsDVB(e)),o.trigger(d.Z.BASE_URLS_UPDATED,{baseUrls:f(e)})}function f(e){return r.getBaseUrls(e)}return e={reset:function(){r.reset(),n.reset()},initialize:function(e){r.setConfig({adapter:t,contentSteeringController:i}),c(e)},resolve:function(e){var t=r.getForPath(e).reduce((function(e,t){var r=n.select(t);return r?(s.isRelative(r.url)?e.url=s.resolve(r.url,e.url):(e.url=r.url,e.serviceLocation=r.serviceLocation),e.availabilityTimeOffset=r.availabilityTimeOffset,e.availabilityTimeComplete=r.availabilityTimeComplete,e.queryParams=r.queryParams,e):new Se}),new Se);if(!s.isRelative(t.url))return t},setConfig:function(e){e.baseURLTreeModel&&(r=e.baseURLTreeModel),e.baseURLSelector&&(n=e.baseURLSelector),e.adapter&&(t=e.adapter),e.contentSteeringController&&(i=e.contentSteeringController)},getBaseUrls:f,update:c},r=wr(a).create(),n=kr(a).create(),o.on(u.Z.SERVICE_LOCATION_BASE_URL_BLACKLIST_CHANGED,(function(e){r.invalidateSelectedIndexes(e.entry)}),e),e}xr.__dashjs_factory_name="BaseURLController";var Fr=c.Z.getClassFactory(xr);function Ur(e){return(Ur="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Br(e,t){return(Br=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Zr(e,t){return!t||"object"!==Ur(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Gr(e){return(Gr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Hr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Br(e,t)}(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=Gr(t);if(r){var i=Gr(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return Zr(this,e)});function i(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(r=n.call(this)).url=e||null,r.type=t||null,r.mediaType=a.Z.STREAM,r.responseType="",r}return i}(m.Z);function Kr(e){e=e||{};var t=this.context,r=(0,l.Z)(t).getInstance(),n=St(t).create({errHandler:e.errHandler,dashMetrics:e.dashMetrics,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,errors:w});return{load:function(e,t,i){var a=function(n,a){t.resolved=!0,t.resolvedContent=n||null,r.trigger(u.Z.XLINK_ELEMENT_LOADED,{element:t,resolveObject:i,error:n||a?null:new S.Z(w.XLINK_LOADER_LOADING_FAILURE_ERROR_CODE,w.XLINK_LOADER_LOADING_FAILURE_ERROR_MESSAGE+e)})};if("urn:mpeg:dash:resolve-to-zero:2013"===e)a(null,!0);else{var o=new Hr(e,D.w.XLINK_EXPANSION_TYPE);n.load({request:o,success:function(e){a(e)},error:function(){a(null)}})}},reset:function(){n&&(n.abort(),n=null)}}}Kr.__dashjs_factory_name="XlinkLoader";var Yr=c.Z.getClassFactory(Kr),qr=function(e){function t(e){var t=e.localName;return null==t&&(t=e.baseName),null!=t&&""!=t||(t=e.nodeName),t}function r(e){return"string"==typeof e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):e}function n(e,t,r,n){for(var i=0;i<e.length;i++){var a=e[i];if("string"==typeof a){if(a==n)break}else if(a instanceof RegExp){if(a.test(n))break}else if("function"==typeof a&&a(t,r,n))break}return i!=e.length}function i(t,r,i){"property"===e.arrayAccessForm&&(t[r]instanceof Array?t[r+"_asArray"]=t[r]:t[r+"_asArray"]=[t[r]]),!(t[r]instanceof Array)&&e.arrayAccessFormPaths.length>0&&n(e.arrayAccessFormPaths,t,r,i)&&(t[r]=[t[r]])}function a(e){var t=e.split(/[-T:+Z]/g),r=new Date(t[0],t[1]-1,t[2]),n=t[5].split(".");if(r.setHours(t[3],t[4],n[0]),n.length>1&&r.setMilliseconds(n[1]),t[6]&&t[7]){var i=60*t[6]+Number(t[7]);i=0+("-"==(/\d\d-\d\d:\d\d$/.test(e)?"-":"+")?-1*i:i),r.setMinutes(r.getMinutes()-i-r.getTimezoneOffset())}else-1!==e.indexOf("Z",e.length-1)&&(r=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds())));return r}function o(t,r,i,a){return!(1==r&&e.xmlElementsFilter.length>0)||n(e.xmlElementsFilter,t,i,a)}function s(r,l){if(9==r.nodeType){for(var u=new Object,c=r.childNodes,f=0;f<c.length;f++)1==(h=c[f]).nodeType&&(e.ignoreRoot?u=s(h):(u={})[g=t(h)]=s(h));return u}if(1==r.nodeType){(u=new Object).__cnt=0;var d=[];for(c=r.childNodes,f=0;f<c.length;f++){var h,g=t(h=c[f]);if(8!=h.nodeType){var m=l+"."+g;if(o(u,h.nodeType,g,m))if(u.__cnt++,null==u[g]){var p=s(h,m);("#text"!=g||/[^\s]/.test(p))&&((y={})[g]=p,d.push(y)),u[g]=p,i(u,g,m)}else{var y;null!=u[g]&&(u[g]instanceof Array||(u[g]=[u[g]],i(u,g,m))),p=s(h,m),("#text"!=g||/[^\s]/.test(p))&&((y={})[g]=p,d.push(y)),u[g][u[g].length]=p}}}u.__children=d;for(var E=t(r),v=0;v<r.attributes.length;v++){var T=r.attributes[v];u.__cnt++;for(var _=T.value,S=0,A=e.matchers.length;S<A;S++){var b=e.matchers[S];b.test(T,E)&&(_=b.converter(T.value))}u[e.attributePrefix+T.name]=_}var R=r.prefix;return null!=R&&""!=R&&(u.__cnt++,u.__prefix=R),null!=u["#text"]&&(u.__text=u["#text"],u.__text instanceof Array&&(u.__text=u.__text.join("\n")),e.stripWhitespaces&&(u.__text=u.__text.trim()),delete u["#text"],"property"==e.arrayAccessForm&&delete u["#text_asArray"],u.__text=function(t,r,i){if(e.datetimeAccessFormPaths.length>0){var o=i.split(".#")[0];return n(e.datetimeAccessFormPaths,t,r,o)?a(t):t}return t}(u.__text,g,l+"."+g)),null!=u["#cdata-section"]&&(u.__cdata=u["#cdata-section"],delete u["#cdata-section"],"property"==e.arrayAccessForm&&delete u["#cdata-section_asArray"]),0==u.__cnt&&"text"==e.emptyNodeForm?u="":1==u.__cnt&&null!=u.__text?u=u.__text:1!=u.__cnt||null==u.__cdata||e.keepCData?u.__cnt>1&&null!=u.__text&&e.skipEmptyTextNodesForObj&&(e.stripWhitespaces&&""==u.__text||""==u.__text.trim())&&delete u.__text:u=u.__cdata,delete u.__cnt,!e.enableToStringFunc||null==u.__text&&null==u.__cdata||(u.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),u}if(3==r.nodeType||4==r.nodeType)return r.nodeValue}function l(t,n,i,a){var o="<"+(null!=t&&null!=t.__prefix?t.__prefix+":":"")+n;if(null!=i)for(var s=0;s<i.length;s++){var l=i[s],u=t[l];e.escapeMode&&(u=r(u)),o+=" "+l.substr(e.attributePrefix.length)+"=",e.useDoubleQuotes?o+='"'+u+'"':o+="'"+u+"'"}return o+(a?"/>":">")}function u(e,t){return"</"+(null!=e.__prefix?e.__prefix+":":"")+t+">"}function c(t,r){return"property"==e.arrayAccessForm&&(i="_asArray",-1!==(n=r.toString()).indexOf(i,n.length-i.length))||0==r.toString().indexOf(e.attributePrefix)||0==r.toString().indexOf("__")||t[r]instanceof Function;var n,i}function f(e){var t=0;if(e instanceof Object)for(var r in e)c(e,r)||t++;return t}function d(t,r,i){return 0==e.jsonPropertiesFilter.length||""==i||n(e.jsonPropertiesFilter,t,r,i)}function h(t){var r=[];if(t instanceof Object)for(var n in t)-1==n.toString().indexOf("__")&&0==n.toString().indexOf(e.attributePrefix)&&r.push(n);return r}function g(t){var n,i,a="";return t instanceof Object?a+=(i="",null!=(n=t).__cdata&&(i+="<![CDATA["+n.__cdata+"]]>"),null!=n.__text&&(e.escapeMode?i+=r(n.__text):i+=n.__text),i):null!=t&&(e.escapeMode?a+=r(t):a+=t),a}function m(e,t){return""===e?t:e+"."+t}function p(e,t,r,n){var i="";if(0==e.length)i+=l(e,t,r,!0);else for(var a=0;a<e.length;a++)i+=l(e[a],t,h(e[a]),!1),i+=y(e[a],m(n,t)),i+=u(e[a],t);return i}function y(e,t){var r="";if(f(e)>0)for(var n in e)if(!c(e,n)&&(""==t||d(e,n,m(t,n)))){var i=e[n],a=h(i);null==i||null==i?r+=l(i,n,a,!0):i instanceof Object?i instanceof Array?r+=p(i,n,a,t):i instanceof Date?(r+=l(i,n,a,!1),r+=i.toISOString(),r+=u(i,n)):f(i)>0||null!=i.__text||null!=i.__cdata?(r+=l(i,n,a,!1),r+=y(i,m(t,n)),r+=u(i,n)):r+=l(i,n,a,!0):(r+=l(i,n,a,!1),r+=g(i),r+=u(i,n))}return r+g(e)}void 0===(e=e||{}).escapeMode&&(e.escapeMode=!0),void 0===e.attributePrefix&&(e.attributePrefix="_"),e.arrayAccessForm=e.arrayAccessForm||"none",e.emptyNodeForm=e.emptyNodeForm||"text",void 0===e.enableToStringFunc&&(e.enableToStringFunc=!0),e.arrayAccessFormPaths=e.arrayAccessFormPaths||[],void 0===e.skipEmptyTextNodesForObj&&(e.skipEmptyTextNodesForObj=!0),void 0===e.stripWhitespaces&&(e.stripWhitespaces=!0),e.datetimeAccessFormPaths=e.datetimeAccessFormPaths||[],void 0===e.useDoubleQuotes&&(e.useDoubleQuotes=!1),e.xmlElementsFilter=e.xmlElementsFilter||[],e.jsonPropertiesFilter=e.jsonPropertiesFilter||[],void 0===e.keepCData&&(e.keepCData=!1),void 0===e.ignoreRoot&&(e.ignoreRoot=!1),this.parseXmlString=function(e){var t;if(void 0===e)return null;if(window.DOMParser){var r=new window.DOMParser;try{(t=r.parseFromString(e,"text/xml")).getElementsByTagNameNS("*","parsererror").length>0&&(t=null)}catch(n){t=null}}else 0==e.indexOf("<?")&&(e=e.substr(e.indexOf("?>")+2)),(t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e);return t},this.asArray=function(e){return void 0===e||null==e?[]:e instanceof Array?e:[e]},this.toXmlDateTime=function(e){return e instanceof Date?e.toISOString():"number"==typeof e?new Date(e).toISOString():null},this.asDateTime=function(e){return"string"==typeof e?a(e):e},this.xml2json=function(e){return s(e)},this.xml_str2json=function(e){var t=this.parseXmlString(e);return null!=t?this.xml2json(t):null},this.json2xml_str=function(e){return y(e,"")},this.json2xml=function(e){var t=this.json2xml_str(e);return this.parseXmlString(t)},this.getVersion=function(){return"1.2.0"}},Vr="onLoad";function jr(e){e=e||{};var t,r,n,i,a,s,c=this.context,f=(0,l.Z)(c).getInstance(),d=(0,X.Z)(c).getInstance();function h(e,t,r){var n,i,a={};a.elements=e,a.type=t,a.resolveType=r,0===a.elements.length&&m(a);for(var o=0;o<a.elements.length;o++)n=a.elements[o],i=d.isHTTPURL(n.url)?n.url:n.originalContent.BaseURL+n.url,s.load(i,n,a)}function g(e){var t,r,n="";if(t=e.element,r=e.resolveObject,t.resolvedContent){var i=0;0===t.resolvedContent.indexOf("<?xml")&&(i=t.resolvedContent.indexOf("?>")+2),n=t.resolvedContent.substr(0,i)+"<response>"+t.resolvedContent.substr(i)+"</response>",t.resolvedContent=a.xml_str2json(n)}(function(e){var t;for(t=0;t<e.elements.length;t++)if(!1===e.elements[t].resolved)return!1;return!0})(r)&&m(r)}function m(e){var t,r,a=[];if(function(e){var t,r,a,o,s,l,u=[];for(o=e.elements.length-1;o>=0;o--){if(r=(t=e.elements[o]).type+"_asArray",t.resolvedContent){if(t.resolvedContent)for(s=0;s<t.resolvedContent[r].length;s++)a=t.resolvedContent[r][s],u.push(a)}else delete t.originalContent["xlink:actuate"],delete t.originalContent["xlink:href"],u.push(t.originalContent);for(t.parentElement[r].splice(t.index,1),l=0;l<u.length;l++)t.parentElement[r].splice(t.index+l,0,u[l]);u=[]}e.elements.length>0&&n.run(i)}(e),"onActuate"===e.resolveType&&f.trigger(u.Z.XLINK_READY,{manifest:i}),e.resolveType===Vr)switch(e.type){case o.Z.PERIOD:for(t=0;t<i[o.Z.PERIOD+"_asArray"].length;t++)(r=i[o.Z.PERIOD+"_asArray"][t]).hasOwnProperty(o.Z.ADAPTATION_SET+"_asArray")&&(a=a.concat(p(r[o.Z.ADAPTATION_SET+"_asArray"],r,o.Z.ADAPTATION_SET,Vr))),r.hasOwnProperty(o.Z.EVENT_STREAM+"_asArray")&&(a=a.concat(p(r[o.Z.EVENT_STREAM+"_asArray"],r,o.Z.EVENT_STREAM,Vr)));h(a,o.Z.ADAPTATION_SET,Vr);break;case o.Z.ADAPTATION_SET:f.trigger(u.Z.XLINK_READY,{manifest:i})}}function p(e,t,r,n){var i,a,o,s=[];for(a=e.length-1;a>=0;a--)(i=e[a]).hasOwnProperty("xlink:href")&&"urn:mpeg:dash:resolve-to-zero:2013"===i["xlink:href"]&&e.splice(a,1);for(a=0;a<e.length;a++)(i=e[a]).hasOwnProperty("xlink:href")&&i.hasOwnProperty("xlink:actuate")&&i["xlink:actuate"]===n&&(o=y(i["xlink:href"],t,r,a,n,i),s.push(o));return s}function y(e,t,r,n,i,a){return{url:e,parentElement:t,type:r,index:n,resolveType:i,originalContent:a,resolvedContent:null,resolved:!1}}return t={resolveManifestOnLoad:function(e){a=new qr({escapeMode:!1,attributePrefix:"",arrayAccessForm:"property",emptyNodeForm:"object",stripWhitespaces:!1,enableToStringFunc:!1,ignoreRoot:!0,matchers:r}),(i=e).Period_asArray?h(p(i.Period_asArray,i,o.Z.PERIOD,Vr),o.Z.PERIOD,Vr):f.trigger(u.Z.XLINK_READY,{manifest:i})},setMatchers:function(e){e&&(r=e)},setIron:function(e){e&&(n=e)},reset:function(){f.off(u.Z.XLINK_ELEMENT_LOADED,g,t),s&&(s.reset(),s=null)}},f.on(u.Z.XLINK_ELEMENT_LOADED,g,t),s=Yr(c).create({errHandler:e.errHandler,dashMetrics:e.dashMetrics,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,settings:e.settings}),t}jr.__dashjs_factory_name="XlinkController";var $r=c.Z.getClassFactory(jr);function zr(e){return(zr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Wr(e){function t(e,t){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}function r(e,r,n){for(var i=0,a=e.length;i<a;++i){var o=e[i];if(r[o.name])if(n[o.name]){if(o.merge){var s=r[o.name],l=n[o.name];"object"===zr(s)&&"object"===zr(l)?t(s,l):n[o.name]=s+l}}else n[o.name]=r[o.name]}}function n(e,t){for(var i=0,a=e.children.length;i<a;++i){var o=e.children[i],s=t[o.name+"_asArray"];if(s)for(var l=0,u=s.length;l<u;++l){var c=s[l];r(e.properties,t,c),n(o,c)}}}return{run:function(t){if(null===t||"object"!==zr(t))return t;if(t.Period_asArray&&"period"in e)for(var r=e.period,i=t.Period_asArray,a=0,o=i.length;a<o;++a){var s=i[a];if(n(r,s),"adaptationset"in e){var l=s.AdaptationSet_asArray;if(l)for(var u=e.adaptationset,c=0,f=l.length;c<f;++c)n(u,l[c])}}return t}}}Wr.__dashjs_factory_name="ObjectIron";var Xr=c.Z.getClassFactory(Wr);function Qr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Jr=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._test=t,this._converter=r}var t;return(t=[{key:"test",get:function(){return this._test}},{key:"converter",get:function(){return this._converter}}])&&Qr(e.prototype,t),e}();function en(e){return(en="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function rn(e,t){return(rn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function nn(e,t){return!t||"object"!==en(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function an(e){return(an=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var on=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&rn(e,t)}(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=an(t);if(r){var i=an(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return nn(this,e)});function i(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),n.call(this,(function(e,t){var r,n=(tn(r={},o.Z.MPD,[o.Z.ID,o.Z.PROFILES]),tn(r,o.Z.PERIOD,[o.Z.ID]),tn(r,o.Z.BASE_URL,[o.Z.SERVICE_LOCATION,o.Z.BYTE_RANGE]),tn(r,o.Z.SEGMENT_BASE,[o.Z.INDEX_RANGE]),tn(r,o.Z.INITIALIZATION,[o.Z.RANGE]),tn(r,o.Z.REPRESENTATION_INDEX,[o.Z.RANGE]),tn(r,o.Z.SEGMENT_LIST,[o.Z.INDEX_RANGE]),tn(r,o.Z.BITSTREAM_SWITCHING,[o.Z.RANGE]),tn(r,o.Z.SEGMENT_URL,[o.Z.MEDIA_RANGE,o.Z.INDEX_RANGE]),tn(r,o.Z.SEGMENT_TEMPLATE,[o.Z.INDEX_RANGE,o.Z.MEDIA,o.Z.INDEX,o.Z.INITIALIZATION_MINUS,o.Z.BITSTREAM_SWITCHING_MINUS]),tn(r,o.Z.ASSET_IDENTIFIER,[o.Z.VALUE,o.Z.ID]),tn(r,o.Z.EVENT_STREAM,[o.Z.VALUE]),tn(r,o.Z.ADAPTATION_SET,[o.Z.PROFILES,o.Z.MIME_TYPE,o.Z.SEGMENT_PROFILES,o.Z.CODECS,o.Z.CONTENT_TYPE]),tn(r,o.Z.FRAME_PACKING,[o.Z.VALUE,o.Z.ID]),tn(r,o.Z.AUDIO_CHANNEL_CONFIGURATION,[o.Z.VALUE,o.Z.ID]),tn(r,o.Z.CONTENT_PROTECTION,[o.Z.VALUE,o.Z.ID]),tn(r,o.Z.ESSENTIAL_PROPERTY,[o.Z.VALUE,o.Z.ID]),tn(r,o.Z.SUPPLEMENTAL_PROPERTY,[o.Z.VALUE,o.Z.ID]),tn(r,o.Z.INBAND_EVENT_STREAM,[o.Z.VALUE,o.Z.ID]),tn(r,o.Z.ACCESSIBILITY,[o.Z.VALUE,o.Z.ID]),tn(r,o.Z.ROLE,[o.Z.VALUE,o.Z.ID]),tn(r,o.Z.RATING,[o.Z.VALUE,o.Z.ID]),tn(r,o.Z.VIEWPOINT,[o.Z.VALUE,o.Z.ID]),tn(r,o.Z.CONTENT_COMPONENT,[o.Z.CONTENT_TYPE]),tn(r,o.Z.REPRESENTATION,[o.Z.ID,o.Z.DEPENDENCY_ID,o.Z.MEDIA_STREAM_STRUCTURE_ID]),tn(r,o.Z.SUBSET,[o.Z.ID]),tn(r,o.Z.METRICS,[o.Z.METRICS_MINUS]),tn(r,o.Z.REPORTING,[o.Z.VALUE,o.Z.ID]),r);if(n.hasOwnProperty(t)){var i=n[t];return void 0!==i&&i.indexOf(e.name)>=0}return!1}),(function(e){return String(e)}))}return i}(Jr);function sn(e){return(sn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ln(e,t){return(ln=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function un(e,t){return!t||"object"!==sn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function cn(e){return(cn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var fn=/^([-])?P(([\d.]*)Y)?(([\d.]*)M)?(([\d.]*)D)?T?(([\d.]*)H)?(([\d.]*)M)?(([\d.]*)S)?/,dn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ln(e,t)}(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=cn(t);if(r){var i=cn(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return un(this,e)});function i(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),n.call(this,(function(e){for(var t=[o.Z.MIN_BUFFER_TIME,o.Z.MEDIA_PRESENTATION_DURATION,o.Z.MINIMUM_UPDATE_PERIOD,o.Z.TIMESHIFT_BUFFER_DEPTH,o.Z.MAX_SEGMENT_DURATION,o.Z.MAX_SUBSEGMENT_DURATION,o.Z.SUGGESTED_PRESENTATION_DELAY,o.Z.START,a.Z.START_TIME,o.Z.DURATION],r=t.length,n=0;n<r;n++)if(e.nodeName===t[n])return fn.test(e.value);return!1}),(function(e){var t=fn.exec(e),r=31536e3*parseFloat(t[3]||0)+2592e3*parseFloat(t[5]||0)+86400*parseFloat(t[7]||0)+3600*parseFloat(t[9]||0)+60*parseFloat(t[11]||0)+parseFloat(t[13]||0);return void 0!==t[1]&&(r=-r),r}))}return i}(Jr);function hn(e){return(hn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function gn(e,t){return(gn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function mn(e,t){return!t||"object"!==hn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function pn(e){return(pn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var yn=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+-])([0-9]{2})(?::?)([0-9]{2}))?/,En=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&gn(e,t)}(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=pn(t);if(r){var i=pn(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return mn(this,e)});function i(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),n.call(this,(function(e){return yn.test(e.value)}),(function(e){var t,r=yn.exec(e);if(t=Date.UTC(parseInt(r[1],10),parseInt(r[2],10)-1,parseInt(r[3],10),parseInt(r[4],10),parseInt(r[5],10),r[6]&&parseInt(r[6],10)||0,r[7]&&1e3*parseFloat(r[7])||0),r[9]&&r[10]){var n=60*parseInt(r[9],10)+parseInt(r[10],10);t+=("+"===r[8]?-1:1)*n*60*1e3}return new Date(t)}))}return i}(Jr);function vn(e){return(vn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Tn(e,t){return(Tn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _n(e,t){return!t||"object"!==vn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Sn(e){return(Sn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var An=/^[-+]?[0-9]+[.]?[0-9]*([eE][-+]?[0-9]+)?$/,bn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Tn(e,t)}(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=Sn(t);if(r){var i=Sn(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return _n(this,e)});function i(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),n.call(this,(function(e){return An.test(e.value)}),(function(e){return parseFloat(e)}))}return i}(Jr);function Rn(e){return(Rn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function In(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function wn(e,t){return(wn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Cn(e,t){return!t||"object"!==Rn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Dn(e){return(Dn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ln=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&wn(e,t)}(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=Dn(t);if(r){var i=Dn(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return Cn(this,e)});function i(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),n.call(this,(function(e,t){var r,n=(In(r={},o.Z.ADAPTATION_SET,[o.Z.LANG]),In(r,o.Z.REPRESENTATION,[o.Z.LANG]),In(r,o.Z.CONTENT_COMPONENT,[o.Z.LANG]),In(r,o.Z.LABEL,[o.Z.LANG]),In(r,o.Z.GROUP_LABEL,[o.Z.LANG]),r);if(n.hasOwnProperty(t)){var i=n[t];return void 0!==i&&i.indexOf(e.name)>=0}return!1}),(function(e){return vr()(e)||String(e)}))}return i}(Jr);function Nn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var On=function(){function e(t){var r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._name=t,this._merge=(r=t)&&r.length&&r.charAt(0)===r.charAt(0).toUpperCase()}var t;return(t=[{key:"name",get:function(){return this._name}},{key:"merge",get:function(){return this._merge}}])&&Nn(e.prototype,t),e}();function Mn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Pn=function(){function e(t,r,n){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._name=t||"",this._properties=[],this._children=n||[],Array.isArray(r)&&r.forEach((function(e){i._properties.push(new On(e))}))}var t;return(t=[{key:"name",get:function(){return this._name}},{key:"children",get:function(){return this._children}},{key:"properties",get:function(){return this._properties}}])&&Mn(e.prototype,t),e}();function kn(e){return(kn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function xn(e,t){return(xn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Fn(e,t){return!t||"object"!==kn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Un(e){return(Un=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Bn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xn(e,t)}(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=Un(t);if(r){var i=Un(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return Fn(this,e)});function i(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);var e=[o.Z.PROFILES,o.Z.WIDTH,o.Z.HEIGHT,o.Z.SAR,o.Z.FRAMERATE,o.Z.AUDIO_SAMPLING_RATE,o.Z.MIME_TYPE,o.Z.SEGMENT_PROFILES,o.Z.CODECS,o.Z.MAXIMUM_SAP_PERIOD,o.Z.START_WITH_SAP,o.Z.MAX_PLAYOUT_RATE,o.Z.CODING_DEPENDENCY,o.Z.SCAN_TYPE,o.Z.FRAME_PACKING,o.Z.AUDIO_CHANNEL_CONFIGURATION,o.Z.CONTENT_PROTECTION,o.Z.ESSENTIAL_PROPERTY,o.Z.ESSENTIAL_PROPERTY+"_asArray",o.Z.SUPPLEMENTAL_PROPERTY,o.Z.INBAND_EVENT_STREAM];return n.call(this,o.Z.ADAPTATION_SET,e,[new Pn(o.Z.REPRESENTATION,e,[new Pn(o.Z.SUB_REPRESENTATION,e)])])}return i}(Pn);function Zn(e){return(Zn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Gn(e,t){return(Gn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Hn(e,t){return!t||"object"!==Zn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Kn(e){return(Kn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Yn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Gn(e,t)}(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=Kn(t);if(r){var i=Kn(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return Hn(this,e)});function i(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);var e=[o.Z.SEGMENT_BASE,o.Z.SEGMENT_TEMPLATE,o.Z.SEGMENT_LIST];return n.call(this,o.Z.PERIOD,e,[new Pn(o.Z.ADAPTATION_SET,e,[new Pn(o.Z.REPRESENTATION,e)])])}return i}(Pn);function qn(e){e=e||{};var t,r,n,i,a,o=this.context,s=e.debug;return t={parse:function(e){var t,n=window.performance.now();if(!(t=i.xml_str2json(e)))throw new Error("parsing the manifest failed");var o=window.performance.now();t.Patch?((t=t.Patch).add_asArray&&t.add_asArray.forEach((function(e){return a.run(e)})),t.replace_asArray&&t.replace_asArray.forEach((function(e){return a.run(e)}))):(t=t.MPD,a.run(t));var s=window.performance.now();return r.info("Parsing complete: ( xml2json: "+(o-n).toPrecision(3)+"ms, objectiron: "+(s-o).toPrecision(3)+"ms, total: "+((s-n)/1e3).toPrecision(3)+"s)"),t.protocol="DASH",t},getMatchers:function(){return n},getIron:function(){return a}},r=s.getLogger(t),n=[new dn,new En,new bn,new Ln,new on],i=new qr({escapeMode:!1,attributePrefix:"",arrayAccessForm:"property",emptyNodeForm:"object",stripWhitespaces:!1,enableToStringFunc:!0,ignoreRoot:!1,matchers:n}),a=Xr(o).create({adaptationset:new Bn,period:new Yn}),t}qn.__dashjs_factory_name="DashParser";var Vn=c.Z.getClassFactory(qn);function jn(e){e=e||{};var t,r,n,i,s,c=this.context,f=e.debug,d=e.settings,h=(0,l.Z)(c).getInstance(),g=(0,X.Z)(c).getInstance(),m=e.mssHandler,p=e.errHandler;function y(e){h.trigger(u.Z.INTERNAL_MANIFEST_LOADED,{manifest:e.manifest})}function E(e){var t=null;return e.indexOf("SmoothStreamingMedia")>-1?(m&&(t=m.createMssParser(),m.createMssFragmentProcessor(),m.registerEvents()),t):e.indexOf("MPD")>-1||e.indexOf("Patch")>-1?Vn(c).create({debug:f}):t}return t={load:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=new Date,l=new Hr(e,D.w.MPD_TYPE);t&&(l.serviceLocation=t),a&&(l.queryParams=a),l.requestStartDate||(l.requestStartDate=o),h.trigger(u.Z.MANIFEST_LOADING_STARTED,{request:l}),n.load({request:l,success:function(t,n,a){var o,l,c;if(i)if(a&&a!==e?(l=g.parseBaseUrl(a),o=a):(g.isRelative(e)&&(e=g.resolve(e,window.location.href)),l=g.parseBaseUrl(e)),"No Content"!=n)if(null===s&&(s=E(t)),null!==s){i.setMatchers(s.getMatchers()),i.setIron(s.getIron());try{c=s.parse(t)}catch(m){return void h.trigger(u.Z.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new S.Z(w.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,w.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+"".concat(e))})}if(c){if(c.url=o||e,c.originalUrl||(c.originalUrl=c.url),d&&d.get().streaming.enableManifestDurationMismatchFix&&c.mediaPresentationDuration&&c.Period_asArray.length>1){var f=c.Period_asArray.reduce((function(e,t){return e+t.duration}),0);!isNaN(f)&&c.mediaPresentationDuration>f&&(r.warn("Media presentation duration greater than duration of all periods. Setting duration to total period duration"),c.mediaPresentationDuration=f)}c.baseUri=l,c.loadedTime=new Date,i.resolveManifestOnLoad(c),h.trigger(u.Z.ORIGINAL_MANIFEST_LOADED,{originalManifest:t})}else h.trigger(u.Z.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new S.Z(w.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,w.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+"".concat(e))})}else h.trigger(u.Z.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new S.Z(w.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,w.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+"".concat(e))});else h.trigger(u.Z.INTERNAL_MANIFEST_LOADED,{manifest:null})},error:function(t,r,n){h.trigger(u.Z.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new S.Z(w.MANIFEST_LOADER_LOADING_FAILURE_ERROR_CODE,w.MANIFEST_LOADER_LOADING_FAILURE_ERROR_MESSAGE+"".concat(e,", ").concat(n))})}})},reset:function(){h.off(u.Z.XLINK_READY,y,t),m&&m.reset(),i&&(i.reset(),i=null),n&&(n.abort(),n=null)}},r=f.getLogger(t),h.on(u.Z.XLINK_READY,y,t),n=St(c).create({errHandler:e.errHandler,dashMetrics:e.dashMetrics,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,urlUtils:g,constants:a.Z,dashConstants:o.Z,errors:w,requestTimeout:e.settings.get().streaming.manifestRequestTimeout}),i=$r(c).create({errHandler:p,dashMetrics:e.dashMetrics,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,settings:e.settings}),s=null,t}jn.__dashjs_factory_name="ManifestLoader";var $n=c.Z.getClassFactory(jn);function zn(){var e=this.context,t=(0,l.Z)(e).getInstance();return{error:function(e){t.trigger(u.Z.ERROR,{error:e})}}}zn.__dashjs_factory_name="ErrorHandler";var Wn=c.Z.getSingletonFactory(zn),Xn=r(1715);function Qn(){var e,t,r,n,i,o,s=this.context,c=(0,l.Z)(s).getInstance();function d(e,n){if(!n||!n.Period_asArray||0===n.Period_asArray.length)return Promise.resolve();var i=[];return n.Period_asArray.forEach((function(n){var s,l;i.push((s=n,l=e,new Promise((function(e){if(s&&s.AdaptationSet_asArray&&0!==s.AdaptationSet_asArray.length){var n=[];s.AdaptationSet_asArray.forEach((function(e){var i,s;t.getIsTypeOf(e,l)&&n.push((i=e,s=l,new Promise((function(e){if(i.Representation_asArray&&0!==i.Representation_asArray.length){var n=[],l=[];i.Representation_asArray.forEach((function(e,o){var u=t.getCodec(i,o,!1),c=function(e,t,r){switch(e){case a.Z.VIDEO:return{codec:r,width:(n=t).width||null,height:n.height||null,framerate:n.frameRate||null,bitrate:n.bandwidth||null};case a.Z.AUDIO:return function(e,t){var r=e.audioSamplingRate||null;return{codec:t,bitrate:e.bandwidth||null,samplerate:r}}(t,r);default:return null}var n}(s,e,u);l.push(c),n.push(r.supportsCodec(c,s))})),Promise.all(n).then((function(t){i.Representation_asArray=i.Representation_asArray.filter((function(e,r){return t[r]||o.debug("[Stream] Codec ".concat(l[r].codec," not supported ")),t[r]})),e()})).catch((function(){e()}))}else e()}))))})),Promise.all(n).then((function(){s.AdaptationSet_asArray=s.AdaptationSet_asArray.filter((function(e){var t=e.Representation_asArray&&e.Representation_asArray.length>0;return t||(c.trigger(u.Z.ADAPTATION_SET_REMOVED_NO_CAPABILITIES,{adaptationSet:e}),o.warn("AdaptationSet has been removed because of no supported Representation")),t})),e()})).catch((function(){e()}))}else e()}))))})),Promise.all(i)}return e={setConfig:function(e){e&&(e.adapter&&(t=e.adapter),e.capabilities&&(r=e.capabilities),e.settings&&(n=e.settings),e.customParametersModel&&(i=e.customParametersModel))},filterUnsupportedFeatures:function(e){return new Promise((function(s){var l=[];l.push(d(a.Z.VIDEO,e)),l.push(d(a.Z.AUDIO,e)),Promise.all(l).then((function(){var a;n.get().streaming.capabilities.filterUnsupportedEssentialProperties&&(a=e)&&a.Period_asArray&&0!==a.Period_asArray.length&&a.Period_asArray.forEach((function(e){e.AdaptationSet_asArray=e.AdaptationSet_asArray.filter((function(e){return!e.Representation_asArray||0===e.Representation_asArray.length||(e.Representation_asArray=e.Representation_asArray.filter((function(e){var n=t.getEssentialPropertiesForRepresentation(e);if(n&&n.length>0)for(var i=0;i<n.length;){if(!r.supportsEssentialProperty(n[i]))return o.debug("[Stream] EssentialProperty not supported: "+n[i].schemeIdUri),!1;i+=1}return!0})),e.Representation_asArray&&e.Representation_asArray.length>0)}))})),function(e){var t=i.getCustomCapabilitiesFilters();t&&0!==t.length&&e&&e.Period_asArray&&0!==e.Period_asArray.length&&e.Period_asArray.forEach((function(e){e.AdaptationSet_asArray=e.AdaptationSet_asArray.filter((function(e){return!e.Representation_asArray||0===e.Representation_asArray.length||(e.Representation_asArray=e.Representation_asArray.filter((function(e){return!t.some((function(t){return!t(e)}))})),e.Representation_asArray&&e.Representation_asArray.length>0)}))}))}(e),s()})).catch((function(){s()}))}))}},o=(0,f.Z)(s).getInstance().getLogger(e),e}Qn.__dashjs_factory_name="CapabilitiesFilter";var Jn=c.Z.getSingletonFactory(Qn),ei=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.t=null,this.xywh=null,this.track=null,this.id=null,this.s=null,this.r=null};function ti(){var e;return{initialize:function(t){if(e=new ei,!t)return null;var r=t.indexOf("#");if(-1!==r)for(var n=t.substr(r+1).split("&"),i=0,a=n.length;i<a;++i){var o=n[i],s=o.indexOf("=");if(-1!==s){var l=o.substring(0,s);e.hasOwnProperty(l)&&(e[l]=o.substr(s+1))}}},getURIFragmentData:function(){return e}}}ti.__dashjs_factory_name="URIFragmentModel";var ri=c.Z.getSingletonFactory(ti);function ni(){var e,t=this.context,r=(0,l.Z)(t).getInstance();return{getValue:function(){return e},setValue:function(t){e=t,t&&r.trigger(u.Z.MANIFEST_LOADED,{data:t})}}}ni.__dashjs_factory_name="ManifestModel";var ii=c.Z.getSingletonFactory(ni),ai=-.5;function oi(){var e,t,r,n,i=this.context,a=(0,C.Z)(i).getInstance();function o(e,r){return isNaN(e)?0:e>0?(r&&t.warn("Supplied minimum playback rate is a positive value when it should be negative or 0. The supplied rate will not be applied and set to 0: 100% playback speed."),0):e<ai?(r&&t.warn("Supplied minimum playback rate is out of range and will be limited to ".concat(ai,": ").concat(-50,"% playback speed.")),ai):e}function s(e,r){return isNaN(e)?0:e<0?(r&&t.warn("Supplied maximum playback rate is a negative value when it should be negative or 0. The supplied rate will not be applied and set to 0: 100% playback speed."),0):e>1?(r&&t.warn("Supplied maximum playback rate is out of range and will be limited to ".concat(1,": ").concat(200,"% playback speed.")),1):e}function l(){var e=a.get().streaming.buffer.stableBufferTime>0?a.get().streaming.buffer.stableBufferTime:a.get().streaming.buffer.fastSwitchEnabled?20:12,t=r.getLiveDelay();return!isNaN(t)&&t>0?Math.min(e,t):e}return e={getCatchupMaxDrift:function(){if(!isNaN(a.get().streaming.liveCatchup.maxDrift)&&a.get().streaming.liveCatchup.maxDrift>0)return a.get().streaming.liveCatchup.maxDrift;var e=n.getServiceDescriptionSettings();return e&&e.liveCatchup&&!isNaN(e.liveCatchup.maxDrift)&&e.liveCatchup.maxDrift>0?e.liveCatchup.maxDrift:12},getCatchupModeEnabled:function(){return null!==a.get().streaming.liveCatchup.enabled?a.get().streaming.liveCatchup.enabled:r.getInitialCatchupModeActivated()},getStableBufferTime:l,getInitialBufferLevel:function(){var e=a.get().streaming.buffer.initialBufferLevel;return isNaN(e)||e<0?0:Math.min(l(),e)},getRetryAttemptsForType:function(e){var t=isNaN(a.get().streaming.retryAttempts.lowLatencyMultiplyFactor)?5:a.get().streaming.retryAttempts.lowLatencyMultiplyFactor;return r.getLowLatencyModeEnabled()?a.get().streaming.retryAttempts[e]*t:a.get().streaming.retryAttempts[e]},getRetryIntervalsForType:function(e){var t=isNaN(a.get().streaming.retryIntervals.lowLatencyReductionFactor)?10:a.get().streaming.retryIntervals.lowLatencyReductionFactor;return r.getLowLatencyModeEnabled()?a.get().streaming.retryIntervals[e]/t:a.get().streaming.retryIntervals[e]},getCatchupPlaybackRates:function(e){var t=a.get().streaming.liveCatchup.playbackRate;if(!isNaN(t.min)||!isNaN(t.max))return{min:o(t.min,e),max:s(t.max,e)};var r=n.getServiceDescriptionSettings();if(r&&r.liveCatchup&&(!isNaN(r.liveCatchup.playbackRate.min)||!isNaN(r.liveCatchup.playbackRate.max))){var i=r.liveCatchup.playbackRate;return{min:o(i.min,e),max:s(i.max,e)}}return{min:-.5,max:.5}},getAbrBitrateParameter:function(e,t){try{var r=a.get().streaming.abr[e][t];if(!isNaN(r)&&-1!==r)return r;var i=n.getServiceDescriptionSettings();return i&&i[e]&&!isNaN(i[e][t])?i[e][t]:-1}catch(o){return-1}},setConfig:function(e){e.playbackController&&(r=e.playbackController),e.serviceDescriptionController&&(n=e.serviceDescriptionController)},reset:function(){}},t=(0,f.Z)(i).getInstance().getLogger(e),e}oi.__dashjs_factory_name="MediaPlayerModel";var si=c.Z.getSingletonFactory(oi),li=r(1767);function ui(e){var t=(e=e||{}).abrController,r=e.switchHistory,n=e.droppedFramesHistory,i=e.currentRequest,a=e.useBufferOccupancyABR,o=e.useL2AABR,s=e.useLoLPABR,l=e.streamProcessor?e.streamProcessor.getScheduleController():null,u=e.streamProcessor?e.streamProcessor.getRepresentationInfo():null,c=e.videoModel?e.videoModel:null;function f(){return u?u.mediaInfo:null}return{getMediaType:function(){var e=f();return e?e.type:null},getMediaInfo:f,getDroppedFramesHistory:function(){return n},getCurrentRequest:function(){return i},getSwitchHistory:function(){return r},getStreamInfo:function(){var e=f();return e?e.streamInfo:null},getScheduleController:function(){return l},getAbrController:function(){return t},getRepresentationInfo:function(){return u},useBufferOccupancyABR:function(){return a},useL2AABR:function(){return o},useLoLPABR:function(){return s},getVideoModel:function(){return c}}}ui.__dashjs_factory_name="RulesContext";var ci=c.Z.getClassFactory(ui),fi=r(2068);function di(){var e=[],t=[];return{push:function(r){r.newValue===fi.Z.NO_CHANGE&&(r.newValue=r.oldValue),e[r.oldValue]||(e[r.oldValue]={noDrops:0,drops:0,dropSize:0});var n=r.newValue-r.oldValue,i=n<0?1:0,a=i?-n:0,o=i?0:1;if(e[r.oldValue].drops+=i,e[r.oldValue].dropSize+=a,e[r.oldValue].noDrops+=o,t.push({idx:r.oldValue,noDrop:o,drop:i,dropSize:a}),t.length>8){var s=t.shift();e[s.idx].drops-=s.drop,e[s.idx].dropSize-=s.dropSize,e[s.idx].noDrops-=s.noDrop}},getSwitchRequests:function(){return e},reset:function(){e=[],t=[]}}}di.__dashjs_factory_name="SwitchRequestHistory";var hi=c.Z.getClassFactory(di);function gi(){var e={},t={},r={};return{push:function(n,i,a){if(i){e[n]||(e[n]=[],t[n]=0,r[n]=0);var o=a&&a.droppedVideoFrames?a.droppedVideoFrames:0,s=a&&a.totalVideoFrames?a.totalVideoFrames:0,l=o-t[n];t[n]=o;var u=s-r[n];r[n]=s;var c=e[n];isNaN(i)||(c[i]?(c[i].droppedVideoFrames+=l,c[i].totalVideoFrames+=u):c[i]={droppedVideoFrames:l,totalVideoFrames:u})}},getFrameHistory:function(t){return e[t]},clearForStream:function(n){try{delete e[n],delete t[n],delete r[n]}catch(i){}},reset:function(){e={},t={},r={}}}}gi.__dashjs_factory_name="DroppedFramesHistory";var mi=c.Z.getClassFactory(gi);function pi(e){var t,r,n,i,o,s=this.context,u=(e=e||{}).settings,c=(0,l.Z)(s).getInstance();function f(e,t,r,n){var i=Math.pow(.5,r/n.fast);e.fastEstimate=(1-i)*t+i*e.fastEstimate;var a=Math.pow(.5,r/n.slow);e.slowEstimate=(1-a)*t+a*e.slowEstimate,e.totalWeight+=r}function h(e,s,l){return u.get().streaming.abr.movingAverageMethod!==a.Z.MOVING_AVERAGE_SLIDING_WINDOW?function(e,t){var r=e?o.throughputHalfLife:o.latencyHalfLife,a=e?n[t]:i[t];if(!a||a.totalWeight<=0)return NaN;var s=a.fastEstimate/(1-Math.pow(.5,a.totalWeight/r.fast)),l=a.slowEstimate/(1-Math.pow(.5,a.totalWeight/r.slow));return e?Math.min(s,l):Math.max(s,l)}(e,s):(d=function(e,n,i){var a,o;if(e?(a=t[n],o=i?3:4):(a=r[n],o=4),a){if(o>=a.length)o=a.length;else if(e)for(var s=1;s<o;++s){var l=a[a.length-s]/a[a.length-s-1];if((l>=1.3||l<=1/1.3)&&(o+=1)===a.length)break}}else o=0;return o}(c=e,f=s,l),h=(c?t:r)[f],0!==d&&h&&0!==h.length?(h=h.slice(-d)).reduce((function(e,t){return e+t}))/h.length:NaN);var c,f,d,h}function g(e,t){return h(!0,e,t)}function m(e){t[e]=t[e]||[],r[e]=r[e]||[],n[e]=n[e]||{fastEstimate:0,slowEstimate:0,totalWeight:0},i[e]=i[e]||{fastEstimate:0,slowEstimate:0,totalWeight:0}}function p(){t={},r={},n={},i={}}var y={push:function(e,s,l){if(s.trace&&s.trace.length){var h,g=s.tresponse.getTime()-s.trequest.getTime()||1,p=s._tfinish.getTime()-s.tresponse.getTime()||1,y=s.trace.reduce((function(e,t){return e+t.b[0]}),0),E=0;if(0!==(h=s._fileLoaderType&&s._fileLoaderType===a.Z.FILE_LOADER_TYPES.FETCH?s.trace.reduce((function(e,t){return e+t.d}),0):l?p:g+p)&&(E=Math.round(8*y/h)),s.cmsd){var v=s.cmsd.dynamic&&s.cmsd.dynamic.etp?s.cmsd.dynamic.etp:null;if(v){var T=u.get().streaming.cmsd.abr.etpWeightRatio;T>0&&T<=1&&(E=E*(1-T)+v*T)}}if(m(e),S=p,(_=e)===a.Z.VIDEO?S<u.get().streaming.cacheLoadThresholds[a.Z.VIDEO]:_===a.Z.AUDIO?S<u.get().streaming.cacheLoadThresholds[a.Z.AUDIO]:void 0){if(t[e].length>0&&!t[e].hasCachedEntries)return;t[e].hasCachedEntries=!0}else t[e]&&t[e].hasCachedEntries&&function(e){delete t[e],delete r[e],delete n[e],delete i[e],m(e)}(e);t[e].push(E),c.trigger(d.Z.THROUGHPUT_MEASUREMENT_STORED,{throughput:E,mediaType:e,httpRequest:s}),t[e].length>20&&t[e].shift(),r[e].push(g),r[e].length>20&&r[e].shift(),f(n[e],E,.001*p,o.throughputHalfLife),f(i[e],g,1,o.latencyHalfLife)}var _,S},getAverageThroughput:g,getSafeAverageThroughput:function(e,t){var r=g(e,t);return isNaN(r)||(r*=u.get().streaming.abr.bandwidthSafetyFactor),r},getAverageLatency:function(e){return h(!1,e)},reset:p};return o={throughputHalfLife:{fast:3,slow:8},latencyHalfLife:{fast:1,slow:2}},p(),y}pi.__dashjs_factory_name="ThroughputHistory";var yi=c.Z.getClassFactory(pi);function Ei(){var e,t,r,n,i,o,c,h,g,m,p,y,E,v,T,S,A,b,R,I,w,C,L,N,O,M,P,k=this.context,x=(0,f.Z)(k).getInstance(),F=(0,l.Z)(k).getInstance();function U(){i={},o={},h={},c={},I={},L={},N={},O={},void 0===m&&(m=!1),w&&w.reset(),R=void 0,w=void 0,C=void 0,clearTimeout(g),g=null}function B(t){var i=t.request.mediaType,a=t.streamId;if(i&&a&&c[a]&&P.get().streaming.abr.autoSwitchBitrate[i]){var o=c[a][i];if(o){var l=ci(k).create({abrController:e,streamProcessor:o,currentRequest:t.request,useBufferOccupancyABR:L[i],useL2AABR:N[i],useLoLPABR:O[i],videoModel:v}),u=r.shouldAbandonFragment(l,a);u.quality>fi.Z.NO_CHANGE&&o.getFragmentModel().getRequests({state:_.FRAGMENT_MODEL_LOADING,index:t.request.index})[0]&&(h[a][i].state=s.Z.ABANDON_LOAD,I[a][i].reset(),I[a][i].push({oldValue:Y(i,a),newValue:u.quality,confidence:1,reason:u.reason}),q(i,n.getActiveStreamInfo(),u.quality,u.reason),clearTimeout(g),g=setTimeout((function(){h[a][i].state=s.Z.ALLOW_LOAD,g=null}),P.get().streaming.abandonLoadTimeout))}}}function Z(e){e.mediaType===a.Z.VIDEO&&(void 0!==R&&w.push(e.streamId,R,v.getPlaybackQuality()),R=e.newQuality)}function G(e){var r,n;e.metric!==s.Z.HTTP_REQUEST||!e.value||e.value.type!==D.w.MEDIA_SEGMENT_TYPE||e.mediaType!==a.Z.AUDIO&&e.mediaType!==a.Z.VIDEO||C.push(e.mediaType,e.value,P.get().streaming.abr.useDeadTimeLatency),e.metric!==s.Z.BUFFER_LEVEL||e.mediaType!==a.Z.AUDIO&&e.mediaType!==a.Z.VIDEO||(r=e.mediaType,n=.001*e.value.level,P.get().streaming.abr.ABRStrategy===a.Z.ABR_STRATEGY_DYNAMIC&&function(e,r){try{var n=T.getStableBufferTime(),i=n,a=.5*n,o=L[e],s=r>(o?a:i);L[e]=s,s!==o&&(s?t.info("["+e+"] switching from throughput to buffer occupancy ABR rule (buffer: "+r.toFixed(3)+")."):t.info("["+e+"] switching from buffer occupancy to throughput ABR rule (buffer: "+r.toFixed(3)+")."))}catch(l){t.error(l)}}(r,n))}function H(e,r){try{var n;return i[r]=i[r]||{},i[r].hasOwnProperty(e)||(i[r][e]=0),n=function(e,t){var r=i[t][e],n=r;if(!c[t]||!c[t][e])return n;var a=K(e,t);void 0!==a&&(n=Math.max(r,a));var o=function(e,t){try{var r=T.getAbrBitrateParameter("maxBitrate",e);return r>-1?z(c[t][e].getMediaInfo(),r,t):void 0}catch(n){return}}(e,t);return void 0!==o&&(n=Math.min(n,o)),n}(e,r),o=n,s=e,l=i[r][s],u=P.get().streaming.abr.maxRepresentationRatio[s],n=function(e,t,r){if(t!==a.Z.VIDEO||!P.get().streaming.abr.limitBitrateByPortal||!c[r]||!c[r][t])return e;m||X();var n=c[r][t].getStreamInfo(),i=E.getAdaptationForType(n.index,t,n).Representation_asArray,o=e;if(p>0&&y>0){for(;o>0&&i[o]&&p<i[o].width&&p-i[o-1].width<i[o].width-p;)o-=1;for(;o<i.length-1&&i[o].width===i[o+1].width;)o+=1}return o}(n=isNaN(u)||u>=1||u<0?o:Math.min(o,Math.round(l*u)),e,r),P.get().streaming.cmsd.enabled&&P.get().streaming.cmsd.abr.applyMb&&(n=function(e,r,n){if("video"!==r)return e;var i=A.getMaxBitrate(r);if(i<0)return e;var a=j(n,"audio",Y("audio",n));i-=a?a.bitrate/1e3:0;var o=z(c[n][r].getMediaInfo(),i,n);return t.debug("Stream ID: "+n+" ["+r+"] Apply max bit rate from CMSD: "+i),Math.min(e,o)}(n,e,r)),n}catch(o){return}var o,s,l,u}function K(e,t){try{return function(e,t){try{var r=T.getAbrBitrateParameter("minBitrate",e);if(r>-1){var n=c[t][e].getMediaInfo(),i=W(n),a=z(n,r,t);return i[a]&&a<i.length-1&&i[a].bitrate<1e3*r&&a++,a}return}catch(o){return}}(e,t)}catch(r){return}}function Y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{return t||(t=n.getActiveStreamInfo().id),e&&c[t]&&c[t][e]&&t?(o[t]=o[t]||{},o[t].hasOwnProperty(e)||(o[t][e]=0),o[t][e]):0}catch(r){return 0}}function q(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(t&&t.id&&e){var i=t.id,a=Y(e,i);(0,$.SE)(r);var o=H(e,i);r!==a&&r>=0&&r<=o&&V(e,a,r,o,n,i)}}function V(e,r,n,i,a,s){if(e&&c[s]&&c[s][e]){var l=c[s][e].getStreamInfo(),f=l&&l.manifestInfo&&l.manifestInfo.isDynamic,d=M.getCurrentBufferLevel(e);t.info("Stream ID: "+s+" ["+e+"] switch from "+r+" to "+n+"/"+i+" (buffer: "+d+") "+(a?JSON.stringify(a):".")),o[s]=o[s]||{},o[s][e]=n;var h=j(s,e,n);F.trigger(u.Z.QUALITY_CHANGE_REQUESTED,{oldQuality:r,newQuality:n,reason:a,streamInfo:l,bitrateInfo:h,maxIdx:i,mediaType:e},{streamId:l.id,mediaType:e});var g=C.getAverageThroughput(e,f);isNaN(g)||b.setSavedBitrateSettings(e,g)}}function j(e,t,r){if(t&&c&&c[e]&&c[e][t]){var n=W(c[e][t].getMediaInfo());return n[r]?n[r]:null}return null}function z(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=e&&e.type?c[r][e.type].getRepresentationInfo():null;if(P.get().streaming.abr.useDeadTimeLatency&&n&&i&&i.fragmentDuration){n/=1e3;var a=i.fragmentDuration;if(n>a)return 0;t*=1-n/a}for(var o=W(e),s=o.length-1;s>=0;s--)if(1e3*t>=o[s].bitrate)return s;return 0}function W(e){var t=[];if(!e||!e.bitrateList)return t;for(var r,n=e.bitrateList,i=e.type,a=0,o=n.length;a<o;a++)(r=new kt).mediaType=i,r.qualityIndex=a,r.bitrate=n[a].bandwidth,r.width=n[a].width,r.height=n[a].height,r.scanType=n[a].scanType,t.push(r);return t}function X(){if(v){var e=P.get().streaming.abr.usePixelRatioInLimitBitrateByPortal&&window.hasOwnProperty("devicePixelRatio")?window.devicePixelRatio:1;p=v.getClientWidth()*e,y=v.getClientHeight()*e}}return e={initialize:function(){w=mi(k).create(),C=yi(k).create({settings:P}),(r=(0,li.Z)(k).create({dashMetrics:M,customParametersModel:S,mediaPlayerModel:T,settings:P})).initialize(),F.on(d.Z.QUALITY_CHANGE_RENDERED,Z,e),F.on(d.Z.METRIC_ADDED,G,e),F.on(u.Z.LOADING_PROGRESS,B,e)},isPlayingAtTopQuality:function(e){var t=e?e.id:null,r=Y(a.Z.AUDIO,t),n=Y(a.Z.VIDEO,t);return r===H(a.Z.AUDIO,t)&&n===H(a.Z.VIDEO,t)},updateTopQualityIndex:function(e){var t=e.type,r=e.streamInfo.id,n=e.representationCount-1;return i[r]=i[r]||{},i[r][t]=n,n},clearDataForStream:function(e){w&&w.clearForStream(e),c[e]&&delete c[e],I[e]&&delete I[e],h[e]&&delete h[e]},getThroughputHistory:function(){return C},getBitrateList:W,getQualityForBitrate:z,getTopBitrateInfoFor:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t||(t=n.getActiveStreamInfo().id),e&&c&&c[t]&&c[t][e]){var r=H(e,t),i=W(c[t][e].getMediaInfo());return i[r]?i[r]:null}return null},getMinAllowedIndexFor:K,getMaxAllowedIndexFor:H,getInitialBitrateFor:function(e,t){if(function(){if(!b||!b.hasOwnProperty("getSavedBitrateSettings"))throw new Error(a.Z.MISSING_CONFIG_ERROR)}(),e===a.Z.TEXT)return NaN;var r=b.getSavedBitrateSettings(e),n=T.getAbrBitrateParameter("initialBitrate",e),i=P.get().streaming.abr.initialRepresentationRatio[e];if(-1===n)if(i>-1){var o=c[t][e].getStreamInfo(),s=E.getAdaptationForType(o.index,e,o).Representation_asArray;n=Array.isArray(s)?s[Math.max(Math.round(s.length*i)-1,0)].bandwidth/1e3:0}else n=isNaN(r)?e===a.Z.VIDEO?1e3:100:r;return n},getQualityFor:Y,getAbandonmentStateFor:function(e,t){return h[e]&&h[e][t]?h[e][t].state:null},setPlaybackQuality:q,checkPlaybackQuality:function(t,n){try{if(!(t&&c&&c[n]&&c[n][t]))return!1;if(w){var i=v.getPlaybackQuality();i&&w.push(n,R,i)}if(!P.get().streaming.abr.autoSwitchBitrate[t])return!1;var a=Y(t,n),o=ci(k).create({abrController:e,switchHistory:I[n][t],droppedFramesHistory:w,streamProcessor:c[n][t],currentValue:a,useBufferOccupancyABR:L[t],useL2AABR:N[t],useLoLPABR:O[t],videoModel:v}),l=K(t,n),u=H(t,n),f=r.getMaxQuality(o),d=f.quality;return void 0!==l&&(d>fi.Z.NO_CHANGE?d:a)<l&&(d=l),d>u&&(d=u),I[n][t].push({oldValue:a,newValue:d}),d>fi.Z.NO_CHANGE&&d!==a&&(h[n][t].state===s.Z.ALLOW_LOAD||d<a)&&(V(t,a,d,u,f.reason,n),!0)}catch(g){return!1}},setElementSize:X,setWindowResizeEventCalled:function(e){m=e},registerStreamType:function(e,t){var r,n,i=t.getStreamInfo().id;c[i]||(c[i]={}),I[i]||(I[i]={}),h[i]||(h[i]={}),I[i][e]=hi(k).create(),c[i][e]=t,h[i][e]={},h[i][e].state=s.Z.ALLOW_LOAD,r=e,(n=P.get().streaming.abr.ABRStrategy)===a.Z.ABR_STRATEGY_L2A?(L[r]=!1,O[r]=!1,N[r]=!0):n===a.Z.ABR_STRATEGY_LoLP?(L[r]=!1,O[r]=!0,N[r]=!1):n===a.Z.ABR_STRATEGY_BOLA?(L[r]=!0,O[r]=!1,N[r]=!1):n===a.Z.ABR_STRATEGY_THROUGHPUT?(L[r]=!1,O[r]=!1,N[r]=!1):n===a.Z.ABR_STRATEGY_DYNAMIC&&(L[r]=!(!L||!L[r])&&L[r],O[r]=!1,N[r]=!1),e===a.Z.VIDEO&&X()},unRegisterStreamType:function(e,t){try{c[e]&&c[e][t]&&delete c[e][t],I[e]&&I[e][t]&&delete I[e][t],h[e]&&h[e][t]&&delete h[e][t]}catch(r){}},setConfig:function(e){e&&(e.streamController&&(n=e.streamController),e.domStorage&&(b=e.domStorage),e.mediaPlayerModel&&(T=e.mediaPlayerModel),e.customParametersModel&&(S=e.customParametersModel),e.cmsdModel&&(A=e.cmsdModel),e.dashMetrics&&(M=e.dashMetrics),e.adapter&&(E=e.adapter),e.videoModel&&(v=e.videoModel),e.settings&&(P=e.settings))},reset:function(){U(),F.off(u.Z.LOADING_PROGRESS,B,e),F.off(d.Z.QUALITY_CHANGE_RENDERED,Z,e),F.off(d.Z.METRIC_ADDED,G,e),r&&r.reset()}},t=x.getLogger(e),U(),e}Ei.__dashjs_factory_name="AbrController";var vi=c.Z.getSingletonFactory(Ei);vi.QUALITY_DEFAULT=0,c.Z.updateSingletonFactory(Ei.__dashjs_factory_name,vi);var Ti=vi,_i=new Map([[a.Z.VIDEO_ELEMENT_READY_STATES.HAVE_METADATA,"loadedmetadata"],[a.Z.VIDEO_ELEMENT_READY_STATES.HAVE_CURRENT_DATA,"loadeddata"],[a.Z.VIDEO_ELEMENT_READY_STATES.HAVE_FUTURE_DATA,"canplay"],[a.Z.VIDEO_ELEMENT_READY_STATES.HAVE_ENOUGH_DATA,"canplaythrough"]]);function Si(){var e,t,r,n,i,o,s,c,d=this.context,h=(0,l.Z)(d).getInstance(),g=[];function m(){r&&(r.playbackRate=1,r.removeEventListener("canplay",m))}function p(){return g.length>0}function y(){if(r&&p()&&0===r.playbackRate){var e=document.createEvent("Event");e.initEvent("waiting",!0,!1),r.dispatchEvent(e)}}function E(e,t){r&&r.addEventListener(e,t)}function v(e,t){r&&r.removeEventListener(e,t)}function T(){return r?r.readyState:NaN}function _(){return r?r.buffered:null}function S(e,t,n,i,a){if(r)for(var o=0;o<r.textTracks.length;o++)if(r.textTracks[o].kind===e&&(!t||r.textTracks[o].label==t)&&r.textTracks[o].language===n&&r.textTracks[o].isTTML===i&&r.textTracks[o].isEmbedded===a)return r.textTracks[o];return null}function A(e,t){return e===a.Z.VIDEO_ELEMENT_READY_STATES.HAVE_NOTHING||T()>=e?(t(),null):(r=_i.get(e),n=t,E(r,i=function e(){v(r,e),n(r)}),{func:i,event:r});var r,n,i}return e={addEventListener:E,addTextTrack:function(e,t,n,i,a){if(!r)return null;var o=S(e,t,n,i,a);return o||((o=r.addTextTrack(e,t,n)).isEmbedded=a,o.isTTML=i),o},appendChild:function(e){r&&(r.appendChild(e),void 0!==e.isTTML&&(r.textTracks[r.textTracks.length-1].isTTML=e.isTTML,r.textTracks[r.textTracks.length-1].isEmbedded=e.isEmbedded))},getBufferRange:_,getClientHeight:function(){return r?r.clientHeight:NaN},getClientWidth:function(){return r?r.clientWidth:NaN},getElement:function(){return r},getEnded:function(){return r?r.ended:null},getPlaybackQuality:function(){if(!r)return null;var e="webkitDroppedFrameCount"in r&&"webkitDecodedFrameCount"in r,t=null;return"getVideoPlaybackQuality"in r?t=r.getVideoPlaybackQuality():e&&(t={droppedVideoFrames:r.webkitDroppedFrameCount,totalVideoFrames:r.webkitDroppedFrameCount+r.webkitDecodedFrameCount,creationTime:new Date}),t},getPlaybackRate:function(){return r?r.playbackRate:null},getPlayedRanges:function(){return r?r.played:null},getReadyState:T,getSource:function(){return r?r.src:null},getTTMLRenderingDiv:function(){return o},getTextTrack:S,getTextTracks:function(){return r?r.textTracks:[]},getTime:function(){return r?isNaN(n)?r.currentTime:n:null},getVideoHeight:function(){return r?r.videoHeight:NaN},getVideoRelativeOffsetLeft:function(){if(r){var e=r.parentNode.host||r.parentNode;return e?r.getBoundingClientRect().left-e.getBoundingClientRect().left:NaN}return NaN},getVideoRelativeOffsetTop:function(){if(r){var e=r.parentNode.host||r.parentNode;return e?r.getBoundingClientRect().top-e.getBoundingClientRect().top:NaN}return NaN},getVideoWidth:function(){return r?r.videoWidth:NaN},getVttRenderingDiv:function(){return s},initialize:function(){h.on(u.Z.PLAYBACK_PLAYING,y,this)},isPaused:function(){return r?r.paused:null},isSeeking:function(){return r?r.seeking||!isNaN(n):null},isStalled:p,pause:function(){r&&(r.pause(),r.autoplay=!1)},play:function(){if(r){r.autoplay=!0;var e=r.play();e&&e.catch&&"undefined"!=typeof Promise&&e.catch((function(e){"NotAllowedError"===e.name&&h.trigger(u.Z.PLAYBACK_NOT_ALLOWED),t.warn("Caught pending play exception - continuing (".concat(e,")"))}))}},removeChild:function(e){r&&r.removeChild(e)},removeEventListener:v,reset:function(){clearTimeout(c),h.off(u.Z.PLAYBACK_PLAYING,y,this)},setCurrentTime:function(e,t){r&&(i&&i.func&&i.event&&v(i.event,i.func),n=e,i=A(a.Z.VIDEO_ELEMENT_READY_STATES.HAVE_METADATA,(function(){if(r)if(r.currentTime!==n)try{n=t?function(e){var t=_(),r=e,n=9999999999;if(t)for(var i=0;i<t.length;i++){var a=t.start(i),o=t.end(i),s=Math.abs(a-e),l=Math.abs(o-e);if(e>=a&&e<=o)return e;s<n&&(n=s,r=a),l<n&&(n=l,r=o)}return r}(n):n,isNaN(n)||(r.currentTime=n),n=NaN}catch(e){0===r.readyState&&e.code===e.INVALID_STATE_ERR&&(c=setTimeout((function(){r.currentTime=n,n=NaN}),400))}else n=NaN})))},setElement:function(e){if(!(null==e||e&&/^(VIDEO|AUDIO)$/i.test(e.nodeName)))throw"element is not video or audio DOM type!";(r=e)&&(r.preload="auto")},setPlaybackRate:function(e){r&&(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&r.readyState<=2&&e>0?r.addEventListener("canplay",m):r.playbackRate=e)},setSource:function(e){r&&(e?r.src=e:(r.removeAttribute("src"),r.load()))},setStallState:function(e,t){var n,i;n=e,t?null!==(i=n)&&r&&!r.seeking&&-1===g.indexOf(i)&&g.push(i):function(e){var t=g.indexOf(e);null!==e&&-1!==t&&g.splice(t,1)}(n)},setTTMLRenderingDiv:function(e){(o=e).style.position="absolute",o.style.display="flex",o.style.overflow="hidden",o.style.pointerEvents="none",o.style.top=0,o.style.left=0},setVttRenderingDiv:function(e){s=e},waitForReadyState:A,setDisableRemotePlayback:function(e){r&&(r.disableRemotePlayback=e)}},t=(0,f.Z)(d).getInstance().getLogger(e),n=NaN,e}Si.__dashjs_factory_name="VideoModel";var Ai=c.Z.getSingletonFactory(Si),bi=[{oldKey:"dashjs_vbitrate",newKey:"dashjs_video_bitrate"},{oldKey:"dashjs_abitrate",newKey:"dashjs_audio_bitrate"},{oldKey:"dashjs_vsettings",newKey:"dashjs_video_settings"},{oldKey:"dashjs_asettings",newKey:"dashjs_audio_settings"}],Ri="dashjs_?_bitrate",Ii="dashjs_?_settings",wi="localStorage",Ci="lastBitrate",Di="lastMediaSettings";function Li(e){e=e||{};var t,r,n,i=this.context,o=e.settings;function s(e){if(void 0!==n)return n;var t;n=!1;try{"undefined"!=typeof window&&(t=window[e])}catch(i){return r.warn("DOMStorage access denied: "+i.message),n}if(!t||e!==wi&&"sessionStorage"!==e)return n;try{t.setItem("1","1"),t.removeItem("1"),n=!0}catch(i){r.warn("DOMStorage is supported, but cannot be used: "+i.message)}return n}function l(){var e=6e5;return Math.round((new Date).getTime()/e)*e}function u(e,t){return s(e)&&o.get().streaming[t+"CachingInfo"].enabled}function c(){if(!o)throw new Error(a.Z.MISSING_CONFIG_ERROR)}return t={getSavedBitrateSettings:function(e){if(c(),!o.get().streaming.lastBitrateCachingInfo.enabled)return NaN;var t=NaN;if(u(wi,Ci)){var n=Ri.replace(/\?/,e);try{var i=JSON.parse(localStorage.getItem(n))||{},a=(new Date).getTime()-parseInt(i.timestamp,10)>=o.get().streaming.lastBitrateCachingInfo.ttl||!1,s=parseFloat(i.bitrate);isNaN(s)||a?a&&localStorage.removeItem(n):(t=s,r.debug("Last saved bitrate for "+e+" was "+s))}catch(l){return null}}return t},setSavedBitrateSettings:function(e,t){if(u(wi,Ci)&&t){var n=Ri.replace(/\?/,e);try{localStorage.setItem(n,JSON.stringify({bitrate:t.toFixed(3),timestamp:l()}))}catch(i){r.error(i.message)}}},getSavedMediaSettings:function(e){if(c(),!o.get().streaming.lastMediaSettingsCachingInfo.enabled)return null;var t=null;if(u(wi,Di)){var r=Ii.replace(/\?/,e);try{var n=JSON.parse(localStorage.getItem(r))||{},i=(new Date).getTime()-parseInt(n.timestamp,10)>=o.get().streaming.lastMediaSettingsCachingInfo.ttl||!1;t=n.settings,i&&(localStorage.removeItem(r),t=null)}catch(a){return null}}return t},setSavedMediaSettings:function(e,t){if(u(wi,Di)){var n=Ii.replace(/\?/,e);try{localStorage.setItem(n,JSON.stringify({settings:t,timestamp:l()}))}catch(i){r.error(i.message)}}}},r=(0,f.Z)(i).getInstance().getLogger(t),s(wi)&&bi.forEach((function(e){var t=localStorage.getItem(e.oldKey);if(t){localStorage.removeItem(e.oldKey);try{localStorage.setItem(e.newKey,t)}catch(n){r.error(n.message)}}})),t}Li.__dashjs_factory_name="DOMStorage";var Ni=c.Z.getSingletonFactory(Li),Oi=r(2032),Mi=r(2011);function Pi(){var e,t,r,n,i,a,o,s,l,u,c,f,d,h=this.context;function g(e,r,i,a){var o=null,l=e?d.resolve(e.path):null,u=a||{init:!0,url:l?l.url:void 0,range:{start:0,end:1500},searching:!1,bytesLoaded:0,bytesToLoad:1500,mediaType:r};t.debug("Start searching for initialization.");var c=E(u);s.load({request:c,success:function(t){if(u.bytesLoaded=u.range.end,!(o=n.findInitRange(t)))return u.range.end=u.bytesLoaded+u.bytesToLoad,g(e,r,i,u);e.range=o,i(e)},error:function(){i(e)}}),t.debug("Perform init search: "+u.url)}function p(e,r,i,a,o,l){if(i&&(void 0===i.start||void 0===i.end)){var u=i?i.toString().split("-"):null;i=u?{start:parseFloat(u[0]),end:parseFloat(u[1])}:null}o=o||y;var c=null,f=null,h=!!i,g=e?d.resolve(e.path):null,m={init:!1,url:g?g.url:void 0,range:h?i:{start:0,end:1500},searching:!h,bytesLoaded:l?l.bytesLoaded:0,bytesToLoad:1500,mediaType:r},v=E(m);s.load({request:v,success:function(i){var s=m.bytesToLoad,l=i.byteLength;if(m.bytesLoaded=m.range.end-m.range.start,c=n.parse(i),(f=c.getBox("sidx"))&&f.isComplete){var u,d,h=f.references;if(null!=h&&h.length>0&&(u=1===h[0].reference_type),u){var g,y,E,v;t.debug("Initiate multiple SIDX load."),m.range.end=m.range.start+f.size;var T=[],_=0,S=(f.offset||m.range.start)+f.size,A=function(t){t?(T=T.concat(t),++_>=y&&(T.sort((function(e,t){return e.startTime-t.startTime<0?-1:0})),o(T,e,a))):o(null,e,a)};for(g=0,y=h.length;g<y;g++)E=S,v=S+h[g].referenced_size-1,S+=h[g].referenced_size,p(e,r,{start:E,end:v},a,A,m)}else t.debug("Parsing segments from SIDX. representation "+r+" - id: "+e.id+" for range : "+m.range.start+" - "+m.range.end),d=function(e,t){for(var r,n,i,a,o=e.references,s=o.length,l=e.timescale,u=e.earliest_presentation_time,c=t.range.start+e.offset+e.first_offset+e.size,f=[],d=0;d<s;d++)i=o[d].subsegment_duration,a=o[d].referenced_size,(r=new Mi.Z).duration=i,r.startTime=u,r.timescale=l,n=c+a-1,r.mediaRange=c+"-"+n,f.push(r),u+=i,c+=a;return f}(f,m),o(d,e,a)}else{if(f)m.range.start=f.offset||m.range.start,m.range.end=m.range.start+(f.size||s);else{if(l<m.bytesLoaded)return void o(null,e,a);var b=c.getLastBox();b&&b.size?(m.range.start=b.offset+b.size,m.range.end=m.range.start+s):m.range.end+=s}p(e,r,m.range,a,null,m)}},error:function(){o(null,e,a)}}),t.debug("Perform SIDX load for type ".concat(r," : ").concat(m.url," with range ").concat(m.range.start," - ").concat(m.range.end))}function y(e,t,r){r({segments:e,representation:t,error:e?void 0:new S.Z(l.SEGMENT_BASE_LOADER_ERROR_CODE,l.SEGMENT_BASE_LOADER_ERROR_MESSAGE)})}function E(e){if(e.url){var t=new m.Z;return t.setInfo(e),t}}return e={setConfig:function(s){s.baseURLController&&(d=s.baseURLController),s.dashMetrics&&(a=s.dashMetrics),s.mediaPlayerModel&&(o=s.mediaPlayerModel),s.errHandler&&(r=s.errHandler),s.boxParser&&(n=s.boxParser),s.debug&&(t=s.debug.getLogger(e)),s.requestModifier&&(i=s.requestModifier),s.errors&&(l=s.errors),s.urlUtils&&(f=s.urlUtils),s.constants&&(u=s.constants),s.dashConstants&&(c=s.dashConstants)},initialize:function(){s=St(h).create({errHandler:r,dashMetrics:a,mediaPlayerModel:o,requestModifier:i,boxParser:n,errors:l,urlUtils:f,constants:u,dashConstants:c})},loadInitialization:function(e,t){return new Promise((function(r){g(e,t,r)}))},loadSegments:function(e,t,r){return new Promise((function(n){p(e,t,r,n)}))},reset:function(){s&&(s.abort(),s=null)}}}Pi.__dashjs_factory_name="SegmentBaseLoader";var ki=c.Z.getSingletonFactory(Pi);function xi(e){var t;e=e||{};var r=new DataView(e.data),n=0;function i(e,t){var i=!0,a=0;if(void 0===t&&(t=!1),e.tag>16777215?(r.getUint32(n)!==e.tag&&(i=!1),a=4):e.tag>65535?(256*r.getUint16(n)+r.getUint8(n+2)!==e.tag&&(i=!1),a=3):e.tag>255?(r.getUint16(n)!==e.tag&&(i=!1),a=2):(r.getUint8(n)!==e.tag&&(i=!1),a=1),!i&&e.required&&!t)throw new Error("required tag not found");return i&&(n+=a),i}function a(e){var t=1,i=128,a=-1,o=0,s=r.getUint8(n),l=0;for(l=0;l<8;l+=1){if((s&i)===i){o=void 0===e?s&~i:s,a=l;break}i>>=1}for(l=0;l<a;l+=1,t+=1)o=o<<8|255&r.getUint8(n+t);return n+=t,o}return t={getPos:function(){return n},setPos:function(e){n=e},consumeTag:i,consumeTagAndSize:function(e,t){var r=i(e,t);return r&&a(),r},parseTag:function(e){var r;return i(e),r=a(),t[e.parse](r)},skipOverElement:function(e,t){var r,o=i(e,t);return o&&(r=a(),n+=r),o},getMatroskaCodedNum:a,getMatroskaFloat:function(e){var t;switch(e){case 4:t=r.getFloat32(n),n+=4;break;case 8:t=r.getFloat64(n),n+=8}return t},getMatroskaUint:function(e){if(e>4)return function(e){for(var t=Math.floor(Number.MAX_SAFE_INTEGER/256),i=0,a=0;a<e;a+=1){if(i>t)throw new Error("Value exceeds safe integer limit");i*=256;var o=r.getUint8(n+a);if(i>Number.MAX_SAFE_INTEGER-o)throw new Error("Value exceeds safe integer limit");i+=o}return n+=e,i}(e);for(var t=0,i=0;i<e;i+=1)t<<=8,t|=255&r.getUint8(n+i);return n+=e,t>>>0},moreData:function(){return n<r.byteLength}}}xi.__dashjs_factory_name="EBMLParser";var Fi=c.Z.getClassFactory(xi);function Ui(){var e,t,r,n,i,o,s,l,u,c,f=this.context;function d(e){var t=new m.Z;return t.setInfo(e),t}return e={setConfig:function(r){if(!(r.baseURLController&&r.dashMetrics&&r.mediaPlayerModel&&r.errHandler))throw new Error(a.Z.MISSING_CONFIG_ERROR);c=r.baseURLController,o=r.dashMetrics,s=r.mediaPlayerModel,n=r.errHandler,u=r.errors,t=r.debug.getLogger(e),i=r.requestModifier},initialize:function(){l=St(f).create({errHandler:n,dashMetrics:o,mediaPlayerModel:s,requestModifier:i,errors:u})},loadInitialization:function(e,r){return new Promise((function(n){var i=null,a=e?c.resolve(e.path):null,o=e?e.range.split("-"):null,s={range:{start:o?parseFloat(o[0]):null,end:o?parseFloat(o[1]):null},request:i,url:a?a.url:void 0,init:!0,mediaType:r};t.info("Start loading initialization."),i=d(s),l.load({request:i,success:function(){n(e)},error:function(){n(e)}}),t.debug("Perform init load: "+s.url)}))},loadSegments:function(e,n,i){return new Promise((function(a){var o=null,s=e?c.resolve(e.path):null,h=s?s.url:void 0;o=d({bytesLoaded:0,bytesToLoad:8192,range:{start:0,end:8192},request:o,url:h,init:!1,mediaType:n}),t.debug("Parsing ebml header"),l.load({request:o,success:function(n){!function(e,n,i,a){if(e&&0!==e.byteLength){var o,s,u,c,h=Fi(f).create({data:e}),g=i?i.split("-"):null,m=null,p={url:n,range:{start:g?parseFloat(g[0]):null,end:g?parseFloat(g[1]):null},request:m};for(t.debug("Parse EBML header: "+p.url),h.skipOverElement(r.EBML),h.consumeTag(r.Segment),u=h.getMatroskaCodedNum(),u+=h.getPos(),c=h.getPos();h.moreData()&&!h.consumeTagAndSize(r.Segment.Info,!0);)if(!(h.skipOverElement(r.Segment.SeekHead,!0)||h.skipOverElement(r.Segment.Tracks,!0)||h.skipOverElement(r.Segment.Cues,!0)||h.skipOverElement(r.Void,!0)))throw new Error("no valid top level element found");for(;void 0===o;){var y=h.getMatroskaCodedNum(!0),E=h.getMatroskaCodedNum();y===r.Segment.Info.Duration.tag?o=h[r.Segment.Info.Duration.parse](E):h.setPos(h.getPos()+E)}m=d(p),l.load({request:m,success:function(e){s=function(e,n,i,a){var o,s,l,u,c,d,h,g;for(l=[],c=0,d=(s=function(e){var t,n,i=[],a=Fi(f).create({data:e});for(a.consumeTagAndSize(r.Segment.Cues);a.moreData()&&a.consumeTagAndSize(r.Segment.Cues.CuePoint,!0);){for((t={}).CueTime=a.parseTag(r.Segment.Cues.CuePoint.CueTime),t.CueTracks=[];a.moreData()&&a.consumeTag(r.Segment.Cues.CuePoint.CueTrackPositions,!0);){var o=a.getMatroskaCodedNum(),s=a.getPos();if((n={}).Track=a.parseTag(r.Segment.Cues.CuePoint.CueTrackPositions.CueTrack),0===n.Track)throw new Error("Cue track cannot be 0");n.ClusterPosition=a.parseTag(r.Segment.Cues.CuePoint.CueTrackPositions.CueClusterPosition),t.CueTracks.push(n),a.setPos(s+o)}if(0===t.CueTracks.length)throw new Error("Mandatory cuetrack not found");i.push(t)}if(0===i.length)throw new Error("mandatory cuepoint not found");return i}(e)).length;c<d;c+=1)u=new Mi.Z,o=c<s.length-1?s[c+1].CueTime-s[c].CueTime:a-s[c].CueTime,u.duration=o,u.startTime=s[c].CueTime,u.timescale=1e3,h=s[c].CueTracks[0].ClusterPosition+n,g=c<s.length-1?s[c+1].CueTracks[0].ClusterPosition+n-1:i-1,u.mediaRange=h+"-"+g,l.push(u);return t.debug("Parsed cues: "+l.length+" cues."),l}(e,c,u,o),a(s)},error:function(){t.error("Download Error: Cues "+p.url),a(null)}}),t.debug("Perform cues load: "+p.url+" bytes="+p.range.start+"-"+p.range.end)}else a(null)}(n,h,i,(function(t){a({segments:t,representation:e,error:t?void 0:new S.Z(u.SEGMENT_BASE_LOADER_ERROR_CODE,u.SEGMENT_BASE_LOADER_ERROR_MESSAGE)})}))},error:function(){a({representation:e,error:new S.Z(u.SEGMENT_BASE_LOADER_ERROR_CODE,u.SEGMENT_BASE_LOADER_ERROR_MESSAGE)})}})}))},reset:function(){l&&(l.abort(),l=null)}},r={EBML:{tag:440786851,required:!0},Segment:{tag:408125543,required:!0,SeekHead:{tag:290298740,required:!0},Info:{tag:357149030,required:!0,TimecodeScale:{tag:2807729,required:!0,parse:"getMatroskaUint"},Duration:{tag:17545,required:!0,parse:"getMatroskaFloat"}},Tracks:{tag:374648427,required:!0},Cues:{tag:475249515,required:!0,CuePoint:{tag:187,required:!0,CueTime:{tag:179,required:!0,parse:"getMatroskaUint"},CueTrackPositions:{tag:183,required:!0,CueTrack:{tag:247,required:!0,parse:"getMatroskaUint"},CueClusterPosition:{tag:241,required:!0,parse:"getMatroskaUint"}}}}},Void:{tag:236,required:!0}},e}Ui.__dashjs_factory_name="WebmSegmentBaseLoader";var Bi=c.Z.getSingletonFactory(Ui);function Zi(e){e=e||{};var t,r,n,i=this.context,a=e.eventBus,o=e.events,s=e.dashMetrics,l=e.mediaPlayerModel,u=e.errHandler,c=e.baseURLController,f=e.debug,d=e.boxParser,h=e.requestModifier,g=e.errors;function m(e){return"webm"===(e?e.split("/")[1]:"").toLowerCase()}return t={initialize:function(){r.initialize(),n.initialize()},getSegmentBaseInitSegment:function(e){return m(e.representation.mimeType)?n.loadInitialization(e.representation,e.mediaType):r.loadInitialization(e.representation,e.mediaType)},getSegmentList:function(e){return m(e.mimeType)?n.loadSegments(e.representation,e.mediaType,e.representation?e.representation.indexRange:null):r.loadSegments(e.representation,e.mediaType,e.representation?e.representation.indexRange:null)},reset:function(){r.reset(),n.reset()}},r=ki(i).getInstance(),n=Bi(i).getInstance(),r.setConfig({baseURLController:c,dashMetrics:s,mediaPlayerModel:l,errHandler:u,eventBus:a,events:o,errors:g,debug:f,boxParser:d,requestModifier:h}),n.setConfig({baseURLController:c,dashMetrics:s,mediaPlayerModel:l,errHandler:u,eventBus:a,events:o,errors:g,debug:f,requestModifier:h}),t}Zi.__dashjs_factory_name="SegmentBaseController";var Gi=c.Z.getSingletonFactory(Zi),Hi=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.quality=null,this.fragmentDuration=null,this.mediaInfo=null,this.MSETimeOffset=null},Ki=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.index=null,this.type=null,this.streamInfo=null,this.representationCount=0,this.labels=null,this.lang=null,this.viewpoint=null,this.viewpointsWithSchemeIdUri=null,this.accessibility=null,this.accessibilitiesWithSchemeIdUri=null,this.audioChannelConfiguration=null,this.audioChannelConfigurationsWithSchemeIdUri=null,this.roles=null,this.rolesWithSchemeIdUri=null,this.codec=null,this.mimeType=null,this.contentProtection=null,this.isText=!1,this.KID=null,this.bitrateList=null,this.isFragmented=null,this.isEmbedded=null,this.selectionPriority=1,this.supplementalProperties={},this.supplementalPropertiesAsArray=[],this.essentialProperties={},this.essentialPropertiesAsArray=[],this.segmentAlignment=!1,this.subSegmentAlignment=!1},Yi=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.index=null,this.start=NaN,this.duration=NaN,this.manifestInfo=null,this.isLast=!0},qi=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.dvrWindowSize=NaN,this.loadedTime=null,this.availableFrom=null,this.minBufferTime=NaN,this.duration=NaN,this.isDynamic=!1,this.maxFragmentDuration=null,this.serviceDescriptions=[],this.protocol=null};function Vi(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ji=function(){function e(t){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.valid="/"==t[0],this.path=t.split("/").filter((function(e){return 0!==e.length})).map((function(e){var t={name:e},n=e.indexOf("[");if(-1!=n){t.name=e.substring(0,n);var i=e.substring(n+1,e.length-1);r.valid=r.valid&&-1==i.indexOf("[");var a=i.indexOf("=");-1!=a?(t.attribute={name:i.substring(1,a),value:i.substring(a+1)},-1!=["'",'"'].indexOf(t.attribute.value[0])&&(t.attribute.value=t.attribute.value.substring(1,t.attribute.value.length-1))):t.position=parseInt(i,10)-1}return t}))}var t;return(t=[{key:"isValid",value:function(){return this.valid}},{key:"findsElement",value:function(){return!this.findsAttribute()}},{key:"findsAttribute",value:function(){return this.path[this.path.length-1].name.startsWith("@")}},{key:"findsTextReplace",value:function(){return"text()"===this.path[this.path.length-1].name}},{key:"getMpdTarget",value:function(e,t){for(var r=null,n=e,i=1,a="MPD";i<this.path.length&&null!==n;){r=n;var o=this.path[i];if(a=o.name,i!==this.path.length-1||!a.startsWith("@")&&"text()"!==a){var s=r[a+"_asArray"]||[];0===s.length&&r[a]&&s.push(r[a]),o.position?n=s[o.position]||null:o.attribute?function(){var e=o.attribute;n=s.filter((function(t){return t[e.name]==e.value}))[0]||null}():n=s[0]||null}i++}return null===n?null:a.startsWith("@")?{name:a.substring(1),leaf:n,target:n}:"text()"===a?{name:"__text",leaf:n,target:n}:{name:a,leaf:n,target:t?r:n}}}])&&Vi(e.prototype,t),e}();function $i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var zi=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.action=t,this.xpath=r,this.value=n,this.position=null}var t;return(t=[{key:"getMpdTarget",value:function(e){var t="remove"===this.action||"replace"===this.action||"before"===this.position||"after"===this.position;return this.xpath.getMpdTarget(e,t)}}])&&$i(e.prototype,t),e}();function Wi(){var e,t,r=this.context;return e={getIsPatch:function(e){return e&&e.hasOwnProperty(o.Z.ORIGINAL_MPD_ID)||!1},getPublishTime:function(e){return e&&e.hasOwnProperty(o.Z.PUBLISH_TIME)?new Date(e[o.Z.PUBLISH_TIME]):null},getOriginalPublishTime:function(e){return e&&e.hasOwnProperty(o.Z.ORIGINAL_PUBLISH_TIME)?new Date(e[o.Z.ORIGINAL_PUBLISH_TIME]):null},getMpdId:function(e){return e&&e[o.Z.ORIGINAL_MPD_ID]||null},getPatchOperations:function(e){return e?(e.__children||[]).map((function(e){var r=Object.keys(e)[0];if("add"!==r&&"remove"!==r&&"replace"!==r)return t.warn("Ignoring node of invalid action: ".concat(r)),null;var n=e[r],i=n.sel;if("add"===r&&n.type){if(!n.type.startsWith("@"))return t.warn("Ignoring add action for prefixed namespace declaration: ".concat(n.type,"=").concat(n.__text)),null;i="".concat(i,"/").concat(n.type)}var a=new ji(i);if(!a.isValid())return t.warn("Ignoring action with invalid selector: ".concat(r," - ").concat(i)),null;var o=null;a.findsAttribute()||a.findsTextReplace()?o=n.__text||"":"remove"!==r&&(o=n.__children.reduce((function(e,t){var r=Object.keys(t)[0];return"#text"!==r&&(e[r]=e[r]||[],e[r].push(t[r])),e}),{}));var s=new zi(r,a,o);return"add"===r&&(s.position=n.pos),s})).filter((function(e){return!!e})):[]}},t=(0,f.Z)(r).getInstance().getLogger(e),e}Wi.__dashjs_factory_name="PatchManifestModel";var Xi=c.Z.getSingletonFactory(Wi);function Qi(){var e,t,r,n,i,a,s,l=this.context;function u(e,r,a){var s,l=t.getAdaptationsForType(n[0].mpd.manifest,e,r);if(!l||0===l.length)return null;if(l.length>1&&a){var u=d(a,r);if(i[a.id]&&i[a.id][r])for(var f=0,h=l.length;f<h;f++)if(c(i[a.id][r],u[f]))return l[f];for(var g=0,m=l.length;g<m;g++)if(s=l[g],t.getRolesForAdaptation(s).filter((function(e){return e.value===o.Z.MAIN}))[0])return l[g]}return l[0]}function c(e,t){if(!e||!t)return!1;var r=e.id===t.id,n=e.codec===t.codec,i=e.viewpoint===t.viewpoint,a=JSON.stringify(e.viewpointsWithSchemeIdUri)===JSON.stringify(t.viewpointsWithSchemeIdUri),o=e.lang===t.lang,s=e.roles.toString()===t.roles.toString(),l=JSON.stringify(e.rolesWithSchemeIdUri)===JSON.stringify(t.rolesWithSchemeIdUri),u=e.accessibility.toString()===t.accessibility.toString(),c=JSON.stringify(e.accessibilitiesWithSchemeIdUri)===JSON.stringify(t.accessibilitiesWithSchemeIdUri),f=e.audioChannelConfiguration.toString()===t.audioChannelConfiguration.toString(),d=JSON.stringify(e.audioChannelConfigurationsWithSchemeIdUri)===JSON.stringify(t.audioChannelConfigurationsWithSchemeIdUri);return r&&n&&i&&a&&o&&s&&l&&u&&c&&f&&d}function f(e,r,n,i,o,s){var l,u,c,f,d,h,g=[];if(!i||0===i.length)return[];var m=t.getAdaptationsForPeriod(r);for(f=0,h=i.length;f<h;f++)if(l=i[f],u=v(m[c=t.getIndexForAdaptation(l,e,n.index)]),s){var p=u.accessibility.length;for(d=0;d<p;d++)if(u){var y=u.accessibility[d];if(0===y.indexOf("cea-608:")){var E=y.substring(8).split(";");if("CC"===E[0].substring(0,2))for(d=0;d<E.length;d++)u||(u=v.call(this,m[c])),T(u,E[d].substring(0,3),E[d].substring(4)),g.push(u),u=null;else for(d=0;d<E.length;d++)u||(u=v.call(this,m[c])),T(u,"CC"+(d+1),E[d]),g.push(u),u=null}else 0===y.indexOf("cea-608")&&(T(u,a.CC1,"eng"),g.push(u),u=null)}}else o===a.IMAGE?(u.type=a.IMAGE,g.push(u),u=null):u&&g.push(u);return g}function d(e,r,i){var o=n,s=i,l=[];if(s)S(),o=h(s);else{if(!(n.length>0))return l;s=n[0].mpd.manifest}var u=E(e,o),c=t.getAdaptationsForType(s,e?e.index:null,r);return l=f(s,u,e,c,r),r===a.TEXT&&(c=t.getAdaptationsForType(s,e?e.index:null,a.VIDEO),l=l.concat(f(s,u,e,c,r,!0))),l}function h(e){var r=g(e);return t.getRegularPeriods(r)}function g(e){var r=p(e);return t.getMpd(r)}function m(){n=[],i={}}function p(e){return e||(n.length>0?n[0].mpd.manifest:null)}function y(e){try{var r=E(e.streamInfo,n),i=t.getAdaptationsForPeriod(r);return e&&e.streamInfo&&void 0!==e.streamInfo.id&&i?i[e.index]:null}catch(a){return null}}function E(e,t){for(var r=t.length,n=0;n<r;n++){var i=t[n];if(e&&e.id===i.id)return i}return null}function v(e){if(!e)return null;var r,n,i,a,o,l=new Ki,u=e.period.mpd.manifest.Period_asArray[e.period.index].AdaptationSet_asArray[e.index];if(l.id=e.id,l.index=e.index,l.type=e.type,l.streamInfo=_(e.period),l.representationCount=t.getRepresentationCount(u),l.labels=t.getLabelsForAdaptation(u),l.lang=t.getLanguageForAdaptation(u),l.segmentAlignment=t.getSegmentAlignment(u),l.subSegmentAlignment=t.getSubSegmentAlignment(u),r=t.getViewpointForAdaptation(u),l.viewpoint=r.length?r[0].value:void 0,l.viewpointsWithSchemeIdUri=r,o=t.getAccessibilityForAdaptation(u),l.accessibility=o.map((function(e){var t=e.value,r=t;return e.schemeIdUri&&e.schemeIdUri.search("cea-608")>=0&&void 0!==s&&(r=t?"cea-608:"+t:"cea-608",l.embeddedCaptions=!0),r})),l.accessibilitiesWithSchemeIdUri=o,n=t.getAudioChannelConfigurationForAdaptation(u),l.audioChannelConfiguration=n.map((function(e){return e.value})),l.audioChannelConfigurationsWithSchemeIdUri=n,0===l.audioChannelConfiguration.length&&Array.isArray(u.Representation_asArray)&&u.Representation_asArray.length>0&&(i=t.getAudioChannelConfigurationForRepresentation(u.Representation_asArray[0]),l.audioChannelConfiguration=i.map((function(e){return e.value})),l.audioChannelConfigurationsWithSchemeIdUri=i),a=t.getRolesForAdaptation(u),l.roles=a.map((function(e){return e.value})),l.rolesWithSchemeIdUri=a,l.codec=t.getCodec(u),l.mimeType=t.getMimeType(u),l.contentProtection=t.getContentProtectionData(u),l.bitrateList=t.getBitrateListForAdaptation(u),l.selectionPriority=t.getSelectionPriority(u),l.contentProtection){var c=l.contentProtection.map((function(e){return t.getKID(e)})).filter((function(e){return null!==e}));if(c.length){var f=c[0];l.contentProtection.forEach((function(e){e.keyId=f}))}}if(l.isText=t.getIsText(u),l.supplementalProperties=t.getSupplementalPropertiesForAdaptation(u),(!l.supplementalProperties||0===Object.keys(l.supplementalProperties).length)&&Array.isArray(u.Representation_asArray)&&u.Representation_asArray.length>0){var d=u.Representation_asArray.map((function(e){return t.getSupplementalPropertiesForRepresentation(e)}));d.every((function(e){return JSON.stringify(e)===JSON.stringify(d[0])}))&&(l.supplementalProperties=d[0])}if(l.supplementalPropertiesAsArray=t.getSupplementalPropertiesAsArrayForAdaptation(u),(!l.supplementalPropertiesAsArray||0===l.supplementalPropertiesAsArray.length)&&Array.isArray(u.Representation_asArray)&&u.Representation_asArray.length>0){var h=u.Representation_asArray.map((function(e){return t.getSupplementalPropertiesAsArrayForRepresentation(e)}));h.every((function(e){return JSON.stringify(e)===JSON.stringify(h[0])}))&&(l.supplementalPropertiesAsArray=h[0])}return l.essentialProperties=t.getEssentialPropertiesForAdaptation(u),l.essentialPropertiesAsArray=t.getEssentialPropertiesAsArrayForAdaptation(u),l.isFragmented=t.getIsFragmented(u),l.isEmbedded=!1,l}function T(e,t,r){e.id=t,e.index=100+parseInt(t.substring(2,3)),e.type=a.TEXT,e.codec="cea-608-in-SEI",e.isEmbedded=!0,e.isFragmented=!1;var n=vr()(r);e.lang=n||r,e.roles=["caption"],e.rolesWithSchemeIdUri=[{schemeIdUri:"urn:mpeg:dash:role:2011",value:"caption"}]}function _(e){var r,n,i=new Yi;return i.id=e.id,i.index=e.index,i.start=e.start,i.duration=e.duration,i.manifestInfo=(r=e.mpd,(n=new qi).dvrWindowSize=r.timeShiftBufferDepth,n.loadedTime=r.manifest.loadedTime,n.availableFrom=r.availabilityStartTime,n.minBufferTime=r.manifest.minBufferTime,n.maxFragmentDuration=r.maxSegmentDuration,n.duration=t.getDuration(r.manifest),n.isDynamic=t.getIsDynamic(r.manifest),n.serviceDescriptions=t.getServiceDescriptions(r.manifest),n.protocol=r.manifest.protocol,n),i.isLast=1===e.mpd.manifest.Period_asArray.length||Math.abs(i.start+i.duration-i.manifestInfo.duration)<1,i}function S(){if(!a)throw new Error("setConfig function has to be called previously")}function A(e){return n.length>0?n[0].mpd.manifest.Period_asArray[e]:null}function b(e,t,r){var n,i,a,o,s;if(e)for(n=e.AdaptationSet_asArray,o=0;o<n.length;o+=1)for(a=n[o].Representation_asArray,s=0;s<a.length;s+=1)if(t===(i=a[s]).id)return r?s:i;return null}return e={getBandwidthForRepresentation:function(e,t){var r;return(r=b(A(t),e))?r.bandwidth:null},getIndexForRepresentation:function(e,t){return r=A(t),null!==(n=b(r,e,!0))?n:-1;var r,n},getMaxIndexForBufferType:function(e,r){return function(e,r){var n,i,a,o;if(!e||!r)return-1;for(i=e.AdaptationSet_asArray,o=0;o<i.length;o+=1)if(a=(n=i[o]).Representation_asArray,t.getIsTypeOf(n,r))return a.length;return-1}(A(r),e)},convertRepresentationToRepresentationInfo:function(e){if(e){var r=new Hi,n=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index],i=t.getRepresentationFor(e.index,n);return r.id=e.id,r.quality=e.index,r.bandwidth=t.getBandwidth(i),r.fragmentDuration=e.segmentDuration||(e.segments&&e.segments.length>0?e.segments[0].duration:NaN),r.MSETimeOffset=e.MSETimeOffset,r.mediaInfo=v(e.adaptation),r}return null},getStreamsInfo:function(e,t){var r=[],i=n;if(e&&(S(),i=h(e)),i.length>0){(!t||t>i.length)&&(t=i.length);for(var a=0;a<t;a++)r.push(_(i[a]))}return r},getMediaInfoForType:function(e,r){if(0===n.length||!e)return null;var i=E(e,n);if(!i)return null;var a=t.getAdaptationsForPeriod(i),o=u(e.index,r,e);return o?v(a[t.getIndexForAdaptation(o,n[0].mpd.manifest,e.index)]):null},getAllMediaInfoForType:d,getAdaptationForType:u,getRealAdaptation:function(e,r){var i,a,o=E(e,n);return i=r?r.id:null,n.length>0&&o&&(a=i?t.getAdaptationForId(i,n[0].mpd.manifest,o.index):t.getAdaptationForIndex(r?r.index:null,n[0].mpd.manifest,o.index)),a},getProducerReferenceTimes:function(e,r){var i,a,o=E(e,n);return i=r?r.id:null,n.length>0&&o&&(a=i?t.getAdaptationForId(i,n[0].mpd.manifest,o.index):t.getAdaptationForIndex(r?r.index:null,n[0].mpd.manifest,o.index)),a?t.getProducerReferenceTimesForAdaptation(a):[]},getRealPeriodByIndex:function(e){return t.getRealPeriodForIndex(e,n[0].mpd.manifest)},getEssentialPropertiesForRepresentation:function(e){try{return t.getEssentialPropertiesForRepresentation(e)}catch(r){return[]}},getVoRepresentations:function(e){var r=y(e);return t.getRepresentationsForAdaptation(r)},getEventsFor:function(e,r,i){var a=[];if(n.length>0){var o=n[0].mpd.manifest;if(e instanceof Yi){var s=E(e,n);a=t.getEventsForPeriod(s)}else if(e instanceof Ki){var l=E(i,n);a=t.getEventStreamForAdaptationSet(o,y(e),l)}else if(e instanceof Hi){var u=E(i,n);a=t.getEventStreamForRepresentation(o,r,u)}}return a},getEvent:function(e,t,r,n){try{if(!e||!t||isNaN(r)||!n)return null;var i=e.scheme_id_uri,a=e.value;if(!t[i+"/"+a])return null;var o,s=new Te,l=e.timescale||1,u=n.adaptation.period.start,c=t[i+"/"+a],f=isNaN(n.presentationTimeOffset)?isNaN(c.presentationTimeOffset)?0:c.presentationTimeOffset:n.presentationTimeOffset,d=e.presentation_time_delta/l;o=0===e.version?u+r-f+d:u-f+d;var h=e.event_duration/l,g=e.id,m=e.message_data;return s.eventStream=c,s.eventStream.value=a,s.eventStream.timescale=l,s.duration=h,s.id=g,s.calculatedPresentationTime=o,s.messageData=m,s.presentationTimeDelta=d,s}catch(p){return null}},getMpd:g,setConfig:function(e){e&&(e.constants&&(a=e.constants),e.cea608parser&&(s=e.cea608parser),e.errHandler&&t.setConfig({errHandler:e.errHandler}),e.BASE64&&t.setConfig({BASE64:e.BASE64}))},updatePeriods:function(e){if(!e)return null;S(),n=h(e)},getIsTextTrack:function(e){return t.getIsText(e)},getUTCTimingSources:function(){var e=p();return t.getUTCTimingSources(e)},getSuggestedPresentationDelay:function(){var e=n.length>0?n[0].mpd:null;return t.getSuggestedPresentationDelay(e)},getAvailabilityStartTime:function(e){var r=g(e);return t.getAvailabilityStartTime(r)},getIsTypeOf:function(e,r){return t.getIsTypeOf(e,r)},getIsDynamic:function(e){var r=p(e);return t.getIsDynamic(r)},getDuration:function(e){var r=p(e);return t.getDuration(r)},getRegularPeriods:h,getContentSteering:function(e){return t.getContentSteering(e)},getLocation:function(e){return t.getLocation(e)},getPatchLocation:function(e){var r=t.getPatchLocation(e),n=t.getPublishTime(e);return r&&0!==r.length&&n?r.filter((function(e){return isNaN(e.ttl)||n.getTime()+e.ttl>(new Date).getTime()})):[]},getManifestUpdatePeriod:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t.getManifestUpdatePeriod(e,r)},getPublishTime:function(e){return t.getPublishTime(e)},getIsDVB:function(e){return t.hasProfile(e,"urn:dvb:dash:profile:dvb-dash:2014")},getIsPatch:function(e){return r.getIsPatch(e)},getBaseURLsFromElement:function(e){return t.getBaseURLsFromElement(e)},getRepresentationSortFunction:function(){return t.getRepresentationSortFunction()},getCodec:function(e,r,n){return t.getCodec(e,r,n)},getPeriodById:function(e){if(!e||0===n.length)return null;var t=n.filter((function(t){return t.id===e}));return t&&t.length>0?t[0]:null},setCurrentMediaInfo:function(e,t,r){i[e]=i[e]||{},i[e][t]=i[e][t]||{},i[e][t]=r},isPatchValid:function(e,n){var i=t.getId(e),a=r.getMpdId(n),o=t.getPublishTime(e),s=r.getPublishTime(n),l=r.getOriginalPublishTime(n);return!!(i&&a&&i==a&&o&&l&&o.getTime()==l.getTime()&&s&&o.getTime()<s.getTime())},applyPatchToManifest:function(e,t){r.getPatchOperations(t).forEach((function(t){var r=t.getMpdTarget(e);if(null!==r){var n=r.name,i=r.target,a=r.leaf;if(t.xpath.findsAttribute()||"__text"===n)switch(t.action){case"add":case"replace":i[n]=t.value;break;case"remove":delete i[n]}else{var o=(i[n+"_asArray"]||[]).indexOf(a),s="prepend"===t.position||"before"===t.position;if(("remove"===t.action||"replace"===t.action)&&(delete i[n],-1!=o)){var l=i[n+"_asArray"];l.splice(o,1),l.length>1?i[n]=l:1==l.length?i[n]=l[0]:delete i[n+"_asArray"]}"add"!==t.action&&"replace"!==t.action||Object.keys(t.value).forEach((function(e){var r=t.value[e],a=i[e+"_asArray"]||[];if(0===a.length&&i[e]&&a.push(i[e]),0===a.length)a=r;else{var l=a.length;l=e==n&&-1!=o?o+(s?0:1)+("replace"==t.action?-1:0):s?0:a.length,a.splice.apply(a,[l,0].concat(r))}i[e+"_asArray"]=a,i[e]=1==a.length?a[0]:a}))}}}))},areMediaInfosEqual:c,reset:m},t=He(l).getInstance(),r=Xi(l).getInstance(),m(),e}Qi.__dashjs_factory_name="DashAdapter";var Ji=c.Z.getSingletonFactory(Qi);function ea(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ta=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t;return(t=[{key:"round10",value:function(e,t){return r="round",n=e,void 0===(i=t)||0==+i?Math[r](n):(i=+i,null===(n=+n)||isNaN(n)||"number"!=typeof i||i%1!=0?NaN:(n=n.toString().split("e"),+((n=(n=Math[r](+(n[0]+"e"+(n[1]?+n[1]-i:-i)))).toString().split("e"))[0]+"e"+(n[1]?+n[1]+i:i))));var r,n,i}}])&&ea(e,t),e}(),ra=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.TcpList=[],this.HttpList=[],this.RepSwitchList=[],this.BufferLevel=[],this.BufferState=[],this.PlayList=[],this.DroppedFrames=[],this.SchedulingInfo=[],this.DVRInfo=[],this.ManifestUpdate=[],this.RequestsQueue=null,this.DVBErrors=[]},na=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.t=null,this.mt=null,this.to=null,this.lto=null},ia=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.t=null,this.level=null},aa=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.target=null,this.state=s.Z.BUFFER_EMPTY},oa=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.time=null,this.range=null,this.manifestInfo=null},sa=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.time=null,this.droppedFrames=null};function la(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var ua=function e(){la(this,e),this.mediaType=null,this.type=null,this.requestTime=null,this.fetchTime=null,this.availabilityStartTime=null,this.presentationStartTime=0,this.clientTimeOffset=0,this.currentTime=null,this.buffered=null,this.latency=0,this.streamInfo=[],this.representationInfo=[]},ca=function e(){la(this,e),this.id=null,this.index=null,this.start=null,this.duration=null},fa=function e(){la(this,e),this.id=null,this.index=null,this.mediaType=null,this.streamIndex=null,this.presentationTimeOffset=null,this.startNumber=null,this.fragmentInfoType=null},da=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mediaType=null,this.t=null,this.type=null,this.startTime=null,this.availabilityStartTime=null,this.duration=null,this.quality=null,this.range=null,this.state=null},ha=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.loadingRequests=[],this.executedRequests=[]};function ga(e){var t,r,n=(e=e||{}).settings,i=this.context,o=(0,l.Z)(i).getInstance();function c(){o.trigger(u.Z.METRICS_CHANGED)}function f(e){o.trigger(u.Z.METRIC_CHANGED,{mediaType:e}),c()}function d(e,t,r){o.trigger(u.Z.METRIC_UPDATED,{mediaType:e,metric:t,value:r}),f(e)}function h(e,t,r){o.trigger(u.Z.METRIC_ADDED,{mediaType:e,metric:t,value:r}),f(e)}function g(e,t){var n=null;return e?(r.hasOwnProperty(e)?n=r[e]:t||(n=new ra,r[e]=n),n):n}function m(e,t,r){var i=g(e);null!==i&&(i[t].push(r),i[t].length>n.get().streaming.metrics.maxListDepth&&i[t].shift())}function p(e,t,r){m(e,t,r),h(e,t,r)}return t={clearCurrentMetricsForType:function(e){delete r[e],f(e)},clearAllCurrentMetrics:function(){r={},c()},getMetricsFor:g,addHttpRequest:function e(t,r,n,i,a,o,l,u,c,f,d,h,g,m,y,E,v){var T=new D.w;null!=o&&o!==i&&(e(t,null,n,i,a,null,null,u,c,null,null,null,g,null,null,E,v),T.actualurl=o),T.tcpid=r,T.type=n,T.url=i,T.range=u,T.trequest=c,T.tresponse=f,T.responsecode=h,T.cmsd=v,T._tfinish=d,T._stream=t,T._mediaduration=g,T._quality=a,T._responseHeaders=m,T._serviceLocation=l,T._fileLoaderType=E,y?y.forEach((function(e){var t,r,n,i,a;t=T,r=e.s,n=e.d,i=e.b,(a=new D.O).s=r,a.d=n,a.b=i,t.trace.push(a),t.interval||(t.interval=0),t.interval+=n})):(delete T.interval,delete T.trace),p(t,s.Z.HTTP_REQUEST,T)},addRepresentationSwitch:function(e,t,r,n,i){var a=new na;a.t=t,a.mt=r,a.to=n,i?a.lto=i:delete a.lto,p(e,s.Z.TRACK_SWITCH,a)},addBufferLevel:function(e,t,r){var n=new ia;n.t=t,n.level=r,p(e,s.Z.BUFFER_LEVEL,n)},addBufferState:function(e,t,r){var n=new aa;n.target=r,n.state=t,p(e,s.Z.BUFFER_STATE,n)},addDVRInfo:function(e,t,r,n){var i=new oa;i.time=t,i.range=n,i.manifestInfo=r,p(e,s.Z.DVR_INFO,i)},addDroppedFrames:function(e,t){var r=new sa,n=g(e).DroppedFrames;t&&(r.time=t.creationTime,r.droppedFrames=t.droppedVideoFrames,n.length>0&&n[n.length-1]==r||p(e,s.Z.DROPPED_FRAMES,r))},addSchedulingInfo:function(e,t,r,n,i,a,o,l,u){var c=new da;c.mediaType=e,c.t=t,c.type=r,c.startTime=n,c.availabilityStartTime=i,c.duration=a,c.quality=o,c.range=l,c.state=u,p(e,s.Z.SCHEDULING_INFO,c)},addRequestsQueue:function(e,t,r){var n=new ha;n.loadingRequests=t,n.executedRequests=r,g(e).RequestsQueue=n,h(e,s.Z.REQUESTS_QUEUE,n)},addManifestUpdate:function(e,t,r,n,i,o,l,u,c,f){var d=new ua;d.mediaType=e,d.type=t,d.requestTime=r,d.fetchTime=n,d.availabilityStartTime=i,d.presentationStartTime=o,d.clientTimeOffset=l,d.currentTime=u,d.buffered=c,d.latency=f,m(a.Z.STREAM,s.Z.MANIFEST_UPDATE,d),h(e,s.Z.MANIFEST_UPDATE,d)},updateManifestUpdateInfo:function(e,t){if(e){for(var r in t)e[r]=t[r];d(e.mediaType,s.Z.MANIFEST_UPDATE,e)}},addManifestUpdateStreamInfo:function(e,t,r,n,i){if(e){var a=new ca;a.id=t,a.index=r,a.start=n,a.duration=i,e.streamInfo.push(a),d(e.mediaType,s.Z.MANIFEST_UPDATE_STREAM_INFO,e)}},addManifestUpdateRepresentationInfo:function(e,t,r,n,i,a,o,l){if(e&&e.representationInfo){var u=new fa;u.id=t,u.index=r,u.streamIndex=n,u.mediaType=i,u.startNumber=o,u.fragmentInfoType=l,u.presentationTimeOffset=a,e.representationInfo.push(u),d(e.mediaType,s.Z.MANIFEST_UPDATE_TRACK_INFO,e)}},addPlayList:function(e){e.trace&&Array.isArray(e.trace)?e.trace.forEach((function(e){e.hasOwnProperty("subreplevel")&&!e.subreplevel&&delete e.subreplevel})):delete e.trace,p(a.Z.STREAM,s.Z.PLAY_LIST,e)},addDVBErrors:function(e){p(a.Z.STREAM,s.Z.DVB_ERRORS,e)}},r={},t}ga.__dashjs_factory_name="MetricsModel";var ma=c.Z.getSingletonFactory(ga);function pa(e){e=e||{};var t,r,n,i,o=this.context,l=e.metricsModel;function u(e){var t=l.getMetricsFor(e,!0);if(!t)return null;var r,n=t.HttpList,i=null;if(!n||n.length<=0)return null;for(r=n.length-1;r>=0;){if(n[r].responsecode){i=n[r];break}r--}return i}function c(e){var t=l.getMetricsFor(e,!0);return t&&t.HttpList?t.HttpList:[]}function f(e,t){if(!e)return null;var r=e[t];return r&&0!==r.length?r[r.length-1]:null}return t={getCurrentRepresentationSwitch:function(e){return f(l.getMetricsFor(e,!0),s.Z.TRACK_SWITCH)},getCurrentBufferState:function(e){return f(l.getMetricsFor(e,!0),s.Z.BUFFER_STATE)},getCurrentBufferLevel:function(e){var t=f(l.getMetricsFor(e,!0),s.Z.BUFFER_LEVEL);return t?ta.round10(t.level/1e3,-3):0},getCurrentHttpRequest:u,getHttpRequests:c,getCurrentDroppedFrames:function(){return f(l.getMetricsFor(a.Z.VIDEO,!0),s.Z.DROPPED_FRAMES)},getCurrentSchedulingInfo:function(e){return f(l.getMetricsFor(e,!0),s.Z.SCHEDULING_INFO)},getCurrentDVRInfo:function(e){return f(e?l.getMetricsFor(e,!0):l.getMetricsFor(a.Z.VIDEO,!0)||l.getMetricsFor(a.Z.AUDIO,!0),s.Z.DVR_INFO)},getCurrentManifestUpdate:function(){return f(l.getMetricsFor(a.Z.STREAM),s.Z.MANIFEST_UPDATE)},getLatestFragmentRequestHeaderValueByID:function(e,t){if(!t)return null;var r={},n=u(e);n&&(r=Ke.Z.parseHttpHeaders(n._responseHeaders));var i=r[t.toLowerCase()];return void 0===i?null:i},getLatestMPDRequestHeaderValueByID:function(e){if(!e)return null;var t,r,n,i={};for(n=(t=c(a.Z.STREAM)).length-1;n>=0;n--)if((r=t[n]).type===D.w.MPD_TYPE){i=Ke.Z.parseHttpHeaders(r._responseHeaders);break}var o=i[e.toLowerCase()];return void 0===o?null:o},addRepresentationSwitch:function(e,t,r,n,i){l.addRepresentationSwitch(e,t,r,n,i)},addDVRInfo:function(e,t,r,n){l.addDVRInfo(e,t,r,n)},updateManifestUpdateInfo:function(e){var t=this.getCurrentManifestUpdate();l.updateManifestUpdateInfo(t,e)},addManifestUpdateStreamInfo:function(e){if(e){var t=this.getCurrentManifestUpdate();l.addManifestUpdateStreamInfo(t,e.id,e.index,e.start,e.duration)}},addManifestUpdateRepresentationInfo:function(e,t){if(e){var r=this.getCurrentManifestUpdate();l.addManifestUpdateRepresentationInfo(r,e.id,e.index,e.streamIndex,t,e.presentationTimeOffset,e.startNumber,e.fragmentInfoType)}},addManifestUpdate:function(e){l.addManifestUpdate(a.Z.STREAM,e.type,e.requestStartDate,e.requestEndDate)},addHttpRequest:function(e,t,r,n,i,a){l.addHttpRequest(e.mediaType,null,e.type,e.url,e.quality,t,e.serviceLocation||null,e.range||null,e.requestStartDate,e.firstByteDate,e.requestEndDate,r,e.duration,n,i,e.fileLoaderType,a)},addSchedulingInfo:function(e,t){l.addSchedulingInfo(e.mediaType,new Date,e.type,e.startTime,e.availabilityStartTime,e.duration,e.quality,e.range,t)},addRequestsQueue:function(e,t,r){l.addRequestsQueue(e,t,r)},addBufferLevel:function(e,t,r){l.addBufferLevel(e,t,r)},addBufferState:function(e,t,r){l.addBufferState(e,t,r)},addDroppedFrames:function(e){l.addDroppedFrames(a.Z.VIDEO,e)},addPlayList:function(){i&&(l.addPlayList(i),i=null)},addDVBErrors:function(e){l.addDVBErrors(e)},createPlaylistMetrics:function(e,t){(i=new J).start=new Date,i.mstart=e,i.starttype=t},createPlaylistTraceMetrics:function(e,t,i){!0===r&&(r=!1,(n=new ee).representationid=e,n.start=new Date,n.mstart=t,n.playbackspeed=null!==i?i.toString():null)},updatePlayListTraceMetrics:function(e){if(n)for(var t in n)n[t]=e[t]},pushPlayListTraceMetrics:function(e,t){if(!1===r&&i&&n&&n.start){var a=n.start,o=e.getTime()-a.getTime();n.duration=o,n.stopreason=t,i.trace.push(n),r=!0}},clearAllCurrentMetrics:function(){l.clearAllCurrentMetrics()}},l=l||ma(o).getInstance({settings:e.settings}),r=!0,n=null,i=null,t}pa.__dashjs_factory_name="DashMetrics";var ya=c.Z.getSingletonFactory(pa);function Ea(){var e,t,r,n,i=this.context,s=(0,l.Z)(i).getInstance(),c=(0,C.Z)(i).getInstance();function f(e){n=e}function h(e,t,r,n){var i,a=t.adaptation.period.mpd,o=a.availabilityStartTime;if(n)i=r&&a.timeShiftBufferDepth!==Number.POSITIVE_INFINITY?new Date(o.getTime()+1e3*(e+a.timeShiftBufferDepth)):a.availabilityEndTime;else if(r){var s=t.availabilityTimeOffset;i=new Date(o.getTime()+1e3*(e-s))}else i=o;return i}function g(e,t){return(e.getTime()-t.mpd.availabilityStartTime.getTime()+1e3*n)/1e3}function m(e,t){return e+(t.adaptation.period.start-t.presentationTimeOffset)}function p(e){var r={start:NaN,end:NaN},n=e[0].getAdapter().getRegularPeriods()[0],i=g(new Date,n);if(!e||0===e.length)return{range:r,now:i};e.forEach((function(e){var n=e.getAdapter(),s=n.getMediaInfoForType(e.getStreamInfo(),a.Z.VIDEO)||n.getMediaInfoForType(e.getStreamInfo(),a.Z.AUDIO),l=n.getVoRepresentations(s)[0],u={start:NaN,end:NaN};if(l)if(l.segmentInfoType===o.Z.SEGMENT_TIMELINE)u=function(e){var r,n,i,a,o=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index],s=t.getRepresentationFor(e.index,o),l=s.SegmentTemplate||s.SegmentList,u=l.SegmentTimeline,c=l.timescale,f=u.S_asArray,d={start:0,end:0},h=f[0].t,g=!isNaN(h),p=g?h:0,y=0;for(g&&(d.start=m(p/c,e)),i=0,a=f.length;i<a;i++)n=0,(r=f[i]).hasOwnProperty("r")&&(n=r.r),y+=r.d*(1+n);return d.end=m((p+y)/c,e),d}(l);else{var c=l.adaptation.period;u.start=c.start,u.end=Math.max(i,c.start+c.duration)}!isNaN(u.start)&&(isNaN(r.start)||r.start>u.start)&&(r.start=u.start),!isNaN(u.end)&&(isNaN(r.end)||r.end<u.end)&&(r.end=u.end)})),r.end=Math.min(i,r.end);var s=E(e,r.end,!0);return r.end=isNaN(s)?r.end:s,r.start=n&&n.mpd&&n.mpd.timeShiftBufferDepth&&!isNaN(n.mpd.timeShiftBufferDepth)&&!isNaN(r.end)?Math.max(r.end-n.mpd.timeShiftBufferDepth,r.start):r.start,r.start=E(e,r.start),{range:r,now:i}}function y(e,t){r=e-t.end}function E(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{for(var n=0,i=!1,a=NaN;!i&&n<e.length;){var o=e[n].getStreamInfo();o.start<=t&&(!isFinite(o.duration)||o.start+o.duration>=t)?(a=t,i=!0):!r&&o.start>t&&(isNaN(a)||o.start<a)?a=o.start:r&&o.start+o.duration<t&&(isNaN(a)||o.start+o.duration>a)&&(a=o.start+o.duration),n+=1}return a}catch(s){return t}}function v(e){void 0===e.offset||isNaN(e.offset)||f(e.offset/1e3)}function T(){n=0,r=0}function _(){s.off(u.Z.UPDATE_TIME_SYNC_OFFSET,v,this),T()}return e={initialize:function(){T(),s.on(u.Z.UPDATE_TIME_SYNC_OFFSET,v,this)},getClientTimeOffset:function(){return n},setClientTimeOffset:f,getClientReferenceTime:function(){return Date.now()-1e3*r+1e3*n},calcAvailabilityStartTimeFromPresentationTime:function(e,t,r){return h(e,t,r)},calcAvailabilityEndTimeFromPresentationTime:function(e,t,r){return h(e,t,r,!0)},calcPresentationTimeFromWallTime:g,calcPresentationTimeFromMediaTime:m,calcPeriodRelativeTimeFromMpdRelativeTime:function(e,t){return t-e.adaptation.period.start},calcMediaTimeFromPresentationTime:function(e,t){return e-t.adaptation.period.start+t.presentationTimeOffset},calcWallTimeForSegment:function(e,t){var r,n,i;return t&&(r=e.representation.adaptation.period.mpd.suggestedPresentationDelay,n=e.presentationStartTime+r,i=new Date(e.availabilityStartTime.getTime()+1e3*n)),i},calcTimeShiftBufferWindow:function(e,t){if(!t)return r={start:NaN,end:NaN},n=0,i=NaN,e.forEach((function(e){var t=e.getStreamInfo();n+=t.duration,(isNaN(i)||t.start<i)&&(i=t.start)})),r.start=i,r.end=i+n,r;var r,n,i;if(c.get().streaming.timeShiftBuffer.calcFromSegmentTimeline){var a=p(e);return y(a.now,a.range),a.range}return function(e){var t={start:NaN,end:NaN};if(!e||0===e.length)return t;var r=e[0].getAdapter().getRegularPeriods()[0],n=g(new Date,r),i=r.mpd.timeShiftBufferDepth,a=isNaN(i)?0:n-i;if(t.start=E(e,a),t.end=!isNaN(t.start)&&n<t.start?n:E(e,n,!0),!isNaN(i)&&t.end<n-i&&(t.end=NaN),c.get().streaming.timeShiftBuffer.fallbackToSegmentTimeline){var o=p(e);if(o.range.end<t.start)return s.trigger(d.Z.CONFORMANCE_VIOLATION,{level:ar.LEVELS.WARNING,event:ar.EVENTS.INVALID_DVR_WINDOW}),y(o.now,o.range),o.range}return t}(e)},reset:_},t=He(i).getInstance(),_(),e}Ea.__dashjs_factory_name="TimelineConverter";var va=c.Z.getSingletonFactory(Ea),Ta=r(4593),_a=r(6934);function Sa(e){return(Sa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Aa(e,t){return(Aa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ba(e,t){return!t||"object"!==Sa(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ra(e){return(Ra=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ia=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Aa(e,t)}(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=Ra(t);if(r){var i=Ra(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return ba(this,e)});function i(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(e=n.call(this)).captionData=null,e.label=null,e.defaultTrack=!1,e.kind=null,e.isFragmented=!1,e.isEmbedded=!1,e.isTTML=null,e}return i}(Ki),wa=r(2295);function Ca(){var e=0;function t(e){for(var t="",r=0;r<e.length;++r)t+=e[r].uchar;return t.length-t.replace(/^\s+/,"").length}function r(e){return"left: "+3.125*e.x+"%; top: "+6.66*e.y1+"%; width: "+(100-3.125*e.x)+"%; height: "+6.66*Math.max(e.y2-1-e.y1,1)+"%; align-items: flex-start; overflow: visible; -webkit-writing-mode: horizontal-tb;"}function n(e){return"red"===e?"rgb(255, 0, 0)":"green"===e?"rgb(0, 255, 0)":"blue"===e?"rgb(0, 0, 255)":"cyan"===e?"rgb(0, 255, 255)":"magenta"===e?"rgb(255, 0, 255)":"yellow"===e?"rgb(255, 255, 0)":"white"===e?"rgb(255, 255, 255)":"black"===e?"rgb(0, 0, 0)":e}function i(e,t){var r=e.videoHeight/15;return t?"font-size: "+r+"px; font-family: Menlo, Consolas, 'Cutive Mono', monospace; color: "+(t.foreground?n(t.foreground):"rgb(255, 255, 255)")+"; font-style: "+(t.italics?"italic":"normal")+"; text-decoration: "+(t.underline?"underline":"none")+"; white-space: pre; background-color: "+(t.background?n(t.background):"transparent")+";":"font-size: "+r+"px; font-family: Menlo, Consolas, 'Cutive Mono', monospace; justify-content: flex-start; text-align: left; color: rgb(255, 255, 255); font-style: normal; white-space: pre; line-height: normal; font-weight: normal; text-decoration: none; width: 100%; display: flex;"}function a(e){return e.replace(/^\s+/g,"")}function o(e){return e.replace(/\s+$/g,"")}return{createHTMLCaptionsFromScreen:function(n,s,l,u){var c,f,d=null,h=!1,g=-1,m={start:s,end:l,spans:[]},p="style_cea608_white_black",y={},E={},v=[];for(c=0;c<15;++c){var T=u.rows[c],_="",S=null;if(!1===T.isEmpty()){var A=t(T.chars);null===d&&(d={x:A,y1:c,y2:c+1,p:[]}),A!==g&&h&&(d.p.push(m),m={start:s,end:l,spans:[]},d.y2=c,d.name="region_"+d.x+"_"+d.y1+"_"+d.y2,!1===y.hasOwnProperty(d.name)?(v.push(d),y[d.name]=d):y[d.name].p.contat(d.p),d={x:A,y1:c,y2:c+1,p:[]});for(var b=0;b<T.chars.length;++b){var R=T.chars[b],I=R.penState;if(null===S||!I.equals(S)){_.trim().length>0&&(m.spans.push({name:p,line:_,row:c}),_="");var w="style_cea608_"+I.foreground+"_"+I.background;I.underline&&(w+="_underline"),I.italics&&(w+="_italics"),E.hasOwnProperty(w)||(E[w]=JSON.parse(JSON.stringify(I))),S=I,p=w}_+=R.uchar}_.trim().length>0&&m.spans.push({name:p,line:_,row:c}),h=!0,g=A}else h=!1,g=-1,d&&(d.p.push(m),m={start:s,end:l,spans:[]},d.y2=c,d.name="region_"+d.x+"_"+d.y1+"_"+d.y2,!1===y.hasOwnProperty(d.name)?(v.push(d),y[d.name]=d):y[d.name].p.contat(d.p),d=null)}d&&(d.p.push(m),d.y2=c+1,d.name="region_"+d.x+"_"+d.y1+"_"+d.y2,!1===y.hasOwnProperty(d.name)?(v.push(d),y[d.name]=d):y[d.name].p.contat(d.p),d=null);var C=[];for(c=0;c<v.length;++c){var D=v[c],L="sub_cea608_"+e++,N=document.createElement("div");N.id=L;var O=r(D);N.style.cssText="position: absolute; margin: 0; display: flex; box-sizing: border-box; pointer-events: none;"+O;var M=document.createElement("div");M.className="paragraph bodyStyle",M.style.cssText=i(n);var P=document.createElement("div");P.className="cueUniWrapper",P.style.cssText="unicode-bidi: normal; direction: ltr;";for(var k=0;k<D.p.length;++k){var x=D.p[k],F=0;for(f=0;f<x.spans.length;++f){var U=x.spans[f];if(U.line.length>0){if(0!==f&&F!=U.row){var B=document.createElement("br");B.className="lineBreak",P.appendChild(B)}var Z=!1;F===U.row&&(Z=!0),F=U.row;var G=E[U.name],H=document.createElement("span");H.className="spanPadding "+U.name+" customSpanColor",H.style.cssText=i(n,G),0!==f&&Z?f===x.spans.length-1?H.textContent=o(U.line):H.textContent=U.line:x.spans.length>1&&f<x.spans.length-1&&U.row===x.spans[f+1].row?H.textContent=a(U.line):H.textContent=U.line.trim(),P.appendChild(H)}}}M.appendChild(P),N.appendChild(M);var K={bodyStyle:["%",90]};for(var Y in E)E.hasOwnProperty(Y)&&(K[Y]=["%",90]);C.push({type:"html",start:s,end:l,cueHTMLElement:N,cueID:L,cellResolution:[32,15],isFromCEA608:!0,fontSize:K,lineHeight:{},linePadding:{}})}return C}}}Ca.__dashjs_factory_name="EmbeddedTextHtmlRender";var Da=c.Z.getSingletonFactory(Ca);function La(e){var t,r,n,o,s,c,d,h,g,m,p,y,E,v,T,_,A,b=e.errHandler,R=e.manifestModel,I=e.mediaController,C=e.videoModel,L=e.textTracks,N=e.vttParser,O=e.vttCustomRenderingParser,M=e.ttmlParser,P=e.streamInfo,k=e.settings,x=this.context,F=(0,l.Z)(x).getInstance(),U=!1;function B(){c=null,h=NaN,g=[],m=null,d=!1,s=[],o=null}function Z(e){var t,r,n=new Ia;for(var i in e)n[i]=e[i];n.labels=e.labels,n.defaultTrack=(t=e,r=!1,y.length>1&&t.isEmbedded?r=t.id&&t.id===a.Z.CC1:1===y.length?t.id&&"string"==typeof t.id&&"CC"===t.id.substring(0,2)&&(r=!0):0===y.length&&(r=t.index===s[0].index),r),n.isFragmented=e.isFragmented,n.isEmbedded=!!e.isEmbedded,n.isTTML=function(e){return e.codec&&e.codec.search(a.Z.STPP)>=0||e.mimeType&&e.mimeType.search(a.Z.TTML)>=0}(e),n.kind=function(e,t){var r=e.roles&&e.roles.length>0?t[e.roles[0]]:t.caption;return r===t.caption||r===t.subtitle?r:t.caption}(e,{subtitle:"subtitles",caption:"captions"}),L.addTextTrack(n)}function G(e){var t=e.chunk;t.mediaInfo.embeddedCaptions&&K(t.bytes,t)}function H(e){p=e}function K(e,s){var l=s.mediaInfo,u=l.type,f=l.mimeType,g=l.codec||f;g?-1!==l.codec.indexOf("application/mp4")?function(e,i,s){var l;if("InitializationSegment"===i.segmentType)d=!0,h=n.getMediaTimescaleFromMoov(e);else{if(!d)return;(l=n.getSamplesInfo(e).sampleList).length>0&&(m=l[0].cts-i.start*h),s.search(a.Z.STPP)>=0?function(e,n,i){var s,l;for(o=null!==o?o:V(i),s=0;s<n.length;s++){var u=n[s],f=u.cts,d=q(),g=d+f/h,m=g+u.duration/h;t.buffered.add(g,m);var y=new DataView(e,u.offset,u.subSizes[0]),E=_a.Utils.dataViewToString(y,a.Z.UTF8),v=[],T=u.offset+u.subSizes[0];for(l=1;l<u.subSizes.length;l++){var _=new Uint8Array(e,T,u.subSizes[l]),S=String.fromCharCode.apply(null,_);v.push(S),T+=u.subSizes[l]}try{var A=R.getValue().ttmlTimeIsRelative?f/h:0,b=o.parse(E,A,f/h,(f+u.duration)/h,v);L.addCaptions(p,d,b)}catch(I){c.removeExecutedRequestsBeforeTime(),this.remove(),r.error("TTML parser error: "+I.message)}}}(e,l,s):function(e,n){var i,a,o,s=[];for(i=0;i<n.length;i++){var l=n[i];l.cts-=m;var u=q()+l.cts/h,c=u+l.duration/h;t.buffered.add(u,c);var f=e.slice(l.offset,l.offset+l.size),d=_a.parseBuffer(f);for(a=0;a<d.boxes.length;a++){var g=d.boxes[a];if(r.debug("VTT box1: "+g.type),"vtte"!==g.type&&"vttc"===g.type){r.debug("VTT vttc boxes.length = "+g.boxes.length);var y={styles:{}};for(o=0;o<g.boxes.length;o++){var E=g.boxes[o];if(r.debug("VTT box2: "+E.type),"payl"===E.type)y.start=l.cts/h,y.end=(l.cts+l.duration)/h,y.data=E.cue_text;else if("sttg"===E.type&&E.settings&&""!==E.settings)try{var v=E.settings.split(" ");y.styles=N.getCaptionStyles(v)}catch(T){}}y&&y.data&&(s.push(y),r.debug("VTT  ".concat(y.start," - ").concat(y.end," :  ").concat(y.data)))}}}s.length>0&&L.addCaptions(p,0,s)}(e,l)}}(e,s,g):u===a.Z.VIDEO?function(e,t){var a,o,s,l,u,c,f;if(t.segmentType===D.w.INIT_SEGMENT_TYPE)0===E&&(E=n.getMediaTimescaleFromMoov(e));else if(t.segmentType===D.w.MEDIA_SEGMENT_TYPE){if(0===E)return void r.warn("CEA-608: No timescale for embeddedTextTrack yet");var d=(o=n.getSamplesInfo(e)).lastSequenceNumber,h=Math.trunc(t.start),g=Math.trunc(t.end);if(_[0]||_[1]||function(){for(var e,t=0;t<y.length;t++){if(-1===(e=L.getTrackIdxForId(y[t].id)))return void r.warn("CEA-608: data before track is ready.");var n=Y(e);_[t]=new(i().Cea608Parser)(t+1,{newCue:n},null)}}(),E){if(s=v,l=d,u=o.numSequences,c=T,f=h,null!==s&&null!==l&&null!==c&&null!==f&&(l===s?c!==f:l!==s+u))for(a=0;a<_.length;a++)_[a]&&_[a].reset();for(var m=function(e,t){if(0===t.length)return null;for(var r={splits:[],fields:[[],[]]},n=new DataView(e),a=0;a<t.length;a++)for(var o=t[a],s=i().findCea608Nalus(n,o.offset,o.size),l=null,u=0,c=0;c<s.length;c++)for(var f=i().extractCea608DataFromRange(n,s[c]),d=0;d<2;d++)if(f[d].length>0){o.cts!==l?u=0:u+=1;var h=q();r.fields[d].push([o.cts+h*E,f[d],u]),l=o.cts}return r.fields.forEach((function(e){e.sort((function(e,t){return e[0]===t[0]?e[2]-t[2]:e[0]-t[0]}))})),r}(e,o.sampleList),p=0;p<_.length;p++){var S=m.fields[p],A=_[p];if(A)for(a=0;a<S.length;a++)A.addData(S[a][0]/E,S[a][1])}v=d,T=g}}}(e,s):function(e,r,n){var i,o,s=new DataView(e,0,e.byteLength);o=_a.Utils.dataViewToString(s,a.Z.UTF8);try{i=V(n).parse(o,0),L.addCaptions(L.getCurrentTrackIdx(),0,i),t.buffered&&t.buffered.add(r.start,r.end)}catch(l){b.error(new S.Z(w.TIMED_TEXT_ERROR_ID_PARSE_CODE,w.TIMED_TEXT_ERROR_MESSAGE_PARSE+l.message,o))}}(e,s,g):r.error("No text type defined")}function Y(e){return function(t,r,n){var i;(i=C.getTTMLRenderingDiv()?A.createHTMLCaptionsFromScreen(C.getElement(),t,r,n):[{start:t,end:r,data:n.getDisplayText(),styles:{}}])&&L.addCaptions(e,0,i)}}function q(){return isNaN(t.timestampOffset)?0:t.timestampOffset}function V(e){var t;return e.search(a.Z.VTT)>=0?t=k.get().streaming.text.webvtt.customRenderingEnabled&&O?O:N:(e.search(a.Z.TTML)>=0||e.search(a.Z.STPP)>=0)&&(t=M),t}function j(e){y.forEach((function(t){var r=L.getTrackIdxForId(t.id);r>=0&&L.deleteCuesFromTrackIdx(r,e.from,e.to)}))}return t={initialize:function(){U||(y=[],p=null,E=0,_=[],v=null,T=null,U=!0,A=Da(x).getInstance(),F.on(u.Z.VIDEO_CHUNK_RECEIVED,G,t),F.on(u.Z.BUFFER_CLEARED,j,t))},addMediaInfos:function(e,r,n){if(s=s.concat(r),e===a.Z.TEXT&&r[0].isFragmented&&!r[0].isEmbedded){c=n,t.buffered=(0,wa.Z)(x).create(),g=I.getTracksFor(a.Z.TEXT,P.id).filter((function(e){return e.isFragmented}));for(var i=I.getCurrentTrackFor(a.Z.TEXT,P.id),o=0;o<g.length;o++)if(g[o]===i){H(o);break}}for(var l=0;l<r.length;l++)Z(r[l])},resetMediaInfos:function(){s=[]},getStreamId:function(){return P.id},append:K,abort:function(){},addEmbeddedTrack:function(e){if(U&&e)if(e.id===a.Z.CC1||e.id===a.Z.CC3){for(var t=0;t<y.length;t++)if(y[t].id===e.id)return;y.push(e)}else r.warn("Embedded track "+e.id+" not supported!")},resetEmbedded:function(){F.off(u.Z.VIDEO_CHUNK_RECEIVED,G,t),F.off(u.Z.BUFFER_CLEARED,j,t),L&&L.deleteAllTextTracks(),U=!1,y=[],_=[null,null],v=null,T=null},getConfig:function(){return{fragmentModel:c,fragmentedTracks:g,videoModel:C}},setCurrentFragmentedTrackIdx:H,remove:function(e,r){void 0===e&&e===r&&(e=t.buffered.start(0),r=t.buffered.end(t.buffered.length-1)),t.buffered.remove(e,r),L.deleteCuesFromTrackIdx(p,e,r)},reset:function(){B(),s=[],n=null}},r=(0,f.Z)(x).getInstance().getLogger(t),n=(0,Ut.Z)(x).getInstance(),B(),t}La.__dashjs_factory_name="TextSourceBuffer";var Na=c.Z.getClassFactory(La),Oa=r(4403);function Ma(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Pa=["text","align","fontSize","id","isd","line","lineAlign","lineHeight","linePadding","position","positionAlign","region","size","snapToLines","vertical"];function ka(e){var t,r,n,i,o,s,c,h,g,m,p,y,E,v,T,_,S,A,b,R,I=this.context,w=(0,l.Z)(I).getInstance(),C=e.videoModel,D=e.streamInfo,L=e.settings;function N(e,t,r,n,i,a){var o=0,s=0;e/t>r/n?o=(s=t)/n*r:s=(o=e)/r*n;var l,u,c=0,f=0;return o/s>i?(f=s,c=s*i):(c=o,f=o/i),l=(e-c)/2,u=(t-f)/2,a?{x:l+.1*c,y:u+.1*f,w:.8*c,h:.8*f}:{x:l,y:u,w:c,h:f}}function O(e,t){var r=C.getClientWidth(),n=C.getClientHeight(),i=C.getVideoWidth(),a=C.getVideoHeight(),o=C.getVideoRelativeOffsetTop(),s=C.getVideoRelativeOffsetLeft();if(0!==i&&0!==a){var l=i/a,u=!1;e.isFromCEA608&&(l=3.5/3,u=!0);var f=N.call(this,r,n,i,a,l,u),y=f.w,E=f.h,_=f.x,A=f.y;if(y!=g||E!=m||_!=c||A!=h||t){if(c=_+s,h=A+o,g=y,m=E,p){var b=p.style;b&&(b.left=c+"px",b.top=h+"px",b.width=g+"px",b.height=m+"px",b.zIndex=v&&document[v]||T?S:null,w.trigger(d.Z.CAPTION_CONTAINER_RESIZE))}var R=e.activeCues;if(R)for(var I=R.length,D=0;D<I;++D){var L=R[D];L.scaleCue(L)}}}}function M(e){var t,r,n,i,a,o=g,s=m;if(e.cellResolution){var l=[o/e.cellResolution[0],s/e.cellResolution[1]];if(e.linePadding)for(t in e.linePadding)if(e.linePadding.hasOwnProperty(t)){r=(e.linePadding[t]*l[0]).toString();for(var u=document.getElementsByClassName("spanPadding"),c=0;c<u.length;c++)u[c].style.cssText=u[c].style.cssText.replace(/(padding-left\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+r),u[c].style.cssText=u[c].style.cssText.replace(/(padding-right\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+r)}if(e.fontSize){for(t in e.fontSize)if(e.fontSize.hasOwnProperty(t)){"%"===e.fontSize[t][0]?n=e.fontSize[t][1]/100:"c"===e.fontSize[t][0]&&(n=e.fontSize[t][1]),r=(n*l[1]).toString(),a="defaultFontSize"!==t?document.getElementsByClassName(t):document.getElementsByClassName("paragraph");for(var f=0;f<a.length;f++)a[f].style.cssText=a[f].style.cssText.replace(/(font-size\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+r)}if(e.lineHeight)for(t in e.lineHeight)if(e.lineHeight.hasOwnProperty(t)){"%"===e.lineHeight[t][0]?i=e.lineHeight[t][1]/100:"c"===e.fontSize[t][0]&&(i=e.lineHeight[t][1]),r=(i*l[1]).toString(),a=document.getElementsByClassName(t);for(var d=0;d<a.length;d++)a[d].style.cssText=a[d].style.cssText.replace(/(line-height\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+r)}}}if(e.isd){var h=document.getElementById(e.cueID);h&&p.removeChild(h),k(e)}}function P(e,t){var r=/^(urn:)(mpeg:[a-z0-9][a-z0-9-]{0,31}:)(subs:)([0-9]+)$/,n=/^#(.*)$/;if(r.test(t)){var i=r.exec(t),a=parseInt(i[4],10)-1;return"data:image/png;base64,"+btoa(e.images[a])}if(n.test(t)){var o=n.exec(t)[1];return"data:image/png;base64,"+e.embeddedImages[o]}return t}function k(e){if(p){ie.call(this);var t=document.createElement("div");p.appendChild(t),_=(0,Oa.renderHTML)(e.isd,t,(function(t){return P(e,t)}),p.clientHeight,p.clientWidth,L.get().streaming.text.imsc.displayForcedOnlyMode,(function(e){r.info("renderCaption :",e)}),_,L.get().streaming.text.imsc.enableRollUp),t.id=e.cueID,w.trigger(d.Z.CAPTION_RENDERED,{captionDiv:t,currentTrackIdx:s})}}function x(e,t){return!!t&&t.endTime>=e.startTime}function F(e,t){return!!L.get().streaming.text.extendSegmentedCues&&!!function(e,t,r){for(var n=0;n<r.length;n++){var i=r[n];if(JSON.stringify(e[i])!==JSON.stringify(t[i]))return!1}return!0}(t,e,Pa)&&(t.endTime=Math.max(t.endTime,e.endTime),!0)}function U(e,t){t&&t.forEach((function(t){t.kind&&"image"===t.kind&&(t.src=P(e,t.src)),U(e,t.contents)}))}function B(e,t,n){var i=z(e),o=L.get().streaming.text.dispatchForManualRendering;if(i&&Array.isArray(n)&&0!==n.length)for(var s=0;s<n.length;s++){var l=null,u=n[s];i.cellResolution=u.cellResolution,i.isFromCEA608=u.isFromCEA608,isNaN(u.start)||isNaN(u.end)||(o?l=Z(u,t):q(u)&&p?l=K(u,t,i):u.data&&(l=Y(u,t,i)));try{if(l){if(!Q(i,l))if(L.get().streaming.text.webvtt.customRenderingEnabled)i.manualCueList||(i.manualCueList=[]),i.manualCueList.push(l);else{var c=void 0;i.cues&&0!==i.cues.length&&(c=i.cues[i.cues.length-1]),x(l,c)?F(l,c)||(c.isd&&(c.onexit=function(){}),i.mode!==a.Z.TEXT_DISABLED&&i.addCue(l)):i.mode!==a.Z.TEXT_DISABLED&&i.addCue(l)}var f=L.get().streaming.buffer.bufferToKeep;ee(i,0,C.getTime()-f)}else r.error("Impossible to display subtitles. You might have missed setting a TTML rendering div via player.attachTTMLRenderingDiv(TTMLRenderingDiv)")}catch(d){throw te(i),i.addCue(l),d}}}function Z(e,t){var r=V(e,t);return r.onenter=function(){q(e)&&R&&R.cueID!==r.cueID&&H(R),delete r.type,R=r,G(r)},r.onexit=function(){H(r),R=null},r}function G(e){w.trigger(d.Z.CUE_ENTER,e)}function H(e){w.trigger(d.Z.CUE_EXIT,{cueID:e.cueID})}function K(e,t,n){var i=this,o=V(e,t);return p.style.left=c+"px",p.style.top=h+"px",p.style.width=g+"px",p.style.height=m+"px",o.onenter=function(){var e=this;n.mode===a.Z.TEXT_SHOWING&&(this.isd?(b?requestAnimationFrame((function(){return k(e)})):k(this),r.debug("Cue enter id:"+this.cueID)):(p.appendChild(this.cueHTMLElement),M.call(i,this),w.trigger(d.Z.CAPTION_RENDERED,{captionDiv:this.cueHTMLElement,currentTrackIdx:s})))},o.onexit=function(){if(p)for(var e=p.childNodes,t=0;t<e.length;++t)e[t].id===this.cueID&&(r.debug("Cue exit id:"+e[t].id),p.removeChild(e[t]),--t)},o}function Y(e,t,n){var i=V(e,t);if(i.isActive=!1,e.styles)try{void 0!==e.styles.align&&"align"in i&&(i.align=e.styles.align),void 0!==e.styles.line&&"line"in i&&(i.line=e.styles.line),void 0!==e.styles.snapToLines&&"snapToLines"in i&&(i.snapToLines=e.styles.snapToLines),void 0!==e.styles.position&&"position"in i&&(i.position=e.styles.position),void 0!==e.styles.size&&"size"in i&&(i.size=e.styles.size)}catch(o){r.error(o)}return i.onenter=function(){n.mode===a.Z.TEXT_SHOWING&&w.trigger(d.Z.CAPTION_RENDERED,{currentTrackIdx:s})},i}function q(e){return"html"===e.type}function V(e,t){return q(e)?(i=t,(a=new n((r=e).start+i,r.end+i,"")).cueHTMLElement=r.cueHTMLElement,a.isd=r.isd,a.images=r.images,a.embeddedImages=r.embeddedImages,a.cueID=r.cueID,a.scaleCue=M.bind(self),a.cellResolution=r.cellResolution,a.lineHeight=r.lineHeight,a.linePadding=r.linePadding,a.fontSize=r.fontSize,a.isd&&U(a,a.isd.contents),a):function(e,t){var r=new n(e.start-t,e.end-t,e.data);return r.cueID="".concat(r.startTime,"_").concat(r.endTime),r}(e,t);var r,i,a}function j(e){if(y)for(var t=y.childNodes,r=0;r<t.length;++r)t[r].id===e.cueID&&(y.removeChild(t[r]),--r)}function $(){var e,t=[],r=function(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return Ma(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ma(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(C.getTextTracks());try{for(r.s();!(e=r.n()).done;){var n=e.value;n.manualMode===a.Z.TEXT_SHOWING&&t.push(n)}}catch(i){r.e(i)}finally{r.f()}return t}function z(e){return e>=0&&i[e]?C.getTextTrack(i[e].kind,i[e].id,i[e].lang,i[e].isTTML,i[e].isEmbedded):null}function W(e){var t=this;if(e!==s){var r=z(s=e);X.call(this,r),E&&(clearInterval(E),E=null),r&&"html"===r.renderingType&&(O.call(this,r,!0),window.ResizeObserver?(A=new window.ResizeObserver((function(){O.call(t,r,!0)}))).observe(C.getElement()):E=setInterval(O.bind(this,r),500))}}function X(e){ie.call(this),e&&"html"===e.renderingType?re.call(this):ne.call(this)}function Q(e,t){if(!e.cues)return!1;for(var r=0;r<e.cues.length;r++)if(e.cues[r].startTime===t.startTime&&e.cues[r].endTime===t.endTime)return!0;return!1}function J(e,t,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return!!e&&(isNaN(t)||(n?e.startTime:e.endTime)>=t)&&(isNaN(r)||(n?e.endTime:e.startTime)<=r)}function ee(e,t,r){var n,i;if(!(r<t)&&e&&(e.cues||e.manualCueList)){var a=e.cues&&e.cues.length>0?"native":"custom",o="native"===a?e.cues:e.manualCueList;if(!o||0===o.length)return;for(var s=o.length-1;s>=0;s--)!J(o[s],t,r,!0)||(n=o[s],i=C.getTime(),n.startTime>=i&&n.endTime<=i)||("native"===a?e.removeCue(o[s]):(j(o[s]),delete e.manualCueList[s]))}}function te(e,t,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(e&&(e.cues||e.manualCueList)){var i=e.cues&&e.cues.length>0?"native":"custom",a="native"===i?e.cues:e.manualCueList;if(!a||0===a.length)return;for(var o=a.length-1;o>=0;o--)J(a[o],t,r,n)&&("native"===i?(a[o].onexit&&a[o].onexit(),e.removeCue(a[o])):(j(a[o]),delete e.manualCueList[o]))}}function re(){var e=document.getElementById("native-cue-style");if(!e){(e=document.createElement("style")).id="native-cue-style",document.head.appendChild(e);var t=e.sheet,n=C.getElement();try{n&&(n.id?t.insertRule("#"+n.id+"::cue {background: transparent}",0):0!==n.classList.length?t.insertRule("."+n.className+"::cue {background: transparent}",0):t.insertRule("video::cue {background: transparent}",0))}catch(i){r.info(""+i.message)}}}function ne(){var e=document.getElementById("native-cue-style");e&&document.head.removeChild(e)}function ie(){if(p)for(;p.firstChild;)p.removeChild(p.firstChild)}return t={initialize:function(){"undefined"!=typeof window&&"undefined"!=typeof navigator&&(n=window.VTTCue||window.TextTrackCue,i=[],o=[],s=-1,c=0,h=0,g=0,m=0,p=null,y=null,E=null,T=!1,S=2147483647,_=null,b="requestAnimationFrame"in window,void 0!==document.fullscreenElement?v="fullscreenElement":void 0!==document.webkitIsFullScreen?v="webkitIsFullScreen":document.msFullscreenElement?v="msFullscreenElement":document.mozFullScreen&&(v="mozFullScreen"))},getStreamId:function(){return D.id},addTextTrack:function(e){i.push(e)},addCaptions:B,createTracks:function(){var e=L.get().streaming.text.dispatchForManualRendering;i.sort((function(e,t){return e.index-t.index})),p=C.getTTMLRenderingDiv(),y=C.getVttRenderingDiv();for(var t,r,n,l,c,f,h=-1,g=0;g<i.length;g++){var m=(r=(t=i[g]).kind,n=void 0!==t.id?t.id:t.lang,l=t.lang,c=t.isTTML,f=t.isEmbedded,C.addTextTrack(r,n,l,c,f));o.push(m),i[g].defaultTrack&&(m.default=!0,h=g);var E=z(g);E&&(E.mode=a.Z.TEXT_SHOWING,p&&(i[g].isTTML||i[g].isEmbedded)?E.renderingType="html":E.renderingType="default"),B(g,0,i[g].captionData),w.trigger(d.Z.TEXT_TRACK_ADDED)}if(W.call(this,h),h>=0){w.on(d.Z.PLAYBACK_METADATA_LOADED,(function e(){var t=z(h);t&&"html"===t.renderingType&&O.call(this,t,!0),w.off(d.Z.PLAYBACK_METADATA_LOADED,e,this)}),this);for(var v=0;v<i.length;v++){var T=z(v);T&&(T.mode=v!==h||e?a.Z.TEXT_HIDDEN:a.Z.TEXT_SHOWING,T.manualMode=v===h?a.Z.TEXT_SHOWING:a.Z.TEXT_HIDDEN)}}w.trigger(u.Z.TEXT_TRACKS_QUEUE_INITIALIZED,{index:s,tracks:i,streamId:D.id})},getCurrentTrackIdx:function(){return s},setCurrentTrackIdx:W,getTrackIdxForId:function(e){for(var t=-1,r=0;r<i.length;r++)if(i[r].id===e){t=r;break}return t},getCurrentTrackInfo:function(){return i[s]},setModeForTrackIdx:function(e,t){var r=z(e);r&&r.mode!==t&&(r.mode=t),r&&r.manualMode!==t&&(r.manualMode=t)},deleteCuesFromTrackIdx:function(e,t,r){var n=z(e);n&&te(n,t,r)},deleteAllTextTracks:function(){for(var e=o?o.length:0,t=0;t<e;t++){var r=z(t);r&&te.call(this,r,D.start,D.start+D.duration,!1)}o=[],i=[],E&&(clearInterval(E),E=null),A&&C&&(A.unobserve(C.getElement()),A=null),s=-1,ie.call(this)},manualCueProcessing:function(e){var t=$();if(t&&t.length>0){var r=t[0].manualCueList;r&&r.length>0&&r.forEach((function(t){t.startTime<=e&&t.endTime>=e&&!t.isActive?(t.isActive=!0,L.get().streaming.text.dispatchForManualRendering?G(t):WebVTT.processCues(window,[t],y,t.cueID)):t.isActive&&(t.startTime>e||t.endTime<e)&&(t.isActive=!1,L.get().streaming.text.dispatchForManualRendering?H(t):j(t))}))}},disableManualTracks:function(){var e=$();if(e&&e.length>0){var t=e[0].manualCueList;t&&t.length>0&&t.forEach((function(e){if(e.isActive)if(e.isActive=!1,L.get().streaming.text.dispatchForManualRendering)H(e);else if(y)for(var t=y.childNodes,r=0;r<t.length;++r)t[r].id===e.cueID&&(y.removeChild(t[r]),--r)}))}}},r=(0,f.Z)(I).getInstance().getLogger(t),t}ka.__dashjs_factory_name="TextTracks";var xa=c.Z.getClassFactory(ka);function Fa(){var e,t,r,n,i,a,o=this.context;function s(e){var t=e.split(":"),r=t.length-1;return e=60*parseInt(t[r-1],10)+parseFloat(t[r]),2===r&&(e+=3600*parseInt(t[0],10)),e}function l(e){var t=e.split(n),r=t[1].split(a);return r.shift(),t[1]=r[0],r.shift(),{cuePoints:t,styles:u(r)}}function u(e){var t={};return e.forEach((function(e){if(e.split(/:/).length>1){var r=e.split(/:/)[1],n=!1;r&&-1!=r.search(/%/)&&(n=!0,r=parseInt(r.replace(/%/,""),10)),(e.match(/align/)||e.match(/A/))&&(t.align=r),(e.match(/line/)||e.match(/L/))&&(t.line="auto"===r?r:parseInt(r,10),n&&(t.snapToLines=!1)),(e.match(/position/)||e.match(/P/))&&(t.position=r),(e.match(/size/)||e.match(/S/))&&(t.size=r)}})),t}function c(e,t){for(var r,i=t,a="",o="";""!==e[i]&&i<e.length;)i++;if((r=i-t)>1)for(var s=0;s<r;s++){if((o=e[t+s]).match(n)){a="";break}a+=o,s!==r-1&&(a+="\n")}else(o=e[t]).match(n)||(a=o);return a}return e={parse:function(e){var a,o,u=[];if(!e)return u;a=(e=e.split(r)).length,o=-1;for(var f=0;f<a;f++){var d=e[f];if(d.length>0&&"WEBVTT"!==d&&d.match(n)){var h=l(d),g=h.cuePoints,m=h.styles,p=c(e,f+1),y=s(g[0].replace(i,"")),E=s(g[1].replace(i,""));!isNaN(y)&&!isNaN(E)&&y>=o&&E>y?""!==p?(o=y,u.push({start:y,end:E,data:p,styles:m})):t.error("Skipping cue due to empty/malformed cue text"):t.error("Skipping cue due to incorrect cue timing")}}return u},getCaptionStyles:u},t=(0,f.Z)(o).getInstance().getLogger(e),r=/(?:\r\n|\r|\n)/gm,n=/-->/,i=/(^[\s]+|[\s]+$)/g,a=/\s\b/g,e}Fa.__dashjs_factory_name="VTTParser";var Ua=c.Z.getSingletonFactory(Fa);function Ba(){var e,t;return e={parse:function(e){var r=[];return t.oncue=function(e){e.start=e.startTime,e.end=e.endTime,e.data=e.text,e.styles={align:e.align,line:e.line,position:e.position,size:e.size},r.push(e)},t.parse(e),r}},function(){try{window&&window.WebVTT&&window.WebVTT.Parser&&(t=new window.WebVTT.Parser(window,window.vttjs,window.WebVTT.StringDecoder()))}catch(e){}}(),e}Ba.__dashjs_factory_name="VttCustomRenderingParser";var Za=c.Z.getSingletonFactory(Ba);function Ga(){var e,t,r=this.context,n=(0,l.Z)(r).getInstance(),i=0;return e={parse:function(e,r,a,o,s){var l,c,f,h="",g=[],m={},p={},y="",E="",v={onOpenTag:function(e,r,i){if(i[" imagetype"]&&!i[" imageType"]&&(n.trigger(d.Z.CONFORMANCE_VIOLATION,{level:ar.LEVELS.ERROR,event:ar.EVENTS.NON_COMPLIANT_SMPTE_IMAGE_ATTRIBUTE}),i[" imageType"]=i[" imagetype"]),"image"===r&&("http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt"===e||"http://www.smpte-ra.org/schemas/2052-1/2013/smpte-tt"===e)){if(!i[" imageType"]||"PNG"!==i[" imageType"].value)return void t.warn("smpte-tt imageType != PNG. Discarded");y=i["http://www.w3.org/XML/1998/namespace id"].value}},onCloseTag:function(){y&&(p[y]=E.trim()),E="",y=""},onText:function(e){y&&(E+=e)}};if(!e)throw h="no ttml data to parse",new Error(h);m.data=e,n.trigger(u.Z.TTML_TO_PARSE,m);var T=(0,Oa.fromXML)(m.data,(function(e){h=e}),v);n.trigger(u.Z.TTML_PARSED,{ttmlString:m.data,ttmlDoc:T});var _,S=T.getMediaTimeEvents();for(f=0;f<S.length;f++){var A=(0,Oa.generateISD)(T,S[f],(function(e){h=e}));A.contents.some((function(e){return e.contents.length}))&&(l=S[f]+r)<(c=S[f+1]+r)&&g.push({start:l,end:c,type:"html",cueID:(_="cue_TTML_"+i,i++,_),isd:A,images:s,embeddedImages:p})}if(""!==h)throw t.error(h),new Error(h);return g}},t=(0,f.Z)(r).getInstance().getLogger(e),e}Ga.__dashjs_factory_name="TTMLParser";var Ha=c.Z.getSingletonFactory(Ga);function Ka(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ya(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ka(Object(r),!0).forEach((function(t){qa(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ka(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function qa(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Va(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ja(e){var t,r,n,i=this.context,o=(0,l.Z)(i).getInstance(),s=(0,X.Z)(i).getInstance(),u=e.adapter,c=e.baseURLController;function h(e,t){var r,i,o=!1;if(c.resolve()){var l=u.getVoRepresentations(e);l&&l.length>0&&(r=c.resolve(l[0].path).url)}var f=e.essentialPropertiesAsArray.filter((function(e){return e.schemeIdUri&&e.schemeIdUri===a.Z.FONT_DOWNLOAD_DVB_SCHEME})),d=e.supplementalPropertiesAsArray.filter((function(e){return e.schemeIdUri&&e.schemeIdUri===a.Z.FONT_DOWNLOAD_DVB_SCHEME}));f.length>0?(o=!0,i=f):i=d,i.forEach((function(i){if((u=i).value&&"1"===u.value&&u.dvbUrl&&u.dvbUrl.length>0&&u.dvbFontFamily&&u.dvbFontFamily.length>0&&u.dvbMimeType&&(u.dvbMimeType===a.Z.OFF_MIMETYPE||u.dvbMimeType===a.Z.WOFF_MIMETYPE)){var l=(c=i.dvbUrl,f=r,s.isPathAbsolute(c)?c:s.isRelative(c)?f?s.resolve(c,f):s.resolve(c):c);n.push({fontFamily:i.dvbFontFamily,url:l,mimeType:i.dvbMimeType,trackId:e.id,streamId:t,isEssential:o,status:"unloaded",fontFace:new FontFace(i.dvbFontFamily,"url(".concat(l,")"),{display:"swap"})})}var u,c,f}))}function g(e,t){var r=n[e];n[e]=Ya(Ya({},r),{},{status:t})}function m(){n=[]}return t={addFontsFromTracks:function(e,t){if(e&&Array.isArray(e)&&t)for(var r=0;r<e.length;r++)h(e[r],t)},downloadFonts:function(){for(var e=function(e){var t=n[e];document.fonts.add(t.fontFace),o.trigger(d.Z.DVB_FONT_DOWNLOAD_ADDED,t),t.fontFace.load().then((function(){g(e,"loaded"),o.trigger(d.Z.DVB_FONT_DOWNLOAD_COMPLETE,t)}),(function(n){g(e,"error"),r.debug("Font download error: ",n),o.trigger(d.Z.DVB_FONT_DOWNLOAD_FAILED,t)}))},t=0;t<n.length;t++)e(t)},getFonts:function(){return n},getFontsForTrackId:function(e){return n.filter((function(t){return t.trackId&&t.trackId===e}))},reset:function(){!function(){var e,t=function(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return Va(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Va(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(n);try{for(t.s();!(e=t.n()).done;){var i=e.value,a=document.fonts.delete(i.fontFace);r.debug("Removal of fontFamily: ".concat(i.fontFamily," was ").concat(a?"successful":"unsuccessful"))}}catch(o){t.e(o)}finally{t.f()}}(),m()}},r=(0,f.Z)(i).getInstance().getLogger(t),m(),t}ja.__dashjs_factory_name="DVBFonts";var $a=c.Z.getClassFactory(ja);function za(e){var t,r,n,i,o,s,c,h,g,m,p,y,E,v,T=this.context,_=e.adapter,S=e.errHandler,A=e.manifestModel,b=e.mediaController,R=e.baseURLController,I=e.videoModel,w=e.settings;function C(e){if(v.error("Could not download ".concat(e.isEssential?"an essential":"a"," font - fontFamily: ").concat(e.fontFamily,", url: ").concat(e.url)),e.isEssential){var t=i[e.streamId].getTrackIdxForId(e.trackId);i[e.streamId].setModeForTrackIdx(t,a.Z.TEXT_DISABLED)}}function D(e){if(v.debug("Successfully downloaded ".concat(e.isEssential?"an essential":"a"," font - fontFamily: ").concat(e.fontFamily,", url: ").concat(e.url)),e.isEssential){var t=i[e.streamId].getTrackIdxForId(e.trackId);t===i[e.streamId].getCurrentTrackIdx()?i[e.streamId].setModeForTrackIdx(t,a.Z.TEXT_SHOWING):i[e.streamId].setModeForTrackIdx(t,a.Z.TEXT_HIDDEN)}}function L(e){var t=e.tracks,n=e.index,o=e.streamId;if(!1===w.get().streaming.text.defaultEnabled&&!M()||y)P(o,-1);else{var s=b.getCurrentTrackFor(a.Z.TEXT,o);if(s){var l={lang:s.lang,role:s.roles[0],index:s.index,codec:s.codec,accessibility:s.accessibility[0]};t.some((function(e,t){if(b.matchSettings(l,e))return P(o,t),n=t,!0}))}g=!1}r[o].lastEnabledIndex=n,h.trigger(d.Z.TEXT_TRACKS_ADDED,{enabled:M(),index:n,tracks:t,streamId:o}),p=!0,E.addFontsFromTracks(t,o),E.getFonts().forEach((function(e){if(e.isEssential){var t=i[e.streamId].getTrackIdxForId(e.trackId);i[e.streamId].setModeForTrackIdx(t,a.Z.TEXT_DISABLED)}})),E.downloadFonts()}function N(e){try{var t=e.streamId;if(!i[t]||isNaN(e.time))return;i[t].manualCueProcessing(e.time)}catch(r){}}function O(e){try{var t=e.streamId;if(!i[t])return;i[t].disableManualTracks()}catch(r){}}function M(){var e=!0;return g&&!m&&(e=!1),e}function P(e,t){(g=-1===t)&&b&&b.saveTextSettingsDisabled();var r,o,s=k(e);if(s!==t&&i[e]){i[e].disableManualTracks();var l=i[e].getCurrentTrackInfo(),c=l?I.getTextTrack(l.kind,l.id,l.lang,l.isTTML,l.isEmbedded):null;c&&c.mode!==a.Z.TEXT_DISABLED&&i[e].setModeForTrackIdx(s,a.Z.TEXT_HIDDEN),i[e].setCurrentTrackIdx(t),l=i[e].getCurrentTrackInfo();var f=w.get().streaming.text.dispatchForManualRendering;l&&!f&&l.mode!==a.Z.TEXT_DISABLED&&i[e].setModeForTrackIdx(t,a.Z.TEXT_SHOWING),l&&l.isFragmented&&!l.isEmbedded?function(e,t,r){if(n[e])for(var o=n[e].getConfig().fragmentedTracks,s=0;s<o.length;s++){var l=o[s];if(t.lang===l.lang&&(l.id?t.id===l.id:t.index===l.index)){var c=b.getCurrentTrackFor(a.Z.TEXT,e);(l.id?c.id!==l.id:c.index!==l.index)?(i[e].deleteCuesFromTrackIdx(r),n[e].setCurrentFragmentedTrackIdx(s)):-1===r&&h.trigger(u.Z.SET_FRAGMENTED_TEXT_AFTER_DISABLED,{},{streamId:e,mediaType:a.Z.TEXT})}}}(e,l,s):l&&!l.isFragmented&&(r=e,o=l,h.trigger(u.Z.SET_NON_FRAGMENTED_TEXT,{currentTrackInfo:o},{streamId:r,mediaType:a.Z.TEXT})),b.setTrack(l)}}function k(e){return i[e].getCurrentTrackIdx()}function x(){n={},i={},r={},g=!0,p=!1,y=!1}return t={deactivateStream:function(e){if(e){var t=e.id;n[t]&&n[t].resetMediaInfos(),i[t]&&i[t].deleteAllTextTracks()}},initialize:function(){E=$a(T).create({adapter:_,baseURLController:R}),h.on(u.Z.TEXT_TRACKS_QUEUE_INITIALIZED,L,t),h.on(u.Z.DVB_FONT_DOWNLOAD_FAILED,C,t),h.on(u.Z.DVB_FONT_DOWNLOAD_COMPLETE,D,t),w.get().streaming.text.webvtt.customRenderingEnabled&&(h.on(u.Z.PLAYBACK_TIME_UPDATED,N,t),h.on(u.Z.PLAYBACK_SEEKING,O,t))},initializeForStream:function(e){var t=e.id,a=xa(T).create({videoModel:I,settings:w,streamInfo:e});a.initialize(),i[t]=a;var l=Na(T).create({errHandler:S,adapter:_,dvbFonts:E,manifestModel:A,mediaController:b,videoModel:I,textTracks:a,vttParser:o,vttCustomRenderingParser:s,ttmlParser:c,streamInfo:e,settings:w});l.initialize(),n[t]=l,r[t]={},r[t].lastEnabledIndex=-1},createTracks:function(e){var t=e.id;i[t]&&i[t].createTracks()},getTextSourceBuffer:function(e){var t=e.id;if(n&&n[t])return n[t]},getAllTracksAreDisabled:function(){return g},addEmbeddedTrack:function(e,t){var r=e.id;n[r]&&n[r].addEmbeddedTrack(t)},enableText:function(e,t){return(0,$.PS)(t,"boolean"),M()!==t&&(t&&P(e,r[e].lastEnabledIndex),t||(r[e].lastEnabledIndex=k(e),p?P(e,-1):y=!0)),!0},isTextEnabled:M,setTextTrack:P,getCurrentTrackIdx:k,enableForcedTextStreaming:function(e){return(0,$.PS)(e,"boolean"),m=e,!0},addMediaInfosToBuffer:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=e.id;n[a]&&n[a].addMediaInfos(t,r,i)},reset:function(){E.reset(),x(),h.off(u.Z.TEXT_TRACKS_QUEUE_INITIALIZED,L,t),h.off(u.Z.DVB_FONT_DOWNLOAD_FAILED,C,t),h.off(u.Z.DVB_FONT_DOWNLOAD_COMPLETE,D,t),w.get().streaming.text.webvtt.customRenderingEnabled&&(h.off(u.Z.PLAYBACK_TIME_UPDATED,N,t),h.off(u.Z.PLAYBACK_SEEKING,O,t)),Object.keys(n).forEach((function(e){n[e].resetEmbedded(),n[e].reset()}))}},m=!1,p=!1,y=!1,o=Ua(T).getInstance(),s=Za(T).getInstance(),c=Ha(T).getInstance(),h=(0,l.Z)(T).getInstance(),v=(0,f.Z)(T).getInstance().getLogger(t),x(),t}za.__dashjs_factory_name="TextController";var Wa=c.Z.getClassFactory(za);function Xa(){var e,t,r,n,h,m,p,y,E,v,T,_,A,b,R,I,L,N,O,M,P,k,x,F,U,B,Z,G,H,K,Y,q,V,j,z,Q,J,ee,te,re="You must first call initialize() and set a source before calling this method",ne="You must first call initialize() and set a valid source and view before calling this method",ie="You must first call attachView() to set the video element before calling this method",ae="You must first call attachSource() with a valid source before calling this method",oe="MediaPlayer not initialized!",se=this.context,le=(0,l.Z)(se).getInstance(),ue=(0,C.Z)(se).getInstance(),ce=(0,f.Z)(se).getInstance({settings:ue});function fe(){Re(null),Ae(null),n=null,b&&(b.reset(),b=null),R&&(R.reset(),R=null),M&&M.reset(),ue.reset(),L&&(L.reset(),L=null)}function de(){return!!r&&!!Q.getElement()}function he(){return(0,Oi.e)()}function ge(){if(!p)throw ne;return G.isPaused()}function me(){if(!p)throw ne;return G.getIsDynamic()}function pe(e){var t=U&&U.hasVideoTrack()?a.Z.VIDEO:a.Z.AUDIO,r=q.getCurrentDVRInfo(t);if(!r)return 0;var n=G.getOriginalLiveDelay(),i=r.range.start+e;return i>r.range.end-n&&(i=r.range.end-n),i}function ye(e){if(!p)throw ne;var t=Se().currentTime;if(void 0!==e)t=U.getTimeRelativeToStreamId(t,e);else if(G.getIsDynamic()){var r=U&&U.hasVideoTrack()?a.Z.VIDEO:a.Z.AUDIO,n=q.getCurrentDVRInfo(r);t=null===n||0===t?0:Math.max(0,t-n.range.start)}return t}function Ee(){if(!p)throw ne;var e=Se().duration;if(G.getIsDynamic()){var t=U&&U.hasVideoTrack()?a.Z.VIDEO:a.Z.AUDIO,r=q.getCurrentDVRInfo(t);e=r?r.range.end-r.range.start:0}return e}function ve(e){(0,$.PS)(e,"boolean"),y=e}function Te(){M.restoreDefaultUTCTimingSources()}function _e(){return q}function Se(){if(!Q.getElement())throw ie;return Q.getElement()}function Ae(e){if(!h)throw oe;Q.setElement(e),e&&(Le(),function(){if(!R){var e=dashjs.MetricsReporting;if("function"==typeof e){var t=e(se).create();R=t.createMetricsReporting({debug:ce,eventBus:le,mediaElement:Se(),adapter:N,dashMetrics:q,mediaPlayerModel:O,events:u.Z,constants:a.Z,metricsConstants:s.Z})}}}(),function(){if(!I){var e=dashjs.MssHandler;"function"==typeof e&&(w.extend(e.errors),I=e(se).create({eventBus:le,mediaPlayerModel:O,dashMetrics:q,manifestModel:V,playbackController:G,streamController:U,protectionController:b,baseURLController:k,errHandler:P,events:u.Z,constants:a.Z,debug:ce,initSegmentType:D.w.INIT_SEGMENT_TYPE,BASE64:Ta,ISOBoxer:_a,settings:ue}))}}(),U&&U.switchToVideoElement(E)),p&&we(),Me(E)}function be(e){if(!m)throw re;var t=U.getActiveStreamInfo();return t?A.getTracksFor(e,t.id):[]}function Re(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:NaN;if(!h)throw oe;"string"==typeof e&&J.initialize(e),null==t&&(t=NaN),isNaN(t)||(t=Math.max(0,t)),E=t,r=e,(m||p)&&we(),de()&&Me(E)}function Ie(){if(!m)throw re;var e=U.getActiveStreamInfo();return e?U.getStreamById(e.id):null}function we(){p=!1,m=!1,N.reset(),U.reset(),Z.reset(),Y.reset(),G.reset(),H.reset(),K.reset(),v.reset(),A.reset(),te.reset(),b&&(ue.get().streaming.protection.keepProtectionMediaKeys?b.stop():(b.reset(),b=null,Le())),B.reset(),j.reset(),z.reset()}function Ce(){var e=De();U||(U=lr(se).getInstance()),B||(B=Wa(se).create({errHandler:P,manifestModel:V,adapter:N,mediaController:A,baseURLController:k,videoModel:Q,settings:ue})),F.setConfig({capabilities:x,customParametersModel:M,adapter:N,settings:ue,manifestModel:V,errHandler:P}),U.setConfig({capabilities:x,capabilitiesFilter:F,manifestLoader:e,manifestModel:V,mediaPlayerModel:O,customParametersModel:M,protectionController:b,textController:B,adapter:N,dashMetrics:q,errHandler:P,timelineConverter:_,videoModel:Q,playbackController:G,serviceDescriptionController:H,contentSteeringController:K,abrController:v,mediaController:A,settings:ue,baseURLController:k,uriFragmentModel:J,segmentBaseController:te}),Z.setConfig({settings:ue,playbackController:G,streamController:U,videoModel:Q,timelineConverter:_,adapter:N}),G.setConfig({streamController:U,serviceDescriptionController:H,dashMetrics:q,adapter:N,videoModel:Q,timelineConverter:_,settings:ue}),Y.setConfig({streamController:U,playbackController:G,mediaPlayerModel:O,videoModel:Q,settings:ue}),v.setConfig({streamController:U,domStorage:ee,mediaPlayerModel:O,customParametersModel:M,cmsdModel:z,dashMetrics:q,adapter:N,videoModel:Q,settings:ue}),j.setConfig({abrController:v,dashMetrics:q,playbackController:G}),z.setConfig({}),v.initialize(),U.initialize(y,n),B.initialize(),Z.initialize(),Y.initialize(),j.initialize(),z.initialize(),K.initialize(),te.initialize()}function De(){return $n(se).create({debug:ce,errHandler:P,dashMetrics:q,mediaPlayerModel:O,requestModifier:(0,W.Z)(se).getInstance(),mssHandler:I,settings:ue})}function Le(){if(b)return b;var e=dashjs.Protection;if("function"==typeof e){var t=e(se).create();return u.Z.extend(e.events),d.Z.extend(e.events,{publicOnly:!0}),w.extend(e.errors),x||(x=(0,Xn.Z)(se).getInstance()),b=t.createProtectionSystem({debug:ce,errHandler:P,videoModel:Q,customParametersModel:M,capabilities:x,eventBus:le,events:u.Z,BASE64:Ta,constants:a.Z,cmcdModel:j,settings:ue})}return null}function Ne(){if(!h)throw oe;if(L)return L;var e=dashjs.OfflineController;if("function"==typeof e){u.Z.extend(e.events),d.Z.extend(e.events,{publicOnly:!0}),w.extend(e.errors);var t=De(),r=Xt(se).create();return r.setConfig({manifestModel:V,adapter:N,manifestLoader:t,errHandler:P,contentSteeringController:K}),L=e(se).create({debug:ce,manifestUpdater:r,baseURLController:k,manifestLoader:t,manifestModel:V,mediaPlayerModel:O,abrController:v,playbackController:G,adapter:N,errHandler:P,dashMetrics:q,timelineConverter:_,segmentBaseController:te,schemeLoaderFactory:T,eventBus:le,events:u.Z,errors:w,constants:a.Z,settings:ue,dashConstants:o.Z,urlUtils:(0,X.Z)(se).getInstance()})}return null}function Oe(e){var t=U&&U.hasVideoTrack()?a.Z.VIDEO:a.Z.AUDIO,r=q.getCurrentDVRInfo(t);return r?e+(r.manifestInfo.availableFrom.getTime()/1e3+r.range.start):0}function Me(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN;L&&L.resetRecords(),!m&&r&&(m=!0,t.info("Streaming Initialized"),Ce(),"string"==typeof r?U.load(r,e):U.loadWithManifest(r,e)),!p&&de()&&(p=!0,t.info("Playback Initialized"))}return e={initialize:function(e,r,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:NaN;x||(x=(0,Xn.Z)(se).getInstance()).setConfig({settings:ue}),P||(P=Wn(se).getInstance()),x.supportsMediaSource()?(h||(h=!0,_=va(se).getInstance(),v||(v=Ti(se).getInstance()).setConfig({settings:ue}),T||(T=Tt(se).getInstance()),G||(G=g(se).getInstance()),A||(A=Ar(se).getInstance()),U||(U=lr(se).getInstance()),Z||(Z=cr(se).getInstance()),Y||(Y=dr(se).getInstance()),H||(H=yr(se).getInstance()),K||(K=jt(se).getInstance()),F||(F=Jn(se).getInstance()),N=Ji(se).getInstance(),V=ii(se).getInstance(),j=je(se).getInstance(),z=dt(se).getInstance(),q=ya(se).getInstance({settings:ue}),ee=Ni(se).getInstance({settings:ue}),N.setConfig({constants:a.Z,cea608parser:i(),errHandler:P,BASE64:Ta}),k||(k=Fr(se).create()),k.setConfig({adapter:N,contentSteeringController:K}),H.setConfig({adapter:N}),te||(te=Gi(se).getInstance({dashMetrics:q,mediaPlayerModel:O,errHandler:P,baseURLController:k,events:u.Z,eventBus:le,debug:ce,boxParser:(0,Ut.Z)(se).getInstance(),requestModifier:(0,W.Z)(se).getInstance(),errors:w})),A.setConfig({domStorage:ee,settings:ue,customParametersModel:M}),O.setConfig({playbackController:G,serviceDescriptionController:H}),K.setConfig({adapter:N,errHandler:P,dashMetrics:q,mediaPlayerModel:O,manifestModel:V,serviceDescriptionController:H,eventBus:le,requestModifier:(0,W.Z)(se).getInstance()}),Te(),ve(void 0===n||n),Ne()),e&&Ae(e),r&&Re(r,o),t.info("[dash.js "+he()+"] MediaPlayer has been initialized")):P.error(new S.Z(w.CAPABILITY_MEDIASOURCE_ERROR_CODE,w.CAPABILITY_MEDIASOURCE_ERROR_MESSAGE))},setConfig:function(e){e&&(e.capabilities&&(x=e.capabilities),e.capabilitiesFilter&&(F=e.capabilitiesFilter),e.streamController&&(U=e.streamController),e.textController&&(B=e.textController),e.gapController&&(Z=e.gapController),e.playbackController&&(G=e.playbackController),e.serviceDescriptionController&&(H=e.serviceDescriptionController),e.contentSteeringController&&(K=e.contentSteeringController),e.catchupController&&(Y=e.catchupController),e.mediaPlayerModel&&(O=e.mediaPlayerModel),e.customParametersModel&&(M=e.customParametersModel),e.abrController&&(v=e.abrController),e.schemeLoaderFactory&&(T=e.schemeLoaderFactory),e.mediaController&&(A=e.mediaController),e.settings&&(ue=e.settings))},on:function(e,t,r,n){le.on(e,t,r,n)},off:function(e,t,r){le.off(e,t,r)},extend:function(e,t,r){c.Z.extend(e,t,r,se)},attachView:Ae,attachSource:Re,refreshManifest:function(e){if(!h)throw oe;if(!de())return e(null,ae);var t=this;"function"==typeof e&&le.on(u.Z.INTERNAL_MANIFEST_LOADED,(function r(n){le.off(u.Z.INTERNAL_MANIFEST_LOADED,r,t),n.error?e(null,n.error):e(n.manifest)}),t),U.refreshManifest()},isReady:de,preload:function(){if(!Q.getElement()&&!m){if(!r)throw ae;Me(E)}},play:function(){if(!p)throw ne;(!y||ge()&&p)&&G.play(!0)},isPaused:ge,pause:function(){if(!p)throw ne;G.pause()},isSeeking:function(){if(!p)throw ne;return G.isSeeking()},isDynamic:me,getLowLatencyModeEnabled:function(){if(!p)throw ne;return G.getLowLatencyModeEnabled()},seek:function(e){if(!p)throw ne;if((0,$.PS)(e,"number"),isNaN(e))throw a.Z.BAD_ARGUMENT_ERROR;e<0&&(e=0);var t=G.getIsDynamic()?pe(e):e,r=Se();!G.getIsDynamic()&&r.duration&&(t=Math.min(r.duration,t)),G.seek(t,!1,!1,!0)},seekToOriginalLive:function(){p&&me()&&G.seekToOriginalLive()},setPlaybackRate:function(e){Se().playbackRate=e},getPlaybackRate:function(){return Se().playbackRate},setMute:function(e){(0,$.PS)(e,"boolean"),Se().muted=e},isMuted:function(){return Se().muted},setVolume:function(e){if("number"!=typeof e||isNaN(e)||e<0||e>1)throw a.Z.BAD_ARGUMENT_ERROR;Se().volume=e},getVolume:function(){return Se().volume},time:ye,duration:Ee,timeAsUTC:function(){if(!p)throw ne;return ye()<0?NaN:Oe(ye())},durationAsUTC:function(){if(!p)throw ne;return Oe(Ee())},getActiveStream:Ie,getDVRWindowSize:function(){var e=U&&U.hasVideoTrack()?a.Z.VIDEO:a.Z.AUDIO,t=q.getCurrentDVRInfo(e);return t?t.manifestInfo.dvrWindowSize:0},getDVRSeekOffset:pe,getAvailableBaseUrls:function(){var e=V.getValue();return e?k.getBaseUrls(e):[]},getAvailableLocations:function(){var e=V.getValue();if(!e)return[];var t=N.getLocation(e),r=K.getSynthesizedLocationElements(t);return t.concat(r)},getTargetLiveDelay:function(){if(!p)throw ne;return G.getOriginalLiveDelay()},convertToTimeCode:function(e){e=Math.max(e,0);var t=Math.floor(e/3600),r=Math.floor(e%3600/60),n=Math.floor(e%3600%60);return(0===t?"":t<10?"0"+t.toString()+":":t.toString()+":")+(r<10?"0"+r.toString():r.toString())+":"+(n<10?"0"+n.toString():n.toString())},formatUTC:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=new Date(1e3*e),a=i.toLocaleDateString(t),o=i.toLocaleTimeString(t,{hour12:r});return n?o+" "+a:o},getVersion:he,getDebug:function(){return ce},getBufferLength:function(e){var r=[a.Z.VIDEO,a.Z.AUDIO,a.Z.TEXT];if(e)return-1!==r.indexOf(e)?_e().getCurrentBufferLevel(e)||NaN:(t.warn("getBufferLength requested for invalid type"),NaN);var n=r.map((function(e){return be(e).length>0?_e().getCurrentBufferLevel(e):Number.MAX_VALUE})).reduce((function(e,t){return Math.min(e,t)}));return n===Number.MAX_VALUE?NaN:n},getTTMLRenderingDiv:function(){return Q?Q.getTTMLRenderingDiv():null},getVideoElement:Se,getSource:function(){if(!r)throw ae;return r},updateSource:function(e){r=e,U.load(r)},getCurrentLiveLatency:function(){if(!h)throw oe;return p?G.getCurrentLiveLatency():NaN},getTopBitrateInfoFor:function(e){if(!m)throw re;return v.getTopBitrateInfoFor(e)},setAutoPlay:ve,getAutoPlay:function(){return y},getDashMetrics:_e,getQualityFor:function(e){if(!m)throw re;if(e===a.Z.IMAGE){var t=Ie();if(!t)return-1;var r=t.getThumbnailController();return r?r.getCurrentTrackIndex():-1}return v.getQualityFor(e)},setQualityFor:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!m)throw re;if(e===a.Z.IMAGE){var n=Ie();if(!n)return;var i=n.getThumbnailController();i&&i.setTrackByIndex(t)}v.setPlaybackQuality(e,U.getActiveStreamInfo(),t,{forceReplace:r})},updatePortalSize:function(){v.setElementSize(),v.setWindowResizeEventCalled(!0)},enableText:function(e){var t=U.getActiveStreamInfo();return!(!t||!B)&&B.enableText(t.id,e)},enableForcedTextStreaming:function(e){return!(!U.getActiveStreamInfo()||!B)&&B.enableForcedTextStreaming(e)},isTextEnabled:function(){var e=U.getActiveStreamInfo();return!(!e||!B)&&B.isTextEnabled(e)},setTextTrack:function(e){if(!p)throw ne;var t=U.getActiveStreamInfo();t&&B&&B.setTextTrack(t.id,e)},getBitrateInfoListFor:function(e){if(!m)throw re;var t=Ie();return t?t.getBitrateListFor(e):[]},getStreamsFromManifest:function(e){if(!m)throw re;return N.getStreamsInfo(e)},getTracksFor:be,getTracksForTypeFromManifest:function(e,t,r){if(!m)throw re;return(r=r||N.getStreamsInfo(t,1)[0])?N.getAllMediaInfoForType(r,e,t):[]},getCurrentTrackFor:function(e){if(!m)throw re;var t=U.getActiveStreamInfo();return A.getCurrentTrackFor(e,t.id)},setInitialMediaSettingsFor:function(e,t){if(!h)throw oe;A.setInitialSettings(e,t)},getInitialMediaSettingsFor:function(e){if(!h)throw oe;return A.getInitialSettings(e)},setCurrentTrack:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!m)throw re;A.setTrack(e,t)},addABRCustomRule:function(e,t,r){M.addAbrCustomRule(e,t,r)},removeABRCustomRule:function(e){M.removeAbrCustomRule(e)},removeAllABRCustomRule:function(){M.removeAllAbrCustomRule()},getABRCustomRules:function(){return M.getAbrCustomRules()},getAverageThroughput:function(e){var t=v.getThroughputHistory(),r=G.getIsDynamic();return t?t.getAverageThroughput(e,r):0},retrieveManifest:function(e,t){var r=De(),n=this;le.on(u.Z.INTERNAL_MANIFEST_LOADED,(function e(i){i.error?t(null,i.error):t(i.manifest),le.off(u.Z.INTERNAL_MANIFEST_LOADED,e,n),r.reset()}),n),J.initialize(e),r.load(e)},addUTCTimingSource:function(e,t){M.addUTCTimingSource(e,t)},removeUTCTimingSource:function(e,t){M.removeUTCTimingSource(e,t)},clearDefaultUTCTimingSources:function(){M.clearDefaultUTCTimingSources()},restoreDefaultUTCTimingSources:Te,setXHRWithCredentialsForType:function(e,t){M.setXHRWithCredentialsForType(e,t)},getXHRWithCredentialsForType:function(e){return M.getXHRWithCredentialsForType(e)},getProtectionController:function(){return Le()},attachProtectionController:function(e){b=e},setProtectionData:function(e){n=e,U&&U.setProtectionData(n)},registerLicenseRequestFilter:function(e){M.registerLicenseRequestFilter(e)},registerLicenseResponseFilter:function(e){M.registerLicenseResponseFilter(e)},unregisterLicenseRequestFilter:function(e){M.unregisterLicenseRequestFilter(e)},unregisterLicenseResponseFilter:function(e){M.unregisterLicenseResponseFilter(e)},registerCustomCapabilitiesFilter:function(e){M.registerCustomCapabilitiesFilter(e)},unregisterCustomCapabilitiesFilter:function(e){M.unregisterCustomCapabilitiesFilter(e)},setCustomInitialTrackSelectionFunction:function(e){M.setCustomInitialTrackSelectionFunction(e)},resetCustomInitialTrackSelectionFunction:function(){M.resetCustomInitialTrackSelectionFunction(null)},attachTTMLRenderingDiv:function(e){if(!Q.getElement())throw ie;Q.setTTMLRenderingDiv(e)},attachVttRenderingDiv:function(e){if(!Q.getElement())throw ie;Q.setVttRenderingDiv(e)},getCurrentTextTrackIndex:function(){var e=U.getActiveStreamInfo();if(e&&B)return B.getCurrentTrackIdx(e.id)},provideThumbnail:function(e,t){if("function"==typeof t)if(e<0)t(null);else{var r=G.getIsDynamic()?pe(e):e,n=U.getStreamForTime(r);if(null!==n){var i=n.getThumbnailController();if(i)return i.provide(r,t);t(null)}else t(null)}},getDashAdapter:function(){return N},getOfflineController:function(){return Ne()},triggerSteeringRequest:function(){if(K)return K.loadSteeringData()},getCurrentSteeringResponseData:function(){if(K)return K.getCurrentSteeringResponseData()},getSettings:function(){return ue.get()},updateSettings:function(e){ue.update(e)},resetSettings:function(){ue.reset()},reset:fe,destroy:function(){fe(),c.Z.deleteSingletonInstances(se)}},t=ce.getLogger(e),h=!1,p=!1,m=!1,y=!0,E=NaN,b=null,L=null,n=null,N=null,te=null,u.Z.extend(d.Z),O=si(se).getInstance(),M=(0,mt.Z)(se).getInstance(),Q=Ai(se).getInstance(),J=ri(se).getInstance(),e}Xa.__dashjs_factory_name="MediaPlayer";var Qa=c.Z.getClassFactory(Xa);Qa.events=d.Z,Qa.errors=w,c.Z.updateClassFactory(Xa.__dashjs_factory_name,Qa);var Ja=Qa},8825:function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var s=new(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(s,e);var t,r,n=(t=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=o(t);if(r){var i=o(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return a(this,e)});function s(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(e=n.call(this)).AST_IN_FUTURE="astInFuture",e.BASE_URLS_UPDATED="baseUrlsUpdated",e.BUFFER_EMPTY="bufferStalled",e.BUFFER_LOADED="bufferLoaded",e.BUFFER_LEVEL_STATE_CHANGED="bufferStateChanged",e.BUFFER_LEVEL_UPDATED="bufferLevelUpdated",e.DVB_FONT_DOWNLOAD_ADDED="dvbFontDownloadAdded",e.DVB_FONT_DOWNLOAD_COMPLETE="dvbFontDownloadComplete",e.DVB_FONT_DOWNLOAD_FAILED="dvbFontDownloadFailed",e.DYNAMIC_TO_STATIC="dynamicToStatic",e.ERROR="error",e.FRAGMENT_LOADING_COMPLETED="fragmentLoadingCompleted",e.FRAGMENT_LOADING_PROGRESS="fragmentLoadingProgress",e.FRAGMENT_LOADING_STARTED="fragmentLoadingStarted",e.FRAGMENT_LOADING_ABANDONED="fragmentLoadingAbandoned",e.LOG="log",e.MANIFEST_LOADING_STARTED="manifestLoadingStarted",e.MANIFEST_LOADING_FINISHED="manifestLoadingFinished",e.MANIFEST_LOADED="manifestLoaded",e.METRICS_CHANGED="metricsChanged",e.METRIC_CHANGED="metricChanged",e.METRIC_ADDED="metricAdded",e.METRIC_UPDATED="metricUpdated",e.PERIOD_SWITCH_STARTED="periodSwitchStarted",e.PERIOD_SWITCH_COMPLETED="periodSwitchCompleted",e.QUALITY_CHANGE_REQUESTED="qualityChangeRequested",e.QUALITY_CHANGE_RENDERED="qualityChangeRendered",e.TRACK_CHANGE_RENDERED="trackChangeRendered",e.STREAM_INITIALIZING="streamInitializing",e.STREAM_UPDATED="streamUpdated",e.STREAM_ACTIVATED="streamActivated",e.STREAM_DEACTIVATED="streamDeactivated",e.STREAM_INITIALIZED="streamInitialized",e.STREAM_TEARDOWN_COMPLETE="streamTeardownComplete",e.TEXT_TRACKS_ADDED="allTextTracksAdded",e.TEXT_TRACK_ADDED="textTrackAdded",e.CUE_ENTER="cueEnter",e.CUE_EXIT="cueExit",e.THROUGHPUT_MEASUREMENT_STORED="throughputMeasurementStored",e.TTML_PARSED="ttmlParsed",e.TTML_TO_PARSE="ttmlToParse",e.CAPTION_RENDERED="captionRendered",e.CAPTION_CONTAINER_RESIZE="captionContainerResize",e.CAN_PLAY="canPlay",e.CAN_PLAY_THROUGH="canPlayThrough",e.PLAYBACK_ENDED="playbackEnded",e.PLAYBACK_ERROR="playbackError",e.PLAYBACK_NOT_ALLOWED="playbackNotAllowed",e.PLAYBACK_METADATA_LOADED="playbackMetaDataLoaded",e.PLAYBACK_LOADED_DATA="playbackLoadedData",e.PLAYBACK_PAUSED="playbackPaused",e.PLAYBACK_PLAYING="playbackPlaying",e.PLAYBACK_PROGRESS="playbackProgress",e.PLAYBACK_RATE_CHANGED="playbackRateChanged",e.PLAYBACK_SEEKED="playbackSeeked",e.PLAYBACK_SEEKING="playbackSeeking",e.PLAYBACK_STALLED="playbackStalled",e.PLAYBACK_STARTED="playbackStarted",e.PLAYBACK_TIME_UPDATED="playbackTimeUpdated",e.PLAYBACK_VOLUME_CHANGED="playbackVolumeChanged",e.PLAYBACK_WAITING="playbackWaiting",e.MANIFEST_VALIDITY_CHANGED="manifestValidityChanged",e.EVENT_MODE_ON_START="eventModeOnStart",e.EVENT_MODE_ON_RECEIVE="eventModeOnReceive",e.CONFORMANCE_VIOLATION="conformanceViolation",e.REPRESENTATION_SWITCH="representationSwitch",e.ADAPTATION_SET_REMOVED_NO_CAPABILITIES="adaptationSetRemovedNoCapabilities",e.CONTENT_STEERING_REQUEST_COMPLETED="contentSteeringRequestCompleted",e.INBAND_PRFT="inbandPrft",e.MANAGED_MEDIA_SOURCE_START_STREAMING="managedMediaSourceStartStreaming",e.MANAGED_MEDIA_SOURCE_END_STREAMING="managedMediaSourceEndStreaming",e}return s}(r(8342).Z));t.Z=s},3393:function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}var t;return(t=[{key:"init",value:function(){this.STREAM="stream",this.VIDEO="video",this.AUDIO="audio",this.TEXT="text",this.MUXED="muxed",this.IMAGE="image",this.STPP="stpp",this.TTML="ttml",this.VTT="vtt",this.WVTT="wvtt",this.CONTENT_STEERING="contentSteering",this.ABR_STRATEGY_DYNAMIC="abrDynamic",this.ABR_STRATEGY_BOLA="abrBola",this.ABR_STRATEGY_L2A="abrL2A",this.ABR_STRATEGY_LoLP="abrLoLP",this.ABR_STRATEGY_THROUGHPUT="abrThroughput",this.ABR_FETCH_THROUGHPUT_CALCULATION_DOWNLOADED_DATA="abrFetchThroughputCalculationDownloadedData",this.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING="abrFetchThroughputCalculationMoofParsing",this.ABR_FETCH_THROUGHPUT_CALCULATION_AAST="abrFetchThroughputCalculationAAST",this.LIVE_CATCHUP_MODE_DEFAULT="liveCatchupModeDefault",this.LIVE_CATCHUP_MODE_LOLP="liveCatchupModeLoLP",this.MOVING_AVERAGE_SLIDING_WINDOW="slidingWindow",this.MOVING_AVERAGE_EWMA="ewma",this.BAD_ARGUMENT_ERROR="Invalid Arguments",this.MISSING_CONFIG_ERROR="Missing config parameter(s)",this.TRACK_SWITCH_MODE_ALWAYS_REPLACE="alwaysReplace",this.TRACK_SWITCH_MODE_NEVER_REPLACE="neverReplace",this.TRACK_SELECTION_MODE_FIRST_TRACK="firstTrack",this.TRACK_SELECTION_MODE_HIGHEST_BITRATE="highestBitrate",this.TRACK_SELECTION_MODE_HIGHEST_EFFICIENCY="highestEfficiency",this.TRACK_SELECTION_MODE_WIDEST_RANGE="widestRange",this.TRACK_SELECTION_MODE_HIGHEST_SELECTION_PRIORITY="highestSelectionPriority",this.CMCD_MODE_QUERY="query",this.CMCD_MODE_HEADER="header",this.INITIALIZE="initialize",this.TEXT_SHOWING="showing",this.TEXT_HIDDEN="hidden",this.TEXT_DISABLED="disabled",this.CC1="CC1",this.CC3="CC3",this.UTF8="utf-8",this.SCHEME_ID_URI="schemeIdUri",this.START_TIME="starttime",this.SERVICE_DESCRIPTION_DVB_LL_SCHEME="urn:dvb:dash:lowlatency:scope:2019",this.SUPPLEMENTAL_PROPERTY_DVB_LL_SCHEME="urn:dvb:dash:lowlatency:critical:2019",this.FONT_DOWNLOAD_DVB_SCHEME="urn:dvb:dash:fontdownload:2014",this.XML="XML",this.ARRAY_BUFFER="ArrayBuffer",this.DVB_REPORTING_URL="dvb:reportingUrl",this.DVB_PROBABILITY="dvb:probability",this.OFF_MIMETYPE="application/font-sfnt",this.WOFF_MIMETYPE="application/font-woff",this.VIDEO_ELEMENT_READY_STATES={HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4},this.FILE_LOADER_TYPES={FETCH:"fetch_loader",XHR:"xhr_loader"}}}])&&r(e.prototype,t),e}());t.Z=n},3860:function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}var t;return(t=[{key:"init",value:function(){this.TCP_CONNECTION="TcpList",this.HTTP_REQUEST="HttpList",this.TRACK_SWITCH="RepSwitchList",this.BUFFER_LEVEL="BufferLevel",this.BUFFER_LOADED="bufferLoaded",this.ABANDON_LOAD="abandonload",this.ALLOW_LOAD="allowload",this.BUFFER_EMPTY="bufferStalled",this.BUFFER_STATE="BufferState",this.DVR_INFO="DVRInfo",this.DROPPED_FRAMES="DroppedFrames",this.SCHEDULING_INFO="SchedulingInfo",this.REQUESTS_QUEUE="RequestsQueue",this.MANIFEST_UPDATE="ManifestUpdate",this.MANIFEST_UPDATE_STREAM_INFO="ManifestUpdatePeriodInfo",this.MANIFEST_UPDATE_TRACK_INFO="ManifestUpdateRepresentationInfo",this.PLAY_LIST="PlayList",this.DVB_ERRORS="DVBErrors",this.HTTP_REQUEST_DVB_REPORTING_TYPE="DVBReporting"}}])&&r(e.prototype,t),e}());t.Z=n},8080:function(e,t,r){r.d(t,{default:function(){return V}});var n=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mpdurl=null,this.errorcode=null,this.terror=null,this.url=null,this.ipaddress=null,this.servicelocation=null};n.SSL_CONNECTION_FAILED_PREFIX="SSL",n.DNS_RESOLUTION_FAILED="C00",n.HOST_UNREACHABLE="C01",n.CONNECTION_REFUSED="C02",n.CONNECTION_ERROR="C03",n.CORRUPT_MEDIA_ISOBMFF="M00",n.CORRUPT_MEDIA_OTHER="M01",n.BASE_URL_CHANGED="F00",n.BECAME_REPORTER="S00";var i=n,a=r(1180);function o(e){var t,r,n=(e=e||{}).eventBus,o=e.dashMetrics,s=e.metricsConstants,l=e.events;function u(e){var t=new i;if(r){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.mpdurl||(t.mpdurl=r.originalUrl||r.url),t.terror||(t.terror=new Date),o.addDVBErrors(t)}}function c(e){e.error||(r=e.manifest)}function f(e){u({errorcode:i.BASE_URL_CHANGED,servicelocation:e.entry})}function d(){u({errorcode:i.BECAME_REPORTER})}function h(e){var t;e.metric===s.HTTP_REQUEST&&(0===(t=e.value).responsecode||null==t.responsecode||t.responsecode>=400||t.responsecode<100||t.responsecode>=600)&&u({errorcode:t.responsecode||i.CONNECTION_ERROR,url:t.url,terror:t.tresponse,servicelocation:t._serviceLocation})}function g(e){var t;switch(e.error?e.error.code:0){case MediaError.MEDIA_ERR_NETWORK:t=i.CONNECTION_ERROR;break;case MediaError.MEDIA_ERR_DECODE:t=i.CORRUPT_MEDIA_OTHER;break;default:return}u({errorcode:t})}return t={initialize:function(){n.on(l.MANIFEST_UPDATED,c,t),n.on(l.SERVICE_LOCATION_BASE_URL_BLACKLIST_CHANGED,f,t),n.on(l.METRIC_ADDED,h,t),n.on(l.METRIC_UPDATED,h,t),n.on(l.PLAYBACK_ERROR,g,t),n.on(a.Z.BECAME_REPORTING_PLAYER,d,t)},reset:function(){n.off(l.MANIFEST_UPDATED,c,t),n.off(l.SERVICE_LOCATION_BASE_URL_BLACKLIST_CHANGED,f,t),n.off(l.METRIC_ADDED,h,t),n.off(l.METRIC_UPDATED,h,t),n.off(l.PLAYBACK_ERROR,g,t),n.off(a.Z.BECAME_REPORTING_PLAYER,d,t)}}}o.__dashjs_factory_name="DVBErrorsTranslator";var s=dashjs.FactoryMaker.getSingletonFactory(o),l=r(2295);function u(e){e=e||{};var t,r,n=!1,i=this.context,a=e.mediaElement;return t={initialize:function(e){e&&e.length&&(e.forEach((function(e){var t=e.starttime,n=t+e.duration;r.add(t,n)})),n=!!e[0]._useWallClockTime)},reset:function(){r.clear()},isEnabled:function(){var e,t=r.length;if(!t)return!0;e=n?(new Date).getTime()/1e3:a.currentTime;for(var i=0;i<t;i+=1){var o=r.start(i),s=r.end(i);if(o<=e&&e<s)return!0}return!1}},r=(0,l.Z)(i).create(),t}u.__dashjs_factory_name="RangeController";var c=dashjs.FactoryMaker.getClassFactory(u);function f(){return{serialise:function e(t){var r,n,i=[],a=[];for(r in t)if(t.hasOwnProperty(r)&&0!==r.indexOf("_")){if(null==(n=t[r])&&(n=""),Array.isArray(n)){if(!n.length)continue;a=[],n.forEach((function(t){var r="Object"!==Object.prototype.toString.call(t).slice(8,-1);a.push(r?t:e(t))})),n=a.map(encodeURIComponent).join(",")}else"string"==typeof n?n=encodeURIComponent(n):n instanceof Date?n=n.toISOString():"number"==typeof n&&(n=Math.round(n));i.push(r+"="+n)}return i.join("&")}}}f.__dashjs_factory_name="MetricSerialiser";var d=dashjs.FactoryMaker.getSingletonFactory(f);function h(){var e,t,r,n=window.crypto||window.msCrypto,i=Uint32Array,a=Math.pow(2,8*i.BYTES_PER_ELEMENT)-1;function o(){n&&(e||(e=new i(10)),n.getRandomValues(e),t=0)}return r={random:function(r,i){var s;return r||(r=0),i||(i=1),n?(t===e.length&&o(),s=e[t]/a,t+=1):s=Math.random(),s*(i-r)+r}},o(),r}h.__dashjs_factory_name="RNG";var g=dashjs.FactoryMaker.getSingletonFactory(h),m=r(5717);function p(e){var t;e=e||{};var r,n,i,a,o,s,l,u=this.context,c=[],f=e.metricsConstants;function h(){a=!1,o=!1,s=null,l=null}return t={report:function(e,t){Array.isArray(t)||(t=[t]),o&&l.isEnabled()&&t.forEach((function(t){var i=r.serialise(t);e!==f.DVB_ERRORS&&(i="metricname=".concat(e,"&").concat(i)),function(e,t,r){var i=new XMLHttpRequest;i.withCredentials=n.getXHRWithCredentialsForType(f.HTTP_REQUEST_DVB_REPORTING_TYPE);var a=function(){var e=c.indexOf(i);-1!==e&&(c.splice(e,1),!(i.status>=200&&i.status<300)&&r&&r())};c.push(i);try{i.open("GET",e),i.onloadend=a,i.onerror=a,i.send()}catch(o){i.onerror()}}(i="".concat(s,"?").concat(i),0,(function(){o=!1}))}))},initialize:function(e,t){var r;if(l=t,!(s=e.dvbReportingUrl))throw new Error("required parameter missing (dvb:reportingUrl)");a||((r=e.dvbProbability)&&(1e3===r||r/1e3>=i.random())&&(o=!0),a=!0)},reset:function(){h()}},r=d(u).getInstance(),i=g(u).getInstance(),n=(0,m.Z)(u).getInstance(),h(),t}p.__dashjs_factory_name="DVBReporting";var y=dashjs.FactoryMaker.getClassFactory(p);function E(e){e=e||{};var t,r={"urn:dvb:dash:reporting:2014":y},n=this.context,i=e.debug?e.debug.getLogger(t):{},a=e.metricsConstants,o=e.mediaPlayerModel||{};return{create:function(e,t){var s;try{(s=r[e.schemeIdUri](n).create({metricsConstants:a,mediaPlayerModel:o})).initialize(e,t)}catch(l){s=null,i.error("ReportingFactory: could not create Reporting with schemeIdUri ".concat(e.schemeIdUri," (").concat(l.message,")"))}return s},register:function(e,t){r[e]=t},unregister:function(e){delete r[e]}}}E.__dashjs_factory_name="ReportingFactory";var v=dashjs.FactoryMaker.getSingletonFactory(E);function T(e){var t=[],r=v(this.context).getInstance(e);return{initialize:function(e,n){e.some((function(e){var i=r.create(e,n);if(i)return t.push(i),!0}))},reset:function(){t.forEach((function(e){return e.reset()})),t=[]},report:function(e,r){t.forEach((function(t){return t.report(e,r)}))}}}T.__dashjs_factory_name="ReportingController";var _=dashjs.FactoryMaker.getClassFactory(T);function S(){return{reconstructFullMetricName:function(e,t,r){var n=e;return t&&(n+="("+t,r&&r.length&&(n+=","+r),n+=")"),n},validateN:function(e){if(!e)throw new Error("missing n");if(isNaN(e))throw new Error("n is NaN");if(e<0)throw new Error("n must be positive");return e}}}S.__dashjs_factory_name="HandlerHelpers";var A=dashjs.FactoryMaker.getSingletonFactory(S);function b(e){var t,r,n,i,a;e=e||{};var o=this.context,s=A(o).getInstance(),l=[],u=e.metricsConstants;function c(){var e=function(){try{return Object.keys(l).map((function(e){return l[e]})).reduce((function(e,t){return e.level<t.level?e:t}))}catch(e){return}}();e&&a!==e.t&&(a=e.t,t.report(n,e))}return{initialize:function(e,a,o){a&&(r=s.validateN(o),t=a,n=s.reconstructFullMetricName(e,o),i=setInterval(c,r))},reset:function(){clearInterval(i),i=null,r=0,t=null,a=null},handleNewMetric:function(e,t,r){e===u.BUFFER_LEVEL&&(l[r]=t)}}}b.__dashjs_factory_name="BufferLevelHandler";var R=dashjs.FactoryMaker.getClassFactory(b),I=dashjs.FactoryMaker.getClassFactory((function(e){var t,r=(e=e||{}).eventBus,n=e.metricsConstants;function i(){r.off(a.Z.METRICS_INITIALISATION_COMPLETE,i,this),r.trigger(a.Z.BECAME_REPORTING_PLAYER)}return{initialize:function(e,n){n&&(t=n,r.on(a.Z.METRICS_INITIALISATION_COMPLETE,i,this))},reset:function(){t=null},handleNewMetric:function(e,r){e===n.DVB_ERRORS&&t&&t.report(e,r)}}}));function w(e){var t,r,n,i,a;e=e||{};var o=[],s=A(this.context).getInstance(),l=e.metricsConstants;function u(){var e=o;e.length&&t&&t.report(i,e),o=[]}return{initialize:function(e,o,l,c){o&&(r=s.validateN(l),t=o,c&&c.length&&(n=c),i=s.reconstructFullMetricName(e,l,c),a=setInterval(u,r))},reset:function(){clearInterval(a),a=null,r=null,n=null,o=[],t=null},handleNewMetric:function(e,t){e===l.HTTP_REQUEST&&(n&&n!==t.type||o.push(t))}}}w.__dashjs_factory_name="HttpListHandler";var C=dashjs.FactoryMaker.getClassFactory(w);function D(){var e,t;return{initialize:function(r,n){e=r,t=n},reset:function(){t=null,e=void 0},handleNewMetric:function(r,n){r===e&&t&&t.report(e,n)}}}D.__dashjs_factory_name="GenericMetricHandler";var L=dashjs.FactoryMaker.getClassFactory(D);function N(e){var t,r=(e=e||{}).debug?e.debug.getLogger(t):{},n=/([a-zA-Z]*)(\(([0-9]*)(\,\s*([a-zA-Z]*))?\))?/,i=this.context,a={BufferLevel:R,DVBErrors:I,HttpList:C,PlayList:L,RepSwitchList:L,TcpList:L};return{create:function(t,o){var s,l=t.match(n);if(l){try{(s=a[l[1]](i).create({eventBus:e.eventBus,metricsConstants:e.metricsConstants})).initialize(l[1],o,l[3],l[5])}catch(u){s=null,r.error("MetricsHandlerFactory: Could not create handler for type ".concat(l[1]," with args ").concat(l[3],", ").concat(l[5]," (").concat(u.message,")"))}return s}},register:function(e,t){a[e]=t},unregister:function(e){delete a[e]}}}N.__dashjs_factory_name="MetricsHandlerFactory";var O=dashjs.FactoryMaker.getSingletonFactory(N);function M(e){e=e||{};var t,r=[],n=this.context,i=e.eventBus,a=e.events,o=O(n).getInstance({debug:e.debug,eventBus:e.eventBus,metricsConstants:e.metricsConstants});function s(e){r.forEach((function(t){t.handleNewMetric(e.metric,e.value,e.mediaType)}))}return t={initialize:function(e,n){e.split(",").forEach((function(e,t,i){var a;if(-1!==e.indexOf("(")&&-1===e.indexOf(")")){var s=i[t+1];s&&-1===s.indexOf("(")&&-1!==s.indexOf(")")&&(e+=","+s,delete i[t+1])}(a=o.create(e,n))&&r.push(a)})),i.on(a.METRIC_ADDED,s,t),i.on(a.METRIC_UPDATED,s,t)},reset:function(){i.off(a.METRIC_ADDED,s,t),i.off(a.METRIC_UPDATED,s,t),r.forEach((function(e){return e.reset()})),r=[]}}}M.__dashjs_factory_name="MetricsHandlersController";var P=dashjs.FactoryMaker.getClassFactory(M);function k(e){var t,r,n;e=e||{};var i=this.context;function a(){t&&t.reset(),r&&r.reset(),n&&n.reset()}return{initialize:function(o){try{(n=c(i).create({mediaElement:e.mediaElement})).initialize(o.Range),(r=_(i).create({debug:e.debug,metricsConstants:e.metricsConstants,mediaPlayerModel:e.mediaPlayerModel})).initialize(o.Reporting,n),(t=P(i).create({debug:e.debug,eventBus:e.eventBus,metricsConstants:e.metricsConstants,events:e.events})).initialize(o.metrics,r)}catch(s){throw a(),s}},reset:a}}k.__dashjs_factory_name="MetricsController";var x=dashjs.FactoryMaker.getClassFactory(k),F=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.metrics="",this.Range=[],this.Reporting=[]},U=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.starttime=0,this.duration=1/0,this._useWallClockTime=!1},B=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.schemeIdUri="",this.value="",this.dvbReportingUrl="",this.dvbProbability=1e3};function Z(e){var t=(e=e||{}).adapter,r=e.constants;return{getMetrics:function(e){var n=[];return e&&e.Metrics_asArray&&e.Metrics_asArray.forEach((function(i){var a=new F,o=t.getIsDynamic(e);i.hasOwnProperty("metrics")&&(a.metrics=i.metrics,i.Range_asArray&&i.Range_asArray.forEach((function(n){var i,s,l,u,c,f=new U;f.starttime=(i=e,s=n,c=0,o?c=t.getAvailabilityStartTime(i)/1e3:(l=t.getRegularPeriods(i)).length&&(c=l[0].start),u=c,s&&s.hasOwnProperty(r.START_TIME)&&(u+=s.starttime),u),n.hasOwnProperty("duration")?f.duration=n.duration:f.duration=t.getDuration(e),f._useWallClockTime=o,a.Range.push(f)})),i.Reporting_asArray&&(i.Reporting_asArray.forEach((function(e){var t=new B;e.hasOwnProperty(r.SCHEME_ID_URI)&&(t.schemeIdUri=e.schemeIdUri,e.hasOwnProperty("value")&&(t.value=e.value),e.hasOwnProperty(r.DVB_REPORTING_URL)&&(t.dvbReportingUrl=e[r.DVB_REPORTING_URL]),e.hasOwnProperty(r.DVB_PROBABILITY)&&(t.dvbProbability=e[r.DVB_PROBABILITY]),a.Reporting.push(t))})),n.push(a)))})),n}}}Z.__dashjs_factory_name="ManifestParsing";var G=dashjs.FactoryMaker.getSingletonFactory(Z);function H(e){var t;e=e||{};var r={},n=this.context,i=e.eventBus,o=e.events;function s(t){if(!t.error){var o=Object.keys(r);G(n).getInstance({adapter:e.adapter,constants:e.constants}).getMetrics(t.manifest).forEach((function(t){var i=JSON.stringify(t);if(r.hasOwnProperty(i))o.splice(i,1);else try{var a=x(n).create(e);a.initialize(t),r[i]=a}catch(s){}})),o.forEach((function(e){r[e].reset(),delete r[e]})),i.trigger(a.Z.METRICS_INITIALISATION_COMPLETE)}}function l(){Object.keys(r).forEach((function(e){r[e].reset()})),r={}}return t={reset:function(){i.off(o.MANIFEST_UPDATED,s,t),i.off(o.STREAM_TEARDOWN_COMPLETE,l,t)}},i.on(o.MANIFEST_UPDATED,s,t),i.on(o.STREAM_TEARDOWN_COMPLETE,l,t),t}H.__dashjs_factory_name="MetricsCollectionController";var K=dashjs.FactoryMaker.getClassFactory(H);function Y(){var e=this.context;return{createMetricsReporting:function(t){return s(e).getInstance({eventBus:t.eventBus,dashMetrics:t.dashMetrics,metricsConstants:t.metricsConstants,events:t.events}).initialize(),K(e).create(t)},getReportingFactory:function(){return v(e).getInstance()},getMetricsHandlerFactory:function(){return O(e).getInstance()}}}Y.__dashjs_factory_name="MetricsReporting";var q=dashjs.FactoryMaker.getClassFactory(Y);q.events=a.Z,dashjs.FactoryMaker.updateClassFactory(Y.__dashjs_factory_name,q);var V=q},1180:function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var s=new(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(s,e);var t,r,n=(t=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=o(t);if(r){var i=o(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return a(this,e)});function s(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(e=n.call(this)).METRICS_INITIALISATION_COMPLETE="internal_metricsReportingInitialized",e.BECAME_REPORTING_PLAYER="internal_becameReportingPlayer",e.CMCD_DATA_GENERATED="cmcdDataGenerated",e}return s}(r(8342).Z));t.Z=s},5717:function(e,t,r){var n=r(2610),i=r(5448),a=r(1264),o=r(3106),s=r(1767),l=r(3393);function u(){var e,t,r,i,u,c,f,d,h=this.context,g=(0,a.Z)(h).getInstance();function m(){i=[],u=[],c=[],d=[],f=null,t=[]}function p(e,t){var r=-1;e.some((function(e,n){if(e===t)return r=n,!0})),r<0||e.splice(r,1)}function y(e){var t;for(t=0;t<d.length;t++)if(d[t].rulename===e)return t;return-1}function E(e,r){v(e,r);var i=new n.Z;i.schemeIdUri=e,i.value=r,t.push(i)}function v(e,r){(0,o.PS)(e,"string"),(0,o.PS)(r,"string"),t.forEach((function(n,i){n.schemeIdUri===e&&n.value===r&&t.splice(i,1)}))}return e={getCustomInitialTrackSelectionFunction:function(){return f},setCustomInitialTrackSelectionFunction:function(e){f=e},resetCustomInitialTrackSelectionFunction:function(){f=null},getLicenseResponseFilters:function(){return u},getLicenseRequestFilters:function(){return i},getCustomCapabilitiesFilters:function(){return c},registerCustomCapabilitiesFilter:function(e){c.push(e)},registerLicenseResponseFilter:function(e){u.push(e)},registerLicenseRequestFilter:function(e){i.push(e)},unregisterCustomCapabilitiesFilter:function(e){p(c,e)},unregisterLicenseResponseFilter:function(e){p(u,e)},unregisterLicenseRequestFilter:function(e){p(i,e)},addAbrCustomRule:function(e,t,r){if("string"!=typeof e||e!==s.Z.ABANDON_FRAGMENT_RULES&&e!==s.Z.QUALITY_SWITCH_RULES||"string"!=typeof t)throw l.Z.BAD_ARGUMENT_ERROR;var n=y(t);-1===n?d.push({type:e,rulename:t,rule:r}):(d[n].type=e,d[n].rule=r)},removeAllAbrCustomRule:function(){d=[]},removeAbrCustomRule:function(e){if(e){var t=y(e);-1!==t&&d.splice(t,1)}else d=[]},getAbrCustomRules:function(){return d},addUTCTimingSource:E,removeUTCTimingSource:v,getUTCTimingSources:function(){return t},clearDefaultUTCTimingSources:function(){t=[]},restoreDefaultUTCTimingSources:function(){var e=g.get().streaming.utcSynchronization.defaultTimingSource;E(e.scheme,e.value)},setXHRWithCredentialsForType:function e(t,n){t?r[t]=!!n:Object.keys(r).forEach((function(t){e(t,n)}))},getXHRWithCredentialsForType:function(e){var t=r[e];return void 0===t?r.default:t},setConfig:function(){},reset:function(){m()}},r={default:!1},m(),e}u.__dashjs_factory_name="CustomParametersModel",t.Z=i.Z.getSingletonFactory(u)},9032:function(e,t,r){var n=r(5448),i=r(7473);function a(e){var t=(e=e||{}).requestModifier;function r(e){var r=new Date,n=e.request,i=new XMLHttpRequest;if(i.open(e.method,e.url,!0),n.responseType&&(i.responseType=n.responseType),n.range&&i.setRequestHeader("Range","bytes="+n.range),n.requestStartDate||(n.requestStartDate=r),t&&t.modifyRequestHeader&&(i=t.modifyRequestHeader(i,{url:e.url})),e.headers)for(var a in e.headers){var o=e.headers[a];o&&i.setRequestHeader(a,o)}i.withCredentials=e.withCredentials,i.onload=e.onload,i.onloadend=e.onend,i.onerror=e.onerror,i.onprogress=e.progress,i.onabort=e.onabort,i.ontimeout=e.ontimeout,i.timeout=e.timeout,i.send(),e.response=i}return{load:function(e){t&&t.modifyRequest?(0,i.k)(e,t).then((function(){return r(e)})):r(e)},abort:function(e){var t=e.response;t.onloadend=t.onerror=t.onprogress=void 0,t.abort()}}}a.__dashjs_factory_name="XHRLoader";var o=n.Z.getClassFactory(a);t.Z=o},1737:function(e,t,r){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}r.d(t,{default:function(){return Ae}});var i={attributes:["Laurl","laurl"],prefixes:["clearkey","dashif"]},a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t;return(t=[{key:"findCencContentProtection",value:function(e){for(var t=null,r=0;r<e.length;++r){var n=e[r];"urn:mpeg:dash:mp4protection:2011"!==n.schemeIdUri.toLowerCase()||"cenc"!==n.value.toLowerCase()&&"cbcs"!==n.value.toLowerCase()||(t=n)}return t}},{key:"getPSSHData",value:function(e){var t=8,r=new DataView(e),n=r.getUint8(t);return t+=20,n>0&&(t+=4+16*r.getUint32(t)),t+=4,e.slice(t)}},{key:"getPSSHForKeySystem",value:function(t,r){var n=e.parsePSSHList(r);return t&&n.hasOwnProperty(t.uuid.toLowerCase())?n[t.uuid.toLowerCase()]:null}},{key:"parseInitDataFromContentProtection",value:function(e,t){return"pssh"in e?(e.pssh.__text=e.pssh.__text.replace(/\r?\n|\r/g,"").replace(/\s+/g,""),t.decodeArray(e.pssh.__text).buffer):null}},{key:"parsePSSHList",value:function(e){if(null==e)return[];for(var t=new DataView(e.buffer||e),r={},n=0;;){var i,a,o=void 0,s=n;if(n>=t.buffer.byteLength)break;if(i=n+t.getUint32(n),n+=4,1886614376===t.getUint32(n))if(n+=4,0===(a=t.getUint8(n))||1===a){n++,n+=3,o="";var l=void 0,u=void 0;for(l=0;l<4;l++)o+=1===(u=t.getUint8(n+l).toString(16)).length?"0"+u:u;for(n+=4,o+="-",l=0;l<2;l++)o+=1===(u=t.getUint8(n+l).toString(16)).length?"0"+u:u;for(n+=2,o+="-",l=0;l<2;l++)o+=1===(u=t.getUint8(n+l).toString(16)).length?"0"+u:u;for(n+=2,o+="-",l=0;l<2;l++)o+=1===(u=t.getUint8(n+l).toString(16)).length?"0"+u:u;for(n+=2,o+="-",l=0;l<6;l++)o+=1===(u=t.getUint8(n+l).toString(16)).length?"0"+u:u;n+=6,n+=4,r[o=o.toLowerCase()]=t.buffer.slice(s,i),n=i}else n=i;else n=i}return r}},{key:"getLicenseServerUrlFromMediaInfo",value:function(e,t){try{if(!e||0===e.length)return null;for(var r=0,n=null;r<e.length&&!n;){var a=e[r];if(a&&a.contentProtection&&a.contentProtection.length>0){var o=a.contentProtection.filter((function(e){return e.schemeIdUri&&e.schemeIdUri===t}));if(o&&o.length>0)for(var s=0;s<o.length&&!n;){for(var l=o[s],u=0;u<i.attributes.length&&!n;){for(var c=0,f=i.attributes[u];c<i.prefixes.length&&!n;){var d=i.prefixes[c];l[f]&&l[f].__prefix&&l[f].__prefix===d&&l[f].__text&&(n=l[f].__text),c+=1}u+=1}s+=1}}r+=1}return n}catch(h){return null}}}])&&n(e,t),e}(),o=function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.contentType=t,this.robustness=r},s=function e(t,r,n,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.initDataTypes=["cenc"],t&&t.length&&(this.audioCapabilities=t),r&&r.length&&(this.videoCapabilities=r),this.distinctiveIdentifier=n,this.persistentState=i,this.sessionTypes=a};function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var d=new(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=f(t);if(r){var i=f(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return c(this,e)});function i(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(e=n.call(this)).MEDIA_KEYERR_CODE=100,e.MEDIA_KEYERR_UNKNOWN_CODE=101,e.MEDIA_KEYERR_CLIENT_CODE=102,e.MEDIA_KEYERR_SERVICE_CODE=103,e.MEDIA_KEYERR_OUTPUT_CODE=104,e.MEDIA_KEYERR_HARDWARECHANGE_CODE=105,e.MEDIA_KEYERR_DOMAIN_CODE=106,e.MEDIA_KEY_MESSAGE_ERROR_CODE=107,e.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_CODE=108,e.SERVER_CERTIFICATE_UPDATED_ERROR_CODE=109,e.KEY_STATUS_CHANGED_EXPIRED_ERROR_CODE=110,e.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_CODE=111,e.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE=112,e.KEY_SESSION_CREATED_ERROR_CODE=113,e.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE=114,e.MEDIA_KEYERR_UNKNOWN_MESSAGE="An unspecified error occurred. This value is used for errors that don't match any of the other codes.",e.MEDIA_KEYERR_CLIENT_MESSAGE="The Key System could not be installed or updated.",e.MEDIA_KEYERR_SERVICE_MESSAGE="The message passed into update indicated an error from the license service.",e.MEDIA_KEYERR_OUTPUT_MESSAGE="There is no available output device with the required characteristics for the content protection system.",e.MEDIA_KEYERR_HARDWARECHANGE_MESSAGE="A hardware configuration change caused a content protection error.",e.MEDIA_KEYERR_DOMAIN_MESSAGE="An error occurred in a multi-device domain licensing configuration. The most common error is a failure to join the domain.",e.MEDIA_KEY_MESSAGE_ERROR_MESSAGE="Multiple key sessions were creates with a user-agent that does not support sessionIDs!! Unpredictable behavior ahead!",e.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_MESSAGE="DRM: Empty key message from CDM",e.SERVER_CERTIFICATE_UPDATED_ERROR_MESSAGE="Error updating server certificate -- ",e.KEY_STATUS_CHANGED_EXPIRED_ERROR_MESSAGE="DRM: KeyStatusChange error! -- License has expired",e.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_MESSAGE="DRM: No license server URL specified!",e.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE="DRM: KeySystem Access Denied! -- ",e.KEY_SESSION_CREATED_ERROR_MESSAGE="DRM: unable to create session! --",e.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE="DRM: licenser error! --",e}return i}(r(2230).Z)),h=r(5459),g=function e(t,r,n,i,a,o,s,l){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t,this.method=r,this.responseType=n,this.headers=i,this.withCredentials=a,this.messageType=o,this.sessionId=s,this.data=l},m=function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t,this.headers=r,this.data=n},p=r(7855),y=r(703),E=r(3393),v=r(5448);function T(e){return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _(e){var t,r,n,i,l,u,c,f,v,_,S,A=(e=e||{}).protectionKeyController,b=e.protectionModel,R=e.eventBus,I=e.events,w=e.debug,C=e.BASE64,D=e.constants,L=[],N=e.cmcdModel,O=e.settings,M=e.customParametersModel;function P(){if(!(R&&R.hasOwnProperty("on")&&A&&A.hasOwnProperty("getSupportedKeySystemsFromContentProtection")))throw new Error("Missing config parameter(s)")}function k(e,t){f||v?f&&x():function(e,t){if(!v){v=!0;var n,i=[];e=e.sort((function(t,r){return(l&&l[t.ks.systemString]&&l[t.ks.systemString].priority>=0?l[t.ks.systemString].priority:e.length)-(l&&l[r.ks.systemString]&&l[r.ks.systemString].priority>=0?l[r.ks.systemString].priority:e.length)}));for(var a=0;a<e.length;a++){var o=K(e[a]);i.push({ks:e[a].ks,configs:[o],protData:e[a].protData})}b.requestKeySystemAccess(i).then((function(e){var t=(n=e.data).mksa&&n.mksa.selectedSystemString?n.mksa.selectedSystemString:n.keySystem.systemString;return r.info("DRM: KeySystem Access Granted for system string ("+t+")!  Selecting key system..."),b.selectKeySystem(n)})).then((function(e){if(f=e,v=!1,b){R.trigger(I.KEY_SYSTEM_SELECTED,{data:n});var t=Z(f);t&&t.serverCertificate&&t.serverCertificate.length>0&&b.setServerCertificate(C.decodeArray(t.serverCertificate).buffer),x()}})).catch((function(e){f=null,v=!1,t||R.trigger(I.KEY_SYSTEM_SELECTED,{data:null,error:new h.Z(d.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE,d.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE+"Error selecting key system! -- "+e.error)})}))}}(e,t)}function x(){for(var e,t=0;t<n.length;t++)for(e=0;e<n[t].length;e++)if(f===n[t][e].ks){F(n[t][e]);break}n=[]}function F(e){if(A.isClearKey(f)&&e.protData&&e.protData.hasOwnProperty("clearkeys")&&0!==Object.keys(e.protData.clearkeys).length){var t={kids:Object.keys(e.protData.clearkeys)};e.initData=(new TextEncoder).encode(JSON.stringify(t))}e.sessionId?U(e):null!==e.initData&&B(e)}function U(e){P(),b.loadKeySession(e)}function B(e){var t=a.getPSSHForKeySystem(f,e?e.initData:null);if(t){if(function(e){if(!e)return!1;try{for(var t=b.getSessions(),r=0;r<t.length;r++)if(t[r].getKeyId()===e)return!0;return!1}catch(n){return!1}}(e.keyId))return;if(G(t))return;try{e.initData=t,b.createKeySession(e)}catch(r){R.trigger(I.KEY_SESSION_CREATED,{data:null,error:new h.Z(d.KEY_SESSION_CREATED_ERROR_CODE,d.KEY_SESSION_CREATED_ERROR_MESSAGE+r.message)})}}else e&&e.initData?b.createKeySession(e):R.trigger(I.KEY_SESSION_CREATED,{data:null,error:new h.Z(d.KEY_SESSION_CREATED_ERROR_CODE,d.KEY_SESSION_CREATED_ERROR_MESSAGE+"Selected key system is "+(f?f.systemString:null)+".  needkey/encrypted event contains no initData corresponding to that key system!")})}function Z(e){if(e){var t=e.systemString;if(l)return t in l?l[t]:null}return null}function G(e){if(!e)return!1;try{for(var t=b.getAllInitData(),n=0;n<t.length;n++)if(A.initDataEquals(e,t[n]))return r.debug("DRM: Ignoring initData because we have already seen it!"),!0;return!1}catch(i){return!1}}function H(e){P(),e?(b.setMediaElement(e),R.on(I.NEED_KEY,Q,t)):null===e&&(b.setMediaElement(e),R.off(I.NEED_KEY,Q,t))}function K(e){var t=e.protData,r=[],n=[],a=t&&t.audioRobustness&&t.audioRobustness.length>0?t.audioRobustness:c,l=t&&t.videoRobustness&&t.videoRobustness.length>0?t.videoRobustness:c,u=e.sessionType,f=t&&t.distinctiveIdentifier?t.distinctiveIdentifier:"optional",d=t&&t.persistentState?t.persistentState:"temporary"===u?"optional":"required";return i.forEach((function(e){e.type===D.AUDIO?r.push(new o(e.codec,a)):e.type===D.VIDEO&&n.push(new o(e.codec,l))})),new s(r,n,f,d,[u])}function Y(e){e.error?R.trigger(I.KEY_STATUSES_CHANGED,{data:null,error:e.error}):r.debug("DRM: key status = "+e.status)}function q(e){r.debug("DRM: onKeyMessage");var t=e.data;R.trigger(I.KEY_MESSAGE,{data:t});var n=t.messageType?t.messageType:"license-request",o=t.message,s=t.sessionToken,l=Z(f),u=A.getLicenseServerModelInstance(f,l,n),c={sessionToken:s,messageType:n};if(o&&0!==o.byteLength){if(!u)return r.debug("DRM: License server request not required for this message (type = "+e.data.messageType+").  Session ID = "+s.getSessionId()),void V(c);if(A.isClearKey(f)){var E=A.processClearKeyLicenseRequest(f,l,o);if(E&&E.keyPairs&&E.keyPairs.length>0)return r.debug("DRM: ClearKey license request handled by application!"),V(c),void b.updateKeySession(s,E)}!function(e,t,r){var n=e.sessionToken,o=e.messageType?e.messageType:"license-request",s={sessionToken:n,messageType:o},l=f?f.systemString:null,u=function(e,t,r,n,o){var s=null,l=n.message;if(e&&e.serverURL){var u=e.serverURL;"string"==typeof u&&""!==u?s=u:"object"===T(u)&&u.hasOwnProperty(t)&&(s=u[t])}else if(e&&e.laURL&&""!==e.laURL)s=e.laURL;else if(!(s=a.getLicenseServerUrlFromMediaInfo(i,f.schemeIdURI))&&!A.isClearKey(f)){var c=a.getPSSHData(r.initData);(s=f.getLicenseServerURLFromInitData(c))||(s=n.laURL)}return o.getServerURLFromMessage(s,l,t)}(r,o,n,e,t);if(u){var c={},E=!1;r&&z(c,r.httpRequestHeaders);var v=e.message;z(c,f.getRequestHeadersFromMessage(v)),Object.keys(c).forEach((function(e){"authorization"===e.toLowerCase()&&(E=!0)})),r&&"boolean"==typeof r.withCredentials&&(E=r.withCredentials);var _=function(e){if(b)if(e.status>=200&&e.status<=299){var r=y.Z.parseHttpHeaders(e.getAllResponseHeaders?e.getAllResponseHeaders():null),i=new m(e.responseURL,r,e.response);X(M.getLicenseResponseFilters(),i).then((function(){var r=t.getLicenseMessage(i.data,l,o);null!==r?(V(s),b.updateKeySession(n,r)):W(e,s,l,o,t)}))}else W(e,s,l,o,t)},S=function(e){V(s,new h.Z(d.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,d.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+l+' update, XHR aborted. status is "'+e.statusText+'" ('+e.status+"), readyState is "+e.readyState))},R=function(e){V(s,new h.Z(d.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,d.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+l+' update, XHR error. status is "'+e.statusText+'" ('+e.status+"), readyState is "+e.readyState))},I=f.getLicenseRequestFromMessage(v),w=t.getHTTPMethod(o),C=t.getResponseType(l,o),D=r&&!isNaN(r.httpTimeout)?r.httpTimeout:8e3,L=n.getSessionId()||null,N=new g(u,w,C,c,E,o,L,I),P=isNaN(O.get().streaming.retryAttempts[p.w.LICENSE])?3:O.get().streaming.retryAttempts[p.w.LICENSE];X(M.getLicenseRequestFilters(),N).then((function(){j(N,P,D,_,S,R)}))}else V(s,new h.Z(d.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_CODE,d.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_MESSAGE))}(t,u,l)}else V(c,new h.Z(d.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_CODE,d.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_MESSAGE))}function V(e,t){R.trigger(I.LICENSE_REQUEST_COMPLETE,{data:e,error:t})}function j(e,t,n,i,a,o){var s=new XMLHttpRequest;if(O.get().streaming.cmcd&&O.get().streaming.cmcd.enabled&&O.get().streaming.cmcd.mode===E.Z.CMCD_MODE_QUERY){var l=N.getQueryParameter({url:e.url,type:p.w.LICENSE});l&&(e.url=y.Z.addAditionalQueryParameterToUrl(e.url,[l]))}for(var u in s.open(e.method,e.url,!0),s.responseType=e.responseType,s.withCredentials=e.withCredentials,n>0&&(s.timeout=n),e.headers)s.setRequestHeader(u,e.headers[u]);if(O.get().streaming.cmcd&&O.get().streaming.cmcd.enabled&&O.get().streaming.cmcd.mode===E.Z.CMCD_MODE_HEADER){var c=N.getHeaderParameters({url:e.url,type:p.w.LICENSE});if(c)for(var f in c){var d=c[f];d&&s.setRequestHeader(f,d)}}var h=function(){t--;var r=isNaN(O.get().streaming.retryIntervals[p.w.LICENSE])?1e3:O.get().streaming.retryIntervals[p.w.LICENSE];S=setTimeout((function(){j(e,t,n,i,a,o)}),r)};s.onload=function(){_=null,this.status>=200&&this.status<=299||t<=0?i(this):(r.warn("License request failed ("+this.status+"). Retrying it... Pending retries: "+t),h())},s.ontimeout=s.onerror=function(){_=null,t<=0?o(this):(r.warn("License request network request failed . Retrying it... Pending retries: "+t),h())},s.onabort=function(){a(this)},R.trigger(I.LICENSE_REQUEST_SENDING,{url:e.url,headers:e.headers,payload:e.data,sessionId:e.sessionId}),_=s,s.send(e.data)}function $(){_&&(_.onloadend=_.onerror=_.onprogress=void 0,_.abort(),_=null),S&&(clearTimeout(S),S=null)}function z(e,t){if(t)for(var r in t)e[r]=t[r]}function W(e,t,r,n,i){var a="NONE",o=null;e.response&&(a=i.getErrorResponse(e.response,r,n),o={serverResponse:e.response||null,responseCode:e.status||null,responseText:e.statusText||null}),V(t,new h.Z(d.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,d.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+r+' update, XHR complete. status is "'+e.statusText+'" ('+e.status+"), readyState is "+e.readyState+".  Response is "+a,o))}function X(e,t){return e?e.reduce((function(e,r){return e.then((function(){return r(t)}))}),Promise.resolve()):Promise.resolve()}function Q(e,t){if(!O.get().streaming.protection.ignoreEmeEncryptedEvent){if(r.debug("DRM: onNeedKey"),"cenc"!==e.key.initDataType)return void r.warn("DRM:  Only 'cenc' initData is supported!  Ignoring initData of type: "+e.key.initDataType);if(0===i.length&&(r.warn("DRM: onNeedKey called before initializeForMedia, wait until initialized"),(t=void 0===t?1:t+1)<5))return void L.push(setTimeout((function(){Q(e,t)}),500));var o=e.key.initData;if(ArrayBuffer.isView(o)&&(o=o.buffer),f){var s=a.getPSSHForKeySystem(f,o);if(s&&G(s))return}r.debug("DRM: initData:",String.fromCharCode.apply(null,new Uint8Array(o)));var c=A.getSupportedKeySystemsFromSegmentPssh(o,l,u);if(0===c.length)return void r.debug("DRM: Received needkey event with initData, but we don't support any of the key systems!");d=c,n.push(d),k(d,!1)}var d}return t={initializeForMedia:function(e){if(!e)throw new Error("mediaInfo can not be null or undefined");P(),i.push(e)},clearMediaInfoArray:function(){i=[]},handleKeySystemFromManifest:function(){if(i&&0!==i.length){var e=[];i.forEach((function(t){var r=A.getSupportedKeySystemsFromContentProtection(t.contentProtection,l,u);r.length>0&&(0===e.length&&(e=r),n.push(r))})),e&&e.length>0&&k(e,!0)}},createKeySession:B,loadKeySession:U,removeKeySession:function(e){P(),b.removeKeySession(e)},closeKeySession:function(e){P(),b.closeKeySession(e)},setServerCertificate:function(e){P(),b.setServerCertificate(e)},setMediaElement:H,setSessionType:function(e){u=e},setRobustnessLevel:function(e){c=e},setProtectionData:function(e){l=e,A.setProtectionData(e)},getSupportedKeySystemsFromContentProtection:function(e){return P(),A.getSupportedKeySystemsFromContentProtection(e,l,u)},getKeySystems:function(){return A?A.getKeySystems():[]},setKeySystems:function(e){A&&A.setKeySystems(e)},stop:function(){$(),b&&b.stop()},reset:function(){R.off(I.INTERNAL_KEY_MESSAGE,q,t),R.off(I.INTERNAL_KEY_STATUS_CHANGED,Y,t),P(),$(),H(null),f=null,v=!1,b&&(b.reset(),b=null),L.forEach((function(e){return clearTimeout(e)})),L=[],i=[],n=[]}},r=w.getLogger(t),n=[],i=[],u="temporary",c="",_=null,S=null,R.on(I.INTERNAL_KEY_MESSAGE,q,t),R.on(I.INTERNAL_KEY_STATUS_CHANGED,Y,t),t}_.__dashjs_factory_name="ProtectionController";var S=v.Z.getClassFactory(_),A=function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.keyID=t,this.key=r};function b(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var R=function(){function e(t,r){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r&&"persistent"!==r&&"temporary"!==r)throw new Error("Invalid ClearKey key set type!  Must be one of 'persistent' or 'temporary'");this.keyPairs=t,this.type=r}var t;return(t=[{key:"toJWK",value:function(){var e,t=this.keyPairs.length,r={keys:[]};for(e=0;e<t;e++){var n={kty:"oct",alg:"A128KW",kid:this.keyPairs[e].keyID,k:this.keyPairs[e].key};r.keys.push(n)}this.type&&(r.type=this.type);var i=JSON.stringify(r),a=i.length,o=new ArrayBuffer(a),s=new Uint8Array(o);for(e=0;e<a;e++)s[e]=i.charCodeAt(e);return o}}])&&b(e.prototype,t),e}();function I(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var w=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}var t;return(t=[{key:"init",value:function(){this.CLEARKEY_KEYSTEM_STRING="org.w3.clearkey",this.WIDEVINE_KEYSTEM_STRING="com.widevine.alpha",this.PLAYREADY_KEYSTEM_STRING="com.microsoft.playready",this.PLAYREADY_RECOMMENDATION_KEYSTEM_STRING="com.microsoft.playready.recommendation",this.INITIALIZATION_DATA_TYPE_CENC="cenc",this.INITIALIZATION_DATA_TYPE_KEYIDS="keyids",this.INITIALIZATION_DATA_TYPE_WEBM="webm"}}])&&I(e.prototype,t),e}()),C="e2719d58-a985-b3c9-781a-b030af78d30e",D=w.CLEARKEY_KEYSTEM_STRING,L="urn:uuid:"+C;function N(e){var t=(e=e||{}).BASE64;return{uuid:C,schemeIdURI:L,systemString:D,getInitData:function(e,r){try{var n=a.parseInitDataFromContentProtection(e,t);if(!n&&r){var i={kids:[function(e){try{var t=e.replace(/-/g,"");return(t=btoa(t.match(/\w{2}/g).map((function(e){return String.fromCharCode(parseInt(e,16))})).join(""))).replace(/=/g,"").replace(/\//g,"_").replace(/\+/g,"-")}catch(r){return null}}(r["cenc:default_KID"])]};n=(new TextEncoder).encode(JSON.stringify(i))}return n}catch(o){return null}},getRequestHeadersFromMessage:function(){return{"Content-Type":"application/json"}},getLicenseRequestFromMessage:function(e){return JSON.stringify(JSON.parse(String.fromCharCode.apply(null,new Uint8Array(e))))},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null},getClearKeysFromProtectionData:function(e,t){var r=null;if(e){for(var n=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(t))),i=[],a=0;a<n.kids.length;a++){var o=n.kids[a],s=e.clearkeys&&e.clearkeys.hasOwnProperty(o)?e.clearkeys[o]:null;if(!s)throw new Error("DRM: ClearKey keyID ("+o+") is not known!");i.push(new A(o,s))}r=new R(i)}return r}}}N.__dashjs_factory_name="KeySystemClearKey";var O=dashjs.FactoryMaker.getSingletonFactory(N),M="1077efec-c0b2-4d02-ace3-3c1e52e2fb4b",P=w.CLEARKEY_KEYSTEM_STRING,k="urn:uuid:"+M;function x(e){var t,r=e.BASE64,n=e.debug.getLogger(t);return{uuid:M,schemeIdURI:k,systemString:P,getInitData:function(e){return a.parseInitDataFromContentProtection(e,r)},getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(e){return new Uint8Array(e)},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null},getClearKeysFromProtectionData:function(e,t){var r=null;if(e){for(var i=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(t))),a=[],o=0;o<i.kids.length;o++){var s=i.kids[o],l=e.clearkeys&&e.clearkeys.hasOwnProperty(s)?e.clearkeys[s]:null;if(!l)throw new Error("DRM: ClearKey keyID ("+s+") is not known!");a.push(new A(s,l))}r=new R(a),n.warn("ClearKey schemeIdURI is using W3C Common PSSH systemID (1077efec-c0b2-4d02-ace3-3c1e52e2fb4b) in Content Protection. See DASH-IF IOP v4.1 section 7.6.2.4")}return r}}}x.__dashjs_factory_name="KeySystemW3CClearKey";var F=dashjs.FactoryMaker.getSingletonFactory(x),U="edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",B=w.WIDEVINE_KEYSTEM_STRING,Z="urn:uuid:"+U;function G(e){var t=(e=e||{}).BASE64;return{uuid:U,schemeIdURI:Z,systemString:B,getInitData:function(e){return a.parseInitDataFromContentProtection(e,t)},getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(e){return new Uint8Array(e)},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null}}}G.__dashjs_factory_name="KeySystemWidevine";var H=dashjs.FactoryMaker.getSingletonFactory(G),K="9a04f079-9840-4286-ab92-e65be0885f95",Y=w.PLAYREADY_KEYSTEM_STRING,q="urn:uuid:"+K;function V(e){var t="utf-16",r=(e=e||{}).BASE64,n=e.settings;function i(){if(!r||!r.hasOwnProperty("decodeArray")||!r.hasOwnProperty("decodeArray"))throw new Error("Missing config parameter(s)")}return{uuid:K,schemeIdURI:q,systemString:Y,getInitData:function(e){var t,n,o,s,l,u=new Uint8Array([112,115,115,104,0,0,0,0]),c=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),f=0,d=null;if(i(),!e)return null;if("pssh"in e)return a.parseInitDataFromContentProtection(e,r);if("pro"in e)d=r.decodeArray(e.pro.__text);else{if(!("prheader"in e))return null;d=r.decodeArray(e.prheader.__text)}return t=d.length,n=4+u.length+c.length+4+t,o=new ArrayBuffer(n),s=new Uint8Array(o),(l=new DataView(o)).setUint32(f,n),f+=4,s.set(u,f),f+=u.length,s.set(c,f),f+=c.length,l.setUint32(f,t),f+=4,s.set(d,f),f+=t,s.buffer},getRequestHeadersFromMessage:function(e){var r,i,a={},o=new DOMParser;if(n&&n.get().streaming.protection.detectPlayreadyMessageFormat&&"utf-16"===t&&e&&e.byteLength%2==1)return a["Content-Type"]="text/xml; charset=utf-8",a;var s="utf-16"===t?new Uint16Array(e):new Uint8Array(e);r=String.fromCharCode.apply(null,s);for(var l=(i=o.parseFromString(r,"application/xml")).getElementsByTagName("name"),u=i.getElementsByTagName("value"),c=0;c<l.length;c++)a[l[c].childNodes[0].nodeValue]=u[c].childNodes[0].nodeValue;return a.hasOwnProperty("Content")&&(a["Content-Type"]=a.Content,delete a.Content),a.hasOwnProperty("Content-Type")||(a["Content-Type"]="text/xml; charset=utf-8"),a},getLicenseRequestFromMessage:function(e){var a=null,o=new DOMParser;if(n&&n.get().streaming.protection.detectPlayreadyMessageFormat&&"utf-16"===t&&e&&e.byteLength%2==1)return e;var s="utf-16"===t?new Uint16Array(e):new Uint8Array(e);i();var l=String.fromCharCode.apply(null,s),u=o.parseFromString(l,"application/xml");if(!u.getElementsByTagName("PlayReadyKeyMessage")[0])return e;var c=u.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue;return c&&(a=r.decode(c)),a},getLicenseServerURLFromInitData:function(e){if(e)for(var t=new DataView(e),r=t.getUint16(4,!0),n=6,i=new DOMParser,a=0;a<r;a++){var o=t.getUint16(n,!0);n+=2;var s=t.getUint16(n,!0);if(n+=2,1===o){var l=e.slice(n,n+s),u=String.fromCharCode.apply(null,new Uint16Array(l)),c=i.parseFromString(u,"application/xml");if(c.getElementsByTagName("LA_URL")[0]){var f=c.getElementsByTagName("LA_URL")[0].childNodes[0].nodeValue;if(f)return f}if(c.getElementsByTagName("LUI_URL")[0]){var d=c.getElementsByTagName("LUI_URL")[0].childNodes[0].nodeValue;if(d)return d}}else n+=s}return null},getCDMData:function(e){var t,n,a,o;if(i(),!e)return null;for(t=[],o=0;o<e.length;++o)t.push(e.charCodeAt(o)),t.push(0);for(t=String.fromCharCode.apply(null,t),t=r.encode(t),n='<PlayReadyCDMData type="LicenseAcquisition"><LicenseAcquisition version="1.0" Proactive="false"><CustomData encoding="base64encoded">%CUSTOMDATA%</CustomData></LicenseAcquisition></PlayReadyCDMData>'.replace("%CUSTOMDATA%",t),a=[],o=0;o<n.length;++o)a.push(n.charCodeAt(o)),a.push(0);return new Uint8Array(a).buffer},setPlayReadyMessageFormat:function(e){if("utf-8"!==e&&"utf-16"!==e)throw new Error('Specified message format is not one of "utf-8" or "utf-16"');t=e}}}V.__dashjs_factory_name="KeySystemPlayReady";var j=dashjs.FactoryMaker.getSingletonFactory(V);function $(e){var t=(e=e||{}).BASE64,r={};return r[w.WIDEVINE_KEYSTEM_STRING]={responseType:"json",getLicenseMessage:function(e){return t.decodeArray(e.license)},getErrorResponse:function(e){return e}},r[w.PLAYREADY_KEYSTEM_STRING]={responseType:"arraybuffer",getLicenseMessage:function(e){return e},getErrorResponse:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}},{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(e){return r[e].responseType},getLicenseMessage:function(e,n){return function(){if(!t||!t.hasOwnProperty("decodeArray"))throw new Error("Missing config parameter(s)")}(),r[n].getLicenseMessage(e)},getErrorResponse:function(e,t){return r[t].getErrorResponse(e)}}}$.__dashjs_factory_name="DRMToday";var z=dashjs.FactoryMaker.getSingletonFactory($);function W(){var e="http://schemas.xmlsoap.org/soap/envelope/";function t(e){var t=String.fromCharCode.apply(null,new Uint8Array(e));return decodeURIComponent(escape(t))}function r(r){if(window.DOMParser){var n=t(r),i=(new window.DOMParser).parseFromString(n,"text/xml"),a=i?i.getElementsByTagNameNS(e,"Envelope")[0]:null,o=a?a.getElementsByTagNameNS(e,"Body")[0]:null;if(o&&o.getElementsByTagNameNS(e,"Fault")[0])return null}return r}function n(r){var n="",i="",a="",o=-1,s=-1;if(window.DOMParser){var l=t(r),u=(new window.DOMParser).parseFromString(l,"text/xml"),c=u?u.getElementsByTagNameNS(e,"Envelope")[0]:null,f=c?c.getElementsByTagNameNS(e,"Body")[0]:null,d=f?f.getElementsByTagNameNS(e,"Fault")[0]:null,h=d?d.getElementsByTagName("detail")[0]:null,g=h?h.getElementsByTagName("Exception")[0]:null,m=null;if(null===d)return l;n=(m=d.getElementsByTagName("faultstring")[0].firstChild)?m.nodeValue:null,null!==g&&(i=(m=g.getElementsByTagName("StatusCode")[0])?m.firstChild.nodeValue:null,o=(a=(m=g.getElementsByTagName("Message")[0])?m.firstChild.nodeValue:null)?a.lastIndexOf("[")+1:-1,s=a?a.indexOf("]"):-1,a=a?a.substring(o,s):"")}var p="code: ".concat(i,", name: ").concat(n);return a&&(p+=", message: ".concat(a)),p}return{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"arraybuffer"},getLicenseMessage:function(e){return r.call(this,e)},getErrorResponse:function(e){return n.call(this,e)}}}W.__dashjs_factory_name="PlayReady";var X=v.Z.getSingletonFactory(W);function Q(){return{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"arraybuffer"},getLicenseMessage:function(e){return e},getErrorResponse:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}}}Q.__dashjs_factory_name="Widevine";var J=dashjs.FactoryMaker.getSingletonFactory(Q);function ee(){return{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"json"},getLicenseMessage:function(e){if(!e.hasOwnProperty("keys"))return null;for(var t=[],r=0;r<e.keys.length;r++){var n=e.keys[r],i=n.kid.replace(/=/g,""),a=n.k.replace(/=/g,"");t.push(new A(i,a))}return new R(t)},getErrorResponse:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}}}ee.__dashjs_factory_name="ClearKey";var te=dashjs.FactoryMaker.getSingletonFactory(ee);function re(){var e,t,r,n,i,o,s,l,u=this.context;function c(e,t){return t&&e in t?t[e]:null}function f(e,t){return e&&e.sessionId?e.sessionId:t&&t.sessionId?t.sessionId:null}function d(e,t){return e&&e.sessionType?e.sessionType:t}return e={initialize:function(){var e;n=[],e=j(u).getInstance({BASE64:i,settings:o}),n.push(e),e=H(u).getInstance({BASE64:i}),n.push(e),e=O(u).getInstance({BASE64:i}),n.push(e),s=e,e=F(u).getInstance({BASE64:i,debug:t}),n.push(e),l=e},setProtectionData:function(e){for(var t,r,i=0;i<n.length;i++){var a=n[i];a.hasOwnProperty("init")&&a.init((t=a.systemString,r=void 0,r=null,e&&(r=t in e?e[t]:null),r))}},isClearKey:function(e){return e===s||e===l},initDataEquals:function(e,t){if(e.byteLength===t.byteLength){for(var r=new Uint8Array(e),n=new Uint8Array(t),i=0;i<r.length;i++)if(r[i]!==n[i])return!1;return!0}return!1},getKeySystems:function(){return n},setKeySystems:function(e){n=e},getKeySystemBySystemString:function(e){for(var t=0;t<n.length;t++)if(n[t].systemString===e)return n[t];return null},getSupportedKeySystemsFromContentProtection:function(e,t,r){var i,o,s,l,u=[];if(e){var h=a.findCencContentProtection(e);for(s=0;s<n.length;++s){var g=c((o=n[s]).systemString,t);for(l=0;l<e.length;++l)if((i=e[l]).schemeIdUri.toLowerCase()===o.schemeIdURI){var m=o.getInitData(i,h);u.push({ks:n[s],keyId:i.keyId,initData:m,protData:g,cdmData:o.getCDMData(g?g.cdmData:null),sessionId:f(g,i),sessionType:d(g,r)})}}}return u},getSupportedKeySystemsFromSegmentPssh:function(e,t,r){for(var i,o=[],s=a.parsePSSHList(e),l=0;l<n.length;++l){var u=c((i=n[l]).systemString,t);i.uuid in s&&o.push({ks:i,initData:s[i.uuid],protData:u,cdmData:i.getCDMData(u?u.cdmData:null),sessionId:f(u),sessionType:d(u,r)})}return o},getLicenseServerModelInstance:function(e,t,r){if("license-release"===r||"individualization-request"===r)return null;var n=null;return t&&t.hasOwnProperty("drmtoday")?n=z(u).getInstance({BASE64:i}):e.systemString===w.WIDEVINE_KEYSTEM_STRING?n=J(u).getInstance():e.systemString===w.PLAYREADY_KEYSTEM_STRING?n=X(u).getInstance():e.systemString===w.CLEARKEY_KEYSTEM_STRING&&(n=te(u).getInstance()),n},processClearKeyLicenseRequest:function(e,t,n){try{return e.getClearKeysFromProtectionData(t,n)}catch(i){return r.error("Failed to retrieve clearkeys from ProtectionData"),null}},setConfig:function(n){n&&(n.debug&&(t=n.debug,r=t.getLogger(e)),n.BASE64&&(i=n.BASE64),n.settings&&(o=n.settings))}}}re.__dashjs_factory_name="ProtectionKeyController";var ne=dashjs.FactoryMaker.getSingletonFactory(re);function ie(e){return(ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ae(e,t){return(ae=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function oe(e,t){return!t||"object"!==ie(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function se(e){return(se=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var le=new(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ae(e,t)}(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=se(t);if(r){var i=se(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return oe(this,e)});function i(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(e=n.call(this)).INTERNAL_KEY_MESSAGE="internalKeyMessage",e.INTERNAL_KEY_STATUS_CHANGED="internalkeyStatusChanged",e.KEY_ADDED="public_keyAdded",e.KEY_ERROR="public_keyError",e.KEY_MESSAGE="public_keyMessage",e.KEY_SESSION_CLOSED="public_keySessionClosed",e.KEY_SESSION_CREATED="public_keySessionCreated",e.KEY_SESSION_REMOVED="public_keySessionRemoved",e.KEY_STATUSES_CHANGED="public_keyStatusesChanged",e.KEY_SYSTEM_ACCESS_COMPLETE="public_keySystemAccessComplete",e.KEY_SYSTEM_SELECTED="public_keySystemSelected",e.LICENSE_REQUEST_COMPLETE="public_licenseRequestComplete",e.LICENSE_REQUEST_SENDING="public_licenseRequestSending",e.NEED_KEY="needkey",e.PROTECTION_CREATED="public_protectioncreated",e.PROTECTION_DESTROYED="public_protectiondestroyed",e.SERVER_CERTIFICATE_UPDATED="serverCertificateUpdated",e.TEARDOWN_COMPLETE="protectionTeardownComplete",e.VIDEO_ELEMENT_SELECTED="videoElementSelected",e.KEY_SESSION_UPDATED="public_keySessionUpdated",e}return i}(r(8342).Z)),ue=function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.initData=t,this.initDataType=r},ce=function e(t,r,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sessionToken=t,this.message=r,this.defaultURL=n,this.messageType=i||"license-request"},fe=function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.keySystem=t,this.ksConfiguration=r},de={};function he(e){e=e||{};var t,r,n,i,a,o,s,l,u=this.context,c=e.eventBus,f=e.events,g=e.debug;function m(e,t,r,n){if(void 0===navigator.requestMediaKeySystemAccess||"function"!=typeof navigator.requestMediaKeySystemAccess){var i="Insecure origins are not allowed";return c.trigger(f.KEY_SYSTEM_ACCESS_COMPLETE,{error:i}),void n({error:i})}var a,o,s=e[t].protData&&e[t].protData.systemStringPriority?e[t].protData.systemStringPriority:null,l=e[t].configs,u=e[t].ks,d=u.systemString;(a=s||(de[d]?de[d]:[d]),o=l,new Promise((function(e,t){p(a,o,0,e,t)}))).then((function(e){var t="function"==typeof e.getConfiguration?e.getConfiguration():null,n=new fe(u,t);n.mksa=e,c.trigger(f.KEY_SYSTEM_ACCESS_COMPLETE,{data:n}),r({data:n})})).catch((function(i){if(t+1<e.length)m(e,t+1,r,n);else{var a="Key system access denied! ";c.trigger(f.KEY_SYSTEM_ACCESS_COMPLETE,{error:a+i.message}),n({error:a+i.message})}}))}function p(e,t,n,i,a){var o=e[n];r.debug("Requesting key system access for system string ".concat(o)),navigator.requestMediaKeySystemAccess(o,t).then((function(e){e.selectedSystemString=o,i(e)})).catch((function(r){n+1<e.length?p(e,t,n+1,i,a):a(r)}))}function y(e){if(!e||!e.session)return Promise.resolve;var t=e.session;return t.removeEventListener("keystatuseschange",e),t.removeEventListener("message",e),t.close()}function E(e){for(var t=0;t<o.length;t++)if(o[t]===e){o.splice(t,1);break}}function v(e){var t,r;return e&&e.length>0&&(e[0]&&("string"==typeof e[0]?t=e[0]:r=e[0]),e[1]&&("string"==typeof e[1]?t=e[1]:r=e[1])),{status:t,keyId:r}}function T(e,t){var n={session:e,keyId:t.keyId,initData:t.initData,sessionId:t.sessionId,sessionType:t.sessionType,handleEvent:function(e){switch(e.type){case"keystatuseschange":c.trigger(f.KEY_STATUSES_CHANGED,{data:this}),e.target.keyStatuses.forEach((function(){var e=v(arguments);"expired"===e.status?c.trigger(f.INTERNAL_KEY_STATUS_CHANGED,{error:new h.Z(d.KEY_STATUS_CHANGED_EXPIRED_ERROR_CODE,d.KEY_STATUS_CHANGED_EXPIRED_ERROR_MESSAGE)}):c.trigger(f.INTERNAL_KEY_STATUS_CHANGED,e)}));break;case"message":var t=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;c.trigger(f.INTERNAL_KEY_MESSAGE,{data:new ce(this,t,void 0,e.messageType)})}},getKeyId:function(){return this.keyId},getSessionId:function(){return e.sessionId},getSessionType:function(){return this.sessionType},getExpirationTime:function(){return e.expiration},getKeyStatuses:function(){return e.keyStatuses},getUsable:function(){var t=!1;return e.keyStatuses.forEach((function(){"usable"===v(arguments).status&&(t=!0)})),t}};return e.addEventListener("keystatuseschange",n),e.addEventListener("message",n),e.closed.then((function(){E(n),r.debug("DRM: Session closed.  SessionID = "+n.getSessionId()),c.trigger(f.KEY_SESSION_CLOSED,{data:n.getSessionId()})})),o.push(n),n}return t={getAllInitData:function(){for(var e=[],t=0;t<o.length;t++)o[t].initData&&e.push(o[t].initData);return e},getSessions:function(){return o},requestKeySystemAccess:function(e){return new Promise((function(t,r){m(e,0,t,r)}))},selectKeySystem:function(e){return new Promise((function(t,r){e.mksa.createMediaKeys().then((function(t){return n=e.keySystem,a=t,i?i.setMediaKeys(a):Promise.resolve()})).then((function(){t(n)})).catch((function(){r({error:"Error selecting keys system ("+e.keySystem.systemString+")! Could not create MediaKeys -- TODO"})}))}))},setMediaElement:function(e){i!==e&&(i&&(i.removeEventListener("encrypted",s),i.setMediaKeys&&i.setMediaKeys(null)),(i=e)&&(i.addEventListener("encrypted",s),i.setMediaKeys&&a&&i.setMediaKeys(a)))},setServerCertificate:function(e){if(!n||!a)throw new Error("Can not set server certificate until you have selected a key system");a.setServerCertificate(e).then((function(){r.info("DRM: License server certificate successfully updated."),c.trigger(f.SERVER_CERTIFICATE_UPDATED)})).catch((function(e){c.trigger(f.SERVER_CERTIFICATE_UPDATED,{error:new h.Z(d.SERVER_CERTIFICATE_UPDATED_ERROR_CODE,d.SERVER_CERTIFICATE_UPDATED_ERROR_MESSAGE+e.name)})}))},createKeySession:function(e){if(!n||!a)throw new Error("Can not create sessions until you have selected a key system");var t=a.createSession(e.sessionType),i=T(t,e),o=n.systemString===w.CLEARKEY_KEYSTEM_STRING&&(e.initData||e.protData&&e.protData.clearkeys)?w.INITIALIZATION_DATA_TYPE_KEYIDS:w.INITIALIZATION_DATA_TYPE_CENC;t.generateRequest(o,e.initData).then((function(){r.debug("DRM: Session created.  SessionID = "+i.getSessionId()),c.trigger(f.KEY_SESSION_CREATED,{data:i})})).catch((function(e){E(i),c.trigger(f.KEY_SESSION_CREATED,{data:null,error:new h.Z(d.KEY_SESSION_CREATED_ERROR_CODE,d.KEY_SESSION_CREATED_ERROR_MESSAGE+"Error generating key request -- "+e.name)})}))},updateKeySession:function(e,t){var r=e.session;l.isClearKey(n)&&(t=t.toJWK()),r.update(t).then((function(){c.trigger(f.KEY_SESSION_UPDATED)})).catch((function(t){c.trigger(f.KEY_ERROR,{error:new h.Z(d.MEDIA_KEYERR_CODE,"Error sending update() message! "+t.name,e)})}))},loadKeySession:function(e){if(!n||!a)throw new Error("Can not load sessions until you have selected a key system");for(var t=e.sessionId,i=0;i<o.length;i++)if(t===o[i].sessionId)return void r.warn("DRM: Ignoring session ID because we have already seen it!");var s=a.createSession(e.sessionType),l=T(s,e);s.load(t).then((function(e){e?(r.debug("DRM: Session loaded.  SessionID = "+l.getSessionId()),c.trigger(f.KEY_SESSION_CREATED,{data:l})):(E(l),c.trigger(f.KEY_SESSION_CREATED,{data:null,error:new h.Z(d.KEY_SESSION_CREATED_ERROR_CODE,d.KEY_SESSION_CREATED_ERROR_MESSAGE+"Could not load session! Invalid Session ID ("+t+")")}))})).catch((function(e){E(l),c.trigger(f.KEY_SESSION_CREATED,{data:null,error:new h.Z(d.KEY_SESSION_CREATED_ERROR_CODE,d.KEY_SESSION_CREATED_ERROR_MESSAGE+"Could not load session ("+t+")! "+e.name)})}))},removeKeySession:function(e){e.session.remove().then((function(){r.debug("DRM: Session removed.  SessionID = "+e.getSessionId()),c.trigger(f.KEY_SESSION_REMOVED,{data:e.getSessionId()})}),(function(t){c.trigger(f.KEY_SESSION_REMOVED,{data:null,error:"Error removing session ("+e.getSessionId()+"). "+t.name})}))},closeKeySession:function(e){y(e).catch((function(t){E(e),c.trigger(f.KEY_SESSION_CLOSED,{data:null,error:"Error closing session ("+e.getSessionId()+") "+t.name})}))},stop:function(){for(var e,t=0;t<o.length;t++)(e=o[t]).getUsable()||(y(e),E(e))},reset:function(){var e,t=o.length;0!==t?function(){for(var r=function(e){E(e),0===o.length&&(i?(i.removeEventListener("encrypted",s),i.setMediaKeys(null).then((function(){c.trigger(f.TEARDOWN_COMPLETE)}))):c.trigger(f.TEARDOWN_COMPLETE))},n=0;n<t;n++)a=e=o[n],y(e),r(a);var a}():c.trigger(f.TEARDOWN_COMPLETE)}},r=g.getLogger(t),n=null,i=null,a=null,o=[],l=ne(u).getInstance(),s={handleEvent:function(e){if("encrypted"===e.type&&e.initData){var t=ArrayBuffer.isView(e.initData)?e.initData.buffer:e.initData;c.trigger(f.NEED_KEY,{key:new ue(t,e.initDataType)})}}},t}de[w.PLAYREADY_KEYSTEM_STRING]=[w.PLAYREADY_KEYSTEM_STRING,w.PLAYREADY_RECOMMENDATION_KEYSTEM_STRING],de[w.WIDEVINE_KEYSTEM_STRING]=[w.WIDEVINE_KEYSTEM_STRING],de[w.CLEARKEY_KEYSTEM_STRING]=[w.CLEARKEY_KEYSTEM_STRING],he.__dashjs_factory_name="ProtectionModel_21Jan2015";var ge=dashjs.FactoryMaker.getClassFactory(he);function me(e){e=e||{};var t,r,n,i,a,o,l,u,c,f=this.context,g=e.eventBus,m=e.events,p=e.debug,y=e.api;function E(){try{for(var e=0;e<l.length;e++)v(l[e]);n&&n.removeEventListener(y.needkey,u),g.trigger(m.TEARDOWN_COMPLETE)}catch(t){g.trigger(m.TEARDOWN_COMPLETE,{error:"Error tearing down key sessions and MediaKeys! -- "+t.message})}}function v(e){var t=e.session;t.removeEventListener(y.error,e),t.removeEventListener(y.message,e),t.removeEventListener(y.ready,e),t.removeEventListener(y.close,e);for(var r=0;r<l.length;r++)if(l[r]===e){l.splice(r,1);break}t[y.release]()}function T(){var e=null,t=function(){n.removeEventListener("loadedmetadata",e),n[y.setMediaKeys](a),g.trigger(m.VIDEO_ELEMENT_SELECTED)};n.readyState>=1?t():(e=t.bind(this),n.addEventListener("loadedmetadata",e))}return t={getAllInitData:function(){for(var e=[],t=0;t<l.length;t++)e.push(l[t].initData);return e},getSessions:function(){return l},requestKeySystemAccess:function(e){return new Promise((function(t,r){for(var n=!1,i=0;i<e.length;i++)for(var a=e[i].ks.systemString,o=e[i].configs,l=null,u=null,f=0;f<o.length;f++){var d=o[f].audioCapabilities,h=o[f].videoCapabilities;if(d&&0!==d.length){l=[];for(var p=0;p<d.length;p++)window[y.MediaKeys].isTypeSupported(a,d[p].contentType)&&l.push(d[p])}if(h&&0!==h.length){u=[];for(var E=0;E<h.length;E++)window[y.MediaKeys].isTypeSupported(a,h[E].contentType)&&u.push(h[E])}if(!(!l&&!u||l&&0===l.length||u&&0===u.length)){n=!0;var v=new s(l,u),T=c.getKeySystemBySystemString(a),_=new fe(T,v);g.trigger(m.KEY_SYSTEM_ACCESS_COMPLETE,{data:_}),t({data:_});break}}if(!n){var S="Key system access denied! -- No valid audio/video content configurations detected!";g.trigger(m.KEY_SYSTEM_ACCESS_COMPLETE,{error:S}),r({error:S})}}))},selectKeySystem:function(e){return new Promise((function(t,r){try{a=e.mediaKeys=new window[y.MediaKeys](e.keySystem.systemString),i=e.keySystem,o=e,n&&T(),t(i)}catch(s){r({error:"Error selecting keys system ("+i.systemString+")! Could not create MediaKeys -- TODO"})}}))},setMediaElement:function(e){n!==e&&(n&&n.removeEventListener(y.needkey,u),(n=e)&&(n.addEventListener(y.needkey,u),a&&T()))},createKeySession:function(e){if(!i||!a||!o)throw new Error("Can not create sessions until you have selected a key system");var t=null;if(o.ksConfiguration.videoCapabilities&&o.ksConfiguration.videoCapabilities.length>0&&(t=o.ksConfiguration.videoCapabilities[0]),null===t&&o.ksConfiguration.audioCapabilities&&o.ksConfiguration.audioCapabilities.length>0&&(t=o.ksConfiguration.audioCapabilities[0]),null===t)throw new Error("Can not create sessions for unknown content types.");var n,s=t.contentType,u=a.createSession(s,new Uint8Array(e.initData),e.cdmData?new Uint8Array(e.cdmData):null),c={session:u,keyId:(n=e).keyId,initData:n.initData,getKeyId:function(){return this.keyId},getSessionId:function(){return this.session.sessionId},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"},handleEvent:function(e){switch(e.type){case y.error:g.trigger(m.KEY_ERROR,{error:new h.Z(d.MEDIA_KEYERR_CODE,"KeyError",this)});break;case y.message:var t=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;g.trigger(m.INTERNAL_KEY_MESSAGE,{data:new ce(this,t,e.destinationURL)});break;case y.ready:r.debug("DRM: Key added."),g.trigger(m.KEY_ADDED);break;case y.close:r.debug("DRM: Session closed.  SessionID = "+this.getSessionId()),g.trigger(m.KEY_SESSION_CLOSED,{data:this.getSessionId()})}}};u.addEventListener(y.error,c),u.addEventListener(y.message,c),u.addEventListener(y.ready,c),u.addEventListener(y.close,c),l.push(c),r.debug("DRM: Session created.  SessionID = "+c.getSessionId()),g.trigger(m.KEY_SESSION_CREATED,{data:c})},updateKeySession:function(e,t){var r=e.session;c.isClearKey(i)?r.update(new Uint8Array(t.toJWK())):r.update(new Uint8Array(t)),g.trigger(m.KEY_SESSION_UPDATED)},closeKeySession:v,setServerCertificate:function(){},loadKeySession:function(){},removeKeySession:function(){},stop:E,reset:E},r=p.getLogger(t),n=null,i=null,a=null,o=null,l=[],c=ne(f).getInstance(),u={handleEvent:function(e){if(e.type===y.needkey&&e.initData){var t=ArrayBuffer.isView(e.initData)?e.initData.buffer:e.initData;g.trigger(m.NEED_KEY,{key:new ue(t,"cenc")})}}},t}me.__dashjs_factory_name="ProtectionModel_3Feb2014";var pe=dashjs.FactoryMaker.getClassFactory(me);function ye(e){e=e||{};var t,r,n,i,a,o,l,u,c,f=this.context,g=e.eventBus,m=e.events,p=e.debug,y=e.api,E=e.errHandler;function v(){n&&S();for(var e=0;e<l.length;e++)T(l[e]);g.trigger(m.TEARDOWN_COMPLETE)}function T(e){try{n[y.cancelKeyRequest](i.systemString,e.sessionId)}catch(t){g.trigger(m.KEY_SESSION_CLOSED,{data:null,error:"Error closing session ("+e.sessionId+") "+t.message})}}function _(e,t){if(t&&e){for(var r=e.length,n=0;n<r;n++)if(e[n].sessionId==t)return e[n];return null}return null}function S(){n.removeEventListener(y.keyerror,c),n.removeEventListener(y.needkey,c),n.removeEventListener(y.keymessage,c),n.removeEventListener(y.keyadded,c)}return t={getAllInitData:function(){for(var e=[],t=0;t<o.length;t++)e.push(o[t].initData);for(var r=0;r<l.length;r++)e.push(l[r].initData);return e},getSessions:function(){return l.concat(o)},requestKeySystemAccess:function(e){return new Promise((function(t,r){var i=n;i||(i=document.createElement("video"));for(var o=!1,l=0;l<e.length;l++)for(var u=e[l].ks.systemString,c=e[l].configs,f=null,d=0;d<c.length;d++){var h=c[d].videoCapabilities;if(h&&0!==h.length){f=[];for(var p=0;p<h.length;p++)""!==i.canPlayType(h[p].contentType,u)&&f.push(h[p])}if(f&&(!f||0!==f.length)){o=!0;var y=new s(null,f),E=a.getKeySystemBySystemString(u),v=new fe(E,y);g.trigger(m.KEY_SYSTEM_ACCESS_COMPLETE,{data:v}),t({data:v});break}}if(!o){var T="Key system access denied! -- No valid audio/video content configurations detected!";g.trigger(m.KEY_SYSTEM_ACCESS_COMPLETE,{error:T}),r({error:T})}}))},selectKeySystem:function(e){return i=e.keySystem,Promise.resolve(i)},setMediaElement:function(e){if(n!==e){if(n){S();for(var t=0;t<l.length;t++)T(l[t]);l=[]}(n=e)&&(n.addEventListener(y.keyerror,c),n.addEventListener(y.needkey,c),n.addEventListener(y.keymessage,c),n.addEventListener(y.keyadded,c),g.trigger(m.VIDEO_ELEMENT_SELECTED))}},createKeySession:function(e){if(!i)throw new Error("Can not create sessions until you have selected a key system");if(u||0===l.length){var t={sessionId:null,keyId:e.keyId,initData:e.initData,getKeyId:function(){return this.keyId},getSessionId:function(){return this.sessionId},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"}};return o.push(t),n[y.generateKeyRequest](i.systemString,new Uint8Array(e.initData)),t}throw new Error("Multiple sessions not allowed!")},updateKeySession:function(e,t){var r=e.sessionId;if(a.isClearKey(i))for(var o=0;o<t.keyPairs.length;o++)n[y.addKey](i.systemString,t.keyPairs[o].key,t.keyPairs[o].keyID,r);else n[y.addKey](i.systemString,new Uint8Array(t),new Uint8Array(e.initData),r);g.trigger(m.KEY_SESSION_UPDATED)},closeKeySession:T,setServerCertificate:function(){},loadKeySession:function(){},removeKeySession:function(){},stop:v,reset:v},r=p.getLogger(t),n=null,i=null,o=[],l=[],a=ne(f).getInstance(),c={handleEvent:function(e){var t=null;switch(e.type){case y.needkey:var n=ArrayBuffer.isView(e.initData)?e.initData.buffer:e.initData;g.trigger(m.NEED_KEY,{key:new ue(n,"cenc")});break;case y.keyerror:if((t=_(l,e.sessionId))||(t=_(o,e.sessionId)),t){var i=d.MEDIA_KEYERR_CODE,a="";switch(e.errorCode.code){case 1:i=d.MEDIA_KEYERR_UNKNOWN_CODE,a+="MEDIA_KEYERR_UNKNOWN - "+d.MEDIA_KEYERR_UNKNOWN_MESSAGE;break;case 2:i=d.MEDIA_KEYERR_CLIENT_CODE,a+="MEDIA_KEYERR_CLIENT - "+d.MEDIA_KEYERR_CLIENT_MESSAGE;break;case 3:i=d.MEDIA_KEYERR_SERVICE_CODE,a+="MEDIA_KEYERR_SERVICE - "+d.MEDIA_KEYERR_SERVICE_MESSAGE;break;case 4:i=d.MEDIA_KEYERR_OUTPUT_CODE,a+="MEDIA_KEYERR_OUTPUT - "+d.MEDIA_KEYERR_OUTPUT_MESSAGE;break;case 5:i=d.MEDIA_KEYERR_HARDWARECHANGE_CODE,a+="MEDIA_KEYERR_HARDWARECHANGE - "+d.MEDIA_KEYERR_HARDWARECHANGE_MESSAGE;break;case 6:i=d.MEDIA_KEYERR_DOMAIN_CODE,a+="MEDIA_KEYERR_DOMAIN - "+d.MEDIA_KEYERR_DOMAIN_MESSAGE}a+="  System Code = "+e.systemCode,g.trigger(m.KEY_ERROR,{error:new h.Z(i,a,t)})}else r.error("No session token found for key error");break;case y.keyadded:(t=_(l,e.sessionId))||(t=_(o,e.sessionId)),t?(r.debug("DRM: Key added."),g.trigger(m.KEY_ADDED,{data:t})):r.debug("No session token found for key added");break;case y.keymessage:if((u=null!==e.sessionId&&void 0!==e.sessionId)?!(t=_(l,e.sessionId))&&o.length>0&&(t=o.shift(),l.push(t),t.sessionId=e.sessionId,g.trigger(m.KEY_SESSION_CREATED,{data:t})):o.length>0&&(t=o.shift(),l.push(t),0!==o.length&&E.error(new h.Z(d.MEDIA_KEY_MESSAGE_ERROR_CODE,d.MEDIA_KEY_MESSAGE_ERROR_MESSAGE))),t){var s=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;t.keyMessage=s,g.trigger(m.INTERNAL_KEY_MESSAGE,{data:new ce(t,s,e.defaultURL)})}else r.warn("No session token found for key message")}}},t}ye.__dashjs_factory_name="ProtectionModel_01b";var Ee=dashjs.FactoryMaker.getClassFactory(ye),ve=[{generateKeyRequest:"generateKeyRequest",addKey:"addKey",cancelKeyRequest:"cancelKeyRequest",needkey:"needkey",keyerror:"keyerror",keyadded:"keyadded",keymessage:"keymessage"},{generateKeyRequest:"webkitGenerateKeyRequest",addKey:"webkitAddKey",cancelKeyRequest:"webkitCancelKeyRequest",needkey:"webkitneedkey",keyerror:"webkitkeyerror",keyadded:"webkitkeyadded",keymessage:"webkitkeymessage"}],Te=[{setMediaKeys:"setMediaKeys",MediaKeys:"MediaKeys",release:"close",needkey:"needkey",error:"keyerror",message:"keymessage",ready:"keyadded",close:"keyclose"},{setMediaKeys:"msSetMediaKeys",MediaKeys:"MSMediaKeys",release:"close",needkey:"msneedkey",error:"mskeyerror",message:"mskeymessage",ready:"mskeyadded",close:"mskeyclose"}];function _e(){var e,t=this.context;function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];if("function"==typeof e[n[Object.keys(n)[0]]])return n}return null}return e={createProtectionSystem:function(n){var i=null,a=ne(t).getInstance();a.setConfig({debug:n.debug,BASE64:n.BASE64,settings:n.settings}),a.initialize();var o,s,l,u,c,f,d=(s=(o=n).debug,l=s.getLogger(e),u=o.eventBus,c=o.errHandler,(f=o.videoModel?o.videoModel.getElement():null)&&void 0===f.onencrypted||f&&void 0===f.mediaKeys?r(f,Te)?(l.info("EME detected on this user agent! (ProtectionModel_3Feb2014)"),pe(t).create({debug:s,eventBus:u,events:o.events,api:r(f,Te)})):r(f,ve)?(l.info("EME detected on this user agent! (ProtectionModel_01b)"),Ee(t).create({debug:s,eventBus:u,errHandler:c,events:o.events,api:r(f,ve)})):(l.warn("No supported version of EME detected on this user agent! - Attempts to play encrypted content will fail!"),null):(l.info("EME detected on this user agent! (ProtectionModel_21Jan2015)"),ge(t).create({debug:s,eventBus:u,events:o.events})));return!i&&d&&(i=S(t).create({protectionModel:d,protectionKeyController:a,eventBus:n.eventBus,debug:n.debug,events:n.events,BASE64:n.BASE64,constants:n.constants,cmcdModel:n.cmcdModel,customParametersModel:n.customParametersModel,settings:n.settings}),n.capabilities.setEncryptedMediaSupported(!0)),i}}}_e.__dashjs_factory_name="Protection";var Se=dashjs.FactoryMaker.getClassFactory(_e);Se.events=le,Se.errors=d,dashjs.FactoryMaker.updateClassFactory(_e.__dashjs_factory_name,Se);var Ae=Se},2068:function(e,t,r){var n=r(5448),i={DEFAULT:.5,STRONG:1,WEAK:0};function a(e,t,r){var n,a,o;return n=void 0===e?-1:e,a=r,o=i.DEFAULT,a!==i.DEFAULT&&a!==i.STRONG&&a!==i.WEAK||(o=a),{quality:n,reason:void 0===t?null:t,priority:o}}a.__dashjs_factory_name="SwitchRequest";var o=n.Z.getClassFactory(a);o.NO_CHANGE=-1,o.PRIORITY=i,n.Z.updateClassFactory(a.__dashjs_factory_name,o),t.Z=o},1767:function(e,t,r){var n=r(5628),i=r(6535),a=r(7423),o=r(895),s=r(6070),l=r(3112),u=r(1914),c=r(5435),f=r(5448),d=r(2068),h=r(3393),g="qualitySwitchRules",m="abandonFragmentRules";function p(e){e=e||{};var t,r,f=this.context,p=e.mediaPlayerModel,y=e.customParametersModel,E=e.dashMetrics,v=e.settings;function T(e){return e.filter((function(e){return e.quality>d.Z.NO_CHANGE}))}function _(e){var t,r,n,i,a,o={},s=null;if(0!==e.length){for(o[d.Z.PRIORITY.STRONG]={quality:d.Z.NO_CHANGE,reason:null},o[d.Z.PRIORITY.WEAK]={quality:d.Z.NO_CHANGE,reason:null},o[d.Z.PRIORITY.DEFAULT]={quality:d.Z.NO_CHANGE,reason:null},t=0,r=e.length;t<r;t+=1)(n=e[t]).quality!==d.Z.NO_CHANGE&&(o[n.priority].quality===d.Z.NO_CHANGE||o[n.priority].quality>n.quality)&&(o[n.priority].quality=n.quality,o[n.priority].reason=n.reason||null);return o[d.Z.PRIORITY.WEAK].quality!==d.Z.NO_CHANGE&&(s=o[d.Z.PRIORITY.WEAK]),o[d.Z.PRIORITY.DEFAULT].quality!==d.Z.NO_CHANGE&&(s=o[d.Z.PRIORITY.DEFAULT]),o[d.Z.PRIORITY.STRONG].quality!==d.Z.NO_CHANGE&&(s=o[d.Z.PRIORITY.STRONG]),s&&(i=s.quality,a=s.reason),(0,d.Z)(f).create(i,a)}}return{initialize:function(){t=[],r=[],v.get().streaming.abr.useDefaultABRRules&&(v.get().streaming.abr.ABRStrategy===h.Z.ABR_STRATEGY_L2A?t.push((0,u.Z)(f).create({dashMetrics:E,settings:v})):v.get().streaming.abr.ABRStrategy===h.Z.ABR_STRATEGY_LoLP?t.push((0,c.Z)(f).create({dashMetrics:E})):(t.push((0,l.Z)(f).create({dashMetrics:E,mediaPlayerModel:p,settings:v})),t.push((0,n.Z)(f).create({dashMetrics:E})),v.get().streaming.abr.additionalAbrRules.insufficientBufferRule&&t.push((0,i.Z)(f).create({dashMetrics:E,settings:v})),v.get().streaming.abr.additionalAbrRules.switchHistoryRule&&t.push((0,s.Z)(f).create()),v.get().streaming.abr.additionalAbrRules.droppedFramesRule&&t.push((0,o.Z)(f).create()),v.get().streaming.abr.additionalAbrRules.abandonRequestsRule&&r.push((0,a.Z)(f).create({dashMetrics:E,mediaPlayerModel:p,settings:v})))),y.getAbrCustomRules().forEach((function(e){e.type===g&&t.push(e.rule(f).create()),e.type===m&&r.push(e.rule(f).create())}))},reset:function(){[t,r].forEach((function(e){e&&e.length&&e.forEach((function(e){return e.reset&&e.reset()}))})),t=[],r=[]},getMaxQuality:function(e){return _(T(t.map((function(t){return t.getMaxIndex(e)}))))||(0,d.Z)(f).create()},getMinSwitchRequest:_,shouldAbandonFragment:function(e,t){var n=_(T(r.map((function(r){return r.shouldAbandon(e,t)}))));return n&&(n.reason.forceAbandon=!0),n||(0,d.Z)(f).create()},getQualitySwitchRules:function(){return t}}}p.__dashjs_factory_name="ABRRulesCollection";var y=f.Z.getClassFactory(p);y.QUALITY_SWITCH_RULES=g,y.ABANDON_FRAGMENT_RULES=m,f.Z.updateSingletonFactory(p.__dashjs_factory_name,y),t.Z=y},7423:function(e,t,r){var n=r(2068),i=r(5448),a=r(6398);function o(e){e=e||{};var t,r,i,s,l,u=this.context,c=e.mediaPlayerModel,f=e.dashMetrics,d=e.settings;function h(){i={},s={},l=[]}return t={shouldAbandon:function(e){var t=(0,n.Z)(u).create(n.Z.NO_CHANGE,{name:o.__dashjs_factory_name});if(!(e&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getMediaType")&&e.hasOwnProperty("getCurrentRequest")&&e.hasOwnProperty("getRepresentationInfo")&&e.hasOwnProperty("getAbrController")))return t;var a,h,g,m,p=e.getMediaInfo(),y=e.getMediaType(),E=e.getStreamInfo(),v=E?E.id:null,T=e.getCurrentRequest();if(!isNaN(T.index)){a=y,h=T.index,i[a]=i[a]||{},i[a][h]=i[a][h]||{};var _=c.getStableBufferTime();if(f.getCurrentBufferLevel(y)>_)return t;var S=i[y][T.index];if(null===S||null===T.firstByteDate||s.hasOwnProperty(S.id))return t;if(void 0===S.firstByteTime&&(l[y]=[],S.firstByteTime=T.firstByteDate.getTime(),S.segmentDuration=T.duration,S.bytesTotal=T.bytesTotal,S.id=T.index),S.bytesLoaded=T.bytesLoaded,S.elapsedTime=(new Date).getTime()-S.firstByteTime,S.bytesLoaded>0&&S.elapsedTime>0&&(g=y,m=Math.round(8*S.bytesLoaded/S.elapsedTime),l[g]=l[g]||[],l[g].push(m)),l[y].length>=d.get().streaming.abr.abrRulesParameters.abandonRequestsRule.minLengthToAverage&&S.elapsedTime>d.get().streaming.abr.abrRulesParameters.abandonRequestsRule.graceTimeThreshold&&S.bytesLoaded<S.bytesTotal){var A=l[y].reduce((function(e,t){return e+t}),0);if(S.measuredBandwidthInKbps=Math.round(A/l[y].length),S.estimatedTimeOfDownload=+(8*S.bytesTotal/S.measuredBandwidthInKbps/1e3).toFixed(2),S.estimatedTimeOfDownload<S.segmentDuration*d.get().streaming.abr.abrRulesParameters.abandonRequestsRule.abandonMultiplier||0===e.getRepresentationInfo().quality)return t;if(!s.hasOwnProperty(S.id)){var b=e.getAbrController(),R=S.bytesTotal-S.bytesLoaded,I=b.getBitrateList(p),w=b.getQualityForBitrate(p,S.measuredBandwidthInKbps*d.get().streaming.abr.bandwidthSafetyFactor,v),C=b.getMinAllowedIndexFor(y,v),D=void 0!==C?Math.max(C,w):w;R>S.bytesTotal*I[D].bitrate/I[b.getQualityFor(y,v)].bitrate&&(t.quality=D,t.reason.throughput=S.measuredBandwidthInKbps,t.reason.fragmentID=S.id,t.reason.rule=this.getClassName(),s[S.id]=S,r.debug("["+y+"] frag id",S.id," is asking to abandon and switch to quality to ",D," measured bandwidth was",S.measuredBandwidthInKbps),delete i[y][S.id])}}else S.bytesLoaded===S.bytesTotal&&delete i[y][S.id]}return t},reset:h},r=(0,a.Z)(u).getInstance().getLogger(t),h(),t}o.__dashjs_factory_name="AbandonRequestsRule",t.Z=i.Z.getClassFactory(o)},3112:function(e,t,r){var n=r(3860),i=r(2068),a=r(5448),o=r(7855),s=r(5595),l=r(8512),u=r(6398),c=r(8825),f=r(3393),d=10;function h(e){e=e||{};var t,r,a,h=this.context,g=e.dashMetrics,m=e.mediaPlayerModel,p=(0,s.Z)(h).getInstance();function y(e,t,r){var n=r.reduce((function(e,t,n){return t>r[e]?n:e}),0);if(0===n)return null;var i=Math.max(e,d+2*t.length),a=(r[n]-1)/(i/d-1);return{gp:a,Vp:d/a}}function E(e){e.placeholderBuffer=0,e.mostAdvancedSegmentStart=NaN,e.lastSegmentWasReplacement=!1,e.lastSegmentStart=NaN,e.lastSegmentDurationS=NaN,e.lastSegmentRequestTimeMs=NaN,e.lastSegmentFinishTimeMs=NaN}function v(e,t){var r=m.getStableBufferTime();if(e.stableBufferTime!==r){var n=y(r,e.bitrates,e.utilities);if(n.Vp!==e.Vp||n.gp!==e.gp){var i=g.getCurrentBufferLevel(t),a=i+e.placeholderBuffer;a-=d,a*=n.Vp/e.Vp,a+=d,e.stableBufferTime=r,e.Vp=n.Vp,e.gp=n.gp,e.placeholderBuffer=Math.max(0,a-i)}}}function T(e,t){return e.Vp*(e.utilities[t]+e.gp)}function _(e,t){for(var r=e.bitrates[t],n=e.utilities[t],i=0,a=t-1;a>=0;--a)if(e.utilities[a]<e.utilities[t]){var o=e.bitrates[a],s=e.utilities[a],l=e.Vp*(e.gp+(r*s-o*n)/(r-o));i=Math.max(i,l)}return i}function S(e){var t=e.mediaType===f.Z.AUDIO?[f.Z.AUDIO]:a;for(var r in t)a.hasOwnProperty(r)&&2===a[r].state&&(a[r].placeholderBuffer=0)}function A(){for(var e in a)if(a.hasOwnProperty(e)){var t=a[e];0!==t.state&&(t.state=1,E(t))}}function b(e){if(e&&e.chunk&&e.chunk.mediaInfo){var t=a[e.chunk.mediaInfo.type];if(t&&0!==t.state){var r=e.chunk.start;isNaN(t.mostAdvancedSegmentStart)||r>t.mostAdvancedSegmentStart?(t.mostAdvancedSegmentStart=r,t.lastSegmentWasReplacement=!1):t.lastSegmentWasReplacement=!0,t.lastSegmentStart=r,t.lastSegmentDurationS=e.chunk.duration,t.lastQuality=e.chunk.quality,I(t,e.chunk.mediaInfo.type)}}}function R(e){if(e&&e.metric===n.Z.HTTP_REQUEST&&e.value&&e.value.type===o.w.MEDIA_SEGMENT_TYPE&&e.value.trace&&e.value.trace.length){var t=a[e.mediaType];t&&0!==t.state&&(t.lastSegmentRequestTimeMs=e.value.trequest.getTime(),t.lastSegmentFinishTimeMs=e.value._tfinish.getTime(),I(t,e.mediaType))}}function I(e,t){if(!isNaN(e.lastSegmentStart)&&!isNaN(e.lastSegmentRequestTimeMs)&&!isNaN(e.placeholderBuffer)){if(e.placeholderBuffer*=.99,!isNaN(e.lastSegmentFinishTimeMs)){var r=g.getCurrentBufferLevel(t)+.001*(e.lastSegmentFinishTimeMs-e.lastSegmentRequestTimeMs),n=T(e,e.lastQuality),i=Math.max(0,n-r);e.placeholderBuffer=Math.min(i,e.placeholderBuffer)}e.lastSegmentWasReplacement&&!isNaN(e.lastSegmentDurationS)&&(e.placeholderBuffer+=e.lastSegmentDurationS),e.lastSegmentStart=NaN,e.lastSegmentRequestTimeMs=NaN}}function w(e){if(e){var t=a[e.mediaType];t&&0!==t.state&&(t.abrQuality=e.newQuality)}}function C(e){if(e){var t=a[e.mediaType];if(t&&0!==t.state){var r,n=g.getCurrentBufferLevel(e.mediaType);r=t.abrQuality>0?_(t,t.abrQuality):d;var i=Math.max(0,r-n);t.placeholderBuffer=Math.min(t.placeholderBuffer,i)}}}function D(){a={}}return t={getMaxIndex:function(e){var t=(0,i.Z)(h).create();if(!(e&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getMediaType")&&e.hasOwnProperty("getScheduleController")&&e.hasOwnProperty("getStreamInfo")&&e.hasOwnProperty("getAbrController")&&e.hasOwnProperty("useBufferOccupancyABR")))return t;var n=e.getMediaInfo(),o=e.getMediaType(),s=e.getScheduleController(),l=e.getStreamInfo(),u=e.getAbrController(),c=u.getThroughputHistory(),f=l?l.id:null,d=l&&l.manifestInfo&&l.manifestInfo.isDynamic,p=e.useBufferOccupancyABR();if(t.reason=t.reason||{},!p)return t;s.setTimeToLoadDelay(0);var S,A,b,R=(A=(S=e).getMediaType(),(b=a[A])?0!==b.state&&v(b,A):(b=function(e){var t={},r=e.getMediaInfo().bitrateList.map((function(e){return e.bandwidth})),n=r.map((function(e){return Math.log(e)}));n=n.map((function(e){return e-n[0]+1}));var i=m.getStableBufferTime(),a=y(i,r,n);return a?(t.state=1,t.bitrates=r,t.utilities=n,t.stableBufferTime=i,t.Vp=a.Vp,t.gp=a.gp,t.lastQuality=0,E(t)):t.state=0,t}(S),a[A]=b),b);if(0===R.state)return t;var I,w=g.getCurrentBufferLevel(o),C=c.getAverageThroughput(o,d),D=c.getSafeAverageThroughput(o,d),L=c.getAverageLatency(o);if(t.reason.state=R.state,t.reason.throughput=C,t.reason.latency=L,isNaN(C))return t;switch(R.state){case 1:I=u.getQualityForBitrate(n,D,f,L),t.quality=I,t.reason.throughput=D,R.placeholderBuffer=Math.max(0,_(R,I)-w),R.lastQuality=I,!isNaN(R.lastSegmentDurationS)&&w>=R.lastSegmentDurationS&&(R.state=2);break;case 2:!function(e,t){var r=Date.now();if(isNaN(e.lastSegmentFinishTimeMs)){if(!isNaN(e.lastCallTimeMs)){var n=.001*(r-e.lastCallTimeMs);e.placeholderBuffer+=Math.max(0,n)}}else{var i=.001*(r-e.lastSegmentFinishTimeMs);e.placeholderBuffer+=Math.max(0,i)}e.lastCallTimeMs=r,e.lastSegmentStart=NaN,e.lastSegmentRequestTimeMs=NaN,e.lastSegmentFinishTimeMs=NaN,v(e,t)}(R,o),I=function(e,t){for(var r=e.bitrates.length,n=NaN,i=NaN,a=0;a<r;++a){var o=(e.Vp*(e.utilities[a]+e.gp)-t)/e.bitrates[a];(isNaN(i)||o>=i)&&(i=o,n=a)}return n}(R,w+R.placeholderBuffer);var N=u.getQualityForBitrate(n,D,f,L);I>R.lastQuality&&I>N&&(I=Math.max(N,R.lastQuality));var O=Math.max(0,w+R.placeholderBuffer-T(R,I));O<=R.placeholderBuffer?(R.placeholderBuffer-=O,O=0):(O-=R.placeholderBuffer,R.placeholderBuffer=0,I<u.getMaxAllowedIndexFor(o,f)?s.setTimeToLoadDelay(1e3*O):O=0),t.quality=I,t.reason.throughput=C,t.reason.latency=L,t.reason.bufferLevel=w,t.reason.placeholderBuffer=R.placeholderBuffer,t.reason.delay=O,R.lastQuality=I;break;default:r.debug("BOLA ABR rule invoked in bad state."),t.quality=u.getQualityForBitrate(n,D,f,L),t.reason.state=R.state,t.reason.throughput=D,t.reason.latency=L,R.state=1,E(R)}return t},reset:function(){D(),p.off(c.Z.BUFFER_EMPTY,S,t),p.off(c.Z.PLAYBACK_SEEKING,A,t),p.off(c.Z.METRIC_ADDED,R,t),p.off(c.Z.QUALITY_CHANGE_REQUESTED,w,t),p.off(c.Z.FRAGMENT_LOADING_ABANDONED,C,t),p.off(l.Z.MEDIA_FRAGMENT_LOADED,b,t)}},r=(0,u.Z)(h).getInstance().getLogger(t),D(),p.on(c.Z.BUFFER_EMPTY,S,t),p.on(c.Z.PLAYBACK_SEEKING,A,t),p.on(c.Z.METRIC_ADDED,R,t),p.on(c.Z.QUALITY_CHANGE_REQUESTED,w,t),p.on(c.Z.FRAGMENT_LOADING_ABANDONED,C,t),p.on(l.Z.MEDIA_FRAGMENT_LOADED,b,t),t}h.__dashjs_factory_name="BolaRule",t.Z=a.Z.getClassFactory(h)},895:function(e,t,r){var n=r(5448),i=r(2068),a=r(6398);function o(){var e,t,r=this.context;return e={getMaxIndex:function(e){var n=(0,i.Z)(r).create();if(!e||!e.hasOwnProperty("getDroppedFramesHistory"))return n;var a=e.getDroppedFramesHistory(),o=e.getStreamInfo().id;if(a){var s=a.getFrameHistory(o);if(!s||0===s.length)return n;for(var l=0,u=0,c=i.Z.NO_CHANGE,f=1;f<s.length;f++)if(s[f]&&(l=s[f].droppedVideoFrames,(u=s[f].totalVideoFrames)>375&&l/u>.15)){c=f-1,t.debug("index: "+c+" Dropped Frames: "+l+" Total Frames: "+u);break}return(0,i.Z)(r).create(c,{droppedFrames:l})}return n}},t=(0,a.Z)(r).getInstance().getLogger(e),e}o.__dashjs_factory_name="DroppedFramesRule",t.Z=n.Z.getClassFactory(o)},6535:function(e,t,r){var n=r(5595),i=r(8512),a=r(5448),o=r(6398),s=r(2068),l=r(3393),u=r(3860),c=r(8825);function f(e){e=e||{};var t,r,a,f=this.context,d=(0,n.Z)(f).getInstance(),h=e.dashMetrics;function g(){(a={})[l.Z.VIDEO]={ignoreCount:2},a[l.Z.AUDIO]={ignoreCount:2}}function m(){g()}function p(e){isNaN(e.startTime)||e.mediaType!==l.Z.AUDIO&&e.mediaType!==l.Z.VIDEO||a[e.mediaType].ignoreCount>0&&a[e.mediaType].ignoreCount--}return t={getMaxIndex:function(e){var t=(0,s.Z)(f).create();if(!e||!e.hasOwnProperty("getMediaType"))return t;!function(){if(!h||!h.hasOwnProperty("getCurrentBufferLevel")||!h.hasOwnProperty("getCurrentBufferState"))throw new Error(l.Z.MISSING_CONFIG_ERROR)}();var n,i,o=e.getMediaType(),c=h.getCurrentBufferState(o),d=e.getRepresentationInfo().fragmentDuration,g=e.getStreamInfo(),m=g?g.id:null,p=e.getScheduleController(),y=g&&g.manifestInfo&&g.manifestInfo.isDynamic;if(n=p.getPlaybackController().getLowLatencyModeEnabled(),i=o,!n&&a[i].ignoreCount>0||!d)return t;if(c&&c.state===u.Z.BUFFER_EMPTY)r.debug("["+o+"] Switch to index 0; buffer is empty."),t.quality=0,t.reason="InsufficientBufferRule: Buffer is empty";else{var E=e.getMediaInfo(),v=e.getAbrController(),T=v.getThroughputHistory(),_=h.getCurrentBufferLevel(o),S=T.getAverageThroughput(o,y),A=T.getAverageLatency(o),b=S*(_/d)*.5;t.quality=v.getQualityForBitrate(E,b,m,A),t.reason="InsufficientBufferRule: being conservative to avoid immediate rebuffering"}return t},reset:function(){g(),d.off(c.Z.PLAYBACK_SEEKING,m,t),d.off(i.Z.BYTES_APPENDED_END_FRAGMENT,p,t)}},r=(0,o.Z)(f).getInstance().getLogger(t),g(),d.on(c.Z.PLAYBACK_SEEKING,m,t),d.on(i.Z.BYTES_APPENDED_END_FRAGMENT,p,t),t}f.__dashjs_factory_name="InsufficientBufferRule",t.Z=a.Z.getClassFactory(f)},1914:function(e,t,r){var n=r(3860),i=r(2068),a=r(5448),o=r(7855),s=r(5595),l=r(8512),u=r(6398),c=r(3393);function f(e){e=e||{};var t,r,a,f,d=this.context,h=e.dashMetrics,g=(0,s.Z)(d).getInstance();function m(e){e.placeholderBuffer=0,e.mostAdvancedSegmentStart=NaN,e.lastSegmentWasReplacement=!1,e.lastSegmentStart=NaN,e.lastSegmentDurationS=NaN,e.lastSegmentRequestTimeMs=NaN,e.lastSegmentFinishTimeMs=NaN,e.lastSegmentUrl=""}function p(){for(var e in r)if(r.hasOwnProperty(e)){var t=r[e];0!==t.state&&(t.state=1,m(t))}}function y(e){if(e&&e.chunk&&e.chunk.mediaInfo){var t=r[e.chunk.mediaInfo.type],n=a[e.chunk.mediaInfo.type];if(t&&0!==t.state){var i=e.chunk.start;isNaN(t.mostAdvancedSegmentStart)||i>t.mostAdvancedSegmentStart?(t.mostAdvancedSegmentStart=i,t.lastSegmentWasReplacement=!1):t.lastSegmentWasReplacement=!0,t.lastSegmentStart=i,t.lastSegmentDurationS=e.chunk.duration,t.lastQuality=e.chunk.quality,v(t,n)}}}function E(e){if(e&&e.metric===n.Z.HTTP_REQUEST&&e.value&&e.value.type===o.w.MEDIA_SEGMENT_TYPE&&e.value.trace&&e.value.trace.length){var t=r[e.mediaType],i=a[e.mediaType];t&&0!==t.state&&(t.lastSegmentRequestTimeMs=e.value.trequest.getTime(),t.lastSegmentFinishTimeMs=e.value._tfinish.getTime(),v(t,i))}}function v(e,t){isNaN(e.lastSegmentStart)||isNaN(e.lastSegmentRequestTimeMs)||(t.segment_request_start_s=.001*e.lastSegmentRequestTimeMs,t.segment_download_finish_s=.001*e.lastSegmentFinishTimeMs,e.lastSegmentStart=NaN,e.lastSegmentRequestTimeMs=NaN)}function T(e){if(e&&e.mediaType){var t=r[e.mediaType];t&&0!==t.state&&(t.abrQuality=e.newQuality)}}function _(e,t){if(e.length!==t.length)return-1;for(var r=0,n=0;n<e.length;n++)r+=e[n]*t[n];return r}function S(){r={},a={}}return t={getMaxIndex:function(e){var t,n=(0,i.Z)(d).create(),s=Math.pow(4,.99),l=Math.max(Math.pow(4,1),s*Math.sqrt(4)),u=e.getMediaInfo(),g=e.getMediaType(),p=u.bitrateList.map((function(e){return e.bandwidth})),y=p.length,E=e.getScheduleController(),v=e.getStreamInfo(),T=e.getAbrController(),S=T.getThroughputHistory(),A=v&&v.manifestInfo&&v.manifestInfo.isDynamic,b=e.useL2AABR(),R=h.getCurrentBufferLevel(g,!0),I=S.getSafeAverageThroughput(g,A),w=S.getAverageThroughput(g,A),C=S.getAverageLatency(g),D=e.getVideoModel().getPlaybackRate();if(!(e&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getMediaType")&&e.hasOwnProperty("getScheduleController")&&e.hasOwnProperty("getStreamInfo")&&e.hasOwnProperty("getAbrController")&&e.hasOwnProperty("useL2AABR")))return n;if(n.reason=n.reason||{},!b||g===c.Z.AUDIO)return n;E.setTimeToLoadDelay(0);var L,N,O,M,P,k,x,F=(k=(L=e).getMediaType(),(x=r[k])||(O={},M=L.getMediaInfo(),P=M.bitrateList.map((function(e){return e.bandwidth/1e3})),O.state=1,O.bitrates=P,O.lastQuality=0,(N=M)&&N.type&&(a[N.type]={},a[N.type].w=[],a[N.type].prev_w=[],a[N.type].Q=0,a[N.type].segment_request_start_s=0,a[N.type].segment_download_finish_s=0,a[N.type].B_target=1.5),m(O),x=O,r[k]=x),x);if(0===F.state)return n;var U=a[g];if(!U)return n;if(n.reason.state=F.state,n.reason.throughput=w,n.reason.latency=C,isNaN(w))return n;switch(F.state){case 1:if(t=T.getQualityForBitrate(u,I,v.id,C),n.quality=t,n.reason.throughput=I,F.lastQuality=t,!isNaN(F.lastSegmentDurationS)&&R>=U.B_target){F.state=2,U.Q=s;for(var B=0;B<y;++B)B===F.lastQuality?U.prev_w[B]=1:U.prev_w[B]=0}break;case 2:var Z=[],G=h.getCurrentHttpRequest(g).trace.reduce((function(e,t){return e+t.d}),0),H=h.getCurrentHttpRequest(g).trace.reduce((function(e,t){return e+t.b[0]}),0),K=Math.round(8*H/G),Y=h.getCurrentHttpRequest(g);if(K<1&&(K=1),Y.url===F.lastSegmentUrl||Y.type===o.w.INIT_SEGMENT_TYPE)t=F.lastQuality;else{for(var q=F.lastSegmentDurationS,V=1,j=0;j<y;++j)p[j]=p[j]/1e3,D*p[j]>K&&(V=-1),U.w[j]=U.prev_w[j]+V*(q/(2*l))*((U.Q+s)*(D*p[j]/K));U.w=function(e){for(var t=e.length,r=!1,n=[],i=0;i<t;++i)n[i]=e[i];for(var a=e.sort((function(e,t){return t-e})),o=0,s=0,l=[],u=0;u<t-1;++u)if((s=((o+=a[u])-1)/(u+1))>=a[u+1]){r=!0;break}r||(s=(o+a[t-1]-1)/t);for(var c=0;c<t;++c)l[c]=Math.max(n[c]-s,0);return l}(U.w);for(var $=0;$<y;++$)Z[$]=U.w[$]-U.prev_w[$],U.prev_w[$]=U.w[$];U.Q=Math.max(0,U.Q-q+q*D*((_(p,U.prev_w)+_(p,Z))/K));for(var z=[],W=0;W<y;++W)z[W]=Math.abs(p[W]-_(U.w,p));(t=z.indexOf(Math.min.apply(Math,z)))>F.lastQuality&&p[F.lastQuality+1]<=K&&(t=F.lastQuality+1),p[t]>=K&&(U.Q=2*Math.max(s,U.Q)),F.lastSegmentUrl=Y.url}n.quality=t,n.reason.throughput=w,n.reason.latency=C,n.reason.bufferLevel=R,F.lastQuality=n.quality;break;default:f.debug("L2A ABR rule invoked in bad state."),n.quality=T.getQualityForBitrate(u,I,v.id,C),n.reason.state=F.state,n.reason.throughput=I,n.reason.latency=C,F.state=1,m(F)}return n},reset:function(){S(),g.off(l.Z.PLAYBACK_SEEKING,p,t),g.off(l.Z.MEDIA_FRAGMENT_LOADED,y,t),g.off(l.Z.METRIC_ADDED,E,t),g.off(l.Z.QUALITY_CHANGE_REQUESTED,T,t)}},f=(0,u.Z)(d).getInstance().getLogger(t),S(),g.on(l.Z.PLAYBACK_SEEKING,p,t),g.on(l.Z.MEDIA_FRAGMENT_LOADED,y,t),g.on(l.Z.METRIC_ADDED,E,t),g.on(l.Z.QUALITY_CHANGE_REQUESTED,T,t),t}f.__dashjs_factory_name="L2ARule",t.Z=a.Z.getClassFactory(f)},6070:function(e,t,r){var n=r(5448),i=r(6398),a=r(2068);function o(){var e,t,r=this.context;return e={getMaxIndex:function(e){for(var n=e?e.getSwitchHistory():null,i=n?n.getSwitchRequests():[],o=0,s=0,l=0,u=(0,a.Z)(r).create(),c=0;c<i.length;c++)if(void 0!==i[c]&&(o+=i[c].drops,s+=i[c].noDrops,l+=i[c].dropSize,o+s>=6&&o/s>.075)){u.quality=c>0&&i[c].drops>0?c-1:c,u.reason={index:u.quality,drops:o,noDrops:s,dropSize:l},t.debug("Switch history rule index: "+u.quality+" samples: "+(o+s)+" drops: "+o);break}return u}},t=(0,i.Z)(r).getInstance().getLogger(e),e}o.__dashjs_factory_name="SwitchHistoryRule",t.Z=n.Z.getClassFactory(o)},5628:function(e,t,r){var n=r(5448),i=r(2068),a=r(3393),o=r(3860);function s(e){e=e||{};var t=this.context,r=e.dashMetrics;return{getMaxIndex:function(e){var n=(0,i.Z)(t).create();if(!(e&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getMediaType")&&e.hasOwnProperty("useBufferOccupancyABR")&&e.hasOwnProperty("getAbrController")&&e.hasOwnProperty("getScheduleController")))return n;!function(){if(!r||!r.hasOwnProperty("getCurrentBufferState"))throw new Error(a.Z.MISSING_CONFIG_ERROR)}();var s=e.getMediaInfo(),l=e.getMediaType(),u=r.getCurrentBufferState(l),c=e.getScheduleController(),f=e.getAbrController(),d=e.getStreamInfo(),h=d?d.id:null,g=d&&d.manifestInfo?d.manifestInfo.isDynamic:null,m=f.getThroughputHistory(),p=m.getSafeAverageThroughput(l,g),y=m.getAverageLatency(l),E=e.useBufferOccupancyABR();return isNaN(p)||!u||E||f.getAbandonmentStateFor(h,l)!==o.Z.ABANDON_LOAD&&(u.state===o.Z.BUFFER_LOADED||g)&&(n.quality=f.getQualityForBitrate(s,p,h,y),c.setTimeToLoadDelay(0),n.reason={throughput:p,latency:y}),n},reset:function(){}}}s.__dashjs_factory_name="ThroughputRule",t.Z=n.Z.getClassFactory(s)},4722:function(e,t,r){var n=r(5448),i=r(6398);function a(){var e,t,r,n,a,o,s,l,u,c=this.context;function f(){r=null,n=1,a=100,o=0,s=null,l=null,u="dynamic_weight_selection"}function d(){var e=0;if(r)for(var t=0;t<r.length;t++){var n=r[t];n.state.throughput>e&&(e=n.state.throughput)}return e}function h(e,t,r){var n=e.map((function(e,n){return r[n]*Math.pow(e-t[n],2)})).reduce((function(e,t){return e+t}));return(n<0?-1:1)*Math.sqrt(Math.abs(n))}function g(e,t){return h([e.state.throughput,e.state.latency,e.state.rebuffer,e.state.switch],[t.state.throughput,t.state.latency,t.state.rebuffer,t.state.switch],[1,1,1,1])}function m(e,t,r){for(var n=0;n<t.length;n++){var i=t[n],a=g(i,e);p(i,r,Math.exp(-1*Math.pow(a,2)/(2*Math.pow(.1,2))))}}function p(e,t,r){var n=e.state,i=[.01,.01,.01,.01];n.throughput=n.throughput+(t[0]-n.throughput)*i[0]*r,n.latency=n.latency+(t[1]-n.latency)*i[1]*r,n.rebuffer=n.rebuffer+(t[2]-n.rebuffer)*i[2]*r,n.switch=n.switch+(t[3]-n.switch)*i[3]*r}return e={getNextQuality:function(e,i,c,f,g,p,y){var E=c,v=f,T=i,_=function(e){if(!r){r=[];var t=e.bitrateList,i=[];o=t[0].bandwidth,t.forEach((function(e){i.push(e.bandwidth),e.bandwidth<o&&(o=e.bandwidth)})),u=i.map((function(e){return Math.pow(e,2)})).reduce((function(e,t){return e+t})),n=Math.sqrt(u);for(var a=0;a<t.length;a++){var s={qualityIndex:a,bitrate:t[a].bandwidth,state:{throughput:t[a].bandwidth/n,latency:0,rebuffer:0,switch:0}};r.push(s)}l=function(e){var t=[],r=function(e){for(var t=[],r=0;r<e;r++){var n=[Math.random()*d(),Math.random(),Math.random(),Math.random()];t.push(n)}return t}(Math.pow(e.length,2));t.push(r[0]);for(var n=[1,1,1,1],i=1;i<e.length;i++){for(var a=null,o=null,s=0;s<r.length;s++){for(var l=r[s],u=null,c=0;c<t.length;c++){var f=h(l,t[c],n);(null===u||f<u)&&(u=f)}(null===o||u>o)&&(a=l,o=u)}t.push(a)}for(var g=null,m=null,p=0;p<t.length;p++){for(var y=0,E=0;E<t.length;E++)p!==E&&(y+=h(t[p],t[E],n));(null===g||y>g)&&(g=y,m=p)}var v=[];for(v.push(t[m]),t.splice(m,1);t.length>0;){for(var T=null,_=null,S=0;S<t.length;S++){var A=h(v[0],t[S],n);(null===T||A<T)&&(T=A,_=S)}v.push(t[_]),t.splice(_,1)}return v}(r)}var u;return r}(e),S=i/n;S>1&&(S=d()),c/=a,t.debug("getNextQuality called throughput:".concat(S," latency:").concat(c," bufferSize:").concat(f," currentQualityIndex:").concat(p," playbackRate:").concat(g));var A=_[p],b=A.bitrate*y.getSegmentDuration()/T,R=Math.max(0,b-v);if(v-b<y.getMinBuffer())return t.debug("Buffer is low for bitrate= ".concat(A.bitrate," downloadTime=").concat(b," currentBuffer=").concat(v," rebuffer=").concat(R)),function(e,t){var n=0,i=e;if(r)for(var a=0;a<r.length;a++){var o=r[a];o.bitrate<e.bitrate&&o.bitrate>n&&t>o.bitrate&&(n=o.bitrate,i=o)}return i}(A,T).qualityIndex;switch(u){case"manual_weight_selection":s=[.4,.4,.4,.4];break;case"random_weight_selection":s=function(e,t){for(var r=[],n=Math.sqrt(2/e),i=0;i<4;i++)r.push(Math.random()*n);return s=r}(_.length);break;default:!function(e,t,r,n,i,a,o){s||(s=l[l.length-1]);var u=e.findWeightVector(t,r,n,i,a,o);null!==u&&-1!==u&&(s=u)}(y,_,E,v,R,T,g)}for(var I=null,w=null,C=null,D=0;D<_.length;D++){var L=_[D],N=L.state,O=[N.throughput,N.latency,N.rebuffer,N.switch],M=s.slice(),P=y.getNextBufferWithBitrate(L.bitrate,v,T),k=P<y.getMinBuffer();k&&t.debug("Buffer is low for bitrate=".concat(L.bitrate," downloadTime=").concat(b," currentBuffer=").concat(v," nextBuffer=").concat(P)),(L.bitrate>i-1e4||k)&&L.bitrate!==o&&(M[0]=100);var x=h(O,[S,0,0,0],M);(null===I||x<I)&&(I=x,w=L.qualityIndex,C=L)}var F=Math.abs(A.bitrate-C.bitrate)/n;return m(A,_,[S,c,R,F]),m(C,_,[S,0,0,F]),w},reset:function(){f()}},t=(0,i.Z)(c).getInstance().getLogger(e),f(),e}a.__dashjs_factory_name="LearningAbrController",t.Z=n.Z.getClassFactory(a)},5317:function(e,t,r){var n=r(5448),i=r(2298);function a(){var e,t,r,n,a;function o(){t=null,r=null,n=null,a=null}function s(e,t,r,n){var a=new i.Z;return a.type=e,a.weights.bitrateReward=t||1,a.weights.bitrateSwitchPenalty=1,a.weights.rebufferPenalty=r||1e3,a.weights.latencyPenalty=[],a.weights.latencyPenalty.push({threshold:1.1,penalty:.05*n}),a.weights.latencyPenalty.push({threshold:1e8,penalty:.1*r}),a.weights.playbackSpeedPenalty=n||200,a}function l(e,t,r,n,i){i.bitrateWSum+=i.weights.bitrateReward*e,i.lastBitrate&&(i.bitrateSwitchWSum+=i.weights.bitrateSwitchPenalty*Math.abs(e-i.lastBitrate)),i.lastBitrate=e,i.rebufferWSum+=i.weights.rebufferPenalty*t;for(var a=0;a<i.weights.latencyPenalty.length;a++){var o=i.weights.latencyPenalty[a];if(r<=o.threshold){i.latencyWSum+=o.penalty*r;break}}i.playbackSpeedWSum+=i.weights.playbackSpeedPenalty*Math.abs(1-n),i.totalQoe=i.bitrateWSum-i.bitrateSwitchWSum-i.rebufferWSum-i.latencyWSum-i.playbackSpeedWSum}return e={setupPerSegmentQoe:function(e,i,o){t=s("segment",e,i,o),r=e,n=i,a=o},logSegmentMetrics:function(e,r,n,i){t&&l(e,r,n,i,t)},getPerSegmentQoe:function(){return t},calculateSingleUseQoe:function(e,t,i,o){var u=null;return r&&n&&a&&(u=s("segment",r,n,a)),u?(l(e,t,i,o,u),u.totalQoe):0},reset:function(){o()}},o(),e}a.__dashjs_factory_name="LoLpQoeEvaluator",t.Z=n.Z.getClassFactory(a)},5435:function(e,t,r){var n=r(6398),i=r(5448),a=r(4722),o=r(5317),s=r(2068),l=r(3860),u=r(6523),c=r(3393);function f(e){var t,r,i,f,d=(e=e||{}).dashMetrics,h=this.context;return r={getMaxIndex:function(e){try{var r=(0,s.Z)(h).create(),n=e.getMediaInfo().type,a=e.getAbrController(),o=e.getStreamInfo(),g=a.getQualityFor(n,o.id),m=e.getMediaInfo(),p=d.getCurrentBufferState(n),y=e.getScheduleController(),E=d.getCurrentBufferLevel(n,!0),v=o&&o.manifestInfo?o.manifestInfo.isDynamic:null,T=y.getPlaybackController(),_=T.getCurrentLiveLatency();if(!e.useLoLPABR()||n===c.Z.AUDIO)return r;_||(_=0);var S=T.getPlaybackRate(),A=a.getThroughputHistory().getSafeAverageThroughput(n,v);if(t.debug("Throughput ".concat(Math.round(A)," kbps")),isNaN(A)||!p)return r;if(a.getAbandonmentStateFor(o.id,n)===l.Z.ABANDON_LOAD)return r;for(var b=m.bitrateList,R=e.getRepresentationInfo().fragmentDuration,I=b[0].bandwidth/1e3,w=b[b.length-1].bandwidth/1e3,C=0;C<b.length;C++){var D=b[C].bandwidth/1e3;D>w?w=D:D<I&&(I=D)}var L=b[g].bandwidth/1e3,N=d.getCurrentHttpRequest(n,!0),O=(N.tresponse.getTime()-N.trequest.getTime())/1e3,M=O>R?O-R:0;f.setupPerSegmentQoe(R,w,I),f.logSegmentMetrics(L,M,_,S);var P=(0,u.Z)(h).create({targetLatency:1.5,bufferMin:.3,segmentDuration:R,qoeEvaluator:f});return r.quality=i.getNextQuality(m,1e3*A,_,E,S,g,P),r.reason={throughput:A,latency:_},r.priority=s.Z.PRIORITY.STRONG,y.setTimeToLoadDelay(0),r.quality!==g&&t.debug("[TgcLearningRule]["+n+"] requesting switch to index: ",r.quality,"Average throughput",Math.round(A),"kbps"),r}catch(k){throw k}},reset:function(){i.reset(),f.reset()}},t=(0,n.Z)(h).getInstance().getLogger(r),i=(0,a.Z)(h).create(),f=(0,o.Z)(h).create(),r}f.__dashjs_factory_name="LoLPRule",t.Z=i.Z.getClassFactory(f)},6523:function(e,t,r){var n=r(5448);function i(e){var t,r,n,i,a=e.targetLatency,o=e.bufferMin,s=e.segmentDuration,l=e.qoeEvaluator;function u(){return s}function c(e,t){var r=u();return t>r?e-r:e+r-t}return t={getMinBuffer:function(){return o},getSegmentDuration:u,getNextBufferWithBitrate:function(e,t,r){return c(t,e*s/r)},getNextBuffer:c,findWeightVector:function(e,t,i,u,f,d){var h=null,g=null,m=null,p=Math.abs(t-n);return e.forEach((function(e){r.forEach((function(r){r[0];var n,u=r[1],y=r[2],E=(r[3],e.bitrate*s/f),v=c(i,E),T=(0===y?10:1/y)*Math.max(1e-5,E-v),_=(0===u?10:1/u)*e.state.latency,S=l.calculateSingleUseQoe(e.bitrate,T,_,d);(null===h||S>h)&&(n=v,!(t>a+p)&&n>=o)&&(h=S,g=r,m=e.bitrate)}))})),null===g&&null===m&&(g=-1),n=t,g}},r=function e(t,r,n){if(n===r)return t;for(var a=t.length,o=0;o<a;o++)for(var s=t.shift(),l=0;l<i.length;l++)t.push(s.concat(i[l]));return e(t,r,n+1)}((i=[.2,.4,.6,.8,1]).map((function(e){return[e]})),4,1),n=0,t}i.__dashjs_factory_name="LoLpWeightSelector",t.Z=n.Z.getClassFactory(i)},2298:function(e,t){t.Z=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type=null,this.lastBitrate=null,this.weights={},this.weights.bitrateReward=null,this.weights.bitrateSwitchPenalty=null,this.weights.rebufferPenalty=null,this.weights.latencyPenalty=null,this.weights.playbackSpeedPenalty=null,this.bitrateWSum=0,this.bitrateSwitchWSum=0,this.rebufferWSum=0,this.latencyWSum=0,this.playbackSpeedWSum=0,this.totalQoe=0}},7803:function(e,t,r){r.d(t,{Y:function(){return h}});var n=r(3393),i=r(1553),a=r(5448),o=r(2128),s=r(2594),l=r(7387),u=r(7417),c=r(9032),f=r(9326),d=r(7802),h=["http://dashif.org/thumbnail_tile","http://dashif.org/guidelines/thumbnail_tile"];function g(e){var t,r,a,g,m,p,y,E,v=this.context,T=e.adapter,_=e.baseURLController,S=e.streamInfo,A=e.timelineConverter,b=e.debug,R=e.eventBus,I=e.events,w=e.dashConstants,C=(0,s.Z)(v).getInstance();function D(e,t){var n,i,a=new o.Z;a.id=e.id,a.bitrate=e.bandwidth,a.width=e.width,a.height=e.height,a.tilesHor=1,a.tilesVert=1,e.essentialProperties&&e.essentialProperties.forEach((function(e){if(h.indexOf(e.schemeIdUri)>=0&&e.value){var t=e.value.split("x");2!==t.length||isNaN(t[0])||isNaN(t[1])||(a.tilesHor=parseInt(t[0],10),a.tilesVert=parseInt(t[1],10))}})),t?p.updateSegmentData(e).then((function(t){var r,n,i,o;r=a,i=[],o=function(e,t){var r,n,i,a,o=[],s=0;for(r=0,n=e.segments.length;r<n;r++)i=e.segments[r],(a=(0,l.TJ)(A,T.getIsDynamic(),t,i.startTime,i.duration,i.timescale,i.media,i.mediaRange,s))&&(o.push(a),a=null,s++);return o}(t,n=e),n.segments=o,r.segmentDuration=n.segments[0].duration,r.readThumbnail=function(e,t){var r=null;i.some((function(t){if(t.start<=e&&t.end>e)return r=t.url,!0})),r?t(r):n.segments.some((function(r){if(r.mediaStartTime<=e&&r.mediaStartTime+r.duration>e){var a=_.resolve(n.path);return y.load({method:"get",url:a.url,request:{range:r.mediaRange,responseType:"arraybuffer"},onload:function(e){var n=E.getSamplesInfo(e.target.response),a=new Blob([e.target.response.slice(n.sampleList[0].offset,n.sampleList[0].offset+n.sampleList[0].size)],{type:"image/jpeg"}),o=window.URL.createObjectURL(a);i.push({start:r.mediaStartTime,end:r.mediaStartTime+r.duration,url:o}),t&&t(o)}}),!0}}))}})):(a.startNumber=e.startNumber,a.segmentDuration=e.segmentDuration,a.timescale=e.timescale,a.templateUrl=(n=e,(i=C.isRelative(n.media)?C.resolve(n.media,_.resolve(n.path).url):n.media)?(0,l.Aj)(i,n.id):"")),a.tilesHor>0&&a.tilesVert>0&&(a.widthPerTile=a.width/a.tilesHor,a.heightPerTile=a.height/a.tilesVert,r.push(a))}function L(){r=[],g=-1,m=null}return t={getTracks:function(){return r},addTracks:function(){if(S&&T&&(m=T.getMediaInfoForType(S,n.Z.IMAGE))){var e=T.getVoRepresentations(m);e&&e.length>0&&e.forEach((function(e){(e.segmentInfoType===i.Z.SEGMENT_TEMPLATE&&e.segmentDuration>0&&e.media||e.segmentInfoType===i.Z.SEGMENT_TIMELINE)&&D(e),e.segmentInfoType===i.Z.SEGMENT_BASE&&D(e,!0)})),r.length>0&&r.sort((function(e,t){return e.bitrate-t.bitrate}))}},reset:L,setTrackByIndex:function(e){r&&0!==r.length&&(e>=r.length&&(e=r.length-1),g=e)},getCurrentTrack:function(){return g<0?null:r[g]},getCurrentTrackIndex:function(){return g},getThumbnailRequestForTime:function(e){for(var t,n=T.getVoRepresentations(m),i=0;i<n.length;i++)if(r[g].id===n[i].id){t=n[i];break}return a.getSegmentRequestForTime(m,t,e)}},L(),y=(0,c.Z)(v).create({}),E=(0,u.Z)(v).getInstance(),p=(0,d.Z)(v).create({events:I,eventBus:R,streamInfo:S,timelineConverter:A,dashConstants:w,dashMetrics:e.dashMetrics,segmentBaseController:e.segmentBaseController,type:n.Z.IMAGE}),(a=(0,f.Z)(v).create({streamInfo:S,type:n.Z.IMAGE,timelineConverter:A,segmentsController:p,baseURLController:_,debug:b,eventBus:R,events:I,dashConstants:w,urlUtils:C})).initialize(!!T&&T.getIsDynamic()),t}g.__dashjs_factory_name="ThumbnailTracks",t.Z=a.Z.getClassFactory(g)},7417:function(e,t,r){var n=r(6398),i=r(8260),a=r(5448),o=r(6934),s=r(9597);function l(){var e,t,r=this.context;function a(e){if(!e)return null;void 0===e.fileStart&&(e.fileStart=0);var t=o.parseBuffer(e),n=(0,i.Z)(r).create();return n.setData(t),n}function l(e,t){return e[t+3]>>>0|e[t+2]<<8>>>0|e[t+1]<<16>>>0|e[t]<<24>>>0}function u(e,t){return String.fromCharCode(e[t++])+String.fromCharCode(e[t++])+String.fromCharCode(e[t++])+String.fromCharCode(e[t])}return t={parse:a,findLastTopIsoBoxCompleted:function(e,t,r){if(void 0===r&&(r=0),!t||r+8>=t.byteLength)return new s.Z(0,!1);for(var n,i=t instanceof ArrayBuffer?new Uint8Array(t):t,a=0;r<i.byteLength;){var o=l(i,r),c=u(i,r+4);if(0===o)break;r+o<=i.byteLength&&(e.indexOf(c)>=0?n=new s.Z(r,!0,o):a=r+o),r+=o}return n||new s.Z(a,!1)},getMediaTimescaleFromMoov:function(e){var t=a(e),r=t?t.getBox("mdhd"):void 0;return r?r.timescale:NaN},getSamplesInfo:function(e){if(!e||0===e.byteLength)return{sampleList:[],lastSequenceNumber:NaN,totalDuration:NaN,numSequences:NaN};var t,r,n,i,o,s,l,u,c,f,d,h,g,m,p,y,E=a(e),v=E.getBoxes("moof"),T=E.getBoxes("mfhd");p=E.getBoxes("moof").length,m=T[T.length-1].sequence_number,r=0,o=[];var _=-1,S=-1;for(f=0;f<v.length;f++){var A=v[f],b=A.getChildBoxes("traf");for(u=0;u<b.length;u++){var R=b[u],I=R.getChildBox("tfhd"),w=R.getChildBox("tfdt");i=w.baseMediaDecodeTime;var C=R.getChildBoxes("trun"),D=R.getChildBoxes("subs");for(c=0;c<C.length;c++){var L=C[c];for(r=L.sample_count,g=(I.base_data_offset||0)+(L.data_offset||0),l=0;l<r;l++){t=void 0!==(s=L.samples[l]).sample_duration?s.sample_duration:I.default_sample_duration,n=void 0!==s.sample_size?s.sample_size:I.default_sample_size;var N={dts:i,cts:i+(void 0!==s.sample_composition_time_offset?s.sample_composition_time_offset:0),duration:t,offset:A.offset+g,size:n,subSizes:[n]};if(D)for(d=0;d<D.length;d++){var O=D[d];if(_<O.entry_count-1&&l>S&&(_++,S+=O.entries[_].sample_delta),l==S){N.subSizes=[];var M=O.entries[_];for(h=0;h<M.subsample_count;h++)N.subSizes.push(M.subsamples[h].subsample_size)}}o.push(N),g+=n,i+=t}}y=i-w.baseMediaDecodeTime}}return{sampleList:o,lastSequenceNumber:m,totalDuration:y,numSequences:p}},findInitRange:function(t){var r=null,n=a(t);if(!n)return r;var i=n.getBox("ftyp"),o=n.getBox("moov");return e.debug("Searching for initialization."),o&&o.isComplete&&(r=(i?i.offset:o.offset)+"-"+(o.offset+o.size-1),e.debug("Found the initialization.  Range: "+r)),r},parsePayload:function(e,t,r){if(void 0===r&&(r=0),!t||r+8>=t.byteLength)return new s.Z(0,!1);for(var n,i=t instanceof ArrayBuffer?new Uint8Array(t):t,a=0;r<i.byteLength;){var o=l(i,r),c=u(i,r+4);if(0===o)break;r+o<=i.byteLength&&(e.indexOf(c)>=0?n=new s.Z(r,!0,o,c):a=r+o),r+=o}return n||new s.Z(a,!1)}},e=(0,n.Z)(r).getInstance().getLogger(t),t}l.__dashjs_factory_name="BoxParser",t.Z=a.Z.getSingletonFactory(l)},1715:function(e,t,r){r.d(t,{B:function(){return s}});var n=r(5448),i=r(7803),a=r(3393),o=[{codec:"avc1",compatibleCodecs:["avc3"]},{codec:"avc3",compatibleCodecs:["avc1"]}];function s(){var e="ManagedMediaSource"in window,t="WebKitMediaSource"in window,r="MediaSource"in window;return e||t||r}function l(){var e,t,r;return e={setConfig:function(e){e&&e.settings&&(t=e.settings)},supportsMediaSource:s,supportsEncryptedMedia:function(){return r},supportsCodec:function(e,r){return r!==a.Z.AUDIO&&r!==a.Z.VIDEO?Promise.resolve(!0):(n=e,i=r,t.get().streaming.capabilities.useMediaCapabilitiesApi&&navigator.mediaCapabilities&&navigator.mediaCapabilities.decodingInfo&&(n.codec&&i===a.Z.AUDIO||i===a.Z.VIDEO&&n.codec&&n.width&&n.height&&n.bitrate&&n.framerate)?function(e,t){return new Promise((function(r){if(e&&e.codec){var n={type:"media-source"};n[t]={},n[t].contentType=e.codec,n[t].width=e.width,n[t].height=e.height,n[t].bitrate=parseInt(e.bitrate),n[t].framerate=parseFloat(e.framerate),navigator.mediaCapabilities.decodingInfo(n).then((function(e){r(e.supported)})).catch((function(){r(!1)}))}else r(!1)}))}(e,r):function(e){return new Promise((function(t){if(e&&e.codec){var r=e.codec;e.width&&e.height&&(r+=';width="'+e.width+'";height="'+e.height+'"'),"ManagedMediaSource"in window&&ManagedMediaSource.isTypeSupported(r)||"MediaSource"in window&&MediaSource.isTypeSupported(r)||"WebKitMediaSource"in window&&WebKitMediaSource.isTypeSupported(r)?t(!0):t(!1)}else t(!1)}))}(e));var n,i},setEncryptedMediaSupported:function(e){r=e},supportsEssentialProperty:function(e){try{return-1!==i.Y.indexOf(e.schemeIdUri)||a.Z.FONT_DOWNLOAD_DVB_SCHEME===e.schemeIdUri}catch(t){return!0}},codecRootCompatibleWithCodec:function(e,t){for(var r,n=e.split(".")[0],i=0===t.indexOf(n),a=0;a<o.length;a++)if(o[a].codec===n){r=o[a];break}return r?i||r.compatibleCodecs.some((function(e){return 0===t.indexOf(e)})):i}},r=!1,e}l.__dashjs_factory_name="Capabilities",t.Z=n.Z.getSingletonFactory(l)},2295:function(e,t,r){var n=r(5448),i=r(3106);function a(){return{customTimeRangeArray:[],length:0,add:function(e,t){var r;for(r=0;r<this.customTimeRangeArray.length&&e>this.customTimeRangeArray[r].start;r++);for(this.customTimeRangeArray.splice(r,0,{start:e,end:t}),r=0;r<this.customTimeRangeArray.length-1;r++)this.mergeRanges(r,r+1)&&r--;this.length=this.customTimeRangeArray.length},clear:function(){this.customTimeRangeArray=[],this.length=0},remove:function(e,t){for(var r=0;r<this.customTimeRangeArray.length;r++)if(e<=this.customTimeRangeArray[r].start&&t>=this.customTimeRangeArray[r].end)this.customTimeRangeArray.splice(r,1),r--;else{if(e>this.customTimeRangeArray[r].start&&t<this.customTimeRangeArray[r].end){this.customTimeRangeArray.splice(r+1,0,{start:t,end:this.customTimeRangeArray[r].end}),this.customTimeRangeArray[r].end=e;break}e>this.customTimeRangeArray[r].start&&e<this.customTimeRangeArray[r].end?this.customTimeRangeArray[r].end=e:t>this.customTimeRangeArray[r].start&&t<this.customTimeRangeArray[r].end&&(this.customTimeRangeArray[r].start=t)}this.length=this.customTimeRangeArray.length},mergeRanges:function(e,t){var r=this.customTimeRangeArray[e],n=this.customTimeRangeArray[t];return r.start<=n.start&&n.start<=r.end&&r.end<=n.end?(r.end=n.end,this.customTimeRangeArray.splice(t,1),!0):n.start<=r.start&&r.start<=n.end&&n.end<=r.end?(r.start=n.start,this.customTimeRangeArray.splice(t,1),!0):n.start<=r.start&&r.start<=n.end&&r.end<=n.end?(this.customTimeRangeArray.splice(e,1),!0):r.start<=n.start&&n.start<=r.end&&n.end<=r.end&&(this.customTimeRangeArray.splice(t,1),!0)},start:function(e){return(0,i.SE)(e),e>=this.customTimeRangeArray.length||e<0?NaN:this.customTimeRangeArray[e].start},end:function(e){return(0,i.SE)(e),e>=this.customTimeRangeArray.length||e<0?NaN:this.customTimeRangeArray[e].end}}}a.__dashjs_factory_name="CustomTimeRanges",t.Z=n.Z.getClassFactory(a)},5:function(e,t,r){var n=r(5448);function i(){var e,t=/^[a-z][a-z0-9+\-_.]*:/i,r=/^https?:\/\//i,n=/^https:\/\//i,i=/^([a-z][a-z0-9+\-_.]*:\/\/[^\/]+)\/?/i,a=function(e,t){try{return new window.URL(e,t).toString()}catch(r){return e}},o=function(e,t){var r=s;if(!t)return e;if(!c(e))return e;f(e)&&(r=l),d(e)&&(r=u);var n=r(t),i="/"!==n.charAt(n.length-1)&&"/"!==e.charAt(0)?"/":"";return[n,e].join(i)};function s(e){var t=e.indexOf("/"),r=e.lastIndexOf("/");return-1!==t?r===t+1?e:(-1!==e.indexOf("?")&&(e=e.substring(0,e.indexOf("?"))),e.substring(0,r+1)):""}function l(e){var t=e.match(i);return t?t[1]:""}function u(e){var r=e.match(t);return r?r[0]:""}function c(e){return!t.test(e)}function f(e){return c(e)&&"/"===e.charAt(0)}function d(e){return 0===e.indexOf("//")}return function(){try{new window.URL("x","http://y"),e=a}catch(t){}finally{e=e||o}}(),{parseBaseUrl:s,parseOrigin:l,parseScheme:u,isRelative:c,isPathAbsolute:f,isSchemeRelative:d,isHTTPURL:function(e){return r.test(e)},isHTTPS:function(e){return n.test(e)},removeHostname:function(e){return/^(?:\w+\:\/\/)?([^\/]+)(.*)$/.exec(e)[2].substring(1)},resolve:function(t,r){return e(t,r)}}}i.__dashjs_factory_name="DefaultURLUtils",t.Z=n.Z.getSingletonFactory(i)},8260:function(e,t,r){var n=r(2839),i=r(5448);function a(){var e;function t(t){var n=[];if(!t||!e||"function"!=typeof e.fetchAll)return n;for(var i,a=e.fetchAll(t),o=0,s=a.length;o<s;o++)(i=r(a[o]))&&n.push(i);return n}function r(e){if(!e)return null;var t=new n.Z(e);return e.hasOwnProperty("_incomplete")&&(t.isComplete=!e._incomplete),t}return{getBox:function(t){return t&&e&&e.boxes&&0!==e.boxes.length&&"function"==typeof e.fetch?r(e.fetch(t)):null},getBoxes:t,setData:function(t){e=t},getLastBox:function(){if(!e||!e.boxes||!e.boxes.length)return null;var r=t(e.boxes[e.boxes.length-1].type);return r.length>0?r[r.length-1]:null}}}a.__dashjs_factory_name="IsoFile",t.Z=i.Z.getClassFactory(a)},7473:function(e,t,r){r.d(t,{k:function(){return i}});var n=r(5448);function i(e,t){var r={url:e.url,method:e.method,headers:Object.assign({},e.headers),credentials:e.withCredentials?"include":void 0,range:e.request.range};return Promise.resolve(t.modifyRequest(r)).then((function(){return Object.assign(e,r,{withCredentials:"include"===r.credentials})}))}function a(){return{modifyRequest:null,modifyRequestURL:function(e){return e},modifyRequestHeader:function(e,t){return t.url,e}}}a.__dashjs_factory_name="RequestModifier",t.Z=n.Z.getSingletonFactory(a)},3106:function(e,t,r){r.d(t,{PS:function(){return a},SE:function(){return o}});var n=r(3393);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){if(i(e)!==t)throw n.Z.BAD_ARGUMENT_ERROR}function o(e){if(null===e||isNaN(e)||e%1!=0)throw n.Z.BAD_ARGUMENT_ERROR+" : argument is not an integer"}},2594:function(e,t,r){var n=r(5448),i=r(5);function a(){var e,t=[],r=this.context;function n(r,n,i){var a=function(r){var n;for(n=0;n<t.length;n++)if(t[n].regex.test(r))return t[n].utils;return e}(i||n);return a&&"function"==typeof a[r]?a[r](n,i):e[r](n,i)}return e=(0,i.Z)(r).getInstance(),{registerUrlRegex:function(e,r){t.push({regex:e,utils:r})},parseBaseUrl:function(e){return n("parseBaseUrl",e)},parseOrigin:function(e){return n("parseOrigin",e)},parseScheme:function(e){return n("parseScheme",e)},isRelative:function(e){return n("isRelative",e)},isPathAbsolute:function(e){return n("isPathAbsolute",e)},isSchemeRelative:function(e){return n("isSchemeRelative",e)},isHTTPURL:function(e){return n("isHTTPURL",e)},isHTTPS:function(e){return n("isHTTPS",e)},removeHostname:function(e){return n("removeHostname",e)},resolve:function(e,t){return n("resolve",e,t)}}}a.__dashjs_factory_name="URLUtils";var o=n.Z.getSingletonFactory(a);t.Z=o},5459:function(e,t){t.Z=function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.code=t||null,this.message=r||null,this.data=n||null}},3186:function(e,t,r){var n=r(7855);function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.action=e.ACTION_DOWNLOAD,this.startTime=NaN,this.mediaStartTime=NaN,this.mediaType=null,this.mediaInfo=null,this.type=null,this.duration=NaN,this.timescale=NaN,this.range=null,this.url=t||null,this.serviceLocation=null,this.requestStartDate=null,this.firstByteDate=null,this.requestEndDate=null,this.quality=NaN,this.index=NaN,this.availabilityStartTime=null,this.availabilityEndTime=null,this.wallStartTime=null,this.bytesLoaded=NaN,this.bytesTotal=NaN,this.delayLoadingTime=NaN,this.responseType="arraybuffer",this.representationId=null}var t;return(t=[{key:"isInitializationRequest",value:function(){return this.type&&this.type===n.w.INIT_SEGMENT_TYPE}},{key:"setInfo",value:function(e){this.type=e&&e.init?n.w.INIT_SEGMENT_TYPE:n.w.MEDIA_SEGMENT_TYPE,this.url=e&&e.url?e.url:null,this.range=e&&e.range?e.range.start+"-"+e.range.end:null,this.mediaType=e&&e.mediaType?e.mediaType:null}}])&&i(e.prototype,t),e}();a.ACTION_DOWNLOAD="download",a.ACTION_COMPLETE="complete",t.Z=a},2839:function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.offset=t._offset,this.type=t.type,this.size=t.size,this.boxes=[],t.boxes)for(var r=0;r<t.boxes.length;r++)this.boxes.push(new e(t.boxes[r]));switch(this.isComplete=!0,t.type){case"sidx":if(this.timescale=t.timescale,this.earliest_presentation_time=t.earliest_presentation_time,this.first_offset=t.first_offset,this.references=t.references,t.references){this.references=[];for(var n=0;n<t.references.length;n++){var i={reference_type:t.references[n].reference_type,referenced_size:t.references[n].referenced_size,subsegment_duration:t.references[n].subsegment_duration};this.references.push(i)}}break;case"emsg":this.id=t.id,this.version=1===t.version?1:0,this.value=t.value,this.timescale=t.timescale,this.scheme_id_uri=t.scheme_id_uri,this.presentation_time_delta=1===t.version?t.presentation_time:t.presentation_time_delta,this.event_duration=t.event_duration,this.message_data=t.message_data;break;case"mdhd":this.timescale=t.timescale;break;case"mfhd":this.sequence_number=t.sequence_number;break;case"subs":this.entry_count=t.entry_count,this.entries=t.entries;break;case"tfhd":this.base_data_offset=t.base_data_offset,this.sample_description_index=t.sample_description_index,this.default_sample_duration=t.default_sample_duration,this.default_sample_size=t.default_sample_size,this.default_sample_flags=t.default_sample_flags,this.flags=t.flags;break;case"tfdt":this.version=t.version,this.baseMediaDecodeTime=t.baseMediaDecodeTime,this.flags=t.flags;break;case"trun":if(this.sample_count=t.sample_count,this.first_sample_flags=t.first_sample_flags,this.data_offset=t.data_offset,this.flags=t.flags,this.samples=t.samples,t.samples){this.samples=[];for(var a=0,o=t.samples.length;a<o;a++){var s={sample_size:t.samples[a].sample_size,sample_duration:t.samples[a].sample_duration,sample_composition_time_offset:t.samples[a].sample_composition_time_offset};this.samples.push(s)}}break;case"prft":this.version=t.version,this.reference_track_ID=t.reference_track_ID,this.ntp_timestamp_sec=t.ntp_timestamp_sec,this.ntp_timestamp_frac=t.ntp_timestamp_frac,this.media_time=t.media_time,this.flags=t.flags}}var t;return(t=[{key:"getChildBox",value:function(e){for(var t=0;t<this.boxes.length;t++)if(this.boxes[t].type===e)return this.boxes[t]}},{key:"getChildBoxes",value:function(e){for(var t=[],r=0;r<this.boxes.length;r++)this.boxes[r].type===e&&t.push(this.boxes[r]);return t}}])&&r(e.prototype,t),e}();t.Z=n},9597:function(e,t){t.Z=function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.lastCompletedOffset=t,this.found=r,this.size=n}},2128:function(e,t){t.Z=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.bitrate=0,this.width=0,this.height=0,this.tilesHor=0,this.tilesVert=0,this.widthPerTile=0,this.heightPerTile=0,this.startNumber=0,this.segmentDuration=0,this.timescale=0,this.templateUrl="",this.id=""}},7855:function(e,t,r){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}r.d(t,{O:function(){return a},w:function(){return i}});var i=function e(){n(this,e),this.tcpid=null,this.type=null,this.url=null,this.actualurl=null,this.range=null,this.trequest=null,this.tresponse=null,this.responsecode=null,this.interval=null,this.trace=[],this.cmsd=null,this._stream=null,this._tfinish=null,this._mediaduration=null,this._quality=null,this._responseHeaders=null,this._serviceLocation=null,this._fileLoaderType=null},a=function e(){n(this,e),this.s=null,this.d=null,this.b=[]};i.GET="GET",i.HEAD="HEAD",i.MPD_TYPE="MPD",i.XLINK_EXPANSION_TYPE="XLinkExpansion",i.INIT_SEGMENT_TYPE="InitializationSegment",i.INDEX_SEGMENT_TYPE="IndexSegment",i.MEDIA_SEGMENT_TYPE="MediaSegment",i.BITSTREAM_SWITCHING_SEGMENT_TYPE="BitstreamSwitchingSegment",i.MSS_FRAGMENT_INFO_SEGMENT_TYPE="FragmentInfoSegment",i.DVB_REPORTING_TYPE="DVBReporting",i.LICENSE="license",i.CONTENT_STEERING_TYPE="ContentSteering",i.OTHER_TYPE="other"},3039:function(e,t){function r(e,t){return function(r,i){for(var a,o,s,l=n(r,"tag"),u=n(null==i?"*":i,"range"),c=[],f=-1;++f<u.length;)if(a=u[f].toLowerCase(),t||"*"!==a){for(o=-1,s=[];++o<l.length;)if(e(l[o].toLowerCase(),a)){if(!t)return l[o];c.push(l[o])}else s.push(l[o]);l=s}return t?c:void 0}}function n(e,t){var r=e&&"string"==typeof e?[e]:e;if(!r||"object"!=typeof r||!("length"in r))throw new Error("Invalid "+t+" `"+r+"`, expected non-empty string");return r}t.basicFilter=r((function(e,t){return"*"===t||e===t||e.indexOf(t+"-")>-1}),!0),t.extendedFilter=r((function(e,t){var r=e.split("-"),n=t.split("-"),i=0,a=0;if("*"!==n[a]&&r[i]!==n[a])return!1;for(i++,a++;a<n.length;)if("*"!==n[a]){if(!r[i])return!1;if(r[i]!==n[a]){if(1===r[i].length)return!1;i++}else i++,a++}else a++;return!0}),!0),t.lookup=r((function(e,t){for(var r,n=t;;){if("*"===n||e===n)return!0;if((r=n.lastIndexOf("-"))<0)return!1;"-"===n.charAt(r-2)&&(r-=2),n=n.slice(0,r)}}))},3973:function(e,t,r){e.exports=r(3854)},3854:function(e,t,r){var n=r(2415),i=r(3039),a=r(7778),o=r(5813),s=r(3165),l=r(9460);e.exports=function(e,t){var r,c=t||{},p=n.parse(String(e||"").toLowerCase(),c),y=n.stringify(p),E=-1;if(!y)return y;for(;++E<a.length;)i.extendedFilter(y,a[E].from).length&&(d(p,a[E].from,a[E].to),y=n.stringify(p));for(E=-1;++E<o.length;)h(p,o[E].from.field,o[E].from.value)&&g(p,o[E].to.field,o[E].to.value);for(y=n.stringify(Object.assign({},p,f)),E=-1;++E<s.length;)y===s[E]&&(d(p,s[E],s[E].split("-").slice(0,-1).join("-")),y=n.stringify(Object.assign({},p,f)));if(p.extensions.sort(m),c.warning)for(r in l)u.call(l[r],p[r])&&c.warning("Deprecated "+r+" `"+p[r]+"`, expected one of `"+l[r][p[r]].join("`, `")+"`",null,7);return p.script&&(p.script=p.script.charAt(0).toUpperCase()+p.script.slice(1)),p.region&&(p.region=p.region.toUpperCase()),n.stringify(p)};var u={}.hasOwnProperty,c=new Intl.Collator,f={variants:[],extensions:[],privateuse:[],irregular:null,regular:null};function d(e,t,r){var i,a=n.parse(t),o=n.parse(r),s=[];for(i in a)a[i]&&a[i].length&&h(e,i,a[i])&&s.push(i);for(i in o)o[i]&&o[i].length&&(s.indexOf(i)>-1||!e[i]||!e[i].length)&&g(e,i,o[i])}function h(e,t,r){var n,i,a,o,s=!1;if(r){if(i=n=e[t],n&&"object"==typeof n)for(i=[],a=-1;++a<n.length;)o=n[a],r.indexOf(o)<0?i.push(o):s=!0;else n===r&&(i=null,s=!0);e[t]=i}return s}function g(e,t,r){var n,i,a,o=e[t];if(o&&"object"==typeof o)for(n=[].concat(r),i=-1;++i<n.length;)a=n[i],o.indexOf(a)<0&&o.push(a);else e[t]=r}function m(e,t){return c.compare(e.singleton,t.singleton)}},2415:function(e,t,r){t.parse=r(6903),t.stringify=r(6713)},6903:function(e,t,r){var n=r(2219),i=r(3516),a=r(395),o=r(858),s=r(8589);e.exports=function e(t,r){var u,c,f,d=r||{},h={language:null,extendedLanguageSubtags:[],script:null,region:null,variants:[],extensions:[],privateuse:[],irregular:null,regular:null},g=String(t),m=g.toLowerCase(),p=0;if(null==t)throw new Error("Expected string, got `"+t+"`");if(l.call(s,m))return(null==d.normalize||d.normalize)&&s[m]?e(s[m]):(h[-1===o.indexOf(m)?"irregular":"regular"]=g,h);for(;i(m.charCodeAt(p))&&p<9;)p++;if(p>1&&p<9){if(h.language=g.slice(0,p),p<4)for(c=0;45===m.charCodeAt(p)&&i(m.charCodeAt(p+1))&&i(m.charCodeAt(p+2))&&i(m.charCodeAt(p+3))&&!i(m.charCodeAt(p+4));){if(c>2)return y(p,3,"Too many extended language subtags, expected at most 3 subtags");h.extendedLanguageSubtags.push(g.slice(p+1,p+4)),p+=4,c++}for(45===m.charCodeAt(p)&&i(m.charCodeAt(p+1))&&i(m.charCodeAt(p+2))&&i(m.charCodeAt(p+3))&&i(m.charCodeAt(p+4))&&!i(m.charCodeAt(p+5))&&(h.script=g.slice(p+1,p+5),p+=5),45===m.charCodeAt(p)&&(i(m.charCodeAt(p+1))&&i(m.charCodeAt(p+2))&&!i(m.charCodeAt(p+3))?(h.region=g.slice(p+1,p+3),p+=3):a(m.charCodeAt(p+1))&&a(m.charCodeAt(p+2))&&a(m.charCodeAt(p+3))&&!a(m.charCodeAt(p+4))&&(h.region=g.slice(p+1,p+4),p+=4));45===m.charCodeAt(p);){for(f=u=p+1;n(m.charCodeAt(f));){if(f-u>7)return y(f,1,"Too long variant, expected at most 8 characters");f++}if(!(f-u>4||f-u>3&&a(m.charCodeAt(u))))break;h.variants.push(g.slice(u,f)),p=f}for(;45===m.charCodeAt(p)&&120!==m.charCodeAt(p+1)&&n(m.charCodeAt(p+1))&&45===m.charCodeAt(p+2)&&n(m.charCodeAt(p+3));){for(f=p+2,c=0;45===m.charCodeAt(f)&&n(m.charCodeAt(f+1))&&n(m.charCodeAt(f+2));)for(f=(u=f+1)+2,c++;n(m.charCodeAt(f));){if(f-u>7)return y(f,2,"Too long extension, expected at most 8 characters");f++}if(!c)return y(f,4,"Empty extension, extensions must have at least 2 characters of content");h.extensions.push({singleton:g.charAt(p+1),extensions:g.slice(p+3,f).split("-")}),p=f}}else p=0;if(0===p&&120===m.charCodeAt(p)||45===m.charCodeAt(p)&&120===m.charCodeAt(p+1))for(f=p=p?p+2:1;45===m.charCodeAt(f)&&n(m.charCodeAt(f+1));){for(f=u=p+1;n(m.charCodeAt(f));){if(f-u>7)return y(f,5,"Too long private-use area, expected at most 8 characters");f++}h.privateuse.push(g.slice(p+1,f)),p=f}return p!==g.length?y(p,6,"Found superfluous content after tag"):h;function y(e,t,r){return d.warning&&d.warning(r,t,e),d.forgiving?h:{language:null,extendedLanguageSubtags:[],script:null,region:null,variants:[],extensions:[],privateuse:[],irregular:null,regular:null}}};var l={}.hasOwnProperty},6713:function(e){e.exports=function(e){var t,r,n,i=e||{},a=[];if(i.irregular||i.regular)return i.irregular||i.regular;if(i.language)for(a=a.concat(i.language,i.extendedLanguageSubtags||[],i.script||[],i.region||[],i.variants||[]),t=i.extensions||[],r=-1;++r<t.length;)(n=t[r]).singleton&&n.extensions&&n.extensions.length&&(a=a.concat(n.singleton,n.extensions));return i.privateuse&&i.privateuse.length&&(a=a.concat("x",i.privateuse)),a.join("-")}},1549:function(e,t,r){var n=r(6693),i=r(2165),a="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=l,t.SlowBuffer=function(e){return+e!=e&&(e=0),l.alloc(+e)},t.INSPECT_MAX_BYTES=50;var o=2147483647;function s(e){if(e>o)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,l.prototype),t}function l(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return f(e)}return u(e,t,r)}function u(e,t,r){if("string"==typeof e)return function(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!l.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var r=0|m(e,t),n=s(r),i=n.write(e,t);return i!==r&&(n=n.slice(0,i)),n}(e,t);if(ArrayBuffer.isView(e))return function(e){if(G(e,Uint8Array)){var t=new Uint8Array(e);return h(t.buffer,t.byteOffset,t.byteLength)}return d(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(G(e,ArrayBuffer)||e&&G(e.buffer,ArrayBuffer))return h(e,t,r);if("undefined"!=typeof SharedArrayBuffer&&(G(e,SharedArrayBuffer)||e&&G(e.buffer,SharedArrayBuffer)))return h(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return l.from(n,t,r);var i=function(e){if(l.isBuffer(e)){var t=0|g(e.length),r=s(t);return 0===r.length||e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||H(e.length)?s(0):d(e):"Buffer"===e.type&&Array.isArray(e.data)?d(e.data):void 0}(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return l.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function c(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function f(e){return c(e),s(e<0?0:0|g(e))}function d(e){for(var t=e.length<0?0:0|g(e.length),r=s(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}function h(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');var n;return n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),Object.setPrototypeOf(n,l.prototype),n}function g(e){if(e>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|e}function m(e,t){if(l.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||G(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return U(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return B(e).length;default:if(i)return n?-1:U(e).length;t=(""+t).toLowerCase(),i=!0}}function p(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return L(this,t,r);case"utf8":case"utf-8":return I(this,t,r);case"ascii":return C(this,t,r);case"latin1":case"binary":return D(this,t,r);case"base64":return R(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return N(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function y(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function E(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),H(r=+r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=l.from(t,n)),l.isBuffer(t))return 0===t.length?-1:v(e,t,r,n,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):v(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function v(e,t,r,n,i){var a,o=1,s=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;o=2,s/=2,l/=2,r/=2}function u(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var c=-1;for(a=r;a<s;a++)if(u(e,a)===u(t,-1===c?0:a-c)){if(-1===c&&(c=a),a-c+1===l)return c*o}else-1!==c&&(a-=a-c),c=-1}else for(r+l>s&&(r=s-l),a=r;a>=0;a--){for(var f=!0,d=0;d<l;d++)if(u(e,a+d)!==u(t,d)){f=!1;break}if(f)return a}return-1}function T(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var a=t.length;n>a/2&&(n=a/2);for(var o=0;o<n;++o){var s=parseInt(t.substr(2*o,2),16);if(H(s))return o;e[r+o]=s}return o}function _(e,t,r,n){return Z(U(t,e.length-r),e,r,n)}function S(e,t,r,n){return Z(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function A(e,t,r,n){return Z(B(t),e,r,n)}function b(e,t,r,n){return Z(function(e,t){for(var r,n,i,a=[],o=0;o<e.length&&!((t-=2)<0);++o)n=(r=e.charCodeAt(o))>>8,i=r%256,a.push(i),a.push(n);return a}(t,e.length-r),e,r,n)}function R(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function I(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var a,o,s,l,u=e[i],c=null,f=u>239?4:u>223?3:u>191?2:1;if(i+f<=r)switch(f){case 1:u<128&&(c=u);break;case 2:128==(192&(a=e[i+1]))&&(l=(31&u)<<6|63&a)>127&&(c=l);break;case 3:a=e[i+1],o=e[i+2],128==(192&a)&&128==(192&o)&&(l=(15&u)<<12|(63&a)<<6|63&o)>2047&&(l<55296||l>57343)&&(c=l);break;case 4:a=e[i+1],o=e[i+2],s=e[i+3],128==(192&a)&&128==(192&o)&&128==(192&s)&&(l=(15&u)<<18|(63&a)<<12|(63&o)<<6|63&s)>65535&&l<1114112&&(c=l)}null===c?(c=65533,f=1):c>65535&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|1023&c),n.push(c),i+=f}return function(e){var t=e.length;if(t<=w)return String.fromCharCode.apply(String,e);for(var r="",n=0;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=w));return r}(n)}t.kMaxLength=o,l.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(r){return!1}}(),l.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||console.error,Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}}),l.poolSize=8192,l.from=function(e,t,r){return u(e,t,r)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array),l.alloc=function(e,t,r){return i=t,a=r,c(n=e),n<=0?s(n):void 0!==i?"string"==typeof a?s(n).fill(i,a):s(n).fill(i):s(n);var n,i,a},l.allocUnsafe=function(e){return f(e)},l.allocUnsafeSlow=function(e){return f(e)},l.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==l.prototype},l.compare=function(e,t){if(G(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),G(t,Uint8Array)&&(t=l.from(t,t.offset,t.byteLength)),!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,n=t.length,i=0,a=Math.min(r,n);i<a;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=l.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var a=e[r];if(G(a,Uint8Array))i+a.length>n.length?l.from(a).copy(n,i):Uint8Array.prototype.set.call(n,a,i);else{if(!l.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(n,i)}i+=a.length}return n},l.byteLength=m,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)y(this,t,t+1);return this},l.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)y(this,t,t+3),y(this,t+1,t+2);return this},l.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)y(this,t,t+7),y(this,t+1,t+6),y(this,t+2,t+5),y(this,t+3,t+4);return this},l.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?I(this,0,e):p.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},a&&(l.prototype[a]=l.prototype.inspect),l.prototype.compare=function(e,t,r,n,i){if(G(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),!l.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;for(var a=(i>>>=0)-(n>>>=0),o=(r>>>=0)-(t>>>=0),s=Math.min(a,o),u=this.slice(n,i),c=e.slice(t,r),f=0;f<s;++f)if(u[f]!==c[f]){a=u[f],o=c[f];break}return a<o?-1:o<a?1:0},l.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},l.prototype.indexOf=function(e,t,r){return E(this,e,t,r,!0)},l.prototype.lastIndexOf=function(e,t,r){return E(this,e,t,r,!1)},l.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var a=!1;;)switch(n){case"hex":return T(this,e,t,r);case"utf8":case"utf-8":return _(this,e,t,r);case"ascii":case"latin1":case"binary":return S(this,e,t,r);case"base64":return A(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return b(this,e,t,r);default:if(a)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),a=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var w=4096;function C(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function D(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function L(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",a=t;a<r;++a)i+=K[e[a]];return i}function N(e,t,r){for(var n=e.slice(t,r),i="",a=0;a<n.length-1;a+=2)i+=String.fromCharCode(n[a]+256*n[a+1]);return i}function O(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function M(e,t,r,n,i,a){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function P(e,t,r,n,i,a){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function k(e,t,r,n,a){return t=+t,r>>>=0,a||P(e,0,r,4),i.write(e,t,r,n,23,4),r+4}function x(e,t,r,n,a){return t=+t,r>>>=0,a||P(e,0,r,8),i.write(e,t,r,n,52,8),r+8}l.prototype.slice=function(e,t){var r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return Object.setPrototypeOf(n,l.prototype),n},l.prototype.readUintLE=l.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||O(e,t,this.length);for(var n=this[e],i=1,a=0;++a<t&&(i*=256);)n+=this[e+a]*i;return n},l.prototype.readUintBE=l.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||O(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},l.prototype.readUint8=l.prototype.readUInt8=function(e,t){return e>>>=0,t||O(e,1,this.length),this[e]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(e,t){return e>>>=0,t||O(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(e,t){return e>>>=0,t||O(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(e,t){return e>>>=0,t||O(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(e,t){return e>>>=0,t||O(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||O(e,t,this.length);for(var n=this[e],i=1,a=0;++a<t&&(i*=256);)n+=this[e+a]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},l.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||O(e,t,this.length);for(var n=t,i=1,a=this[e+--n];n>0&&(i*=256);)a+=this[e+--n]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*t)),a},l.prototype.readInt8=function(e,t){return e>>>=0,t||O(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){e>>>=0,t||O(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},l.prototype.readInt16BE=function(e,t){e>>>=0,t||O(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},l.prototype.readInt32LE=function(e,t){return e>>>=0,t||O(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return e>>>=0,t||O(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readFloatLE=function(e,t){return e>>>=0,t||O(e,4,this.length),i.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return e>>>=0,t||O(e,4,this.length),i.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return e>>>=0,t||O(e,8,this.length),i.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return e>>>=0,t||O(e,8,this.length),i.read(this,e,!1,52,8)},l.prototype.writeUintLE=l.prototype.writeUIntLE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||M(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,a=0;for(this[t]=255&e;++a<r&&(i*=256);)this[t+a]=e/i&255;return t+r},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||M(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+r},l.prototype.writeUint8=l.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,1,255,0),this[t]=255&e,t+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);M(this,e,t,r,i-1,-i)}var a=0,o=1,s=0;for(this[t]=255&e;++a<r&&(o*=256);)e<0&&0===s&&0!==this[t+a-1]&&(s=1),this[t+a]=(e/o|0)-s&255;return t+r},l.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);M(this,e,t,r,i-1,-i)}var a=r-1,o=1,s=0;for(this[t+a]=255&e;--a>=0&&(o*=256);)e<0&&0===s&&0!==this[t+a+1]&&(s=1),this[t+a]=(e/o|0)-s&255;return t+r},l.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},l.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeFloatLE=function(e,t,r){return k(this,e,t,!0,r)},l.prototype.writeFloatBE=function(e,t,r){return k(this,e,t,!1,r)},l.prototype.writeDoubleLE=function(e,t,r){return x(this,e,t,!0,r)},l.prototype.writeDoubleBE=function(e,t,r){return x(this,e,t,!1,r)},l.prototype.copy=function(e,t,r,n){if(!l.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i=n-r;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,r,n):Uint8Array.prototype.set.call(e,this.subarray(r,n),t),i},l.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!l.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){var i=e.charCodeAt(0);("utf8"===n&&i<128||"latin1"===n)&&(e=i)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var a;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(a=t;a<r;++a)this[a]=e;else{var o=l.isBuffer(e)?e:l.from(e,n),s=o.length;if(0===s)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(a=0;a<r-t;++a)this[a+t]=o[a%s]}return this};var F=/[^+/0-9A-Za-z-_]/g;function U(e,t){var r;t=t||1/0;for(var n=e.length,i=null,a=[],o=0;o<n;++o){if((r=e.charCodeAt(o))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&a.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&a.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;a.push(r)}else if(r<2048){if((t-=2)<0)break;a.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;a.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return a}function B(e){return n.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(F,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function Z(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function G(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function H(e){return e!=e}var K=function(){for(var e="0123456789abcdef",t=new Array(256),r=0;r<16;++r)for(var n=16*r,i=0;i<16;++i)t[n+i]=e[r]+e[i];return t}()},6693:function(e,t){t.byteLength=function(e){var t=l(e),r=t[0],n=t[1];return 3*(r+n)/4-n},t.toByteArray=function(e){var t,r,a,o=l(e),s=o[0],u=o[1],c=new i(3*(s+(a=u))/4-a),f=0,d=u>0?s-4:s;for(r=0;r<d;r+=4)t=n[e.charCodeAt(r)]<<18|n[e.charCodeAt(r+1)]<<12|n[e.charCodeAt(r+2)]<<6|n[e.charCodeAt(r+3)],c[f++]=t>>16&255,c[f++]=t>>8&255,c[f++]=255&t;return 2===u&&(t=n[e.charCodeAt(r)]<<2|n[e.charCodeAt(r+1)]>>4,c[f++]=255&t),1===u&&(t=n[e.charCodeAt(r)]<<10|n[e.charCodeAt(r+1)]<<4|n[e.charCodeAt(r+2)]>>2,c[f++]=t>>8&255,c[f++]=255&t),c},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,a=[],o=16383,s=0,l=n-i;s<l;s+=o)a.push(u(e,s,s+o>l?l:s+o));return 1===i?(t=e[n-1],a.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],a.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"=")),a.join("")};for(var r=[],n=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,s=a.length;o<s;++o)r[o]=a[o],n[a.charCodeAt(o)]=o;function l(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function u(e,t,n){for(var i,a,o=[],s=t;s<n;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),o.push(r[(a=i)>>18&63]+r[a>>12&63]+r[a>>6&63]+r[63&a]);return o.join("")}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},2165:function(e,t){t.read=function(e,t,r,n,i){var a,o,s=8*i-n-1,l=(1<<s)-1,u=l>>1,c=-7,f=r?i-1:0,d=r?-1:1,h=e[t+f];for(f+=d,a=h&(1<<-c)-1,h>>=-c,c+=s;c>0;a=256*a+e[t+f],f+=d,c-=8);for(o=a&(1<<-c)-1,a>>=-c,c+=n;c>0;o=256*o+e[t+f],f+=d,c-=8);if(0===a)a=1-u;else{if(a===l)return o?NaN:1/0*(h?-1:1);o+=Math.pow(2,n),a-=u}return(h?-1:1)*o*Math.pow(2,a-n)},t.write=function(e,t,r,n,i,a){var o,s,l,u=8*a-i-1,c=(1<<u)-1,f=c>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,h=n?0:a-1,g=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+f>=1?d/l:d*Math.pow(2,1-f))*l>=2&&(o++,l/=2),o+f>=c?(s=0,o=c):o+f>=1?(s=(t*l-1)*Math.pow(2,i),o+=f):(s=t*Math.pow(2,f-1)*Math.pow(2,i),o=0));i>=8;e[r+h]=255&s,h+=g,s/=256,i-=8);for(o=o<<i|s,u+=i;u>0;e[r+h]=255&o,h+=g,o/=256,u-=8);e[r+h-g]|=128*m}},6934:function(e,t){var r={parseBuffer:function(e){return new n(e).parse()},addBoxProcessor:function(e,t){"string"==typeof e&&"function"==typeof t&&(i.prototype._boxProcessors[e]=t)},createFile:function(){return new n},createBox:function(e,t,r){var n=i.create(e);return t&&t.append(n,r),n},createFullBox:function(e,t,n){var i=r.createBox(e,t,n);return i.version=0,i.flags=0,i},Utils:{}};r.Utils.dataViewToString=function(e,t){var r=t||"utf-8";if("undefined"!=typeof TextDecoder)return new TextDecoder(r).decode(e);var n=[],i=0;if("utf-8"===r)for(;i<e.byteLength;){var a=e.getUint8(i++);a<128||(a<224?(a=(31&a)<<6,a|=63&e.getUint8(i++)):a<240?(a=(15&a)<<12,a|=(63&e.getUint8(i++))<<6,a|=63&e.getUint8(i++)):(a=(7&a)<<18,a|=(63&e.getUint8(i++))<<12,a|=(63&e.getUint8(i++))<<6,a|=63&e.getUint8(i++))),n.push(String.fromCharCode(a))}else for(;i<e.byteLength;)n.push(String.fromCharCode(e.getUint8(i++)));return n.join("")},r.Utils.utf8ToByteArray=function(e){var t,r;if("undefined"!=typeof TextEncoder)t=(new TextEncoder).encode(e);else for(t=[],r=0;r<e.length;++r){var n=e.charCodeAt(r);n<128?t.push(n):n<2048?(t.push(192|n>>6),t.push(128|63&n)):n<65536?(t.push(224|n>>12),t.push(128|63&n>>6),t.push(128|63&n)):(t.push(240|n>>18),t.push(128|63&n>>12),t.push(128|63&n>>6),t.push(128|63&n))}return t},r.Utils.appendBox=function(e,t,r){if(t._offset=e._cursor.offset,t._root=e._root?e._root:e,t._raw=e._raw,t._parent=e,-1!==r)if(null!=r){var n,i=-1;if("number"==typeof r)i=r;else{if("string"==typeof r)n=r;else{if("object"!=typeof r||!r.type)return void e.boxes.push(t);n=r.type}for(var a=0;a<e.boxes.length;a++)if(n===e.boxes[a].type){i=a+1;break}}e.boxes.splice(i,0,t)}else e.boxes.push(t)},t.parseBuffer=r.parseBuffer,t.addBoxProcessor=r.addBoxProcessor,t.createFile=r.createFile,t.createBox=r.createBox,t.createFullBox=r.createFullBox,t.Utils=r.Utils,r.Cursor=function(e){this.offset=void 0===e?0:e};var n=function(e){this._cursor=new r.Cursor,this.boxes=[],e&&(this._raw=new DataView(e))};n.prototype.fetch=function(e){var t=this.fetchAll(e,!0);return t.length?t[0]:null},n.prototype.fetchAll=function(e,t){var r=[];return n._sweep.call(this,e,r,t),r},n.prototype.parse=function(){for(this._cursor.offset=0,this.boxes=[];this._cursor.offset<this._raw.byteLength;){var e=i.parse(this);if(void 0===e.type)break;this.boxes.push(e)}return this},n._sweep=function(e,t,r){for(var i in this.type&&this.type==e&&t.push(this),this.boxes){if(t.length&&r)return;n._sweep.call(this.boxes[i],e,t,r)}},n.prototype.write=function(){var e,t=0;for(e=0;e<this.boxes.length;e++)t+=this.boxes[e].getLength(!1);var r=new Uint8Array(t);for(this._rawo=new DataView(r.buffer),this.bytes=r,this._cursor.offset=0,e=0;e<this.boxes.length;e++)this.boxes[e].write();return r.buffer},n.prototype.append=function(e,t){r.Utils.appendBox(this,e,t)};var i=function(){this._cursor=new r.Cursor};i.parse=function(e){var t=new i;return t._offset=e._cursor.offset,t._root=e._root?e._root:e,t._raw=e._raw,t._parent=e,t._parseBox(),e._cursor.offset=t._raw.byteOffset+t._raw.byteLength,t},i.create=function(e){var t=new i;return t.type=e,t.boxes=[],t},i.prototype._boxContainers=["dinf","edts","mdia","meco","mfra","minf","moof","moov","mvex","stbl","strk","traf","trak","tref","udta","vttc","sinf","schi","encv","enca"],i.prototype._boxProcessors={},i.prototype._procField=function(e,t,r){this._parsing?this[e]=this._readField(t,r):this._writeField(t,r,this[e])},i.prototype._procFieldArray=function(e,t,r,n){var i;if(this._parsing)for(this[e]=[],i=0;i<t;i++)this[e][i]=this._readField(r,n);else for(i=0;i<this[e].length;i++)this._writeField(r,n,this[e][i])},i.prototype._procFullBox=function(){this._procField("version","uint",8),this._procField("flags","uint",24)},i.prototype._procEntries=function(e,t,r){var n;if(this._parsing)for(this[e]=[],n=0;n<t;n++)this[e].push({}),r.call(this,this[e][n]);else for(n=0;n<t;n++)r.call(this,this[e][n])},i.prototype._procSubEntries=function(e,t,r,n){var i;if(this._parsing)for(e[t]=[],i=0;i<r;i++)e[t].push({}),n.call(this,e[t][i]);else for(i=0;i<r;i++)n.call(this,e[t][i])},i.prototype._procEntryField=function(e,t,r,n){this._parsing?e[t]=this._readField(r,n):this._writeField(r,n,e[t])},i.prototype._procSubBoxes=function(e,t){var r;if(this._parsing)for(this[e]=[],r=0;r<t;r++)this[e].push(i.parse(this));else for(r=0;r<t;r++)this._rawo?this[e][r].write():this.size+=this[e][r].getLength()},i.prototype._readField=function(e,t){switch(e){case"uint":return this._readUint(t);case"int":return this._readInt(t);case"template":return this._readTemplate(t);case"string":return-1===t?this._readTerminatedString():this._readString(t);case"data":return this._readData(t);case"utf8":return this._readUTF8String();default:return-1}},i.prototype._readInt=function(e){var t=null,r=this._cursor.offset-this._raw.byteOffset;switch(e){case 8:t=this._raw.getInt8(r);break;case 16:t=this._raw.getInt16(r);break;case 32:t=this._raw.getInt32(r);break;case 64:var n=this._raw.getInt32(r),i=this._raw.getInt32(r+4);t=n*Math.pow(2,32)+i}return this._cursor.offset+=e>>3,t},i.prototype._readUint=function(e){var t,r,n=null,i=this._cursor.offset-this._raw.byteOffset;switch(e){case 8:n=this._raw.getUint8(i);break;case 16:n=this._raw.getUint16(i);break;case 24:n=((t=this._raw.getUint16(i))<<8)+(r=this._raw.getUint8(i+2));break;case 32:n=this._raw.getUint32(i);break;case 64:t=this._raw.getUint32(i),r=this._raw.getUint32(i+4),n=t*Math.pow(2,32)+r}return this._cursor.offset+=e>>3,n},i.prototype._readString=function(e){for(var t="",r=0;r<e;r++){var n=this._readUint(8);t+=String.fromCharCode(n)}return t},i.prototype._readTemplate=function(e){return this._readUint(e/2)+this._readUint(e/2)/Math.pow(2,e/2)},i.prototype._readTerminatedString=function(){for(var e="";this._cursor.offset-this._offset<this._raw.byteLength;){var t=this._readUint(8);if(0===t)break;e+=String.fromCharCode(t)}return e},i.prototype._readData=function(e){var t=e>0?e:this._raw.byteLength-(this._cursor.offset-this._offset);if(t>0){var r=new Uint8Array(this._raw.buffer,this._cursor.offset,t);return this._cursor.offset+=t,r}return null},i.prototype._readUTF8String=function(){var e=this._raw.byteLength-(this._cursor.offset-this._offset),t=null;return e>0&&(t=new DataView(this._raw.buffer,this._cursor.offset,e),this._cursor.offset+=e),t?r.Utils.dataViewToString(t):t},i.prototype._parseBox=function(){if(this._parsing=!0,this._cursor.offset=this._offset,this._offset+8>this._raw.buffer.byteLength)this._root._incomplete=!0;else{switch(this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this.size){case 0:this._raw=new DataView(this._raw.buffer,this._offset);break;case 1:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.largesize);break;default:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.size)}this._incomplete||(this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type)?this._parseContainerBox():this._data=this._readData())}},i.prototype._parseFullBox=function(){this.version=this._readUint(8),this.flags=this._readUint(24)},i.prototype._parseContainerBox=function(){for(this.boxes=[];this._cursor.offset-this._raw.byteOffset<this._raw.byteLength;)this.boxes.push(i.parse(this))},i.prototype.append=function(e,t){r.Utils.appendBox(this,e,t)},i.prototype.getLength=function(){if(this._parsing=!1,this._rawo=null,this.size=0,this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type))for(var e=0;e<this.boxes.length;e++)this.size+=this.boxes[e].getLength();return this._data&&this._writeData(this._data),this.size},i.prototype.write=function(){switch(this._parsing=!1,this._cursor.offset=this._parent._cursor.offset,this.size){case 0:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.parent._rawo.byteLength-this._cursor.offset);break;case 1:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.largesize);break;default:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.size)}if(this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type))for(var e=0;e<this.boxes.length;e++)this.boxes[e].write();return this._data&&this._writeData(this._data),this._parent._cursor.offset+=this.size,this.size},i.prototype._writeInt=function(e,t){if(this._rawo){var r=this._cursor.offset-this._rawo.byteOffset;switch(e){case 8:this._rawo.setInt8(r,t);break;case 16:this._rawo.setInt16(r,t);break;case 32:this._rawo.setInt32(r,t);break;case 64:var n=Math.floor(t/Math.pow(2,32)),i=t-n*Math.pow(2,32);this._rawo.setUint32(r,n),this._rawo.setUint32(r+4,i)}this._cursor.offset+=e>>3}else this.size+=e>>3},i.prototype._writeUint=function(e,t){if(this._rawo){var r,n,i=this._cursor.offset-this._rawo.byteOffset;switch(e){case 8:this._rawo.setUint8(i,t);break;case 16:this._rawo.setUint16(i,t);break;case 24:r=(16776960&t)>>8,n=255&t,this._rawo.setUint16(i,r),this._rawo.setUint8(i+2,n);break;case 32:this._rawo.setUint32(i,t);break;case 64:n=t-(r=Math.floor(t/Math.pow(2,32)))*Math.pow(2,32),this._rawo.setUint32(i,r),this._rawo.setUint32(i+4,n)}this._cursor.offset+=e>>3}else this.size+=e>>3},i.prototype._writeString=function(e,t){for(var r=0;r<e;r++)this._writeUint(8,t.charCodeAt(r))},i.prototype._writeTerminatedString=function(e){if(0!==e.length){for(var t=0;t<e.length;t++)this._writeUint(8,e.charCodeAt(t));this._writeUint(8,0)}},i.prototype._writeTemplate=function(e,t){var r=Math.floor(t),n=(t-r)*Math.pow(2,e/2);this._writeUint(e/2,r),this._writeUint(e/2,n)},i.prototype._writeData=function(e){if(e)if(this._rawo){if(e instanceof Array){for(var t=this._cursor.offset-this._rawo.byteOffset,r=0;r<e.length;r++)this._rawo.setInt8(t+r,e[r]);this._cursor.offset+=e.length}e instanceof Uint8Array&&(this._root.bytes.set(e,this._cursor.offset),this._cursor.offset+=e.length)}else this.size+=e.length},i.prototype._writeUTF8String=function(e){var t=r.Utils.utf8ToByteArray(e);if(this._rawo)for(var n=new DataView(this._rawo.buffer,this._cursor.offset,t.length),i=0;i<t.length;i++)n.setUint8(i,t[i]);else this.size+=t.length},i.prototype._writeField=function(e,t,r){switch(e){case"uint":this._writeUint(t,r);break;case"int":this._writeInt(t,r);break;case"template":this._writeTemplate(t,r);break;case"string":-1==t?this._writeTerminatedString(r):this._writeString(t,r);break;case"data":this._writeData(r);break;case"utf8":this._writeUTF8String(r)}},i.prototype._boxProcessors.avc1=i.prototype._boxProcessors.avc2=i.prototype._boxProcessors.avc3=i.prototype._boxProcessors.avc4=i.prototype._boxProcessors.hvc1=i.prototype._boxProcessors.hev1=i.prototype._boxProcessors.encv=function(){this._procFieldArray("reserved1",6,"uint",8),this._procField("data_reference_index","uint",16),this._procField("pre_defined1","uint",16),this._procField("reserved2","uint",16),this._procFieldArray("pre_defined2",3,"uint",32),this._procField("width","uint",16),this._procField("height","uint",16),this._procField("horizresolution","template",32),this._procField("vertresolution","template",32),this._procField("reserved3","uint",32),this._procField("frame_count","uint",16),this._procFieldArray("compressorname",32,"uint",8),this._procField("depth","uint",16),this._procField("pre_defined3","int",16),this._procField("config","data",-1)},i.prototype._boxProcessors.ctts=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,(function(e){this._procEntryField(e,"sample_count","uint",32),this._procEntryField(e,"sample_offset",1===this.version?"int":"uint",32)}))},i.prototype._boxProcessors.dref=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procSubBoxes("entries",this.entry_count)},i.prototype._boxProcessors.elst=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,(function(e){this._procEntryField(e,"segment_duration","uint",1===this.version?64:32),this._procEntryField(e,"media_time","int",1===this.version?64:32),this._procEntryField(e,"media_rate_integer","int",16),this._procEntryField(e,"media_rate_fraction","int",16)}))},i.prototype._boxProcessors.emsg=function(){this._procFullBox(),1==this.version?(this._procField("timescale","uint",32),this._procField("presentation_time","uint",64),this._procField("event_duration","uint",32),this._procField("id","uint",32),this._procField("scheme_id_uri","string",-1),this._procField("value","string",-1)):(this._procField("scheme_id_uri","string",-1),this._procField("value","string",-1),this._procField("timescale","uint",32),this._procField("presentation_time_delta","uint",32),this._procField("event_duration","uint",32),this._procField("id","uint",32)),this._procField("message_data","data",-1)},i.prototype._boxProcessors.free=i.prototype._boxProcessors.skip=function(){this._procField("data","data",-1)},i.prototype._boxProcessors.frma=function(){this._procField("data_format","uint",32)},i.prototype._boxProcessors.ftyp=i.prototype._boxProcessors.styp=function(){this._procField("major_brand","string",4),this._procField("minor_version","uint",32);var e=-1;this._parsing&&(e=(this._raw.byteLength-(this._cursor.offset-this._raw.byteOffset))/4),this._procFieldArray("compatible_brands",e,"string",4)},i.prototype._boxProcessors.hdlr=function(){this._procFullBox(),this._procField("pre_defined","uint",32),this._procField("handler_type","string",4),this._procFieldArray("reserved",3,"uint",32),this._procField("name","string",-1)},i.prototype._boxProcessors.mdat=function(){this._procField("data","data",-1)},i.prototype._boxProcessors.mdhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("timescale","uint",32),this._procField("duration","uint",1==this.version?64:32),this._parsing||"string"!=typeof this.language||(this.language=this.language.charCodeAt(0)-96<<10|this.language.charCodeAt(1)-96<<5|this.language.charCodeAt(2)-96),this._procField("language","uint",16),this._parsing&&(this.language=String.fromCharCode(96+(this.language>>10&31),96+(this.language>>5&31),96+(31&this.language))),this._procField("pre_defined","uint",16)},i.prototype._boxProcessors.mehd=function(){this._procFullBox(),this._procField("fragment_duration","uint",1==this.version?64:32)},i.prototype._boxProcessors.mfhd=function(){this._procFullBox(),this._procField("sequence_number","uint",32)},i.prototype._boxProcessors.mfro=function(){this._procFullBox(),this._procField("mfra_size","uint",32)},i.prototype._boxProcessors.mp4a=i.prototype._boxProcessors.enca=function(){this._procFieldArray("reserved1",6,"uint",8),this._procField("data_reference_index","uint",16),this._procFieldArray("reserved2",2,"uint",32),this._procField("channelcount","uint",16),this._procField("samplesize","uint",16),this._procField("pre_defined","uint",16),this._procField("reserved3","uint",16),this._procField("samplerate","template",32),this._procField("esds","data",-1)},i.prototype._boxProcessors.mvhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("timescale","uint",32),this._procField("duration","uint",1==this.version?64:32),this._procField("rate","template",32),this._procField("volume","template",16),this._procField("reserved1","uint",16),this._procFieldArray("reserved2",2,"uint",32),this._procFieldArray("matrix",9,"template",32),this._procFieldArray("pre_defined",6,"uint",32),this._procField("next_track_ID","uint",32)},i.prototype._boxProcessors.payl=function(){this._procField("cue_text","utf8")},i.prototype._boxProcessors.prft=function(){this._procFullBox(),this._procField("reference_track_ID","uint",32),this._procField("ntp_timestamp_sec","uint",32),this._procField("ntp_timestamp_frac","uint",32),this._procField("media_time","uint",1==this.version?64:32)},i.prototype._boxProcessors.pssh=function(){this._procFullBox(),this._procFieldArray("SystemID",16,"uint",8),this._procField("DataSize","uint",32),this._procFieldArray("Data",this.DataSize,"uint",8)},i.prototype._boxProcessors.schm=function(){this._procFullBox(),this._procField("scheme_type","uint",32),this._procField("scheme_version","uint",32),1&this.flags&&this._procField("scheme_uri","string",-1)},i.prototype._boxProcessors.sdtp=function(){this._procFullBox();var e=-1;this._parsing&&(e=this._raw.byteLength-(this._cursor.offset-this._raw.byteOffset)),this._procFieldArray("sample_dependency_table",e,"uint",8)},i.prototype._boxProcessors.sidx=function(){this._procFullBox(),this._procField("reference_ID","uint",32),this._procField("timescale","uint",32),this._procField("earliest_presentation_time","uint",1==this.version?64:32),this._procField("first_offset","uint",1==this.version?64:32),this._procField("reserved","uint",16),this._procField("reference_count","uint",16),this._procEntries("references",this.reference_count,(function(e){this._parsing||(e.reference=(1&e.reference_type)<<31,e.reference|=2147483647&e.referenced_size,e.sap=(1&e.starts_with_SAP)<<31,e.sap|=(3&e.SAP_type)<<28,e.sap|=268435455&e.SAP_delta_time),this._procEntryField(e,"reference","uint",32),this._procEntryField(e,"subsegment_duration","uint",32),this._procEntryField(e,"sap","uint",32),this._parsing&&(e.reference_type=e.reference>>31&1,e.referenced_size=2147483647&e.reference,e.starts_with_SAP=e.sap>>31&1,e.SAP_type=e.sap>>28&7,e.SAP_delta_time=268435455&e.sap)}))},i.prototype._boxProcessors.smhd=function(){this._procFullBox(),this._procField("balance","uint",16),this._procField("reserved","uint",16)},i.prototype._boxProcessors.ssix=function(){this._procFullBox(),this._procField("subsegment_count","uint",32),this._procEntries("subsegments",this.subsegment_count,(function(e){this._procEntryField(e,"ranges_count","uint",32),this._procSubEntries(e,"ranges",e.ranges_count,(function(e){this._procEntryField(e,"level","uint",8),this._procEntryField(e,"range_size","uint",24)}))}))},i.prototype._boxProcessors.stsd=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procSubBoxes("entries",this.entry_count)},i.prototype._boxProcessors.sttg=function(){this._procField("settings","utf8")},i.prototype._boxProcessors.stts=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,(function(e){this._procEntryField(e,"sample_count","uint",32),this._procEntryField(e,"sample_delta","uint",32)}))},i.prototype._boxProcessors.subs=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,(function(e){this._procEntryField(e,"sample_delta","uint",32),this._procEntryField(e,"subsample_count","uint",16),this._procSubEntries(e,"subsamples",e.subsample_count,(function(e){this._procEntryField(e,"subsample_size","uint",1===this.version?32:16),this._procEntryField(e,"subsample_priority","uint",8),this._procEntryField(e,"discardable","uint",8),this._procEntryField(e,"codec_specific_parameters","uint",32)}))}))},i.prototype._boxProcessors.tenc=function(){this._procFullBox(),this._procField("default_IsEncrypted","uint",24),this._procField("default_IV_size","uint",8),this._procFieldArray("default_KID",16,"uint",8)},i.prototype._boxProcessors.tfdt=function(){this._procFullBox(),this._procField("baseMediaDecodeTime","uint",1==this.version?64:32)},i.prototype._boxProcessors.tfhd=function(){this._procFullBox(),this._procField("track_ID","uint",32),1&this.flags&&this._procField("base_data_offset","uint",64),2&this.flags&&this._procField("sample_description_offset","uint",32),8&this.flags&&this._procField("default_sample_duration","uint",32),16&this.flags&&this._procField("default_sample_size","uint",32),32&this.flags&&this._procField("default_sample_flags","uint",32)},i.prototype._boxProcessors.tfra=function(){this._procFullBox(),this._procField("track_ID","uint",32),this._parsing||(this.reserved=0,this.reserved|=(48&this.length_size_of_traf_num)<<4,this.reserved|=(12&this.length_size_of_trun_num)<<2,this.reserved|=3&this.length_size_of_sample_num),this._procField("reserved","uint",32),this._parsing&&(this.length_size_of_traf_num=(48&this.reserved)>>4,this.length_size_of_trun_num=(12&this.reserved)>>2,this.length_size_of_sample_num=3&this.reserved),this._procField("number_of_entry","uint",32),this._procEntries("entries",this.number_of_entry,(function(e){this._procEntryField(e,"time","uint",1===this.version?64:32),this._procEntryField(e,"moof_offset","uint",1===this.version?64:32),this._procEntryField(e,"traf_number","uint",8*(this.length_size_of_traf_num+1)),this._procEntryField(e,"trun_number","uint",8*(this.length_size_of_trun_num+1)),this._procEntryField(e,"sample_number","uint",8*(this.length_size_of_sample_num+1))}))},i.prototype._boxProcessors.tkhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("track_ID","uint",32),this._procField("reserved1","uint",32),this._procField("duration","uint",1==this.version?64:32),this._procFieldArray("reserved2",2,"uint",32),this._procField("layer","uint",16),this._procField("alternate_group","uint",16),this._procField("volume","template",16),this._procField("reserved3","uint",16),this._procFieldArray("matrix",9,"template",32),this._procField("width","template",32),this._procField("height","template",32)},i.prototype._boxProcessors.trex=function(){this._procFullBox(),this._procField("track_ID","uint",32),this._procField("default_sample_description_index","uint",32),this._procField("default_sample_duration","uint",32),this._procField("default_sample_size","uint",32),this._procField("default_sample_flags","uint",32)},i.prototype._boxProcessors.trun=function(){this._procFullBox(),this._procField("sample_count","uint",32),1&this.flags&&this._procField("data_offset","int",32),4&this.flags&&this._procField("first_sample_flags","uint",32),this._procEntries("samples",this.sample_count,(function(e){256&this.flags&&this._procEntryField(e,"sample_duration","uint",32),512&this.flags&&this._procEntryField(e,"sample_size","uint",32),1024&this.flags&&this._procEntryField(e,"sample_flags","uint",32),2048&this.flags&&this._procEntryField(e,"sample_composition_time_offset",1===this.version?"int":"uint",32)}))},i.prototype._boxProcessors["url "]=i.prototype._boxProcessors["urn "]=function(){this._procFullBox(),"urn "===this.type&&this._procField("name","string",-1),this._procField("location","string",-1)},i.prototype._boxProcessors.vlab=function(){this._procField("source_label","utf8")},i.prototype._boxProcessors.vmhd=function(){this._procFullBox(),this._procField("graphicsmode","uint",16),this._procFieldArray("opcolor",3,"uint",16)},i.prototype._boxProcessors.vttC=function(){this._procField("config","utf8")},i.prototype._boxProcessors.vtte=function(){}},5530:function(e,t,r){e.exports=r(6146).polyfill()},6146:function(e,t,r){e.exports=function(){function e(e){return"function"==typeof e}var t=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},n=0,i=void 0,a=void 0,o=function(e,t){h[n]=e,h[n+1]=t,2===(n+=2)&&(a?a(g):v())},s="undefined"!=typeof window?window:void 0,l=s||{},u=l.MutationObserver||l.WebKitMutationObserver,c="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),f="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function d(){var e=setTimeout;return function(){return e(g,1)}}var h=new Array(1e3);function g(){for(var e=0;e<n;e+=2)(0,h[e])(h[e+1]),h[e]=void 0,h[e+1]=void 0;n=0}var m,p,y,E,v=void 0;function T(e,t){var r=this,n=new this.constructor(A);void 0===n[S]&&P(n);var i=r._state;if(i){var a=arguments[i-1];o((function(){return O(i,n,a,r._result)}))}else L(r,n,e,t);return n}function _(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(A);return I(t,e),t}v=c?function(){return process.nextTick(g)}:u?(p=0,y=new u(g),E=document.createTextNode(""),y.observe(E,{characterData:!0}),function(){E.data=p=++p%2}):f?((m=new MessageChannel).port1.onmessage=g,function(){return m.port2.postMessage(0)}):void 0===s?function(){try{var e=Function("return this")().require("vertx");return void 0!==(i=e.runOnLoop||e.runOnContext)?function(){i(g)}:d()}catch(t){return d()}}():d();var S=Math.random().toString(36).substring(2);function A(){}var b=void 0;function R(t,r,n){var i,a;r.constructor===t.constructor&&n===T&&r.constructor.resolve===_?(i=t,1===(a=r)._state?C(i,a._result):2===a._state?D(i,a._result):L(a,void 0,(function(e){return I(i,e)}),(function(e){return D(i,e)}))):void 0===n?C(t,r):e(n)?function(e,t,r){o((function(e){var n=!1,i=function(e,t,r,n){try{e.call(t,r,n)}catch(i){return i}}(r,t,(function(r){n||(n=!0,t!==r?I(e,r):C(e,r))}),(function(t){n||(n=!0,D(e,t))}),e._label);!n&&i&&(n=!0,D(e,i))}),e)}(t,r,n):C(t,r)}function I(e,t){if(e===t)D(e,new TypeError("You cannot resolve a promise with itself"));else if(i=typeof(n=t),null===n||"object"!==i&&"function"!==i)C(e,t);else{var r=void 0;try{r=t.then}catch(a){return void D(e,a)}R(e,t,r)}var n,i}function w(e){e._onerror&&e._onerror(e._result),N(e)}function C(e,t){e._state===b&&(e._result=t,e._state=1,0!==e._subscribers.length&&o(N,e))}function D(e,t){e._state===b&&(e._state=2,e._result=t,o(w,e))}function L(e,t,r,n){var i=e._subscribers,a=i.length;e._onerror=null,i[a]=t,i[a+1]=r,i[a+2]=n,0===a&&e._state&&o(N,e)}function N(e){var t=e._subscribers,r=e._state;if(0!==t.length){for(var n=void 0,i=void 0,a=e._result,o=0;o<t.length;o+=3)n=t[o],i=t[o+r],n?O(r,n,i,a):i(a);e._subscribers.length=0}}function O(t,r,n,i){var a=e(n),o=void 0,s=void 0,l=!0;if(a){try{o=n(i)}catch(u){l=!1,s=u}if(r===o)return void D(r,new TypeError("A promises callback cannot return that same promise."))}else o=i;r._state!==b||(a&&l?I(r,o):!1===l?D(r,s):1===t?C(r,o):2===t&&D(r,o))}var M=0;function P(e){e[S]=M++,e._state=void 0,e._result=void 0,e._subscribers=[]}var k=function(){function e(e,r){this._instanceConstructor=e,this.promise=new e(A),this.promise[S]||P(this.promise),t(r)?(this.length=r.length,this._remaining=r.length,this._result=new Array(this.length),0===this.length?C(this.promise,this._result):(this.length=this.length||0,this._enumerate(r),0===this._remaining&&C(this.promise,this._result))):D(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;this._state===b&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var r=this._instanceConstructor,n=r.resolve;if(n===_){var i=void 0,a=void 0,o=!1;try{i=e.then}catch(l){o=!0,a=l}if(i===T&&e._state!==b)this._settledAt(e._state,t,e._result);else if("function"!=typeof i)this._remaining--,this._result[t]=e;else if(r===x){var s=new r(A);o?D(s,a):R(s,e,i),this._willSettleAt(s,t)}else this._willSettleAt(new r((function(t){return t(e)})),t)}else this._willSettleAt(n(e),t)},e.prototype._settledAt=function(e,t,r){var n=this.promise;n._state===b&&(this._remaining--,2===e?D(n,r):this._result[t]=r),0===this._remaining&&C(n,this._result)},e.prototype._willSettleAt=function(e,t){var r=this;L(e,void 0,(function(e){return r._settledAt(1,t,e)}),(function(e){return r._settledAt(2,t,e)}))},e}(),x=function(){function t(e){this[S]=M++,this._result=this._state=void 0,this._subscribers=[],A!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function(e,t){try{t((function(t){I(e,t)}),(function(t){D(e,t)}))}catch(r){D(e,r)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return t.prototype.catch=function(e){return this.then(null,e)},t.prototype.finally=function(t){var r=this,n=r.constructor;return e(t)?r.then((function(e){return n.resolve(t()).then((function(){return e}))}),(function(e){return n.resolve(t()).then((function(){throw e}))})):r.then(t,t)},t}();return x.prototype.then=T,x.all=function(e){return new k(this,e).promise},x.race=function(e){var r=this;return t(e)?new r((function(t,n){for(var i=e.length,a=0;a<i;a++)r.resolve(e[a]).then(t,n)})):new r((function(e,t){return t(new TypeError("You must pass an array to race."))}))},x.resolve=_,x.reject=function(e){var t=new this(A);return D(t,e),t},x._setScheduler=function(e){a=e},x._setAsap=function(e){o=e},x._asap=o,x.polyfill=function(){var e=void 0;if(void 0!==r.g)e=r.g;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(i){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(i){}if("[object Promise]"===n&&!t.cast)return}e.Promise=x},x.Promise=x,x}()},1159:function(e){var t,r="object"==typeof Reflect?Reflect:null,n=r&&"function"==typeof r.apply?r.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};t=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,e.exports.once=function(e,t){return new Promise((function(r,n){function i(r){e.removeListener(t,a),n(r)}function a(){"function"==typeof e.removeListener&&e.removeListener("error",i),r([].slice.call(arguments))}var o,s;m(e,t,a,{once:!0}),"error"!==t&&(s=i,"function"==typeof(o=e).on&&m(o,"error",s,{once:!0}))}))},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var o=10;function s(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function u(e,t,r,n){var i,a,o;if(s(r),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),a=e._events),o=a[t]),void 0===o)o=a[t]=r,++e._eventsCount;else if("function"==typeof o?o=a[t]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),(i=l(e))>0&&o.length>i&&!o.warned){o.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=o.length,console&&console.warn}return e}function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=c.bind(n);return i.listener=r,n.wrapFn=i,i}function d(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):g(i,i.length)}function h(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function g(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function m(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(a){n.once&&e.removeEventListener(t,i),r(a)}))}}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return l(this)},a.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i="error"===e,a=this._events;if(void 0!==a)i=i&&void 0===a.error;else if(!i)return!1;if(i){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var s=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw s.context=o,s}var l=a[e];if(void 0===l)return!1;if("function"==typeof l)n(l,this,t);else{var u=l.length,c=g(l,u);for(r=0;r<u;++r)n(c[r],this,t)}return!0},a.prototype.addListener=function(e,t){return u(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return u(this,e,t,!0)},a.prototype.once=function(e,t){return s(t),this.on(e,f(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return s(t),this.prependListener(e,f(this,e,t)),this},a.prototype.removeListener=function(e,t){var r,n,i,a,o;if(s(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,a=r.length-1;a>=0;a--)if(r[a]===t||r[a].listener===t){o=r[a].listener,i=a;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,o||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,a=Object.keys(r);for(n=0;n<a.length;++n)"removeListener"!==(i=a[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},a.prototype.listeners=function(e){return d(this,e,!0)},a.prototype.rawListeners=function(e){return d(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},a.prototype.listenerCount=h,a.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},3101:function(e){var t=Array.isArray,r=Object.keys,n=Object.prototype.hasOwnProperty;e.exports=function e(i,a){if(i===a)return!0;if(i&&a&&"object"==typeof i&&"object"==typeof a){var o,s,l,u=t(i),c=t(a);if(u&&c){if((s=i.length)!=a.length)return!1;for(o=s;0!=o--;)if(!e(i[o],a[o]))return!1;return!0}if(u!=c)return!1;var f=i instanceof Date,d=a instanceof Date;if(f!=d)return!1;if(f&&d)return i.getTime()==a.getTime();var h=i instanceof RegExp,g=a instanceof RegExp;if(h!=g)return!1;if(h&&g)return i.toString()==a.toString();var m=r(i);if((s=m.length)!==r(a).length)return!1;for(o=s;0!=o--;)if(!n.call(a,m[o]))return!1;for(o=s;0!=o--;)if(!e(i[l=m[o]],a[l]))return!1;return!0}return i!=i&&a!=a}},3362:function(e,t,r){!function(e,t,r,n,i){function a(e){if("contents"in e)for(var t=("styleAttrs"in e?e.styleAttrs[n.byName.ruby.qname]:null),r="span"===e.kind&&("container"===t||"textContainer"===t||"baseContainer"===t),i=e.contents.length-1;i>=0;i--)!r||"styleAttrs"in e.contents[i]&&n.byName.ruby.qname in e.contents[i].styleAttrs?a(e.contents[i]):delete e.contents[i]}function o(e,t,r,n){var i=n&&"seq"===n.timeContainer,a=0;n&&(a=i&&r?r.end:n.begin),t.begin=t.explicit_begin?t.explicit_begin+a:a;var s=t.begin,l=null;if("sets"in t)for(var u=0;u<t.sets.length;u++)o(e,t.sets[u],l,t),s="seq"===t.timeContainer?t.sets[u].end:Math.max(s,t.sets[u].end),l=t.sets[u];if("contents"in t){if("contents"in t)for(var c=0;c<t.contents.length;c++)o(e,t.contents[c],l,t),s="seq"===t.timeContainer?t.contents[c].end:Math.max(s,t.contents[c].end),l=t.contents[c]}else s=i?t.begin:Number.POSITIVE_INFINITY;null!==t.explicit_end&&null!==t.explicit_dur?t.end=Math.min(t.begin+t.explicit_dur,a+t.explicit_end):null===t.explicit_end&&null!==t.explicit_dur?t.end=t.begin+t.explicit_dur:null!==t.explicit_end&&null===t.explicit_dur?t.end=a+t.explicit_end:t.end=s,delete t.explicit_begin,delete t.explicit_dur,delete t.explicit_end,e._registerEvent(t)}function s(e){this.node=e}function l(){this.events=[],this.head=new u,this.body=null}function u(){this.styling=new c,this.layout=new h}function c(){this.styles={},this.initials={}}function f(){this.id=null,this.styleAttrs=null,this.styleRefs=null}function d(){this.styleAttrs=null}function h(){this.regions={}}function g(e,t){m.call(this,"image"),this.src=e,this.type=t}function m(e){this.kind=e}function p(e){this.id=e}function y(e){this.regionID=e}function E(e){this.styleAttrs=e}function v(e){this.sets=e}function T(e){this.contents=e}function _(e,t,r){this.explicit_begin=e,this.explicit_end=t,this.explicit_dur=r}function S(){m.call(this,"body")}function A(){m.call(this,"div")}function b(){m.call(this,"p")}function R(){m.call(this,"span")}function I(){m.call(this,"span")}function w(){m.call(this,"br")}function C(){}function D(){}function L(e){return e&&"xml:id"in e.attributes&&e.attributes["xml:id"].value||null}function N(e){return e&&"style"in e.attributes?e.attributes.style.value.split(" "):[]}function O(e,t){var r={};if(null!==e)for(var i in e.attributes){var a=e.attributes[i].uri+" "+e.attributes[i].local,o=n.byQName[a];if(void 0!==o){var s=o.parse(e.attributes[i].value);null!==s?(r[a]=s,o===n.byName.zIndex&&U(t,"zIndex attribute present but not used by IMSC1 since regions do not overlap")):B(t,"Cannot parse styling attribute "+a+" --\x3e "+e.attributes[i].value)}}return r}function M(e,t,r){for(var n in e.attributes)if(e.attributes[n].uri===t&&e.attributes[n].local===r)return e.attributes[n].value;return null}function P(e,t,r){var n,i=null;return null!==(n=/^(\d+(?:\.\d+)?)f$/.exec(r))?null!==t&&(i=parseFloat(n[1])/t):null!==(n=/^(\d+(?:\.\d+)?)t$/.exec(r))?null!==e&&(i=parseFloat(n[1])/e):null!==(n=/^(\d+(?:\.\d+)?)ms$/.exec(r))?i=parseFloat(n[1])/1e3:null!==(n=/^(\d+(?:\.\d+)?)s$/.exec(r))?i=parseFloat(n[1]):null!==(n=/^(\d+(?:\.\d+)?)h$/.exec(r))?i=3600*parseFloat(n[1]):null!==(n=/^(\d+(?:\.\d+)?)m$/.exec(r))?i=60*parseFloat(n[1]):null!==(n=/^(\d{2,}):(\d\d):(\d\d(?:\.\d+)?)$/.exec(r))?i=3600*parseInt(n[1])+60*parseInt(n[2])+parseFloat(n[3]):null!==(n=/^(\d{2,}):(\d\d):(\d\d)\:(\d{2,})$/.exec(r))&&null!==t&&(i=3600*parseInt(n[1])+60*parseInt(n[2])+parseInt(n[3])+(null===n[4]?0:parseInt(n[4])/t)),i}function k(e,t,r){for(;t.styleRefs.length>0;){var n=t.styleRefs.pop();n in e.styles?(k(e,e.styles[n],r),F(e.styles[n].styleAttrs,t.styleAttrs)):B(r,"Non-existant style id referenced")}}function x(e,t,r,n){for(var i=t.length-1;i>=0;i--){var a=t[i];a in e.styles?F(e.styles[a].styleAttrs,r):B(n,"Non-existant style id referenced")}}function F(e,t){for(var r in e)e.hasOwnProperty(r)&&(r in t||(t[r]=e[r]))}function U(e,t){if(e&&e.warn&&e.warn(t))throw t}function B(e,t){if(e&&e.error&&e.error(t))throw t}function Z(e,t){throw e&&e.fatal&&e.fatal(t),t}function G(e,t){for(var r,n=0,i=e.length-1;n<=i;){var a=e[r=Math.floor((n+i)/2)];if(a<t)n=r+1;else{if(!(a>t))return{found:!0,index:r};i=r-1}}return{found:!1,index:n}}e.fromXML=function(e,i,m){var p=t.parser(!0,{xmlns:!0}),y=[],E=[],v=[],T=0,_=null;p.onclosetag=function(e){if(y[0]instanceof C)null!==_.head&&null!==_.head.styling&&x(_.head.styling,y[0].styleRefs,y[0].styleAttrs,i),delete y[0].styleRefs;else if(y[0]instanceof c)for(var t in y[0].styles)y[0].styles.hasOwnProperty(t)&&k(y[0],y[0].styles[t],i);else if(y[0]instanceof b||y[0]instanceof R){if(y[0].contents.length>1){var n,a=[y[0].contents[0]];for(n=1;n<y[0].contents.length;n++)y[0].contents[n]instanceof I&&a[a.length-1]instanceof I?a[a.length-1].text+=y[0].contents[n].text:a.push(y[0].contents[n]);y[0].contents=a}y[0]instanceof R&&1===y[0].contents.length&&y[0].contents[0]instanceof I&&(y[0].text=y[0].contents[0].text,delete y[0].contents)}else y[0]instanceof s&&(y[0].node.uri===r.ns_tt&&"metadata"===y[0].node.local?T--:T>0&&m&&"onCloseTag"in m&&m.onCloseTag());v.shift(),E.shift(),y.shift()},p.ontext=function(e){if(void 0===y[0]);else if(y[0]instanceof R||y[0]instanceof b){if(y[0]instanceof R){var t=y[0].styleAttrs[n.byName.ruby.qname];if("container"===t||"textContainer"===t||"baseContainer"===t)return}var r=new I;r.initFromText(_,y[0],e,E[0],v[0],i),y[0].contents.push(r)}else y[0]instanceof s&&T>0&&m&&"onText"in m&&m.onText(e)},p.onopentag=function(e){var t=e.attributes["xml:space"];t?v.unshift(t.value):0===v.length?v.unshift("default"):v.unshift(v[0]);var a=e.attributes["xml:lang"];if(a?E.unshift(a.value):0===E.length?E.unshift(""):E.unshift(E[0]),e.uri===r.ns_tt)if("tt"===e.local)null!==_&&Z(i,"Two <tt> elements at ("+this.line+","+this.column+")"),(_=new l).initFromNode(e,E[0],i),y.unshift(_);else if("head"===e.local)y[0]instanceof l||Z(i,"Parent of <head> element is not <tt> at ("+this.line+","+this.column+")"),y.unshift(_.head);else if("styling"===e.local)y[0]instanceof u||Z(i,"Parent of <styling> element is not <head> at ("+this.line+","+this.column+")"),y.unshift(_.head.styling);else if("style"===e.local){var o;y[0]instanceof c?((o=new f).initFromNode(e,i),o.id?_.head.styling.styles[o.id]=o:B(i,"<style> element missing @id attribute"),y.unshift(o)):y[0]instanceof C?((o=new f).initFromNode(e,i),F(o.styleAttrs,y[0].styleAttrs),y.unshift(o)):Z(i,"Parent of <style> element is not <styling> or <region> at ("+this.line+","+this.column+")")}else if("initial"===e.local){var p;if(y[0]instanceof c){for(var I in(p=new d).initFromNode(e,i),p.styleAttrs)p.styleAttrs.hasOwnProperty(I)&&(_.head.styling.initials[I]=p.styleAttrs[I]);y.unshift(p)}else Z(i,"Parent of <initial> element is not <styling> at ("+this.line+","+this.column+")")}else if("layout"===e.local)y[0]instanceof u||Z(i,"Parent of <layout> element is not <head> at "+this.line+","+this.column+")"),y.unshift(_.head.layout);else if("region"===e.local){y[0]instanceof h||Z(i,"Parent of <region> element is not <layout> at "+this.line+","+this.column+")");var L=new C;L.initFromNode(_,e,E[0],i),!L.id||L.id in _.head.layout.regions?B(i,"Ignoring <region> with duplicate or missing @id at "+this.line+","+this.column+")"):_.head.layout.regions[L.id]=L,y.unshift(L)}else if("body"===e.local){y[0]instanceof l||Z(i,"Parent of <body> element is not <tt> at "+this.line+","+this.column+")"),null!==_.body&&Z(i,"Second <body> element at "+this.line+","+this.column+")");var N=new S;N.initFromNode(_,e,E[0],i),_.body=N,y.unshift(N)}else if("div"===e.local){y[0]instanceof A||y[0]instanceof S||Z(i,"Parent of <div> element is not <body> or <div> at "+this.line+","+this.column+")");var O=new A;O.initFromNode(_,y[0],e,E[0],i);var M=O.styleAttrs[n.byName.backgroundImage.qname];M&&(O.contents.push(new g(M)),delete O.styleAttrs[n.byName.backgroundImage.qname]),y[0].contents.push(O),y.unshift(O)}else if("image"===e.local){y[0]instanceof A||Z(i,"Parent of <image> element is not <div> at "+this.line+","+this.column+")");var P=new g;P.initFromNode(_,y[0],e,E[0],i),y[0].contents.push(P),y.unshift(P)}else if("p"===e.local){y[0]instanceof A||Z(i,"Parent of <p> element is not <div> at "+this.line+","+this.column+")");var k=new b;k.initFromNode(_,y[0],e,E[0],i),y[0].contents.push(k),y.unshift(k)}else if("span"===e.local){y[0]instanceof R||y[0]instanceof b||Z(i,"Parent of <span> element is not <span> or <p> at "+this.line+","+this.column+")");var x=new R;x.initFromNode(_,y[0],e,E[0],v[0],i),y[0].contents.push(x),y.unshift(x)}else if("br"===e.local){y[0]instanceof R||y[0]instanceof b||Z(i,"Parent of <br> element is not <span> or <p> at "+this.line+","+this.column+")");var U=new w;U.initFromNode(_,y[0],e,E[0],i),y[0].contents.push(U),y.unshift(U)}else if("set"===e.local){y[0]instanceof R||y[0]instanceof b||y[0]instanceof A||y[0]instanceof S||y[0]instanceof C||y[0]instanceof w||Z(i,"Parent of <set> element is not a content element or a region at "+this.line+","+this.column+")");var G=new D;G.initFromNode(_,y[0],e,i),y[0].sets.push(G),y.unshift(G)}else y.unshift(new s(e));else y.unshift(new s(e));if(y[0]instanceof s)if(e.uri===r.ns_tt&&"metadata"===e.local)T++;else if(T>0&&m&&"onOpenTag"in m){var H=[];for(var K in e.attributes)H[e.attributes[K].uri+" "+e.attributes[K].local]={uri:e.attributes[K].uri,local:e.attributes[K].local,value:e.attributes[K].value};m.onOpenTag(e.uri,e.local,H)}},p.write(e).close(),delete _.head.styling.styles;var L=!1;for(var N in _.head.layout.regions)if(_.head.layout.regions.hasOwnProperty(N)){L=!0;break}if(!L){var O=C.prototype.createDefaultRegion(_.lang);_.head.layout.regions[O.id]=O}for(var M in _.head.layout.regions)_.head.layout.regions.hasOwnProperty(M)&&o(_,_.head.layout.regions[M],null,null);return _.body&&o(_,_.body,null,null),_.body&&a(_.body),_},l.prototype.initFromNode=function(e,t,n){var a=function(e,t){var n=M(e,r.ns_ttp,"cellResolution"),i=15,a=32;if(null!==n){var o=/(\d+) (\d+)/.exec(n);null!==o?(a=parseInt(o[1]),i=parseInt(o[2])):U(t,"Malformed cellResolution value (using initial value instead)")}return{w:a,h:i}}(e,n);this.cellLength={h:new i.ComputedLength(0,1/a.h),w:new i.ComputedLength(1/a.w,0)};var o=function(e,t){var n,i=M(e,r.ns_ttp,"frameRate"),a=30;null!==i&&(null!==(n=/(\d+)/.exec(i))?a=parseInt(n[1]):U(t,"Malformed frame rate attribute (using initial value instead)"));var o=M(e,r.ns_ttp,"frameRateMultiplier"),s=1;null!==o&&(null!==(n=/(\d+) (\d+)/.exec(o))?s=parseInt(n[1])/parseInt(n[2]):U(t,"Malformed frame rate multiplier attribute (using initial value instead)"));var l=s*a,u=1,c=M(e,r.ns_ttp,"tickRate");return null===c?null!==i&&(u=l):null!==(n=/(\d+)/.exec(c))?u=parseInt(n[1]):U(t,"Malformed tick rate attribute (using initial value instead)"),{effectiveFrameRate:l,tickRate:u}}(e,n);this.effectiveFrameRate=o.effectiveFrameRate,this.tickRate=o.tickRate,this.aspectRatio=function(e,t){var n=M(e,r.ns_ittp,"aspectRatio");null===n&&(n=M(e,r.ns_ttp,"displayAspectRatio"));var i=null;if(null!==n){var a=/(\d+)\s+(\d+)/.exec(n);if(null!==a){var o=parseInt(a[1]),s=parseInt(a[2]);0!==o&&0!==s?i=o/s:B(t,"Illegal aspectRatio values (ignoring)")}else B(t,"Malformed aspectRatio attribute (ignoring)")}return i}(e,n);var s=M(e,r.ns_ttp,"timeBase");null!==s&&"media"!==s&&Z(n,"Unsupported time base");var l=function(e,t){var n=M(e,r.ns_tts,"extent");if(null===n)return null;var a=n.split(" ");if(2!==a.length)return U(t,"Malformed extent (ignoring)"),null;var o=i.parseLength(a[0]),s=i.parseLength(a[1]);return s&&o?{h:s,w:o}:(U(t,"Malformed extent values (ignoring)"),null)}(e,n);null===l?this.pxLength={h:null,w:null}:("px"===l.h.unit&&"px"===l.w.unit||Z(n,"Extent on TT must be in px or absent"),this.pxLength={h:new i.ComputedLength(0,1/l.h.value),w:new i.ComputedLength(1/l.w.value,0)}),this.dimensions={h:new i.ComputedLength(0,1),w:new i.ComputedLength(1,0)},this.lang=t},l.prototype._registerEvent=function(e){if(!(e.end<=e.begin)){var t=G(this.events,e.begin);if(t.found||this.events.splice(t.index,0,e.begin),e.end!==Number.POSITIVE_INFINITY){var r=G(this.events,e.end);r.found||this.events.splice(r.index,0,e.end)}}},l.prototype.getMediaTimeRange=function(){return[this.events[0],this.events[this.events.length-1]]},l.prototype.getMediaTimeEvents=function(){return this.events},f.prototype.initFromNode=function(e,t){this.id=L(e),this.styleAttrs=O(e,t),this.styleRefs=N(e)},d.prototype.initFromNode=function(e,t){for(var n in this.styleAttrs={},e.attributes)if(e.attributes[n].uri===r.ns_itts||e.attributes[n].uri===r.ns_ebutts||e.attributes[n].uri===r.ns_tts){var i=e.attributes[n].uri+" "+e.attributes[n].local;this.styleAttrs[i]=e.attributes[n].value}},g.prototype.initFromNode=function(e,t,r,n,i){this.src="src"in r.attributes?r.attributes.src.value:null,this.src||B(i,"Invalid image@src attribute"),this.type="type"in r.attributes?r.attributes.type.value:null,this.type||B(i,"Invalid image@type attribute"),E.prototype.initFromNode.call(this,e,t,r,i),_.prototype.initFromNode.call(this,e,t,r,i),v.prototype.initFromNode.call(this,e,t,r,i),y.prototype.initFromNode.call(this,e,t,r,i),this.lang=n},p.prototype.initFromNode=function(e,t,r,n){this.id=L(r)},y.prototype.initFromNode=function(e,t,r,n){var i;this.regionID=(i=r)&&"region"in i.attributes?i.attributes.region.value:""},E.prototype.initFromNode=function(e,t,r,n){this.styleAttrs=O(r,n),null!==e.head&&null!==e.head.styling&&x(e.head.styling,N(r),this.styleAttrs,n)},v.prototype.initFromNode=function(e,t,r,n){this.sets=[]},T.prototype.initFromNode=function(e,t,r,n){this.contents=[]},_.prototype.initFromNode=function(e,t,r,n){var i,a,o,s=function(e,t,r,n){var i=null;r&&"begin"in r.attributes&&null===(i=P(e.tickRate,e.effectiveFrameRate,r.attributes.begin.value))&&U(n,"Malformed begin value "+r.attributes.begin.value+" (using 0)");var a=null;r&&"dur"in r.attributes&&null===(a=P(e.tickRate,e.effectiveFrameRate,r.attributes.dur.value))&&U(n,"Malformed dur value "+r.attributes.dur.value+" (ignoring)");var o=null;return r&&"end"in r.attributes&&null===(o=P(e.tickRate,e.effectiveFrameRate,r.attributes.end.value))&&U(n,"Malformed end value (ignoring)"),{explicit_begin:i,explicit_end:o,explicit_dur:a}}(e,0,r,n);this.explicit_begin=s.explicit_begin,this.explicit_end=s.explicit_end,this.explicit_dur=s.explicit_dur,this.timeContainer=(a=n,(o=(i=r)&&"timeContainer"in i.attributes?i.attributes.timeContainer.value:null)&&"par"!==o?"seq"===o?"seq":(B(a,"Illegal value of timeContainer (assuming 'par')"),"par"):"par")},S.prototype.initFromNode=function(e,t,r,n){E.prototype.initFromNode.call(this,e,null,t,n),_.prototype.initFromNode.call(this,e,null,t,n),v.prototype.initFromNode.call(this,e,null,t,n),y.prototype.initFromNode.call(this,e,null,t,n),T.prototype.initFromNode.call(this,e,null,t,n),this.lang=r},A.prototype.initFromNode=function(e,t,r,n,i){E.prototype.initFromNode.call(this,e,t,r,i),_.prototype.initFromNode.call(this,e,t,r,i),v.prototype.initFromNode.call(this,e,t,r,i),y.prototype.initFromNode.call(this,e,t,r,i),T.prototype.initFromNode.call(this,e,t,r,i),this.lang=n},b.prototype.initFromNode=function(e,t,r,n,i){E.prototype.initFromNode.call(this,e,t,r,i),_.prototype.initFromNode.call(this,e,t,r,i),v.prototype.initFromNode.call(this,e,t,r,i),y.prototype.initFromNode.call(this,e,t,r,i),T.prototype.initFromNode.call(this,e,t,r,i),this.lang=n},R.prototype.initFromNode=function(e,t,r,n,i,a){E.prototype.initFromNode.call(this,e,t,r,a),_.prototype.initFromNode.call(this,e,t,r,a),v.prototype.initFromNode.call(this,e,t,r,a),y.prototype.initFromNode.call(this,e,t,r,a),T.prototype.initFromNode.call(this,e,t,r,a),this.space=i,this.lang=n},I.prototype.initFromText=function(e,t,r,n,i,a){_.prototype.initFromNode.call(this,e,t,null,a),this.text=r,this.space=i,this.lang=n},w.prototype.initFromNode=function(e,t,r,n,i){y.prototype.initFromNode.call(this,e,t,r,i),_.prototype.initFromNode.call(this,e,t,r,i),this.lang=n},C.prototype.createDefaultRegion=function(e){var t=new C;return p.call(t,""),E.call(t,{}),v.call(t,[]),_.call(t,0,Number.POSITIVE_INFINITY,null),this.lang=e,t},C.prototype.initFromNode=function(e,t,r,n){p.prototype.initFromNode.call(this,e,null,t,n),_.prototype.initFromNode.call(this,e,null,t,n),v.prototype.initFromNode.call(this,e,null,t,n),this.styleAttrs=O(t,n),this.styleRefs=N(t),this.lang=r},D.prototype.initFromNode=function(e,t,r,n){_.prototype.initFromNode.call(this,e,t,r,n);var i=O(r,n);for(var a in this.qname=null,this.value=null,i)if(i.hasOwnProperty(a)){if(this.qname){B(n,"More than one style specified on set");break}this.qname=a,this.value=i[a]}}}(t,"undefined"==typeof sax?r(5378):sax,"undefined"==typeof imscNames?r(210):imscNames,"undefined"==typeof imscStyles?r(6811):imscStyles,"undefined"==typeof imscUtils?r(5926):imscUtils)},506:function(e,t,r){var n=/firefox/i.test(navigator.userAgent);!function(e,t,r){function i(e,t,f,h){var g;if("region"===f.kind)(g=document.createElement("div")).style.position="absolute";else if("body"===f.kind)g=document.createElement("div");else if("div"===f.kind)g=document.createElement("div");else if("image"===f.kind){if(g=document.createElement("img"),null!==e.imgResolver&&null!==f.src){var y=e.imgResolver(f.src,g);y&&(g.src=y),g.height=e.regionH,g.width=e.regionW}}else if("p"===f.kind)g=document.createElement("p");else if("span"===f.kind)if("container"===f.styleAttrs[r.byName.ruby.qname])g=document.createElement("ruby"),e.ruby=!0;else if("base"===f.styleAttrs[r.byName.ruby.qname])g=document.createElement("span");else if("text"===f.styleAttrs[r.byName.ruby.qname])g=document.createElement("rt");else if("baseContainer"===f.styleAttrs[r.byName.ruby.qname])g=document.createElement("rbc");else if("textContainer"===f.styleAttrs[r.byName.ruby.qname])g=document.createElement("rtc");else{if("delimiter"===f.styleAttrs[r.byName.ruby.qname])return;g=document.createElement("span")}else"br"===f.kind&&(g=document.createElement("br"));if(g){if(f.lang&&("region"!==f.kind&&f.lang===h.lang||(g.lang=f.lang)),t.appendChild(g),g.style.margin="0","region"===f.kind){var T=f.styleAttrs[r.byName.writingMode.qname];"lrtb"===T||"lr"===T?(e.ipd="lr",e.bpd="tb"):"rltb"===T||"rl"===T?(e.ipd="rl",e.bpd="tb"):"tblr"===T?(e.ipd="tb",e.bpd="lr"):"tbrl"!==T&&"tb"!==T||(e.ipd="tb",e.bpd="rl")}else if("p"===f.kind&&"tb"===e.bpd){var _=f.styleAttrs[r.byName.direction.qname];e.ipd="ltr"===_?"lr":"rl"}for(var S=0;S<d.length;S++){var A=d[S],b=f.styleAttrs[A.qname];void 0!==b&&null!==A.map&&A.map(e,g,f,b)}var R=g,I=f.styleAttrs[r.byName.linePadding.qname];if(I&&!I.isZero()){var w=I.toUsedLength(e.w,e.h);if(w>0){var C=Math.ceil(w)+"px";"tb"===e.bpd?(R.style.paddingLeft=C,R.style.paddingRight=C):(R.style.paddingTop=C,R.style.paddingBottom=C),e.lp=I}}var D=f.styleAttrs[r.byName.multiRowAlign.qname];if(D&&"auto"!==D){var L=document.createElement("span");L.style.display="inline-block",L.style.textAlign=D,g.appendChild(L),R=L,e.mra=D}var N=f.styleAttrs[r.byName.rubyReserve.qname];if(N&&"none"!==N[0]&&(e.rubyReserve=N),f.styleAttrs[r.byName.fillLineGap.qname]&&(e.flg=!0),"span"===f.kind&&f.text){var O=f.styleAttrs[r.byName.textEmphasis.qname];if(O&&"none"!==O.style&&(e.textEmphasis=!0),r.byName.textCombine.qname in f.styleAttrs&&"all"===f.styleAttrs[r.byName.textCombine.qname])g.textContent=f.text,g._isd_element=f,O&&c(e,g,0,O);else for(var M="",P=0;P<f.text.length;P++){M+=f.text.charAt(P);var k=f.text.charCodeAt(P);if(k<55296||k>56319||P===f.text.length-1){var x=document.createElement("span");x.textContent=M,O&&c(e,x,0,O),g.appendChild(x),M="",x._isd_element=f}}}if("contents"in f)for(var F=0;F<f.contents.length;F++)i(e,R,f.contents[F],f);var U=[];if("p"===f.kind&&(u(e,R,U,null),e.rubyReserve&&(function(e,t){for(var r=0;r<e.length;r++){var n,i,a=document.createElement("ruby"),o=document.createElement("span");o.textContent="",a.appendChild(o);var s,l=t.rubyReserve[1].toUsedLength(t.w,t.h)+"px";"both"===t.rubyReserve[0]||"outside"===t.rubyReserve[0]&&1==e.length?((n=document.createElement("rtc")).style[p]=m?"after":"under",n.textContent="",n.style.fontSize=l,(i=document.createElement("rtc")).style[p]=m?"before":"over",i.textContent="",i.style.fontSize=l,a.appendChild(n),a.appendChild(i)):((n=document.createElement("rtc")).textContent="",n.style.fontSize=l,s="after"===t.rubyReserve[0]||"outside"===t.rubyReserve[0]&&r>0?m?"after":"tb"===t.bpd||"rl"===t.bpd?"under":"over":m?"before":"tb"===t.bpd||"rl"===t.bpd?"over":"under",n.style[p]=s,a.appendChild(n));for(var u=null,c=0;c<e[r].rbc.length;c++)if("ruby"===e[r].rbc[c].localName){u=e[r].rbc[c];for(var f=0;f<u.style.length;f++)a.style.setProperty(u.style.item(f),u.style.getPropertyValue(u.style.item(f)));break}(u=u||e[r].elements[0].node).parentElement.insertBefore(a,u)}}(U,e),e.rubyReserve=null),(e.ruby||e.rubyReserve)&&(function(e,t){for(var r=0;r<e.length;r++)for(var n=0;n<e[r].rbc.length;n++){var i;e[r].rbc[n].style[p]||(i=m?0===r?"before":"after":"tb"===t.bpd||"rl"===t.bpd?0===r?"over":"under":0===r?"under":"over",e[r].rbc[n].style[p]=i)}}(U,e),e.ruby=null),e.textEmphasis&&(function(e,t){for(var r=0;r<e.length;r++)for(var n=0;n<e[r].te.length;n++){var i;e[r].te[n].style[E]&&"none"!==e[r].te[n].style[E]||(i="tb"===t.bpd?0===r?"left over":"left under":"rl"===t.bpd?0===r?"right under":"left under":0===r?"left under":"right under",e[r].te[n].style[E]=i)}}(U,e),e.textEmphasis=null),e.mra&&(function(e){for(var t=0;t<e.length-1;t++){var r=e[t].elements.length;if(0!==r&&!1===e[t].br){var n=document.createElement("br"),i=e[t].elements[r-1].node;i.parentElement.insertBefore(n,i.nextSibling)}}}(U),e.mra=null),e.lp&&(function(e,t,r){if(null!==e)for(var i=0;i<e.length;i++){var a=e[i].elements.length,o=Math.ceil(t)+"px",s="-"+Math.ceil(t)+"px";if(0!==a){var l=e[i].elements[e[i].start_elem],u=e[i].elements[e[i].end_elem];if(l===u){var c=l.node.getBoundingClientRect();if(0==c.width||0==c.height)continue}"lr"===r.ipd?(l.node.style.marginLeft=s,l.node.style.paddingLeft=o):"rl"===r.ipd?(l.node.style.paddingRight=o,l.node.style.marginRight=s):"tb"===r.ipd&&(l.node.style.paddingTop=o,l.node.style.marginTop=s),"lr"===r.ipd?(n||(u.node.style.marginRight=s),u.node.style.paddingRight=o):"rl"===r.ipd?(u.node.style.paddingLeft=o,n||(u.node.style.marginLeft=s)):"tb"===r.ipd&&(u.node.style.paddingBottom=o,u.node.style.marginBottom=s)}}}(U,e.lp.toUsedLength(e.w,e.h),e),e.lp=null),function(e,t){for(var r=0;r<e.length;r++)for(var n=e[r],i=1;i<n.elements.length;){var s=n.elements[i-1],l=n.elements[i];o(s.node,l.node,t)?n.elements.splice(i,1):i++}for(var u,c,f=[],d=0;d<e.length;d++)for(var h=0;h<e[d].elements.length;h++)(c=a(u=e[d].elements[h].node,f,!1))&&(u.style.backgroundColor=c);for(var g=0;g<f.length;g++)f[g].style.backgroundColor=""}(U,e),e.flg)){var B=l(R.getBoundingClientRect(),e);!function(e,t,r,n,i){for(var a=Math.sign(r-t),o=0;o<=e.length;o++){var s,l,u,c;if(s=0===o?Math.round(t):o===e.length?Math.round(r):Math.round((e[o-1].after+e[o].before)/2),o>0&&e[o-1])for(u=0;u<e[o-1].elements.length;u++)l=a*(s-(c=e[o-1].elements[u]).after)+"px","lr"===n.bpd?c.node.style.paddingRight=l:"rl"===n.bpd?c.node.style.paddingLeft=l:"tb"===n.bpd&&(c.node.style.paddingBottom=l);if(o<e.length)for(u=0;u<e[o].elements.length;u++)l=a*((c=e[o].elements[u]).before-s)+"px","lr"===n.bpd?c.node.style.paddingLeft=l:"rl"===n.bpd?c.node.style.paddingRight=l:"tb"===n.bpd&&(c.node.style.paddingTop=l)}}(U,B.before,B.after,e),e.flg=null}if("region"===f.kind&&"tb"===e.bpd&&e.enableRollUp&&f.contents.length>0&&"after"===f.styleAttrs[r.byName.displayAlign.qname]){u(e,R,U,null);var Z=new s(""===f.id?"_":f.id,U);if(e.currentISDState[Z.id]=Z,e.previousISDState&&Z.id in e.previousISDState&&e.previousISDState[Z.id].plist.length>0&&Z.plist.length>1&&Z.plist[Z.plist.length-2].text===e.previousISDState[Z.id].plist[e.previousISDState[Z.id].plist.length-1].text){var G=g.firstElementChild,H=Z.plist[Z.plist.length-1].after-Z.plist[Z.plist.length-1].before;G.style.bottom="-"+H+"px",G.style.transition="transform 0.4s",G.style.position="relative",G.style.transform="translateY(-"+H+"px)"}}}else v(e.errorHandler,"Error processing ISD element kind: "+f.kind)}function a(e,t,r){return e.style.backgroundColor?(r&&!t.includes(e)&&t.push(e),e.style.backgroundColor):"SPAN"===e.parentElement.nodeName||"RUBY"===e.parentElement.nodeName||"RBC"===e.parentElement.nodeName||"RTC"===e.parentElement.nodeName||"RT"===e.parentElement.nodeName?a(e.parentElement,t,!0):void 0}function o(e,t,r){if("SPAN"===e.tagName&&"SPAN"===t.tagName&&e._isd_element===t._isd_element){if(!e._isd_element)return v(r.errorHandler,"Internal error: HTML span is not linked to a source element; cannot merge spans."),!1;e.textContent+=t.textContent;for(var n=0;n<t.style.length;n++){var i=t.style[n];(i.indexOf("border")>=0||i.indexOf("padding")>=0||i.indexOf("margin")>=0)&&(e.style[i]=t.style[i])}return t.parentElement.removeChild(t),!0}return!1}function s(e,t){this.id=e,this.plist=t}function l(e,t){var r={before:null,after:null,start:null,end:null};return"tb"===t.bpd?(r.before=e.top,r.after=e.bottom,"lr"===t.ipd?(r.start=e.left,r.end=e.right):(r.start=e.right,r.end=e.left)):"lr"===t.bpd?(r.before=e.left,r.after=e.right,r.start=e.top,r.end=e.bottom):"rl"===t.bpd&&(r.before=e.right,r.after=e.left,r.start=e.top,r.end=e.bottom),r}function u(e,t,r,n){if("rt"!==t.localName&&"rtc"!==t.localName){var i,a,o,s,c=t.style.backgroundColor||n;if(0===t.childElementCount)if("span"===t.localName||"rb"===t.localName){var f=l(t.getBoundingClientRect(),e);if(0!==r.length&&(i=f.before,a=f.after,o=r[r.length-1].before,a<(s=r[r.length-1].after)&&i>o||s<=a&&o>=i)){var d=Math.sign(f.after-f.before),h=Math.sign(f.end-f.start);d*(f.before-r[r.length-1].before)<0&&(r[r.length-1].before=f.before),d*(f.after-r[r.length-1].after)>0&&(r[r.length-1].after=f.after),h*(f.start-r[r.length-1].start)<0&&(r[r.length-1].start=f.start,r[r.length-1].start_elem=r[r.length-1].elements.length),h*(f.end-r[r.length-1].end)>0&&(r[r.length-1].end=f.end,r[r.length-1].end_elem=r[r.length-1].elements.length)}else r.push({before:f.before,after:f.after,start:f.start,end:f.end,start_elem:0,end_elem:0,elements:[],rbc:[],te:[],text:"",br:!1});r[r.length-1].text+=t.textContent,r[r.length-1].elements.push({node:t,bgcolor:c,before:f.before,after:f.after})}else"br"===t.localName&&0!==r.length&&(r[r.length-1].br=!0);else for(var g=t.firstChild;g;)g.nodeType===Node.ELEMENT_NODE&&(u(e,g,r,c),"ruby"===g.localName||"rtc"===g.localName?r.length>0&&r[r.length-1].rbc.push(g):"span"===g.localName&&g.style[y]&&"none"!==g.style[y]&&r.length>0&&r[r.length-1].te.push(g)),g=g.nextSibling}}function c(e,t,r,n){var i;"none"!==n.style&&("auto"===n.style?t.style[y]="filled":t.style[y]=n.style+" "+n.symbol,("before"===n.position||"after"===n.position)&&(i="tb"===e.bpd?"before"===n.position?"left over":"left under":"rl"===e.bpd?"before"===n.position?"right under":"left under":"before"===n.position?"left under":"right under",t.style[E]=i))}function f(e,t){this.qname=e,this.map=t}e.render=function(e,t,r,n,a,o,s,l,u){var c=n||t.clientHeight,f=a||t.clientWidth;if(null!==e.aspectRatio){var d=c*e.aspectRatio;d>f?c=Math.round(f/e.aspectRatio):f=d}var h=document.createElement("div");h.style.position="relative",h.style.width=f+"px",h.style.height=c+"px",h.style.margin="auto",h.style.top=0,h.style.bottom=0,h.style.left=0,h.style.right=0,h.style.zIndex=0;var g={h:c,w:f,regionH:null,regionW:null,imgResolver:r,displayForcedOnlyMode:o||!1,isd:e,errorHandler:s,previousISDState:l,enableRollUp:u||!1,currentISDState:{},flg:null,lp:null,mra:null,ipd:null,bpd:null,ruby:null,textEmphasis:null,rubyReserve:null};if(t.appendChild(h),"contents"in e)for(var m=0;m<e.contents.length;m++)i(g,h,e.contents[m],e);return g.currentISDState};for(var d=[new f("http://www.w3.org/ns/ttml#styling backgroundColor",(function(e,t,r,n){0!==n[3]&&(t.style.backgroundColor="rgba("+n[0].toString()+","+n[1].toString()+","+n[2].toString()+","+(n[3]/255).toString()+")")})),new f("http://www.w3.org/ns/ttml#styling color",(function(e,t,r,n){t.style.color="rgba("+n[0].toString()+","+n[1].toString()+","+n[2].toString()+","+(n[3]/255).toString()+")"})),new f("http://www.w3.org/ns/ttml#styling direction",(function(e,t,r,n){t.style.direction=n})),new f("http://www.w3.org/ns/ttml#styling display",(function(e,t,r,n){})),new f("http://www.w3.org/ns/ttml#styling displayAlign",(function(e,t,r,n){t.style.display="flex",t.style.flexDirection="column","before"===n?t.style.justifyContent="flex-start":"center"===n?t.style.justifyContent="center":"after"===n&&(t.style.justifyContent="flex-end")})),new f("http://www.w3.org/ns/ttml#styling extent",(function(e,t,r,n){e.regionH=n.h.toUsedLength(e.w,e.h),e.regionW=n.w.toUsedLength(e.w,e.h);var i=0,a=0,o=r.styleAttrs["http://www.w3.org/ns/ttml#styling padding"];o&&(i=o[0].toUsedLength(e.w,e.h)+o[2].toUsedLength(e.w,e.h),a=o[1].toUsedLength(e.w,e.h)+o[3].toUsedLength(e.w,e.h)),t.style.height=e.regionH-i+"px",t.style.width=e.regionW-a+"px"})),new f("http://www.w3.org/ns/ttml#styling fontFamily",(function(e,t,r,n){for(var i=[],a=0;a<n.length;a++)n[a]=n[a].trim(),"monospaceSerif"===n[a]?(i.push("Courier New"),i.push('"Liberation Mono"'),i.push("Courier"),i.push("monospace")):"proportionalSansSerif"===n[a]?(i.push("Arial"),i.push("Helvetica"),i.push('"Liberation Sans"'),i.push("sans-serif")):"monospace"===n[a]?i.push("monospace"):"sansSerif"===n[a]?i.push("sans-serif"):"serif"===n[a]?i.push("serif"):"monospaceSansSerif"===n[a]?(i.push("Consolas"),i.push("monospace")):"proportionalSerif"===n[a]?i.push("serif"):i.push(n[a]);if(i.length>0){for(var o=[i[0]],s=1;s<i.length;s++)-1==o.indexOf(i[s])&&o.push(i[s]);i=o}t.style.fontFamily=i.join(",")})),new f("http://www.w3.org/ns/ttml#styling shear",(function(e,t,r,n){if(0!==n){var i=-.9*n;"tb"===e.bpd?t.style.transform="skewX("+i+"deg)":t.style.transform="skewY("+i+"deg)"}})),new f("http://www.w3.org/ns/ttml#styling fontSize",(function(e,t,r,n){t.style.fontSize=n.toUsedLength(e.w,e.h)+"px"})),new f("http://www.w3.org/ns/ttml#styling fontStyle",(function(e,t,r,n){t.style.fontStyle=n})),new f("http://www.w3.org/ns/ttml#styling fontWeight",(function(e,t,r,n){t.style.fontWeight=n})),new f("http://www.w3.org/ns/ttml#styling lineHeight",(function(e,t,r,n){t.style.lineHeight="normal"===n?"normal":n.toUsedLength(e.w,e.h)+"px"})),new f("http://www.w3.org/ns/ttml#styling opacity",(function(e,t,r,n){t.style.opacity=n})),new f("http://www.w3.org/ns/ttml#styling origin",(function(e,t,r,n){t.style.top=n.h.toUsedLength(e.w,e.h)+"px",t.style.left=n.w.toUsedLength(e.w,e.h)+"px"})),new f("http://www.w3.org/ns/ttml#styling overflow",(function(e,t,r,n){t.style.overflow=n})),new f("http://www.w3.org/ns/ttml#styling padding",(function(e,t,r,n){var i=[];i[0]=n[0].toUsedLength(e.w,e.h)+"px",i[1]=n[3].toUsedLength(e.w,e.h)+"px",i[2]=n[2].toUsedLength(e.w,e.h)+"px",i[3]=n[1].toUsedLength(e.w,e.h)+"px",t.style.padding=i.join(" ")})),new f("http://www.w3.org/ns/ttml#styling position",(function(e,t,r,n){t.style.top=n.h.toUsedLength(e.w,e.h)+"px",t.style.left=n.w.toUsedLength(e.w,e.h)+"px"})),new f("http://www.w3.org/ns/ttml#styling rubyAlign",(function(e,t,r,n){t.style.rubyAlign="spaceAround"===n?"space-around":"center"})),new f("http://www.w3.org/ns/ttml#styling rubyPosition",(function(e,t,r,n){var i;"before"!==n&&"after"!==n||(i=m?n:"tb"===e.bpd||"rl"===e.bpd?"before"===n?"over":"under":"before"===n?"under":"over",t.parentElement.style[p]=i)})),new f("http://www.w3.org/ns/ttml#styling showBackground",null),new f("http://www.w3.org/ns/ttml#styling textAlign",(function(e,t,r,n){var i;i="start"===n?"rl"===e.ipd?"right":"left":"end"===n?"rl"===e.ipd?"left":"right":n,t.style.textAlign=i})),new f("http://www.w3.org/ns/ttml#styling textDecoration",(function(e,t,r,n){t.style.textDecoration=n.join(" ").replace("lineThrough","line-through")})),new f("http://www.w3.org/ns/ttml#styling textOutline",(function(e,t,r,n){})),new f("http://www.w3.org/ns/ttml#styling textShadow",(function(e,t,n,i){var a=n.styleAttrs[r.byName.textOutline.qname];if("none"===i&&"none"===a)t.style.textShadow="";else{var o=[];if("none"!==a){var s="rgba("+a.color[0].toString()+","+a.color[1].toString()+","+a.color[2].toString()+","+(a.color[3]/255).toString()+")";o.push("1px 1px 1px "+s),o.push("-1px 1px 1px "+s),o.push("1px -1px 1px "+s),o.push("-1px -1px 1px "+s)}if("none"!==i)for(var l=0;l<i.length;l++)o.push(i[l].x_off.toUsedLength(e.w,e.h)+"px "+i[l].y_off.toUsedLength(e.w,e.h)+"px "+i[l].b_radius.toUsedLength(e.w,e.h)+"px rgba("+i[l].color[0].toString()+","+i[l].color[1].toString()+","+i[l].color[2].toString()+","+(i[l].color[3]/255).toString()+")");t.style.textShadow=o.join(",")}})),new f("http://www.w3.org/ns/ttml#styling textCombine",(function(e,t,r,n){t.style.textCombineUpright=n})),new f("http://www.w3.org/ns/ttml#styling textEmphasis",(function(e,t,r,n){})),new f("http://www.w3.org/ns/ttml#styling unicodeBidi",(function(e,t,r,n){var i;i="bidiOverride"===n?"bidi-override":n,t.style.unicodeBidi=i})),new f("http://www.w3.org/ns/ttml#styling visibility",(function(e,t,r,n){t.style.visibility=n})),new f("http://www.w3.org/ns/ttml#styling wrapOption",(function(e,t,r,n){"wrap"===n?"preserve"===r.space?t.style.whiteSpace="pre-wrap":t.style.whiteSpace="normal":"preserve"===r.space?t.style.whiteSpace="pre":t.style.whiteSpace="noWrap"})),new f("http://www.w3.org/ns/ttml#styling writingMode",(function(e,t,r,n){"lrtb"===n||"lr"===n||"rltb"===n||"rl"===n?t.style.writingMode="horizontal-tb":"tblr"===n?t.style.writingMode="vertical-lr":"tbrl"!==n&&"tb"!==n||(t.style.writingMode="vertical-rl")})),new f("http://www.w3.org/ns/ttml#styling zIndex",(function(e,t,r,n){t.style.zIndex=n})),new f("http://www.w3.org/ns/ttml/profile/imsc1#styling forcedDisplay",(function(e,t,r,n){e.displayForcedOnlyMode&&!1===n&&(t.style.visibility="hidden")}))],h={},g=0;g<d.length;g++)h[d[g].qname]=d[g];var m="webkitRubyPosition"in window.getComputedStyle(document.documentElement),p=m?"webkitRubyPosition":"rubyPosition",y="webkitTextEmphasisStyle"in window.getComputedStyle(document.documentElement)?"webkitTextEmphasisStyle":"textEmphasisStyle",E="webkitTextEmphasisPosition"in window.getComputedStyle(document.documentElement)?"webkitTextEmphasisPosition":"textEmphasisPosition";function v(e,t){if(e&&e.error&&e.error(t))throw t}}(t,"undefined"==typeof imscNames?r(210):imscNames,"undefined"==typeof imscStyles?r(6811):imscStyles,"undefined"==typeof imscUtils?r(5926):imscUtils)},4080:function(e,t,r){!function(e,t,r,n){e.generateISD=function(e,t,n){var i,o=new l(e),s={},u={},c=e.head.styling.initials[r.byName.showBackground.qname],f=e.head.styling.initials[r.byName.backgroundColor.qname];for(var d in e.head.layout.regions)if(e.head.layout.regions.hasOwnProperty(d)){var h=e.head.layout.regions[d],g=h.styleAttrs[r.byName.showBackground.qname]||c,m=h.styleAttrs[r.byName.backgroundColor.qname]||f;u[h.id]=("always"===g||void 0===g)&&void 0!==m&&!(t<h.begin||t>=h.end)}for(var p in e.body&&e.body.regionID&&(u[e.body.regionID]=!0),i=null!==e.body?function e(t,r){if(r.contents){var n={};for(var i in r)r.hasOwnProperty(i)&&(n[i]=r[i]);return n.contents=[],r.contents.filter((function(e){return!(t<e.begin||t>=e.end)})).forEach((function(r){var i=e(t,r);i.regionID&&(u[i.regionID]=!0),null!==i&&n.contents.push(i)})),n}return r}(t,e.body):null,void 0!==u[""]&&(u[""]=!0),u)if(u[p]){var y=a(e,t,e.head.layout.regions[p],i,null,"",e.head.layout.regions[p],n,s);null!==y&&o.contents.push(y.element)}return o};var i=[r.byName.color.qname,r.byName.textCombine.qname,r.byName.textDecoration.qname,r.byName.textEmphasis.qname,r.byName.textOutline.qname,r.byName.textShadow.qname];function a(e,t,l,f,d,h,g,m,p){if(t<g.begin||t>=g.end)return null;var y="regionID"in g&&""!==g.regionID?g.regionID:h;if(null!==d&&y!==l.id&&(!("contents"in g)||"contents"in g&&0===g.contents.length||""!==y))return null;var E=new u(g);if("sets"in g)for(var v=0;v<g.sets.length;v++)t<g.sets[v].begin||t>=g.sets[v].end||(E.styleAttrs[g.sets[v].qname]=g.sets[v].value);var T={};for(var _ in E.styleAttrs)if(E.styleAttrs.hasOwnProperty(_)&&(T[_]=!0,"region"===E.kind&&_===r.byName.writingMode.qname&&!(r.byName.direction.qname in E.styleAttrs))){var S=E.styleAttrs[_];"lrtb"===S||"lr"===S?E.styleAttrs[r.byName.direction.qname]="ltr":"rltb"!==S&&"rl"!==S||(E.styleAttrs[r.byName.direction.qname]="rtl")}if(null!==d)for(var A=0;A<r.all.length;A++){var b=r.all[A];if(b.qname===r.byName.textDecoration.qname){var R=d.styleAttrs[b.qname],I=E.styleAttrs[b.qname],w=[];void 0===I?w=R:-1===I.indexOf("none")?((-1===I.indexOf("noUnderline")&&-1!==R.indexOf("underline")||-1!==I.indexOf("underline"))&&w.push("underline"),(-1===I.indexOf("noLineThrough")&&-1!==R.indexOf("lineThrough")||-1!==I.indexOf("lineThrough"))&&w.push("lineThrough"),(-1===I.indexOf("noOverline")&&-1!==R.indexOf("overline")||-1!==I.indexOf("overline"))&&w.push("overline")):w.push("none"),E.styleAttrs[b.qname]=w}else if(b.qname!==r.byName.fontSize.qname||b.qname in E.styleAttrs||"span"!==E.kind||"textContainer"!==E.styleAttrs[r.byName.ruby.qname])if(b.qname!==r.byName.fontSize.qname||b.qname in E.styleAttrs||"span"!==E.kind||"text"!==E.styleAttrs[r.byName.ruby.qname])b.inherit&&b.qname in d.styleAttrs&&!(b.qname in E.styleAttrs)&&(E.styleAttrs[b.qname]=d.styleAttrs[b.qname]);else{var C=d.styleAttrs[r.byName.fontSize.qname];"textContainer"===d.styleAttrs[r.byName.ruby.qname]?E.styleAttrs[b.qname]=C:E.styleAttrs[b.qname]=new n.ComputedLength(.5*C.rw,.5*C.rh)}else{var D=d.styleAttrs[r.byName.fontSize.qname];E.styleAttrs[b.qname]=new n.ComputedLength(.5*D.rw,.5*D.rh)}}for(var L=0;L<r.all.length;L++){var N=r.all[L];if(!(N.qname in E.styleAttrs)&&!(N.qname===r.byName.position.qname&&r.byName.origin.qname in E.styleAttrs||N.qname===r.byName.origin.qname&&r.byName.position.qname in E.styleAttrs)){var O=e.head.styling.initials[N.qname]||N.initial;if(null!==O&&("region"===E.kind||!1===N.inherit&&null!==O)){var M=N.parse(O);null!==M?(E.styleAttrs[N.qname]=M,T[N.qname]=!0):c(m,"Invalid initial value for '"+N.qname+"' on element '"+E.kind)}}}for(var P=0;P<r.all.length;P++){var k=r.all[P];if(k.qname in T&&null!==k.compute){var x=k.compute(e,d,E,E.styleAttrs[k.qname],p);null!==x?E.styleAttrs[k.qname]=x:(E.styleAttrs[k.qname]=k.compute(e,d,E,k.parse(k.initial),p),c(m,"Style '"+k.qname+"' on element '"+E.kind+"' cannot be computed"))}}if("none"===E.styleAttrs[r.byName.display.qname])return null;var F=null;null===d?F=null===f?[]:[f]:"contents"in g&&(F=g.contents);for(var U=0;null!==F&&U<F.length;U++){var B=a(e,t,l,f,E,y,F[U],m,p);null!==B&&E.contents.push(B.element)}for(var Z in E.styleAttrs)if(E.styleAttrs.hasOwnProperty(Z)){var G=!1;if("span"===E.kind){var H=E.styleAttrs[r.byName.ruby.qname];(G=("container"===H||"textContainer"===H||"baseContainer"===H)&&-1!==i.indexOf(Z))||(G="container"!==H&&Z===r.byName.rubyAlign.qname),G||(G=!("textContainer"===H||"text"===H)&&Z===r.byName.rubyPosition.qname)}if(!G){var K=r.byQName[Z];"applies"in K&&(G=-1===K.applies.indexOf(E.kind))}G&&delete E.styleAttrs[Z]}var Y=E.styleAttrs[r.byName.ruby.qname];if("p"===E.kind||"span"===E.kind&&("textContainer"===Y||"text"===Y)){var q=[];o(E,q),function(e){for(var t,r=0;r<e.length;)if("br"!==(t=e[r]).kind&&"preserve"!==t.space){var n=t.text.replace(/[\t\r\n ]+/g," ");/^[ ]/.test(n)&&(0===r||"br"===(i=e[r-1]).kind||/[\r\n\t ]$/.test(i.text))&&(n=n.substring(1)),t.text=n,0===n.length?e.splice(r,1):r++}else r++;var i,a;for(r=0;r<e.length;r++)"br"!==(t=e[r]).kind&&"preserve"!==t.space?/[ ]$/.test(t.text)&&(r===e.length-1||"br"===(a=e[r+1]).kind||"preserve"===a.space&&/^[\r\n]/.test(a.text))&&(t.text=t.text.slice(0,-1)):r++}(q),s(E)}return"div"===E.kind&&r.byName.backgroundImage.qname in E.styleAttrs||"br"===E.kind||"image"===E.kind||"contents"in E&&E.contents.length>0||"span"===E.kind&&null!==E.text||"region"===E.kind&&"always"===E.styleAttrs[r.byName.showBackground.qname]?{region_id:y,element:E}:null}function o(e,t){if("contents"in e)for(var n=0;n<e.contents.length;n++){var i=e.contents[n],a=i.styleAttrs[r.byName.ruby.qname];("span"!==i.kind||"textContainer"!==a&&"text"!==a)&&("contents"in i?o(i,t):("span"===i.kind&&0!==i.text.length||"br"===i.kind)&&t.push(i))}}function s(e){if("br"===e.kind)return!1;if("text"in e)return 0===e.text.length;if("contents"in e){for(var t=e.contents.length;t--;)s(e.contents[t])&&e.contents.splice(t,1);return 0===e.contents.length}}function l(e){this.contents=[],this.aspectRatio=e.aspectRatio,this.lang=e.lang}function u(e){for(var t in this.kind=e.kind||"region",this.lang=e.lang,e.id&&(this.id=e.id),this.styleAttrs={},e.styleAttrs)e.styleAttrs.hasOwnProperty(t)&&(this.styleAttrs[t]=e.styleAttrs[t]);"src"in e&&(this.src=e.src),"type"in e&&(this.type=e.type),"text"in e?this.text=e.text:("region"===this.kind||"contents"in e)&&(this.contents=[]),"space"in e&&(this.space=e.space)}function c(e,t){if(e&&e.error&&e.error(t))throw t}}(t,"undefined"==typeof imscNames?r(210):imscNames,"undefined"==typeof imscStyles?r(6811):imscStyles,"undefined"==typeof imscUtils?r(5926):imscUtils)},4403:function(e,t,r){t.generateISD=r(4080).generateISD,t.fromXML=r(3362).fromXML,t.renderHTML=r(506).render},210:function(e,t){var r;(r=t).ns_tt="http://www.w3.org/ns/ttml",r.ns_tts="http://www.w3.org/ns/ttml#styling",r.ns_ttp="http://www.w3.org/ns/ttml#parameter",r.ns_xml="http://www.w3.org/XML/1998/namespace",r.ns_itts="http://www.w3.org/ns/ttml/profile/imsc1#styling",r.ns_ittp="http://www.w3.org/ns/ttml/profile/imsc1#parameter",r.ns_smpte="http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt",r.ns_ebutts="urn:ebu:tt:style"},6811:function(e,t,r){!function(e,t,r){function n(e,t,r,n,i,a,o,s){this.name=t,this.ns=e,this.qname=e+" "+t,this.inherit=i,this.animatable=a,this.initial=r,this.applies=n,this.parse=o,this.compute=s}for(var i in e.all=[new n(t.ns_tts,"backgroundColor","transparent",["body","div","p","region","span"],!1,!0,r.parseColor,null),new n(t.ns_tts,"color","white",["span"],!0,!0,r.parseColor,null),new n(t.ns_tts,"direction","ltr",["p","span"],!0,!0,(function(e){return e}),null),new n(t.ns_tts,"display","auto",["body","div","p","region","span"],!1,!0,(function(e){return e}),null),new n(t.ns_tts,"displayAlign","before",["region"],!1,!0,(function(e){return e}),null),new n(t.ns_tts,"extent","auto",["tt","region"],!1,!0,(function(e){if("auto"===e)return e;var t=e.split(" ");if(2!==t.length)return null;var n=r.parseLength(t[0]),i=r.parseLength(t[1]);return i&&n?{h:i,w:n}:null}),(function(e,t,n,i,a){var o,s;if("auto"===i)o=new r.ComputedLength(0,1);else if(null===(o=r.toComputedLength(i.h.value,i.h.unit,null,e.dimensions.h,null,e.pxLength.h)))return null;if("auto"===i)s=new r.ComputedLength(1,0);else if(null===(s=r.toComputedLength(i.w.value,i.w.unit,null,e.dimensions.w,null,e.pxLength.w)))return null;return{h:o,w:s}})),new n(t.ns_tts,"fontFamily","default",["span","p"],!0,!0,(function(e){for(var t=e.split(","),r=[],n=0;n<t.length;n++)t[n]=t[n].trim(),"'"!==t[n].charAt(0)&&'"'!==t[n].charAt(0)&&"default"===t[n]?r.push("monospaceSerif"):r.push(t[n]);return r}),null),new n(t.ns_tts,"shear","0%",["p"],!0,!0,r.parseLength,(function(e,t,r,n){return"%"!==n.unit?null:Math.abs(n.value)>100?100*Math.sign(n.value):n.value})),new n(t.ns_tts,"fontSize","1c",["span","p"],!0,!0,r.parseLength,(function(t,n,i,a,o){return r.toComputedLength(a.value,a.unit,null!==n?n.styleAttrs[e.byName.fontSize.qname]:t.cellLength.h,null!==n?n.styleAttrs[e.byName.fontSize.qname]:t.cellLength.h,t.cellLength.h,t.pxLength.h)})),new n(t.ns_tts,"fontStyle","normal",["span","p"],!0,!0,(function(e){return e}),null),new n(t.ns_tts,"fontWeight","normal",["span","p"],!0,!0,(function(e){return e}),null),new n(t.ns_tts,"lineHeight","normal",["p"],!0,!0,(function(e){return"normal"===e?e:r.parseLength(e)}),(function(t,n,i,a,o){var s;if("normal"===a)s=a;else if(null===(s=r.toComputedLength(a.value,a.unit,i.styleAttrs[e.byName.fontSize.qname],i.styleAttrs[e.byName.fontSize.qname],t.cellLength.h,t.pxLength.h)))return null;return s})),new n(t.ns_tts,"opacity",1,["region"],!1,!0,parseFloat,null),new n(t.ns_tts,"origin","auto",["region"],!1,!0,(function(e){if("auto"===e)return e;var t=e.split(" ");if(2!==t.length)return null;var n=r.parseLength(t[0]),i=r.parseLength(t[1]);return i&&n?{h:i,w:n}:null}),(function(e,t,n,i,a){var o,s;if("auto"===i)o=new r.ComputedLength(0,0);else if(null===(o=r.toComputedLength(i.h.value,i.h.unit,null,e.dimensions.h,null,e.pxLength.h)))return null;if("auto"===i)s=new r.ComputedLength(0,0);else if(null===(s=r.toComputedLength(i.w.value,i.w.unit,null,e.dimensions.w,null,e.pxLength.w)))return null;return{h:o,w:s}})),new n(t.ns_tts,"overflow","hidden",["region"],!1,!0,(function(e){return e}),null),new n(t.ns_tts,"padding","0px",["region"],!1,!0,(function(e){var t=e.split(" ");if(t.length>4)return null;for(var n=[],i=0;i<t.length;i++){var a=r.parseLength(t[i]);if(!a)return null;n.push(a)}return n}),(function(t,n,i,a,o){var s;if(1===a.length)s=[a[0],a[0],a[0],a[0]];else if(2===a.length)s=[a[0],a[1],a[0],a[1]];else if(3===a.length)s=[a[0],a[1],a[2],a[1]];else{if(4!==a.length)return null;s=[a[0],a[1],a[2],a[3]]}var l=i.styleAttrs[e.byName.writingMode.qname];if("lrtb"===l||"lr"===l)s=[s[0],s[3],s[2],s[1]];else if("rltb"===l||"rl"===l)s=[s[0],s[1],s[2],s[3]];else if("tblr"===l)s=[s[3],s[0],s[1],s[2]];else{if("tbrl"!==l&&"tb"!==l)return null;s=[s[3],s[2],s[1],s[0]]}for(var u=[],c=0;c<s.length;c++)if(0===s[c].value)u[c]=new r.ComputedLength(0,0);else if(u[c]=r.toComputedLength(s[c].value,s[c].unit,i.styleAttrs[e.byName.fontSize.qname],0===c||2===c?i.styleAttrs[e.byName.extent.qname].h:i.styleAttrs[e.byName.extent.qname].w,0===c||2===c?t.cellLength.h:t.cellLength.w,0===c||2===c?t.pxLength.h:t.pxLength.w),null===u[c])return null;return u})),new n(t.ns_tts,"position","top left",["region"],!1,!0,(function(e){return r.parsePosition(e)}),(function(t,n,i,a){var o,s;return null===(o=r.toComputedLength(a.v.offset.value,a.v.offset.unit,null,new r.ComputedLength(-i.styleAttrs[e.byName.extent.qname].h.rw,t.dimensions.h.rh-i.styleAttrs[e.byName.extent.qname].h.rh),null,t.pxLength.h))?null:("bottom"===a.v.edge&&(o=new r.ComputedLength(-o.rw-i.styleAttrs[e.byName.extent.qname].h.rw,t.dimensions.h.rh-o.rh-i.styleAttrs[e.byName.extent.qname].h.rh)),s=r.toComputedLength(a.h.offset.value,a.h.offset.unit,null,new r.ComputedLength(t.dimensions.w.rw-i.styleAttrs[e.byName.extent.qname].w.rw,-i.styleAttrs[e.byName.extent.qname].w.rh),null,t.pxLength.w),null===o?null:("right"===a.h.edge&&(s=new r.ComputedLength(t.dimensions.w.rw-s.rw-i.styleAttrs[e.byName.extent.qname].w.rw,-s.rh-i.styleAttrs[e.byName.extent.qname].w.rh)),{h:o,w:s}))})),new n(t.ns_tts,"ruby","none",["span"],!1,!0,(function(e){return e}),null),new n(t.ns_tts,"rubyAlign","center",["span"],!0,!0,(function(e){return"center"!==e&&"spaceAround"!==e?null:e}),null),new n(t.ns_tts,"rubyPosition","outside",["span"],!0,!0,(function(e){return e}),null),new n(t.ns_tts,"rubyReserve","none",["p"],!0,!0,(function(e){var t=e.split(" "),n=[null,null];if(0===t.length||t.length>2)return null;if("none"!==t[0]&&"both"!==t[0]&&"after"!==t[0]&&"before"!==t[0]&&"outside"!==t[0])return null;if(n[0]=t[0],2===t.length&&"none"!==t[0]){var i=r.parseLength(t[1]);if(!i)return null;n[1]=i}return n}),(function(t,n,i,a,o){return"none"===a[0]?a:null===(s=null===a[1]?new r.ComputedLength(.5*i.styleAttrs[e.byName.fontSize.qname].rw,.5*i.styleAttrs[e.byName.fontSize.qname].rh):r.toComputedLength(a[1].value,a[1].unit,i.styleAttrs[e.byName.fontSize.qname],i.styleAttrs[e.byName.fontSize.qname],t.cellLength.h,t.pxLength.h))?null:[a[0],s];var s})),new n(t.ns_tts,"showBackground","always",["region"],!1,!0,(function(e){return e}),null),new n(t.ns_tts,"textAlign","start",["p"],!0,!0,(function(e){return e}),(function(e,t,r,n,i){return"left"===n?"start":"right"===n?"end":n})),new n(t.ns_tts,"textCombine","none",["span"],!0,!0,(function(e){return"none"===e||"all"===e?e:null}),null),new n(t.ns_tts,"textDecoration","none",["span"],!0,!0,(function(e){return e.split(" ")}),null),new n(t.ns_tts,"textEmphasis","none",["span"],!0,!0,(function(e){for(var t=e.split(" "),n={style:null,symbol:null,color:null,position:null},i=0;i<t.length;i++)if("none"===t[i]||"auto"===t[i])n.style=t[i];else if("filled"===t[i]||"open"===t[i])n.style=t[i];else if("circle"===t[i]||"dot"===t[i]||"sesame"===t[i])n.symbol=t[i];else if("current"===t[i])n.color=t[i];else if("outside"===t[i]||"before"===t[i]||"after"===t[i])n.position=t[i];else if(n.color=r.parseColor(t[i]),null===n.color)return null;return null==n.style&&null==n.symbol?n.style="auto":(n.symbol=n.symbol||"circle",n.style=n.style||"filled"),n.position=n.position||"outside",n.color=n.color||"current",n}),null),new n(t.ns_tts,"textOutline","none",["span"],!0,!0,(function(e){if("none"===e)return e;var t={},n=e.split(" ");if(0===n.length||n.length>2)return null;var i=r.parseColor(n[0]);if(t.color=i,null!==i&&n.shift(),1!==n.length)return null;var a=r.parseLength(n[0]);return a?(t.thickness=a,t):null}),(function(t,n,i,a,o){if("none"===a)return a;var s={};return null===a.color?s.color=i.styleAttrs[e.byName.color.qname]:s.color=a.color,s.thickness=r.toComputedLength(a.thickness.value,a.thickness.unit,i.styleAttrs[e.byName.fontSize.qname],i.styleAttrs[e.byName.fontSize.qname],t.cellLength.h,t.pxLength.h),null===s.thickness?null:s})),new n(t.ns_tts,"textShadow","none",["span"],!0,!0,r.parseTextShadow,(function(t,n,i,a){if("none"===a)return a;for(var o=[],s=0;s<a.length;s++){var l={};if(l.x_off=r.toComputedLength(a[s][0].value,a[s][0].unit,null,i.styleAttrs[e.byName.fontSize.qname],null,t.pxLength.w),null===l.x_off)return null;if(l.y_off=r.toComputedLength(a[s][1].value,a[s][1].unit,null,i.styleAttrs[e.byName.fontSize.qname],null,t.pxLength.h),null===l.y_off)return null;if(null===a[s][2])l.b_radius=0;else if(l.b_radius=r.toComputedLength(a[s][2].value,a[s][2].unit,null,i.styleAttrs[e.byName.fontSize.qname],null,t.pxLength.h),null===l.b_radius)return null;null===a[s][3]?l.color=i.styleAttrs[e.byName.color.qname]:l.color=a[s][3],o.push(l)}return o})),new n(t.ns_tts,"unicodeBidi","normal",["span","p"],!1,!0,(function(e){return e}),null),new n(t.ns_tts,"visibility","visible",["body","div","p","region","span"],!0,!0,(function(e){return e}),null),new n(t.ns_tts,"wrapOption","wrap",["span"],!0,!0,(function(e){return e}),null),new n(t.ns_tts,"writingMode","lrtb",["region"],!1,!0,(function(e){return e}),null),new n(t.ns_tts,"zIndex","auto",["region"],!1,!0,(function(e){var t;return"auto"===e?t=e:(t=parseInt(e),isNaN(t)&&(t=null)),t}),null),new n(t.ns_ebutts,"linePadding","0c",["p"],!0,!1,r.parseLength,(function(e,t,n,i,a){return r.toComputedLength(i.value,i.unit,null,null,e.cellLength.w,null)})),new n(t.ns_ebutts,"multiRowAlign","auto",["p"],!0,!1,(function(e){return e}),null),new n(t.ns_smpte,"backgroundImage",null,["div"],!1,!1,(function(e){return e}),null),new n(t.ns_itts,"forcedDisplay","false",["body","div","p","region","span"],!0,!0,(function(e){return"true"===e}),null),new n(t.ns_itts,"fillLineGap","false",["p"],!0,!0,(function(e){return"true"===e}),null)],e.byQName={},e.all)e.byQName[e.all[i].qname]=e.all[i];for(var a in e.byName={},e.all)e.byName[e.all[a].name]=e.all[a]}(t,"undefined"==typeof imscNames?r(210):imscNames,"undefined"==typeof imscUtils?r(5926):imscUtils)},5926:function(e,t){!function(e){var t=/#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})?/,r=/rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/,n=/rgba\(\s*(\d+),\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/,i={transparent:[0,0,0,0],black:[0,0,0,255],silver:[192,192,192,255],gray:[128,128,128,255],white:[255,255,255,255],maroon:[128,0,0,255],red:[255,0,0,255],purple:[128,0,128,255],fuchsia:[255,0,255,255],magenta:[255,0,255,255],green:[0,128,0,255],lime:[0,255,0,255],olive:[128,128,0,255],yellow:[255,255,0,255],navy:[0,0,128,255],blue:[0,0,255,255],teal:[0,128,128,255],aqua:[0,255,255,255],cyan:[0,255,255,255]};e.parseColor=function(e){var a,o=null,s=i[e.toLowerCase()];return void 0!==s?o=s:null!==(a=t.exec(e))?o=[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16),void 0!==a[4]?parseInt(a[4],16):255]:null!==(a=r.exec(e))?o=[parseInt(a[1]),parseInt(a[2]),parseInt(a[3]),255]:null!==(a=n.exec(e))&&(o=[parseInt(a[1]),parseInt(a[2]),parseInt(a[3]),parseInt(a[4])]),o};var a=/^((?:\+|\-)?\d*(?:\.\d+)?)(px|em|c|%|rh|rw)$/;e.parseLength=function(e){var t,r=null;return null!==(t=a.exec(e))&&(r={value:parseFloat(t[1]),unit:t[2]}),r},e.parseTextShadow=function(t){for(var r=t.match(/([^\(,\)]|\([^\)]+\))+/g),n=[],i=0;i<r.length;i++){var a=r[i].split(" ");if(1===a.length&&"none"===a[0])return"none";if(a.length>1&&a.length<5){var o=[null,null,null,null],s=e.parseLength(a.shift());if(null===s)return null;if(o[0]=s,null===(s=e.parseLength(a.shift())))return null;if(o[1]=s,0===a.length){n.push(o);continue}if(null!==(s=e.parseLength(a[0]))&&(o[2]=s,a.shift()),0===a.length){n.push(o);continue}var l=e.parseColor(a[0]);if(null===l)return null;o[3]=l,n.push(o)}}return n},e.parsePosition=function(t){var r=t.split(" "),n=function(e){return"center"===e||"left"===e||"top"===e||"bottom"===e||"right"===e};if(r.length>4)return null;for(var i=0;i<r.length;i++)if(!n(r[i])){var a=e.parseLength(r[i]);if(null===a)return null;r[i]=a}for(var o={h:{edge:"left",offset:{value:50,unit:"%"}},v:{edge:"top",offset:{value:50,unit:"%"}}},s=0;s<r.length;){var l=r[s++];if(n(l)){var u={value:0,unit:"%"};2!==r.length&&s<r.length&&!n(r[s])&&(u=r[s++]),"right"===l?(o.h.edge=l,o.h.offset=u):"bottom"===l?(o.v.edge=l,o.v.offset=u):"left"===l?o.h.offset=u:"top"===l&&(o.v.offset=u)}else{if(1!==r.length&&2!==r.length)return null;1===s?o.h.offset=l:o.v.offset=l}}return o},e.ComputedLength=function(e,t){this.rw=e,this.rh=t},e.ComputedLength.prototype.toUsedLength=function(e,t){return e*this.rw+t*this.rh},e.ComputedLength.prototype.isZero=function(){return 0===this.rw&&0===this.rh},e.toComputedLength=function(t,r,n,i,a,o){return"%"===r&&i?new e.ComputedLength(i.rw*t/100,i.rh*t/100):"em"===r&&n?new e.ComputedLength(n.rw*t,n.rh*t):"c"===r&&a?new e.ComputedLength(t*a.rw,t*a.rh):"px"===r&&o?new e.ComputedLength(t*o.rw,t*o.rh):"rh"===r?new e.ComputedLength(0,t/100):"rw"===r?new e.ComputedLength(t/100,0):null}}(t)},3516:function(e){e.exports=function(e){var t="string"==typeof e?e.charCodeAt(0):e;return t>=97&&t<=122||t>=65&&t<=90}},2219:function(e,t,r){var n=r(3516),i=r(395);e.exports=function(e){return n(e)||i(e)}},395:function(e){e.exports=function(e){var t="string"==typeof e?e.charCodeAt(0):e;return t>=48&&t<=57}},3875:function(e){function t(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function r(e,t){for(var r,n="",i=0,a=-1,o=0,s=0;s<=e.length;++s){if(s<e.length)r=e.charCodeAt(s);else{if(47===r)break;r=47}if(47===r){if(a===s-1||1===o);else if(a!==s-1&&2===o){if(n.length<2||2!==i||46!==n.charCodeAt(n.length-1)||46!==n.charCodeAt(n.length-2))if(n.length>2){var l=n.lastIndexOf("/");if(l!==n.length-1){-1===l?(n="",i=0):i=(n=n.slice(0,l)).length-1-n.lastIndexOf("/"),a=s,o=0;continue}}else if(2===n.length||1===n.length){n="",i=0,a=s,o=0;continue}t&&(n.length>0?n+="/..":n="..",i=2)}else n.length>0?n+="/"+e.slice(a+1,s):n=e.slice(a+1,s),i=s-a-1;a=s,o=0}else 46===r&&-1!==o?++o:o=-1}return n}var n={resolve:function(){for(var e,n="",i=!1,a=arguments.length-1;a>=-1&&!i;a--){var o;a>=0?o=arguments[a]:(void 0===e&&(e=process.cwd()),o=e),t(o),0!==o.length&&(n=o+"/"+n,i=47===o.charCodeAt(0))}return n=r(n,!i),i?n.length>0?"/"+n:"/":n.length>0?n:"."},normalize:function(e){if(t(e),0===e.length)return".";var n=47===e.charCodeAt(0),i=47===e.charCodeAt(e.length-1);return 0!==(e=r(e,!n)).length||n||(e="."),e.length>0&&i&&(e+="/"),n?"/"+e:e},isAbsolute:function(e){return t(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var e,r=0;r<arguments.length;++r){var i=arguments[r];t(i),i.length>0&&(void 0===e?e=i:e+="/"+i)}return void 0===e?".":n.normalize(e)},relative:function(e,r){if(t(e),t(r),e===r)return"";if((e=n.resolve(e))===(r=n.resolve(r)))return"";for(var i=1;i<e.length&&47===e.charCodeAt(i);++i);for(var a=e.length,o=a-i,s=1;s<r.length&&47===r.charCodeAt(s);++s);for(var l=r.length-s,u=o<l?o:l,c=-1,f=0;f<=u;++f){if(f===u){if(l>u){if(47===r.charCodeAt(s+f))return r.slice(s+f+1);if(0===f)return r.slice(s+f)}else o>u&&(47===e.charCodeAt(i+f)?c=f:0===f&&(c=0));break}var d=e.charCodeAt(i+f);if(d!==r.charCodeAt(s+f))break;47===d&&(c=f)}var h="";for(f=i+c+1;f<=a;++f)f!==a&&47!==e.charCodeAt(f)||(0===h.length?h+="..":h+="/..");return h.length>0?h+r.slice(s+c):(s+=c,47===r.charCodeAt(s)&&++s,r.slice(s))},_makeLong:function(e){return e},dirname:function(e){if(t(e),0===e.length)return".";for(var r=e.charCodeAt(0),n=47===r,i=-1,a=!0,o=e.length-1;o>=1;--o)if(47===(r=e.charCodeAt(o))){if(!a){i=o;break}}else a=!1;return-1===i?n?"/":".":n&&1===i?"//":e.slice(0,i)},basename:function(e,r){if(void 0!==r&&"string"!=typeof r)throw new TypeError('"ext" argument must be a string');t(e);var n,i=0,a=-1,o=!0;if(void 0!==r&&r.length>0&&r.length<=e.length){if(r.length===e.length&&r===e)return"";var s=r.length-1,l=-1;for(n=e.length-1;n>=0;--n){var u=e.charCodeAt(n);if(47===u){if(!o){i=n+1;break}}else-1===l&&(o=!1,l=n+1),s>=0&&(u===r.charCodeAt(s)?-1==--s&&(a=n):(s=-1,a=l))}return i===a?a=l:-1===a&&(a=e.length),e.slice(i,a)}for(n=e.length-1;n>=0;--n)if(47===e.charCodeAt(n)){if(!o){i=n+1;break}}else-1===a&&(o=!1,a=n+1);return-1===a?"":e.slice(i,a)},extname:function(e){t(e);for(var r=-1,n=0,i=-1,a=!0,o=0,s=e.length-1;s>=0;--s){var l=e.charCodeAt(s);if(47!==l)-1===i&&(a=!1,i=s+1),46===l?-1===r?r=s:1!==o&&(o=1):-1!==r&&(o=-1);else if(!a){n=s+1;break}}return-1===r||-1===i||0===o||1===o&&r===i-1&&r===n+1?"":e.slice(r,i)},format:function(e){if(null===e||"object"!=typeof e)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return r=(t=e).dir||t.root,n=t.base||(t.name||"")+(t.ext||""),r?r===t.root?r+n:r+"/"+n:n;var t,r,n},parse:function(e){t(e);var r={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return r;var n,i=e.charCodeAt(0),a=47===i;a?(r.root="/",n=1):n=0;for(var o=-1,s=0,l=-1,u=!0,c=e.length-1,f=0;c>=n;--c)if(47!==(i=e.charCodeAt(c)))-1===l&&(u=!1,l=c+1),46===i?-1===o?o=c:1!==f&&(f=1):-1!==o&&(f=-1);else if(!u){s=c+1;break}return-1===o||-1===l||0===f||1===f&&o===l-1&&o===s+1?-1!==l&&(r.base=r.name=0===s&&a?e.slice(1,l):e.slice(s,l)):(0===s&&a?(r.name=e.slice(1,o),r.base=e.slice(1,l)):(r.name=e.slice(s,o),r.base=e.slice(s,l)),r.ext=e.slice(o,l)),s>0?r.dir=e.slice(0,s-1):a&&(r.dir="/"),r},sep:"/",delimiter:":",win32:null,posix:null};n.posix=n,e.exports=n},8387:function(e,t,r){var n=r(1549),i=n.Buffer;function a(e,t){for(var r in e)t[r]=e[r]}function o(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=n:(a(n,t),t.Buffer=o),a(i,o),o.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,r)},o.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=i(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},o.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}},5378:function(e,t,r){!function(e){e.parser=function(e,t){return new i(e,t)},e.SAXParser=i,e.SAXStream=o,e.createStream=function(e,t){return new o(e,t)},e.MAX_BUFFER_LENGTH=65536;var t,n=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];function i(t,r){if(!(this instanceof i))return new i(t,r);var a=this;!function(e){for(var t=0,r=n.length;t<r;t++)e[n[t]]=""}(a),a.q=a.c="",a.bufferCheckPosition=e.MAX_BUFFER_LENGTH,a.opt=r||{},a.opt.lowercase=a.opt.lowercase||a.opt.lowercasetags,a.looseCase=a.opt.lowercase?"toLowerCase":"toUpperCase",a.tags=[],a.closed=a.closedRoot=a.sawRoot=!1,a.tag=a.error=null,a.strict=!!t,a.noscript=!(!t&&!a.opt.noscript),a.state=R.BEGIN,a.strictEntities=a.opt.strictEntities,a.ENTITIES=a.strictEntities?Object.create(e.XML_ENTITIES):Object.create(e.ENTITIES),a.attribList=[],a.opt.xmlns&&(a.ns=Object.create(g)),a.trackPosition=!1!==a.opt.position,a.trackPosition&&(a.position=a.line=a.column=0),w(a,"onready")}e.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(e){function t(){}return t.prototype=e,new t}),Object.keys||(Object.keys=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(r);return t}),i.prototype={end:function(){O(this)},write:function(t){var r=this;if(this.error)throw this.error;if(r.closed)return N(r,"Cannot write after close. Assign an onready handler.");if(null===t)return O(r);"object"==typeof t&&(t=t.toString());for(var i=0,a="";a=G(t,i++),r.c=a,a;)switch(r.trackPosition&&(r.position++,"\n"===a?(r.line++,r.column=0):r.column++),r.state){case R.BEGIN:if(r.state=R.BEGIN_WHITESPACE,"\ufeff"===a)continue;Z(r,a);continue;case R.BEGIN_WHITESPACE:Z(r,a);continue;case R.TEXT:if(r.sawRoot&&!r.closedRoot){for(var o=i-1;a&&"<"!==a&&"&"!==a;)(a=G(t,i++))&&r.trackPosition&&(r.position++,"\n"===a?(r.line++,r.column=0):r.column++);r.textNode+=t.substring(o,i-1)}"<"!==a||r.sawRoot&&r.closedRoot&&!r.strict?(!_(s,a)||r.sawRoot&&!r.closedRoot||M(r,"Text data outside of root node."),"&"===a?r.state=R.TEXT_ENTITY:r.textNode+=a):(r.state=R.OPEN_WAKA,r.startTagPosition=r.position);continue;case R.SCRIPT:"<"===a?r.state=R.SCRIPT_ENDING:r.script+=a;continue;case R.SCRIPT_ENDING:"/"===a?r.state=R.CLOSE_TAG:(r.script+="<"+a,r.state=R.SCRIPT);continue;case R.OPEN_WAKA:if("!"===a)r.state=R.SGML_DECL,r.sgmlDecl="";else if(T(s,a));else if(T(m,a))r.state=R.OPEN_TAG,r.tagName=a;else if("/"===a)r.state=R.CLOSE_TAG,r.tagName="";else if("?"===a)r.state=R.PROC_INST,r.procInstName=r.procInstBody="";else{if(M(r,"Unencoded <"),r.startTagPosition+1<r.position){var l=r.position-r.startTagPosition;a=new Array(l).join(" ")+a}r.textNode+="<"+a,r.state=R.TEXT}continue;case R.SGML_DECL:"[CDATA["===(r.sgmlDecl+a).toUpperCase()?(C(r,"onopencdata"),r.state=R.CDATA,r.sgmlDecl="",r.cdata=""):r.sgmlDecl+a==="--"?(r.state=R.COMMENT,r.comment="",r.sgmlDecl=""):"DOCTYPE"===(r.sgmlDecl+a).toUpperCase()?(r.state=R.DOCTYPE,(r.doctype||r.sawRoot)&&M(r,"Inappropriately located doctype declaration"),r.doctype="",r.sgmlDecl=""):">"===a?(C(r,"onsgmldeclaration",r.sgmlDecl),r.sgmlDecl="",r.state=R.TEXT):T(c,a)?(r.state=R.SGML_DECL_QUOTED,r.sgmlDecl+=a):r.sgmlDecl+=a;continue;case R.SGML_DECL_QUOTED:a===r.q&&(r.state=R.SGML_DECL,r.q=""),r.sgmlDecl+=a;continue;case R.DOCTYPE:">"===a?(r.state=R.TEXT,C(r,"ondoctype",r.doctype),r.doctype=!0):(r.doctype+=a,"["===a?r.state=R.DOCTYPE_DTD:T(c,a)&&(r.state=R.DOCTYPE_QUOTED,r.q=a));continue;case R.DOCTYPE_QUOTED:r.doctype+=a,a===r.q&&(r.q="",r.state=R.DOCTYPE);continue;case R.DOCTYPE_DTD:r.doctype+=a,"]"===a?r.state=R.DOCTYPE:T(c,a)&&(r.state=R.DOCTYPE_DTD_QUOTED,r.q=a);continue;case R.DOCTYPE_DTD_QUOTED:r.doctype+=a,a===r.q&&(r.state=R.DOCTYPE_DTD,r.q="");continue;case R.COMMENT:"-"===a?r.state=R.COMMENT_ENDING:r.comment+=a;continue;case R.COMMENT_ENDING:"-"===a?(r.state=R.COMMENT_ENDED,r.comment=L(r.opt,r.comment),r.comment&&C(r,"oncomment",r.comment),r.comment=""):(r.comment+="-"+a,r.state=R.COMMENT);continue;case R.COMMENT_ENDED:">"!==a?(M(r,"Malformed comment"),r.comment+="--"+a,r.state=R.COMMENT):r.state=R.TEXT;continue;case R.CDATA:"]"===a?r.state=R.CDATA_ENDING:r.cdata+=a;continue;case R.CDATA_ENDING:"]"===a?r.state=R.CDATA_ENDING_2:(r.cdata+="]"+a,r.state=R.CDATA);continue;case R.CDATA_ENDING_2:">"===a?(r.cdata&&C(r,"oncdata",r.cdata),C(r,"onclosecdata"),r.cdata="",r.state=R.TEXT):"]"===a?r.cdata+="]":(r.cdata+="]]"+a,r.state=R.CDATA);continue;case R.PROC_INST:"?"===a?r.state=R.PROC_INST_ENDING:T(s,a)?r.state=R.PROC_INST_BODY:r.procInstName+=a;continue;case R.PROC_INST_BODY:if(!r.procInstBody&&T(s,a))continue;"?"===a?r.state=R.PROC_INST_ENDING:r.procInstBody+=a;continue;case R.PROC_INST_ENDING:">"===a?(C(r,"onprocessinginstruction",{name:r.procInstName,body:r.procInstBody}),r.procInstName=r.procInstBody="",r.state=R.TEXT):(r.procInstBody+="?"+a,r.state=R.PROC_INST_BODY);continue;case R.OPEN_TAG:T(p,a)?r.tagName+=a:(P(r),">"===a?F(r):"/"===a?r.state=R.OPEN_TAG_SLASH:(_(s,a)&&M(r,"Invalid character in tag name"),r.state=R.ATTRIB));continue;case R.OPEN_TAG_SLASH:">"===a?(F(r,!0),U(r)):(M(r,"Forward-slash in opening tag not followed by >"),r.state=R.ATTRIB);continue;case R.ATTRIB:if(T(s,a))continue;">"===a?F(r):"/"===a?r.state=R.OPEN_TAG_SLASH:T(m,a)?(r.attribName=a,r.attribValue="",r.state=R.ATTRIB_NAME):M(r,"Invalid attribute name");continue;case R.ATTRIB_NAME:"="===a?r.state=R.ATTRIB_VALUE:">"===a?(M(r,"Attribute without value"),r.attribValue=r.attribName,x(r),F(r)):T(s,a)?r.state=R.ATTRIB_NAME_SAW_WHITE:T(p,a)?r.attribName+=a:M(r,"Invalid attribute name");continue;case R.ATTRIB_NAME_SAW_WHITE:if("="===a)r.state=R.ATTRIB_VALUE;else{if(T(s,a))continue;M(r,"Attribute without value"),r.tag.attributes[r.attribName]="",r.attribValue="",C(r,"onattribute",{name:r.attribName,value:""}),r.attribName="",">"===a?F(r):T(m,a)?(r.attribName=a,r.state=R.ATTRIB_NAME):(M(r,"Invalid attribute name"),r.state=R.ATTRIB)}continue;case R.ATTRIB_VALUE:if(T(s,a))continue;T(c,a)?(r.q=a,r.state=R.ATTRIB_VALUE_QUOTED):(M(r,"Unquoted attribute value"),r.state=R.ATTRIB_VALUE_UNQUOTED,r.attribValue=a);continue;case R.ATTRIB_VALUE_QUOTED:if(a!==r.q){"&"===a?r.state=R.ATTRIB_VALUE_ENTITY_Q:r.attribValue+=a;continue}x(r),r.q="",r.state=R.ATTRIB_VALUE_CLOSED;continue;case R.ATTRIB_VALUE_CLOSED:T(s,a)?r.state=R.ATTRIB:">"===a?F(r):"/"===a?r.state=R.OPEN_TAG_SLASH:T(m,a)?(M(r,"No whitespace between attributes"),r.attribName=a,r.attribValue="",r.state=R.ATTRIB_NAME):M(r,"Invalid attribute name");continue;case R.ATTRIB_VALUE_UNQUOTED:if(_(f,a)){"&"===a?r.state=R.ATTRIB_VALUE_ENTITY_U:r.attribValue+=a;continue}x(r),">"===a?F(r):r.state=R.ATTRIB;continue;case R.CLOSE_TAG:if(r.tagName)">"===a?U(r):T(p,a)?r.tagName+=a:r.script?(r.script+="</"+r.tagName,r.tagName="",r.state=R.SCRIPT):(_(s,a)&&M(r,"Invalid tagname in closing tag"),r.state=R.CLOSE_TAG_SAW_WHITE);else{if(T(s,a))continue;_(m,a)?r.script?(r.script+="</"+a,r.state=R.SCRIPT):M(r,"Invalid tagname in closing tag."):r.tagName=a}continue;case R.CLOSE_TAG_SAW_WHITE:if(T(s,a))continue;">"===a?U(r):M(r,"Invalid characters in closing tag");continue;case R.TEXT_ENTITY:case R.ATTRIB_VALUE_ENTITY_Q:case R.ATTRIB_VALUE_ENTITY_U:var u,d;switch(r.state){case R.TEXT_ENTITY:u=R.TEXT,d="textNode";break;case R.ATTRIB_VALUE_ENTITY_Q:u=R.ATTRIB_VALUE_QUOTED,d="attribValue";break;case R.ATTRIB_VALUE_ENTITY_U:u=R.ATTRIB_VALUE_UNQUOTED,d="attribValue"}";"===a?(r[d]+=B(r),r.entity="",r.state=u):T(r.entity.length?E:y,a)?r.entity+=a:(M(r,"Invalid character in entity name"),r[d]+="&"+r.entity+a,r.entity="",r.state=u);continue;default:throw new Error(r,"Unknown state: "+r.state)}return r.position>=r.bufferCheckPosition&&function(t){for(var r=Math.max(e.MAX_BUFFER_LENGTH,10),i=0,a=0,o=n.length;a<o;a++){var s=t[n[a]].length;if(s>r)switch(n[a]){case"textNode":D(t);break;case"cdata":C(t,"oncdata",t.cdata),t.cdata="";break;case"script":C(t,"onscript",t.script),t.script="";break;default:N(t,"Max buffer length exceeded: "+n[a])}i=Math.max(i,s)}var l=e.MAX_BUFFER_LENGTH-i;t.bufferCheckPosition=l+t.position}(r),r},resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){var e;D(e=this),""!==e.cdata&&(C(e,"oncdata",e.cdata),e.cdata=""),""!==e.script&&(C(e,"onscript",e.script),e.script="")}};try{t=r(182).Stream}catch(H){t=function(){}}var a=e.EVENTS.filter((function(e){return"error"!==e&&"end"!==e}));function o(e,r){if(!(this instanceof o))return new o(e,r);t.apply(this),this._parser=new i(e,r),this.writable=!0,this.readable=!0;var n=this;this._parser.onend=function(){n.emit("end")},this._parser.onerror=function(e){n.emit("error",e),n._parser.error=null},this._decoder=null,a.forEach((function(e){Object.defineProperty(n,"on"+e,{get:function(){return n._parser["on"+e]},set:function(t){if(!t)return n.removeAllListeners(e),n._parser["on"+e]=t,t;n.on(e,t)},enumerable:!0,configurable:!1})}))}o.prototype=Object.create(t.prototype,{constructor:{value:o}}),o.prototype.write=function(e){if("function"==typeof Buffer&&"function"==typeof Buffer.isBuffer&&Buffer.isBuffer(e)){if(!this._decoder){var t=r(7503).s;this._decoder=new t("utf8")}e=this._decoder.write(e)}return this._parser.write(e.toString()),this.emit("data",e),!0},o.prototype.end=function(e){return e&&e.length&&this.write(e),this._parser.end(),!0},o.prototype.on=function(e,r){var n=this;return n._parser["on"+e]||-1===a.indexOf(e)||(n._parser["on"+e]=function(){var t=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);t.splice(0,0,e),n.emit.apply(n,t)}),t.prototype.on.call(n,e,r)};var s="\r\n\t ",l="0124356789",u="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",c="'\"",f=s+">",d="http://www.w3.org/XML/1998/namespace",h="http://www.w3.org/2000/xmlns/",g={xml:d,xmlns:h};s=v(s),l=v(l),u=v(u);var m=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,p=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/,y=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,E=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/;function v(e){return e.split("").reduce((function(e,t){return e[t]=!0,e}),{})}function T(e,t){return r=e,"[object RegExp]"===Object.prototype.toString.call(r)?!!t.match(e):e[t];var r}function _(e,t){return!T(e,t)}c=v(c),f=v(f);var S,A,b,R=0;for(var I in e.STATE={BEGIN:R++,BEGIN_WHITESPACE:R++,TEXT:R++,TEXT_ENTITY:R++,OPEN_WAKA:R++,SGML_DECL:R++,SGML_DECL_QUOTED:R++,DOCTYPE:R++,DOCTYPE_QUOTED:R++,DOCTYPE_DTD:R++,DOCTYPE_DTD_QUOTED:R++,COMMENT_STARTING:R++,COMMENT:R++,COMMENT_ENDING:R++,COMMENT_ENDED:R++,CDATA:R++,CDATA_ENDING:R++,CDATA_ENDING_2:R++,PROC_INST:R++,PROC_INST_BODY:R++,PROC_INST_ENDING:R++,OPEN_TAG:R++,OPEN_TAG_SLASH:R++,ATTRIB:R++,ATTRIB_NAME:R++,ATTRIB_NAME_SAW_WHITE:R++,ATTRIB_VALUE:R++,ATTRIB_VALUE_QUOTED:R++,ATTRIB_VALUE_CLOSED:R++,ATTRIB_VALUE_UNQUOTED:R++,ATTRIB_VALUE_ENTITY_Q:R++,ATTRIB_VALUE_ENTITY_U:R++,CLOSE_TAG:R++,CLOSE_TAG_SAW_WHITE:R++,SCRIPT:R++,SCRIPT_ENDING:R++},e.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},e.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(e.ENTITIES).forEach((function(t){var r=e.ENTITIES[t],n="number"==typeof r?String.fromCharCode(r):r;e.ENTITIES[t]=n})),e.STATE)e.STATE[e.STATE[I]]=I;function w(e,t,r){e[t]&&e[t](r)}function C(e,t,r){e.textNode&&D(e),w(e,t,r)}function D(e){e.textNode=L(e.opt,e.textNode),e.textNode&&w(e,"ontext",e.textNode),e.textNode=""}function L(e,t){return e.trim&&(t=t.trim()),e.normalize&&(t=t.replace(/\s+/g," ")),t}function N(e,t){return D(e),e.trackPosition&&(t+="\nLine: "+e.line+"\nColumn: "+e.column+"\nChar: "+e.c),t=new Error(t),e.error=t,w(e,"onerror",t),e}function O(e){return e.sawRoot&&!e.closedRoot&&M(e,"Unclosed root tag"),e.state!==R.BEGIN&&e.state!==R.BEGIN_WHITESPACE&&e.state!==R.TEXT&&N(e,"Unexpected end"),D(e),e.c="",e.closed=!0,w(e,"onend"),i.call(e,e.strict,e.opt),e}function M(e,t){if("object"!=typeof e||!(e instanceof i))throw new Error("bad call to strictFail");e.strict&&N(e,t)}function P(e){e.strict||(e.tagName=e.tagName[e.looseCase]());var t=e.tags[e.tags.length-1]||e,r=e.tag={name:e.tagName,attributes:{}};e.opt.xmlns&&(r.ns=t.ns),e.attribList.length=0,C(e,"onopentagstart",r)}function k(e,t){var r=e.indexOf(":")<0?["",e]:e.split(":"),n=r[0],i=r[1];return t&&"xmlns"===e&&(n="xmlns",i=""),{prefix:n,local:i}}function x(e){if(e.strict||(e.attribName=e.attribName[e.looseCase]()),-1!==e.attribList.indexOf(e.attribName)||e.tag.attributes.hasOwnProperty(e.attribName))e.attribName=e.attribValue="";else{if(e.opt.xmlns){var t=k(e.attribName,!0),r=t.prefix,n=t.local;if("xmlns"===r)if("xml"===n&&e.attribValue!==d)M(e,"xml: prefix must be bound to "+d+"\nActual: "+e.attribValue);else if("xmlns"===n&&e.attribValue!==h)M(e,"xmlns: prefix must be bound to "+h+"\nActual: "+e.attribValue);else{var i=e.tag,a=e.tags[e.tags.length-1]||e;i.ns===a.ns&&(i.ns=Object.create(a.ns)),i.ns[n]=e.attribValue}e.attribList.push([e.attribName,e.attribValue])}else e.tag.attributes[e.attribName]=e.attribValue,C(e,"onattribute",{name:e.attribName,value:e.attribValue});e.attribName=e.attribValue=""}}function F(e,t){if(e.opt.xmlns){var r=e.tag,n=k(e.tagName);r.prefix=n.prefix,r.local=n.local,r.uri=r.ns[n.prefix]||"",r.prefix&&!r.uri&&(M(e,"Unbound namespace prefix: "+JSON.stringify(e.tagName)),r.uri=n.prefix);var i=e.tags[e.tags.length-1]||e;r.ns&&i.ns!==r.ns&&Object.keys(r.ns).forEach((function(t){C(e,"onopennamespace",{prefix:t,uri:r.ns[t]})}));for(var a=0,o=e.attribList.length;a<o;a++){var s=e.attribList[a],l=s[0],u=s[1],c=k(l,!0),f=c.prefix,d=c.local,h=""===f?"":r.ns[f]||"",g={name:l,value:u,prefix:f,local:d,uri:h};f&&"xmlns"!==f&&!h&&(M(e,"Unbound namespace prefix: "+JSON.stringify(f)),g.uri=f),e.tag.attributes[l]=g,C(e,"onattribute",g)}e.attribList.length=0}e.tag.isSelfClosing=!!t,e.sawRoot=!0,e.tags.push(e.tag),C(e,"onopentag",e.tag),t||(e.noscript||"script"!==e.tagName.toLowerCase()?e.state=R.TEXT:e.state=R.SCRIPT,e.tag=null,e.tagName=""),e.attribName=e.attribValue="",e.attribList.length=0}function U(e){if(!e.tagName)return M(e,"Weird empty close tag."),e.textNode+="</>",void(e.state=R.TEXT);if(e.script){if("script"!==e.tagName)return e.script+="</"+e.tagName+">",e.tagName="",void(e.state=R.SCRIPT);C(e,"onscript",e.script),e.script=""}var t=e.tags.length,r=e.tagName;e.strict||(r=r[e.looseCase]());for(var n=r;t--&&e.tags[t].name!==n;)M(e,"Unexpected close tag");if(t<0)return M(e,"Unmatched closing tag: "+e.tagName),e.textNode+="</"+e.tagName+">",void(e.state=R.TEXT);e.tagName=r;for(var i=e.tags.length;i-- >t;){var a=e.tag=e.tags.pop();e.tagName=e.tag.name,C(e,"onclosetag",e.tagName);var o={};for(var s in a.ns)o[s]=a.ns[s];var l=e.tags[e.tags.length-1]||e;e.opt.xmlns&&a.ns!==l.ns&&Object.keys(a.ns).forEach((function(t){var r=a.ns[t];C(e,"onclosenamespace",{prefix:t,uri:r})}))}0===t&&(e.closedRoot=!0),e.tagName=e.attribValue=e.attribName="",e.attribList.length=0,e.state=R.TEXT}function B(e){var t,r=e.entity,n=r.toLowerCase(),i="";return e.ENTITIES[r]?e.ENTITIES[r]:e.ENTITIES[n]?e.ENTITIES[n]:("#"===(r=n).charAt(0)&&("x"===r.charAt(1)?(r=r.slice(2),i=(t=parseInt(r,16)).toString(16)):(r=r.slice(1),i=(t=parseInt(r,10)).toString(10))),r=r.replace(/^0+/,""),i.toLowerCase()!==r?(M(e,"Invalid character entity"),"&"+e.entity+";"):String.fromCodePoint(t))}function Z(e,t){"<"===t?(e.state=R.OPEN_WAKA,e.startTagPosition=e.position):_(s,t)&&(M(e,"Non-whitespace before first tag."),e.textNode=t,e.state=R.TEXT)}function G(e,t){var r="";return t<e.length&&(r=e.charAt(t)),r}R=e.STATE,String.fromCodePoint||(S=String.fromCharCode,A=Math.floor,b=function(){var e,t,r=16384,n=[],i=-1,a=arguments.length;if(!a)return"";for(var o="";++i<a;){var s=Number(arguments[i]);if(!isFinite(s)||s<0||s>1114111||A(s)!==s)throw RangeError("Invalid code point: "+s);s<=65535?n.push(s):(e=55296+((s-=65536)>>10),t=s%1024+56320,n.push(e,t)),(i+1===a||n.length>r)&&(o+=S.apply(null,n),n.length=0)}return o},Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:b,configurable:!0,writable:!0}):String.fromCodePoint=b)}(t)},182:function(e,t,r){e.exports=i;var n=r(1159).EventEmitter;function i(){n.call(this)}r(1765)(i,n),i.Readable=r(2846),i.Writable=r(8318),i.Duplex=r(6138),i.Transform=r(9798),i.PassThrough=r(5472),i.finished=r(8800),i.pipeline=r(7295),i.Stream=i,i.prototype.pipe=function(e,t){var r=this;function i(t){e.writable&&!1===e.write(t)&&r.pause&&r.pause()}function a(){r.readable&&r.resume&&r.resume()}r.on("data",i),e.on("drain",a),e._isStdio||t&&!1===t.end||(r.on("end",s),r.on("close",l));var o=!1;function s(){o||(o=!0,e.end())}function l(){o||(o=!0,"function"==typeof e.destroy&&e.destroy())}function u(e){if(c(),0===n.listenerCount(this,"error"))throw e}function c(){r.removeListener("data",i),e.removeListener("drain",a),r.removeListener("end",s),r.removeListener("close",l),r.removeListener("error",u),e.removeListener("error",u),r.removeListener("end",c),r.removeListener("close",c),e.removeListener("close",c)}return r.on("error",u),e.on("error",u),r.on("end",c),r.on("close",c),e.on("close",c),e.emit("pipe",r),e}},1765:function(e){"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}},3690:function(e){var t={};function r(e,r,n){n||(n=Error);var i=function(e){var t,n;function i(t,n,i){return e.call(this,(a=t,o=n,s=i,"string"==typeof r?r:r(a,o,s)))||this;var a,o,s}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,i}(n);i.prototype.name=n.name,i.prototype.code=e,t[e]=i}function n(e,t){if(Array.isArray(e)){var r=e.length;return e=e.map((function(e){return String(e)})),r>2?"one of ".concat(t," ").concat(e.slice(0,r-1).join(", "),", or ")+e[r-1]:2===r?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}r("ERR_INVALID_OPT_VALUE",(function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'}),TypeError),r("ERR_INVALID_ARG_TYPE",(function(e,t,r){var i,a,o,s,l,u,c,f;if("string"==typeof t&&(a="not ",t.substr(0,a.length)===a)?(i="must not be",t=t.replace(/^not /,"")):i="must be",u=e,c=" argument",(void 0===f||f>u.length)&&(f=u.length),u.substring(f-c.length,f)===c)o="The ".concat(e," ").concat(i," ").concat(n(t,"type"));else{var d=("number"!=typeof l&&(l=0),l+1>(s=e).length||-1===s.indexOf(".",l)?"argument":"property");o='The "'.concat(e,'" ').concat(d," ").concat(i," ").concat(n(t,"type"))}return o+". Received type ".concat(typeof r)}),TypeError),r("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),r("ERR_METHOD_NOT_IMPLEMENTED",(function(e){return"The "+e+" method is not implemented"})),r("ERR_STREAM_PREMATURE_CLOSE","Premature close"),r("ERR_STREAM_DESTROYED",(function(e){return"Cannot call "+e+" after a stream was destroyed"})),r("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),r("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),r("ERR_STREAM_WRITE_AFTER_END","write after end"),r("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),r("ERR_UNKNOWN_ENCODING",(function(e){return"Unknown encoding: "+e}),TypeError),r("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),e.exports.q=t},6138:function(e,t,r){var n=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};e.exports=u;var i=r(2846),a=r(8318);r(1765)(u,i);for(var o=n(a.prototype),s=0;s<o.length;s++){var l=o[s];u.prototype[l]||(u.prototype[l]=a.prototype[l])}function u(e){if(!(this instanceof u))return new u(e);i.call(this,e),a.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",c)))}function c(){this._writableState.ended||process.nextTick(f,this)}function f(e){e.end()}Object.defineProperty(u.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(u.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(u.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(u.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})},5472:function(e,t,r){e.exports=i;var n=r(9798);function i(e){if(!(this instanceof i))return new i(e);n.call(this,e)}r(1765)(i,n),i.prototype._transform=function(e,t,r){r(null,e)}},2846:function(e,t,r){var n;e.exports=b,b.ReadableState=A,r(1159).EventEmitter;var i,a=function(e,t){return e.listeners(t).length},o=r(9299),s=r(1549).Buffer,l=r.g.Uint8Array||function(){},u=r(964);i=u&&u.debuglog?u.debuglog("stream"):function(){};var c,f,d,h=r(8393),g=r(6163),m=r(7269).getHighWaterMark,p=r(3690).q,y=p.ERR_INVALID_ARG_TYPE,E=p.ERR_STREAM_PUSH_AFTER_EOF,v=p.ERR_METHOD_NOT_IMPLEMENTED,T=p.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;r(1765)(b,o);var _=g.errorOrDestroy,S=["error","close","destroy","pause","resume"];function A(e,t,i){n=n||r(6138),e=e||{},"boolean"!=typeof i&&(i=t instanceof n),this.objectMode=!!e.objectMode,i&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.highWaterMark=m(this,e,"readableHighWaterMark",i),this.buffer=new h,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(c||(c=r(7503).s),this.decoder=new c(e.encoding),this.encoding=e.encoding)}function b(e){if(n=n||r(6138),!(this instanceof b))return new b(e);var t=this instanceof n;this._readableState=new A(e,this,t),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),o.call(this)}function R(e,t,r,n,a){i("readableAddChunk",t);var o,u,c,f,d,h=e._readableState;if(null===t)h.reading=!1,function(e,t){if(i("onEofChunk"),!t.ended){if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,t.sync?D(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,L(e)))}}(e,h);else if(a||(u=h,d=c=t,s.isBuffer(d)||d instanceof l||"string"==typeof c||void 0===c||u.objectMode||(f=new y("chunk",["string","Buffer","Uint8Array"],c)),o=f),o)_(e,o);else if(h.objectMode||t&&t.length>0)if("string"==typeof t||h.objectMode||Object.getPrototypeOf(t)===s.prototype||(t=function(e){return s.from(e)}(t)),n)h.endEmitted?_(e,new T):I(e,h,t,!0);else if(h.ended)_(e,new E);else{if(h.destroyed)return!1;h.reading=!1,h.decoder&&!r?(t=h.decoder.write(t),h.objectMode||0!==t.length?I(e,h,t,!1):N(e,h)):I(e,h,t,!1)}else n||(h.reading=!1,N(e,h));return!h.ended&&(h.length<h.highWaterMark||0===h.length)}function I(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",r)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&D(e)),N(e,t)}Object.defineProperty(b.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),b.prototype.destroy=g.destroy,b.prototype._undestroy=g.undestroy,b.prototype._destroy=function(e,t){t(e)},b.prototype.push=function(e,t){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=s.from(e,t),t=""),r=!0),R(this,e,t,!1,r)},b.prototype.unshift=function(e){return R(this,e,null,!0,!1)},b.prototype.isPaused=function(){return!1===this._readableState.flowing},b.prototype.setEncoding=function(e){c||(c=r(7503).s);var t=new c(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;for(var n=this._readableState.buffer.head,i="";null!==n;)i+=t.write(n.data),n=n.next;return this._readableState.buffer.clear(),""!==i&&this._readableState.buffer.push(i),this._readableState.length=i.length,this};var w=1073741824;function C(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=((r=e)>=w?r=w:(r--,r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r++),r)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0));var r}function D(e){var t=e._readableState;i("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(i("emitReadable",t.flowing),t.emittedReadable=!0,process.nextTick(L,e))}function L(e){var t=e._readableState;i("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,x(e)}function N(e,t){t.readingMore||(t.readingMore=!0,process.nextTick(O,e,t))}function O(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var r=t.length;if(i("maybeReadMore read 0"),e.read(0),r===t.length)break}t.readingMore=!1}function M(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function P(e){i("readable nexttick read 0"),e.read(0)}function k(e,t){i("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),x(e),t.flowing&&!t.reading&&e.read(0)}function x(e){var t=e._readableState;for(i("flow",t.flowing);t.flowing&&null!==e.read(););}function F(e,t){return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):r=t.buffer.consume(e,t.decoder),r);var r}function U(e){var t=e._readableState;i("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,process.nextTick(B,t,e))}function B(e,t){if(i("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var r=t._writableState;(!r||r.autoDestroy&&r.finished)&&t.destroy()}}function Z(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}b.prototype.read=function(e){i("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return i("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?U(this):D(this),null;if(0===(e=C(e,t))&&t.ended)return 0===t.length&&U(this),null;var n,a=t.needReadable;return i("need readable",a),(0===t.length||t.length-e<t.highWaterMark)&&i("length less than watermark",a=!0),t.ended||t.reading?i("reading or ended",a=!1):a&&(i("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=C(r,t))),null===(n=e>0?F(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&U(this)),null!==n&&this.emit("data",n),n},b.prototype._read=function(e){_(this,new v("_read()"))},b.prototype.pipe=function(e,t){var r=this,n=this._readableState;switch(n.pipesCount){case 0:n.pipes=e;break;case 1:n.pipes=[n.pipes,e];break;default:n.pipes.push(e)}n.pipesCount+=1,i("pipe count=%d opts=%j",n.pipesCount,t);var o=t&&!1===t.end||e===process.stdout||e===process.stderr?m:s;function s(){i("onend"),e.end()}n.endEmitted?process.nextTick(o):r.once("end",o),e.on("unpipe",(function t(a,o){i("onunpipe"),a===r&&o&&!1===o.hasUnpiped&&(o.hasUnpiped=!0,i("cleanup"),e.removeListener("close",h),e.removeListener("finish",g),e.removeListener("drain",u),e.removeListener("error",d),e.removeListener("unpipe",t),r.removeListener("end",s),r.removeListener("end",m),r.removeListener("data",f),c=!0,!n.awaitDrain||e._writableState&&!e._writableState.needDrain||u())}));var l,u=(l=r,function(){var e=l._readableState;i("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&a(l,"data")&&(e.flowing=!0,x(l))});e.on("drain",u);var c=!1;function f(t){i("ondata");var a=e.write(t);i("dest.write",a),!1===a&&((1===n.pipesCount&&n.pipes===e||n.pipesCount>1&&-1!==Z(n.pipes,e))&&!c&&(i("false write response, pause",n.awaitDrain),n.awaitDrain++),r.pause())}function d(t){i("onerror",t),m(),e.removeListener("error",d),0===a(e,"error")&&_(e,t)}function h(){e.removeListener("finish",g),m()}function g(){i("onfinish"),e.removeListener("close",h),m()}function m(){i("unpipe"),r.unpipe(e)}return r.on("data",f),function(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}(e,"error",d),e.once("close",h),e.once("finish",g),e.emit("pipe",r),n.flowing||(i("pipe resume"),r.resume()),e},b.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r)),this;if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var a=0;a<i;a++)n[a].emit("unpipe",this,{hasUnpiped:!1});return this}var o=Z(t.pipes,e);return-1===o||(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r)),this},b.prototype.on=function(e,t){var r=o.prototype.on.call(this,e,t),n=this._readableState;return"data"===e?(n.readableListening=this.listenerCount("readable")>0,!1!==n.flowing&&this.resume()):"readable"===e&&(n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.flowing=!1,n.emittedReadable=!1,i("on readable",n.length,n.reading),n.length?D(this):n.reading||process.nextTick(P,this))),r},b.prototype.addListener=b.prototype.on,b.prototype.removeListener=function(e,t){var r=o.prototype.removeListener.call(this,e,t);return"readable"===e&&process.nextTick(M,this),r},b.prototype.removeAllListeners=function(e){var t=o.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&void 0!==e||process.nextTick(M,this),t},b.prototype.resume=function(){var e,t,r=this._readableState;return r.flowing||(i("resume"),r.flowing=!r.readableListening,e=this,(t=r).resumeScheduled||(t.resumeScheduled=!0,process.nextTick(k,e,t))),r.paused=!1,this},b.prototype.pause=function(){return i("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(i("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},b.prototype.wrap=function(e){var t=this,r=this._readableState,n=!1;for(var a in e.on("end",(function(){if(i("wrapped end"),r.decoder&&!r.ended){var e=r.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(a){i("wrapped data"),r.decoder&&(a=r.decoder.write(a)),r.objectMode&&null==a||(r.objectMode||a&&a.length)&&(t.push(a)||(n=!0,e.pause()))})),e)void 0===this[a]&&"function"==typeof e[a]&&(this[a]=function(t){return function(){return e[t].apply(e,arguments)}}(a));for(var o=0;o<S.length;o++)e.on(S[o],this.emit.bind(this,S[o]));return this._read=function(t){i("wrapped _read",t),n&&(n=!1,e.resume())},this},"function"==typeof Symbol&&(b.prototype[Symbol.asyncIterator]=function(){return void 0===f&&(f=r(7299)),f(this)}),Object.defineProperty(b.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(b.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(b.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),b._fromList=F,Object.defineProperty(b.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(b.from=function(e,t){return void 0===d&&(d=r(6233)),d(b,e,t)})},9798:function(e,t,r){e.exports=c;var n=r(3690).q,i=n.ERR_METHOD_NOT_IMPLEMENTED,a=n.ERR_MULTIPLE_CALLBACK,o=n.ERR_TRANSFORM_ALREADY_TRANSFORMING,s=n.ERR_TRANSFORM_WITH_LENGTH_0,l=r(6138);function u(e,t){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(null===n)return this.emit("error",new a);r.writechunk=null,r.writecb=null,null!=t&&this.push(t),n(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function c(e){if(!(this instanceof c))return new c(e);l.call(this,e),this._transformState={afterTransform:u.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",f)}function f(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?d(this,null,null):this._flush((function(t,r){d(e,t,r)}))}function d(e,t,r){if(t)return e.emit("error",t);if(null!=r&&e.push(r),e._writableState.length)throw new s;if(e._transformState.transforming)throw new o;return e.push(null)}r(1765)(c,l),c.prototype.push=function(e,t){return this._transformState.needTransform=!1,l.prototype.push.call(this,e,t)},c.prototype._transform=function(e,t,r){r(new i("_transform()"))},c.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},c.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},c.prototype._destroy=function(e,t){l.prototype._destroy.call(this,e,(function(e){t(e)}))}},8318:function(e,t,r){function n(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,r){var n=e.entry;for(e.entry=null;n;){var i=n.callback;t.pendingcb--,i(void 0),n=n.next}t.corkedRequestsFree.next=e}(t,e)}}var i;e.exports=b,b.WritableState=A;var a,o={deprecate:r(7839)},s=r(9299),l=r(1549).Buffer,u=r.g.Uint8Array||function(){},c=r(6163),f=r(7269).getHighWaterMark,d=r(3690).q,h=d.ERR_INVALID_ARG_TYPE,g=d.ERR_METHOD_NOT_IMPLEMENTED,m=d.ERR_MULTIPLE_CALLBACK,p=d.ERR_STREAM_CANNOT_PIPE,y=d.ERR_STREAM_DESTROYED,E=d.ERR_STREAM_NULL_VALUES,v=d.ERR_STREAM_WRITE_AFTER_END,T=d.ERR_UNKNOWN_ENCODING,_=c.errorOrDestroy;function S(){}function A(e,t,a){i=i||r(6138),e=e||{},"boolean"!=typeof a&&(a=t instanceof i),this.objectMode=!!e.objectMode,a&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=f(this,e,"writableHighWaterMark",a),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var o=!1===e.decodeStrings;this.decodeStrings=!o,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var r,n=e._writableState,i=n.sync,a=n.writecb;if("function"!=typeof a)throw new m;if((r=n).writing=!1,r.writecb=null,r.length-=r.writelen,r.writelen=0,t)!function(e,t,r,n,i){--t.pendingcb,r?(process.nextTick(i,n),process.nextTick(L,e,t),e._writableState.errorEmitted=!0,_(e,n)):(i(n),e._writableState.errorEmitted=!0,_(e,n),L(e,t))}(e,n,i,t,a);else{var o=C(n)||e.destroyed;o||n.corked||n.bufferProcessing||!n.bufferedRequest||w(e,n),i?process.nextTick(I,e,n,o,a):I(e,n,o,a)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new n(this)}function b(e){var t=this instanceof(i=i||r(6138));if(!t&&!a.call(b,this))return new b(e);this._writableState=new A(e,this,t),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),s.call(this)}function R(e,t,r,n,i,a,o){t.writelen=n,t.writecb=o,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new y("write")):r?e._writev(i,t.onwrite):e._write(i,a,t.onwrite),t.sync=!1}function I(e,t,r,n){var i,a;r||(i=e,0===(a=t).length&&a.needDrain&&(a.needDrain=!1,i.emit("drain"))),t.pendingcb--,n(),L(e,t)}function w(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var i=t.bufferedRequestCount,a=new Array(i),o=t.corkedRequestsFree;o.entry=r;for(var s=0,l=!0;r;)a[s]=r,r.isBuf||(l=!1),r=r.next,s+=1;a.allBuffers=l,R(e,t,!0,t.length,a,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new n(t),t.bufferedRequestCount=0}else{for(;r;){var u=r.chunk,c=r.encoding,f=r.callback;if(R(e,t,!1,t.objectMode?1:u.length,u,c,f),r=r.next,t.bufferedRequestCount--,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}function C(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function D(e,t){e._final((function(r){t.pendingcb--,r&&_(e,r),t.prefinished=!0,e.emit("prefinish"),L(e,t)}))}function L(e,t){var r,n,i=C(t);if(i&&(r=e,(n=t).prefinished||n.finalCalled||("function"!=typeof r._final||n.destroyed?(n.prefinished=!0,r.emit("prefinish")):(n.pendingcb++,n.finalCalled=!0,process.nextTick(D,r,n))),0===t.pendingcb&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var a=e._readableState;(!a||a.autoDestroy&&a.endEmitted)&&e.destroy()}return i}r(1765)(b,s),A.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(A.prototype,"buffer",{get:o.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(a=Function.prototype[Symbol.hasInstance],Object.defineProperty(b,Symbol.hasInstance,{value:function(e){return!!a.call(this,e)||this===b&&e&&e._writableState instanceof A}})):a=function(e){return e instanceof this},b.prototype.pipe=function(){_(this,new p)},b.prototype.write=function(e,t,r){var n,i,a=this._writableState,o=!1,s=!a.objectMode&&(n=e,l.isBuffer(n)||n instanceof u);return s&&!l.isBuffer(e)&&(i=e,e=l.from(i)),"function"==typeof t&&(r=t,t=null),s?t="buffer":t||(t=a.defaultEncoding),"function"!=typeof r&&(r=S),a.ending?function(e,t){var r=new v;_(e,r),process.nextTick(t,r)}(this,r):(s||function(e,t,r,n){var i;return null===r?i=new E:"string"==typeof r||t.objectMode||(i=new h("chunk",["string","Buffer"],r)),!i||(_(e,i),process.nextTick(n,i),!1)}(this,a,e,r))&&(a.pendingcb++,o=function(e,t,r,n,i,a){if(!r){var o=(u=n,c=i,(s=t).objectMode||!1===s.decodeStrings||"string"!=typeof u||(u=l.from(u,c)),u);n!==o&&(r=!0,i="buffer",n=o)}var s,u,c,f=t.objectMode?1:n.length;t.length+=f;var d=t.length<t.highWaterMark;if(d||(t.needDrain=!0),t.writing||t.corked){var h=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:a,next:null},h?h.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else R(e,t,!1,f,n,i,a);return d}(this,a,s,e,t,r)),o},b.prototype.cork=function(){this._writableState.corked++},b.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||w(this,e))},b.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new T(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(b.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(b.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),b.prototype._write=function(e,t,r){r(new g("_write()"))},b.prototype._writev=null,b.prototype.end=function(e,t,r){var n,i,a,o=this._writableState;return"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!=e&&this.write(e,t),o.corked&&(o.corked=1,this.uncork()),o.ending||(n=this,a=r,(i=o).ending=!0,L(n,i),a&&(i.finished?process.nextTick(a):n.once("finish",a)),i.ended=!0,n.writable=!1),this},Object.defineProperty(b.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(b.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),b.prototype.destroy=c.destroy,b.prototype._undestroy=c.undestroy,b.prototype._destroy=function(e,t){t(e)}},7299:function(e,t,r){var n;function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var a=r(8800),o=Symbol("lastResolve"),s=Symbol("lastReject"),l=Symbol("error"),u=Symbol("ended"),c=Symbol("lastPromise"),f=Symbol("handlePromise"),d=Symbol("stream");function h(e,t){return{value:e,done:t}}function g(e){var t=e[o];if(null!==t){var r=e[d].read();null!==r&&(e[c]=null,e[o]=null,e[s]=null,t(h(r,!1)))}}function m(e){process.nextTick(g,e)}var p=Object.getPrototypeOf((function(){})),y=Object.setPrototypeOf((i(n={get stream(){return this[d]},next:function(){var e=this,t=this[l];if(null!==t)return Promise.reject(t);if(this[u])return Promise.resolve(h(void 0,!0));if(this[d].destroyed)return new Promise((function(t,r){process.nextTick((function(){e[l]?r(e[l]):t(h(void 0,!0))}))}));var r,n,i,a=this[c];if(a)r=new Promise((n=a,i=this,function(e,t){n.then((function(){i[u]?e(h(void 0,!0)):i[f](e,t)}),t)}));else{var o=this[d].read();if(null!==o)return Promise.resolve(h(o,!1));r=new Promise(this[f])}return this[c]=r,r}},Symbol.asyncIterator,(function(){return this})),i(n,"return",(function(){var e=this;return new Promise((function(t,r){e[d].destroy(null,(function(e){e?r(e):t(h(void 0,!0))}))}))})),n),p);e.exports=function(e){var t,r=Object.create(y,(i(t={},d,{value:e,writable:!0}),i(t,o,{value:null,writable:!0}),i(t,s,{value:null,writable:!0}),i(t,l,{value:null,writable:!0}),i(t,u,{value:e._readableState.endEmitted,writable:!0}),i(t,f,{value:function(e,t){var n=r[d].read();n?(r[c]=null,r[o]=null,r[s]=null,e(h(n,!1))):(r[o]=e,r[s]=t)},writable:!0}),t));return r[c]=null,a(e,(function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=r[s];return null!==t&&(r[c]=null,r[o]=null,r[s]=null,t(e)),void(r[l]=e)}var n=r[o];null!==n&&(r[c]=null,r[o]=null,r[s]=null,n(h(void 0,!0))),r[u]=!0})),e.on("readable",m.bind(null,r)),r}},8393:function(e,t,r){function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=r(1549).Buffer,s=r(9862).inspect,l=s&&s.custom||"inspect";e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}var t;return t=[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r}},{key:"concat",value:function(e){if(0===this.length)return o.alloc(0);for(var t,r,n,i=o.allocUnsafe(e>>>0),a=this.head,s=0;a;)t=a.data,r=i,n=s,o.prototype.copy.call(t,r,n),s+=a.data.length,a=a.next;return i}},{key:"consume",value:function(e,t){var r;return e<this.head.data.length?(r=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):r=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),r}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,r=1,n=t.data;for(e-=n.length;t=t.next;){var i=t.data,a=e>i.length?i.length:e;if(a===i.length?n+=i:n+=i.slice(0,e),0==(e-=a)){a===i.length?(++r,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=i.slice(a));break}++r}return this.length-=r,n}},{key:"_getBuffer",value:function(e){var t=o.allocUnsafe(e),r=this.head,n=1;for(r.data.copy(t),e-=r.data.length;r=r.next;){var i=r.data,a=e>i.length?i.length:e;if(i.copy(t,t.length-e,0,a),0==(e-=a)){a===i.length?(++n,r.next?this.head=r.next:this.head=this.tail=null):(this.head=r,r.data=i.slice(a));break}++n}return this.length-=n,t}},{key:l,value:function(e,t){return s(this,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},t,{depth:0,customInspect:!1}))}}],t&&a(e.prototype,t),e}()},6163:function(e){function t(e,t){n(e,t),r(e)}function r(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function n(e,t){e.emit("error",t)}e.exports={destroy:function(e,i){var a=this,o=this._readableState&&this._readableState.destroyed,s=this._writableState&&this._writableState.destroyed;return o||s?(i?i(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,process.nextTick(n,this,e)):process.nextTick(n,this,e)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!i&&e?a._writableState?a._writableState.errorEmitted?process.nextTick(r,a):(a._writableState.errorEmitted=!0,process.nextTick(t,a,e)):process.nextTick(t,a,e):i?(process.nextTick(r,a),i(e)):process.nextTick(r,a)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var r=e._readableState,n=e._writableState;r&&r.autoDestroy||n&&n.autoDestroy?e.destroy(t):e.emit("error",t)}}},8800:function(e,t,r){var n=r(3690).q.ERR_STREAM_PREMATURE_CLOSE;function i(){}e.exports=function e(t,r,a){if("function"==typeof r)return e(t,null,r);var o,s;r||(r={}),o=a||i,s=!1,a=function(){if(!s){s=!0;for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];o.apply(this,t)}};var l=r.readable||!1!==r.readable&&t.readable,u=r.writable||!1!==r.writable&&t.writable,c=function(){t.writable||d()},f=t._writableState&&t._writableState.finished,d=function(){u=!1,f=!0,l||a.call(t)},h=t._readableState&&t._readableState.endEmitted,g=function(){l=!1,h=!0,u||a.call(t)},m=function(e){a.call(t,e)},p=function(){var e;return l&&!h?(t._readableState&&t._readableState.ended||(e=new n),a.call(t,e)):u&&!f?(t._writableState&&t._writableState.ended||(e=new n),a.call(t,e)):void 0},y=function(){t.req.on("finish",d)};return function(e){return e.setHeader&&"function"==typeof e.abort}(t)?(t.on("complete",d),t.on("abort",p),t.req?y():t.on("request",y)):u&&!t._writableState&&(t.on("end",c),t.on("close",c)),t.on("end",g),t.on("finish",d),!1!==r.error&&t.on("error",m),t.on("close",p),function(){t.removeListener("complete",d),t.removeListener("abort",p),t.removeListener("request",y),t.req&&t.req.removeListener("finish",d),t.removeListener("end",c),t.removeListener("close",c),t.removeListener("finish",d),t.removeListener("end",g),t.removeListener("error",m),t.removeListener("close",p)}}},6233:function(e){e.exports=function(){throw new Error("Readable.from is not available in the browser")}},7295:function(e,t,r){var n,i=r(3690).q,a=i.ERR_MISSING_ARGS,o=i.ERR_STREAM_DESTROYED;function s(e){if(e)throw e}function l(e,t,i,a){var s,l;s=a,l=!1,a=function(){l||(l=!0,s.apply(void 0,arguments))};var u=!1;e.on("close",(function(){u=!0})),void 0===n&&(n=r(8800)),n(e,{readable:t,writable:i},(function(e){if(e)return a(e);u=!0,a()}));var c=!1;return function(t){if(!u&&!c)return c=!0,function(e){return e.setHeader&&"function"==typeof e.abort}(e)?e.abort():"function"==typeof e.destroy?e.destroy():void a(t||new o("pipe"))}}function u(e){e()}function c(e,t){return e.pipe(t)}function f(e){return e.length?"function"!=typeof e[e.length-1]?s:e.pop():s}e.exports=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n,i=f(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new a("streams");var o=t.map((function(e,r){var a=r<t.length-1;return l(e,a,r>0,(function(e){n||(n=e),e&&o.forEach(u),a||(o.forEach(u),i(n))}))}));return t.reduce(c)}},7269:function(e,t,r){var n=r(3690).q.ERR_INVALID_OPT_VALUE;e.exports={getHighWaterMark:function(e,t,r,i){var a,o,s,l=(o=i,s=r,null!=(a=t).highWaterMark?a.highWaterMark:o?a[s]:null);if(null!=l){if(!isFinite(l)||Math.floor(l)!==l||l<0)throw new n(i?r:"highWaterMark",l);return Math.floor(l)}return e.objectMode?16:16384}}},9299:function(e,t,r){e.exports=r(1159).EventEmitter},7503:function(e,t,r){var n=r(8387).Buffer,i=n.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function a(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(n.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=l,this.end=u,t=4;break;case"utf8":this.fillLast=s,t=4;break;case"base64":this.text=c,this.end=f,t=3;break;default:return this.write=d,void(this.end=h)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(t)}function o(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function s(e){var t=this.lastTotal-this.lastNeed,r=function(e,t,r){if(128!=(192&t[0]))return e.lastNeed=0,"";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,""}}(this,e);return void 0!==r?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function l(e,t){if((e.length-t)%2==0){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function u(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function c(e,t){var r=(e.length-t)%3;return 0===r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function f(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function d(e){return e.toString(this.encoding)}function h(e){return e&&e.length?this.write(e):""}t.s=a,a.prototype.write=function(e){if(0===e.length)return"";var t,r;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},a.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"":t},a.prototype.text=function(e,t){var r=function(e,t,r){var n=t.length-1;if(n<r)return 0;var i=o(t[n]);return i>=0?(i>0&&(e.lastNeed=i-1),i):--n<r||-2===i?0:(i=o(t[n]))>=0?(i>0&&(e.lastNeed=i-2),i):--n<r||-2===i?0:(i=o(t[n]))>=0?(i>0&&(2===i?i=0:e.lastNeed=i-3),i):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)},a.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},1067:function(e,t,r){var n;!function(i,a){var o="function",s="undefined",l="object",u="string",c="major",f="model",d="name",h="type",g="vendor",m="version",p="architecture",y="console",E="mobile",v="tablet",T="smarttv",_="wearable",S="embedded",A="Amazon",b="Apple",R="ASUS",I="BlackBerry",w="Browser",C="Chrome",D="Firefox",L="Google",N="Huawei",O="LG",M="Microsoft",P="Motorola",k="Opera",x="Samsung",F="Sharp",U="Sony",B="Xiaomi",Z="Zebra",G="Facebook",H="Chromium OS",K="Mac OS",Y=function(e){for(var t={},r=0;r<e.length;r++)t[e[r].toUpperCase()]=e[r];return t},q=function(e,t){return typeof e===u&&-1!==V(t).indexOf(V(e))},V=function(e){return e.toLowerCase()},j=function(e,t){if(typeof e===u)return e=e.replace(/^\s\s*/,""),typeof t===s?e:e.substring(0,500)},$=function(e,t){for(var r,n,i,s,u,c,f=0;f<t.length&&!u;){var d=t[f],h=t[f+1];for(r=n=0;r<d.length&&!u&&d[r];)if(u=d[r++].exec(e))for(i=0;i<h.length;i++)c=u[++n],typeof(s=h[i])===l&&s.length>0?2===s.length?typeof s[1]==o?this[s[0]]=s[1].call(this,c):this[s[0]]=s[1]:3===s.length?typeof s[1]!==o||s[1].exec&&s[1].test?this[s[0]]=c?c.replace(s[1],s[2]):a:this[s[0]]=c?s[1].call(this,c,s[2]):a:4===s.length&&(this[s[0]]=c?s[3].call(this,c.replace(s[1],s[2])):a):this[s]=c||a;f+=2}},z=function(e,t){for(var r in t)if(typeof t[r]===l&&t[r].length>0){for(var n=0;n<t[r].length;n++)if(q(t[r][n],e))return"?"===r?a:r}else if(q(t[r],e))return"?"===r?a:r;return e},W={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},X={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[m,[d,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[m,[d,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[d,m],[/opios[\/ ]+([\w\.]+)/i],[m,[d,k+" Mini"]],[/\bopr\/([\w\.]+)/i],[m,[d,k]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[m,[d,"Baidu"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim)\s?(?:browser)?[\/ ]?([\w\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[d,m],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[m,[d,"UC"+w]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[m,[d,"WeChat"]],[/konqueror\/([\w\.]+)/i],[m,[d,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[m,[d,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[m,[d,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[m,[d,"Smart Lenovo "+w]],[/(avast|avg)\/([\w\.]+)/i],[[d,/(.+)/,"$1 Secure "+w],m],[/\bfocus\/([\w\.]+)/i],[m,[d,D+" Focus"]],[/\bopt\/([\w\.]+)/i],[m,[d,k+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[m,[d,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[m,[d,"Dolphin"]],[/coast\/([\w\.]+)/i],[m,[d,k+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[m,[d,"MIUI "+w]],[/fxios\/([-\w\.]+)/i],[m,[d,D]],[/\bqihu|(qi?ho?o?|360)browser/i],[[d,"360 "+w]],[/(oculus|sailfish|huawei|vivo)browser\/([\w\.]+)/i],[[d,/(.+)/,"$1 "+w],m],[/samsungbrowser\/([\w\.]+)/i],[m,[d,x+" Internet"]],[/(comodo_dragon)\/([\w\.]+)/i],[[d,/_/g," "],m],[/metasr[\/ ]?([\d\.]+)/i],[m,[d,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[d,"Sogou Mobile"],m],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345Explorer)[\/ ]?([\w\.]+)/i],[d,m],[/(lbbrowser)/i,/\[(linkedin)app\]/i],[d],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[d,G],m],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[d,m],[/\bgsa\/([\w\.]+) .*safari\//i],[m,[d,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[m,[d,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[m,[d,C+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[d,C+" WebView"],m],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[m,[d,"Android "+w]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[d,m],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[m,[d,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[m,d],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[d,[m,z,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[d,m],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[d,"Netscape"],m],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[m,[d,D+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[d,m],[/(cobalt)\/([\w\.]+)/i],[d,[m,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[p,"amd64"]],[/(ia32(?=;))/i],[[p,V]],[/((?:i[346]|x)86)[;\)]/i],[[p,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[p,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[p,"armhf"]],[/windows (ce|mobile); ppc;/i],[[p,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[p,/ower/,"",V]],[/(sun4\w)[;\)]/i],[[p,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[p,V]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[f,[g,x],[h,v]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[f,[g,x],[h,E]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[f,[g,b],[h,E]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[f,[g,b],[h,v]],[/(macintosh);/i],[f,[g,b]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[f,[g,F],[h,E]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[f,[g,N],[h,v]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[f,[g,N],[h,E]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[f,/_/g," "],[g,B],[h,E]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[f,/_/g," "],[g,B],[h,v]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[f,[g,"OPPO"],[h,E]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[f,[g,"Vivo"],[h,E]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[f,[g,"Realme"],[h,E]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[f,[g,P],[h,E]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[f,[g,P],[h,v]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[f,[g,O],[h,v]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[f,[g,O],[h,E]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[f,[g,"Lenovo"],[h,v]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[f,/_/g," "],[g,"Nokia"],[h,E]],[/(pixel c)\b/i],[f,[g,L],[h,v]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[f,[g,L],[h,E]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[f,[g,U],[h,E]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[f,"Xperia Tablet"],[g,U],[h,v]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[f,[g,"OnePlus"],[h,E]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[f,[g,A],[h,v]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[f,/(.+)/g,"Fire Phone $1"],[g,A],[h,E]],[/(playbook);[-\w\),; ]+(rim)/i],[f,g,[h,v]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[f,[g,I],[h,E]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[f,[g,R],[h,v]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[f,[g,R],[h,E]],[/(nexus 9)/i],[f,[g,"HTC"],[h,v]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[g,[f,/_/g," "],[h,E]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[f,[g,"Acer"],[h,v]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[f,[g,"Meizu"],[h,E]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[f,[g,"Ulefone"],[h,E]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[g,f,[h,E]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[g,f,[h,v]],[/(surface duo)/i],[f,[g,M],[h,v]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[f,[g,"Fairphone"],[h,E]],[/(u304aa)/i],[f,[g,"AT&T"],[h,E]],[/\bsie-(\w*)/i],[f,[g,"Siemens"],[h,E]],[/\b(rct\w+) b/i],[f,[g,"RCA"],[h,v]],[/\b(venue[\d ]{2,7}) b/i],[f,[g,"Dell"],[h,v]],[/\b(q(?:mv|ta)\w+) b/i],[f,[g,"Verizon"],[h,v]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[f,[g,"Barnes & Noble"],[h,v]],[/\b(tm\d{3}\w+) b/i],[f,[g,"NuVision"],[h,v]],[/\b(k88) b/i],[f,[g,"ZTE"],[h,v]],[/\b(nx\d{3}j) b/i],[f,[g,"ZTE"],[h,E]],[/\b(gen\d{3}) b.+49h/i],[f,[g,"Swiss"],[h,E]],[/\b(zur\d{3}) b/i],[f,[g,"Swiss"],[h,v]],[/\b((zeki)?tb.*\b) b/i],[f,[g,"Zeki"],[h,v]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[g,"Dragon Touch"],f,[h,v]],[/\b(ns-?\w{0,9}) b/i],[f,[g,"Insignia"],[h,v]],[/\b((nxa|next)-?\w{0,9}) b/i],[f,[g,"NextBook"],[h,v]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[g,"Voice"],f,[h,E]],[/\b(lvtel\-)?(v1[12]) b/i],[[g,"LvTel"],f,[h,E]],[/\b(ph-1) /i],[f,[g,"Essential"],[h,E]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[f,[g,"Envizen"],[h,v]],[/\b(trio[-\w\. ]+) b/i],[f,[g,"MachSpeed"],[h,v]],[/\btu_(1491) b/i],[f,[g,"Rotor"],[h,v]],[/(shield[\w ]+) b/i],[f,[g,"Nvidia"],[h,v]],[/(sprint) (\w+)/i],[g,f,[h,E]],[/(kin\.[onetw]{3})/i],[[f,/\./g," "],[g,M],[h,E]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[f,[g,Z],[h,v]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[f,[g,Z],[h,E]],[/smart-tv.+(samsung)/i],[g,[h,T]],[/hbbtv.+maple;(\d+)/i],[[f,/^/,"SmartTV"],[g,x],[h,T]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[g,O],[h,T]],[/(apple) ?tv/i],[g,[f,b+" TV"],[h,T]],[/crkey/i],[[f,C+"cast"],[g,L],[h,T]],[/droid.+aft(\w+)( bui|\))/i],[f,[g,A],[h,T]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[f,[g,F],[h,T]],[/(bravia[\w ]+)( bui|\))/i],[f,[g,U],[h,T]],[/(mitv-\w{5}) bui/i],[f,[g,B],[h,T]],[/Hbbtv.*(technisat) (.*);/i],[g,f,[h,T]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[g,j],[f,j],[h,T]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[h,T]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[g,f,[h,y]],[/droid.+; (shield) bui/i],[f,[g,"Nvidia"],[h,y]],[/(playstation [345portablevi]+)/i],[f,[g,U],[h,y]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[f,[g,M],[h,y]],[/((pebble))app/i],[g,f,[h,_]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[f,[g,b],[h,_]],[/droid.+; (glass) \d/i],[f,[g,L],[h,_]],[/droid.+; (wt63?0{2,3})\)/i],[f,[g,Z],[h,_]],[/(quest( 2| pro)?)/i],[f,[g,G],[h,_]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[g,[h,S]],[/(aeobc)\b/i],[f,[g,A],[h,S]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[f,[h,E]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[f,[h,v]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[h,v]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[h,E]],[/(android[-\w\. ]{0,9});.+buil/i],[f,[g,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[m,[d,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[m,[d,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[d,m],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[m,d]],os:[[/microsoft (windows) (vista|xp)/i],[d,m],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[d,[m,z,W]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[m,z,W],[d,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[m,/_/g,"."],[d,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[d,K],[m,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[m,d],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[d,m],[/\(bb(10);/i],[m,[d,I]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[m,[d,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[m,[d,D+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[m,[d,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[m,[d,"watchOS"]],[/crkey\/([\d\.]+)/i],[m,[d,C+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[d,H],m],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[d,m],[/(sunos) ?([\w\.\d]*)/i],[[d,"Solaris"],m],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[d,m]]},Q=function(e,t){if(typeof e===l&&(t=e,e=a),!(this instanceof Q))return new Q(e,t).getResult();var r=typeof i!==s&&i.navigator?i.navigator:a,n=e||(r&&r.userAgent?r.userAgent:""),y=r&&r.userAgentData?r.userAgentData:a,T=t?function(e,t){var r={};for(var n in e)t[n]&&t[n].length%2==0?r[n]=t[n].concat(e[n]):r[n]=e[n];return r}(X,t):X,_=r&&r.userAgent==n;return this.getBrowser=function(){var e,t={};return t[d]=a,t[m]=a,$.call(t,n,T.browser),t[c]=typeof(e=t[m])===u?e.replace(/[^\d\.]/g,"").split(".")[0]:a,_&&r&&r.brave&&typeof r.brave.isBrave==o&&(t[d]="Brave"),t},this.getCPU=function(){var e={};return e[p]=a,$.call(e,n,T.cpu),e},this.getDevice=function(){var e={};return e[g]=a,e[f]=a,e[h]=a,$.call(e,n,T.device),_&&!e[h]&&y&&y.mobile&&(e[h]=E),_&&"Macintosh"==e[f]&&r&&typeof r.standalone!==s&&r.maxTouchPoints&&r.maxTouchPoints>2&&(e[f]="iPad",e[h]=v),e},this.getEngine=function(){var e={};return e[d]=a,e[m]=a,$.call(e,n,T.engine),e},this.getOS=function(){var e={};return e[d]=a,e[m]=a,$.call(e,n,T.os),_&&!e[d]&&y&&"Unknown"!=y.platform&&(e[d]=y.platform.replace(/chrome os/i,H).replace(/macos/i,K)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return n},this.setUA=function(e){return n=typeof e===u&&e.length>500?j(e,500):e,this},this.setUA(n),this};Q.VERSION="1.0.37",Q.BROWSER=Y([d,m,c]),Q.CPU=Y([p]),Q.DEVICE=Y([f,g,h,y,E,T,v,_,S]),Q.ENGINE=Q.OS=Y([d,m]),typeof t!==s?(e.exports&&(t=e.exports=Q),t.UAParser=Q):r.amdO?(n=function(){return Q}.call(t,r,t,e))===a||(e.exports=n):typeof i!==s&&(i.UAParser=Q);var J=typeof i!==s&&(i.jQuery||i.Zepto);if(J&&!J.ua){var ee=new Q;J.ua=ee.getResult(),J.ua.get=function(){return ee.getUA()},J.ua.set=function(e){ee.setUA(e);var t=ee.getResult();for(var r in t)J.ua[r]=t[r]}}}("object"==typeof window?window:this)},7839:function(e,t,r){function n(e){try{if(!r.g.localStorage)return!1}catch(n){return!1}var t=r.g.localStorage[e];return null!=t&&"true"===String(t).toLowerCase()}e.exports=function(e,t){if(n("noDeprecation"))return e;var r=!1;return function(){if(!r){if(n("throwDeprecation"))throw new Error(t);n("traceDeprecation"),r=!0}return e.apply(this,arguments)}}},9862:function(){},964:function(){},3165:function(e){e.exports=JSON.parse('["mni-beng-in","mni-mtei-in","sat-deva-in","sat-olck-in","shi-latn-ma","shi-tfng-ma","vai-latn-lr","vai-vaii-lr","yue-hans-cn","yue-hant-hk","az-arab-ir","az-cyrl-az","az-latn-az","bm-nkoo-ml","bs-cyrl-ba","bs-latn-ba","en-dsrt-us","ff-adlm-gn","ff-latn-sn","ha-arab-ng","hi-latn-in","iu-latn-ca","ks-arab-in","ks-deva-in","mn-mong-cn","ms-arab-my","pa-arab-pk","pa-guru-in","sd-arab-pk","sd-deva-in","sr-cyrl-rs","sr-latn-rs","su-latn-id","uz-arab-af","uz-cyrl-uz","uz-latn-uz","zh-hans-cn","zh-hant-tw","mni-beng","sat-olck","shi-tfng","vai-vaii","yue-hant","az-latn","bs-latn","ff-latn","jbo-001","ks-arab","pa-guru","prg-001","sd-arab","sr-cyrl","su-latn","uz-latn","zh-hans","agq-cm","ar-001","arn-cl","asa-tz","ast-es","bas-cm","bem-zm","bez-tz","bgn-pk","blt-vn","brx-in","bss-cm","byn-er","cad-us","cch-ng","ccp-bd","ceb-ph","cgg-ug","chr-us","cic-us","ckb-iq","dav-ke","dje-ne","doi-in","dsb-de","dua-cm","dyo-sn","ebu-ke","eo-001","ewo-cm","fil-ph","fur-it","gaa-gh","gez-et","gsw-ch","guz-ke","haw-us","hsb-de","ia-001","ife-tg","io-001","jgo-cm","jmc-tz","kab-dz","kaj-ng","kam-ke","kcg-ng","kde-tz","kea-cv","ken-cm","khq-ml","kkj-cm","kln-ke","kok-in","kpe-lr","ksb-tz","ksf-cm","ksh-de","lag-tz","lkt-us","lrc-ir","luo-ke","luy-ke","mai-in","mas-ke","mer-ke","mfe-mu","mgh-mz","mgo-cm","moh-ca","mua-cm","mus-us","myv-ru","mzn-ir","naq-na","nds-de","nmg-cm","nnh-cm","nqo-gn","nso-za","nus-ss","nyn-ug","osa-us","pcm-ng","quc-gt","rof-tz","rwk-tz","sah-ru","saq-ke","sbp-tz","scn-it","sdh-ir","seh-mz","ses-ml","sid-et","sma-se","smj-se","smn-fi","sms-fi","ssy-er","syr-iq","szl-pl","teo-ug","tig-er","trv-tw","trw-pk","twq-ne","tzm-ma","vo-001","vun-tz","wae-ch","wal-et","wbp-au","xog-ug","yav-cm","yi-001","zgh-ma","aa-et","af-za","ak-gh","am-et","an-es","as-in","ba-ru","be-by","bg-bg","bm-ml","bn-bd","bo-cn","br-fr","ca-es","ce-ru","co-fr","cs-cz","cu-ru","cv-ru","cy-gb","da-dk","de-de","dv-mv","dz-bt","ee-gh","el-gr","en-us","es-es","et-ee","eu-es","fa-ir","fi-fi","fo-fo","fr-fr","fy-nl","ga-ie","gd-gb","gl-es","gn-py","gu-in","gv-im","ha-ng","he-il","hi-in","hr-hr","hu-hu","hy-am","id-id","ig-ng","ii-cn","is-is","it-it","iu-ca","ja-jp","jv-id","ka-ge","ki-ke","kk-kz","kl-gl","km-kh","kn-in","ko-kr","ku-tr","kw-gb","ky-kg","lb-lu","lg-ug","ln-cd","lo-la","lt-lt","lu-cd","lv-lv","mg-mg","mi-nz","mk-mk","ml-in","mn-mn","mr-in","ms-my","mt-mt","my-mm","nb-no","nd-zw","ne-np","nl-nl","nn-no","nr-za","nv-us","ny-mw","oc-fr","om-et","or-in","os-ge","pl-pl","ps-af","pt-br","qu-pe","rm-ch","rn-bi","ro-ro","ru-ru","rw-rw","sa-in","sc-it","se-no","sg-cf","si-lk","sk-sk","sl-si","sn-zw","so-so","sq-al","ss-za","st-za","sv-se","sw-tz","ta-in","te-in","tg-tj","th-th","ti-et","tk-tm","tn-za","to-to","tr-tr","ts-za","tt-ru","ug-cn","uk-ua","ur-pk","ve-za","vi-vn","wa-be","wo-sn","xh-za","yo-ng","zu-za"]')},5813:function(e){e.exports=JSON.parse('[{"from":{"field":"script","value":"qaai"},"to":{"field":"script","value":"zinh"}},{"from":{"field":"region","value":"bu"},"to":{"field":"region","value":"mm"}},{"from":{"field":"region","value":"ct"},"to":{"field":"region","value":"ki"}},{"from":{"field":"region","value":"dd"},"to":{"field":"region","value":"de"}},{"from":{"field":"region","value":"dy"},"to":{"field":"region","value":"bj"}},{"from":{"field":"region","value":"fx"},"to":{"field":"region","value":"fr"}},{"from":{"field":"region","value":"hv"},"to":{"field":"region","value":"bf"}},{"from":{"field":"region","value":"jt"},"to":{"field":"region","value":"um"}},{"from":{"field":"region","value":"mi"},"to":{"field":"region","value":"um"}},{"from":{"field":"region","value":"nh"},"to":{"field":"region","value":"vu"}},{"from":{"field":"region","value":"nq"},"to":{"field":"region","value":"aq"}},{"from":{"field":"region","value":"pu"},"to":{"field":"region","value":"um"}},{"from":{"field":"region","value":"pz"},"to":{"field":"region","value":"pa"}},{"from":{"field":"region","value":"qu"},"to":{"field":"region","value":"eu"}},{"from":{"field":"region","value":"rh"},"to":{"field":"region","value":"zw"}},{"from":{"field":"region","value":"tp"},"to":{"field":"region","value":"tl"}},{"from":{"field":"region","value":"uk"},"to":{"field":"region","value":"gb"}},{"from":{"field":"region","value":"vd"},"to":{"field":"region","value":"vn"}},{"from":{"field":"region","value":"wk"},"to":{"field":"region","value":"um"}},{"from":{"field":"region","value":"yd"},"to":{"field":"region","value":"ye"}},{"from":{"field":"region","value":"zr"},"to":{"field":"region","value":"cd"}},{"from":{"field":"region","value":"230"},"to":{"field":"region","value":"et"}},{"from":{"field":"region","value":"280"},"to":{"field":"region","value":"de"}},{"from":{"field":"region","value":"736"},"to":{"field":"region","value":"sd"}},{"from":{"field":"region","value":"886"},"to":{"field":"region","value":"ye"}},{"from":{"field":"region","value":"958"},"to":{"field":"region","value":"aa"}},{"from":{"field":"region","value":"020"},"to":{"field":"region","value":"ad"}},{"from":{"field":"region","value":"784"},"to":{"field":"region","value":"ae"}},{"from":{"field":"region","value":"004"},"to":{"field":"region","value":"af"}},{"from":{"field":"region","value":"028"},"to":{"field":"region","value":"ag"}},{"from":{"field":"region","value":"660"},"to":{"field":"region","value":"ai"}},{"from":{"field":"region","value":"008"},"to":{"field":"region","value":"al"}},{"from":{"field":"region","value":"051"},"to":{"field":"region","value":"am"}},{"from":{"field":"region","value":"024"},"to":{"field":"region","value":"ao"}},{"from":{"field":"region","value":"010"},"to":{"field":"region","value":"aq"}},{"from":{"field":"region","value":"032"},"to":{"field":"region","value":"ar"}},{"from":{"field":"region","value":"016"},"to":{"field":"region","value":"as"}},{"from":{"field":"region","value":"040"},"to":{"field":"region","value":"at"}},{"from":{"field":"region","value":"036"},"to":{"field":"region","value":"au"}},{"from":{"field":"region","value":"533"},"to":{"field":"region","value":"aw"}},{"from":{"field":"region","value":"248"},"to":{"field":"region","value":"ax"}},{"from":{"field":"region","value":"031"},"to":{"field":"region","value":"az"}},{"from":{"field":"region","value":"070"},"to":{"field":"region","value":"ba"}},{"from":{"field":"region","value":"052"},"to":{"field":"region","value":"bb"}},{"from":{"field":"region","value":"050"},"to":{"field":"region","value":"bd"}},{"from":{"field":"region","value":"056"},"to":{"field":"region","value":"be"}},{"from":{"field":"region","value":"854"},"to":{"field":"region","value":"bf"}},{"from":{"field":"region","value":"100"},"to":{"field":"region","value":"bg"}},{"from":{"field":"region","value":"048"},"to":{"field":"region","value":"bh"}},{"from":{"field":"region","value":"108"},"to":{"field":"region","value":"bi"}},{"from":{"field":"region","value":"204"},"to":{"field":"region","value":"bj"}},{"from":{"field":"region","value":"652"},"to":{"field":"region","value":"bl"}},{"from":{"field":"region","value":"060"},"to":{"field":"region","value":"bm"}},{"from":{"field":"region","value":"096"},"to":{"field":"region","value":"bn"}},{"from":{"field":"region","value":"068"},"to":{"field":"region","value":"bo"}},{"from":{"field":"region","value":"535"},"to":{"field":"region","value":"bq"}},{"from":{"field":"region","value":"076"},"to":{"field":"region","value":"br"}},{"from":{"field":"region","value":"044"},"to":{"field":"region","value":"bs"}},{"from":{"field":"region","value":"064"},"to":{"field":"region","value":"bt"}},{"from":{"field":"region","value":"104"},"to":{"field":"region","value":"mm"}},{"from":{"field":"region","value":"074"},"to":{"field":"region","value":"bv"}},{"from":{"field":"region","value":"072"},"to":{"field":"region","value":"bw"}},{"from":{"field":"region","value":"112"},"to":{"field":"region","value":"by"}},{"from":{"field":"region","value":"084"},"to":{"field":"region","value":"bz"}},{"from":{"field":"region","value":"124"},"to":{"field":"region","value":"ca"}},{"from":{"field":"region","value":"166"},"to":{"field":"region","value":"cc"}},{"from":{"field":"region","value":"180"},"to":{"field":"region","value":"cd"}},{"from":{"field":"region","value":"140"},"to":{"field":"region","value":"cf"}},{"from":{"field":"region","value":"178"},"to":{"field":"region","value":"cg"}},{"from":{"field":"region","value":"756"},"to":{"field":"region","value":"ch"}},{"from":{"field":"region","value":"384"},"to":{"field":"region","value":"ci"}},{"from":{"field":"region","value":"184"},"to":{"field":"region","value":"ck"}},{"from":{"field":"region","value":"152"},"to":{"field":"region","value":"cl"}},{"from":{"field":"region","value":"120"},"to":{"field":"region","value":"cm"}},{"from":{"field":"region","value":"156"},"to":{"field":"region","value":"cn"}},{"from":{"field":"region","value":"170"},"to":{"field":"region","value":"co"}},{"from":{"field":"region","value":"188"},"to":{"field":"region","value":"cr"}},{"from":{"field":"region","value":"192"},"to":{"field":"region","value":"cu"}},{"from":{"field":"region","value":"132"},"to":{"field":"region","value":"cv"}},{"from":{"field":"region","value":"531"},"to":{"field":"region","value":"cw"}},{"from":{"field":"region","value":"162"},"to":{"field":"region","value":"cx"}},{"from":{"field":"region","value":"196"},"to":{"field":"region","value":"cy"}},{"from":{"field":"region","value":"203"},"to":{"field":"region","value":"cz"}},{"from":{"field":"region","value":"278"},"to":{"field":"region","value":"de"}},{"from":{"field":"region","value":"276"},"to":{"field":"region","value":"de"}},{"from":{"field":"region","value":"262"},"to":{"field":"region","value":"dj"}},{"from":{"field":"region","value":"208"},"to":{"field":"region","value":"dk"}},{"from":{"field":"region","value":"212"},"to":{"field":"region","value":"dm"}},{"from":{"field":"region","value":"214"},"to":{"field":"region","value":"do"}},{"from":{"field":"region","value":"012"},"to":{"field":"region","value":"dz"}},{"from":{"field":"region","value":"218"},"to":{"field":"region","value":"ec"}},{"from":{"field":"region","value":"233"},"to":{"field":"region","value":"ee"}},{"from":{"field":"region","value":"818"},"to":{"field":"region","value":"eg"}},{"from":{"field":"region","value":"732"},"to":{"field":"region","value":"eh"}},{"from":{"field":"region","value":"232"},"to":{"field":"region","value":"er"}},{"from":{"field":"region","value":"724"},"to":{"field":"region","value":"es"}},{"from":{"field":"region","value":"231"},"to":{"field":"region","value":"et"}},{"from":{"field":"region","value":"246"},"to":{"field":"region","value":"fi"}},{"from":{"field":"region","value":"242"},"to":{"field":"region","value":"fj"}},{"from":{"field":"region","value":"238"},"to":{"field":"region","value":"fk"}},{"from":{"field":"region","value":"583"},"to":{"field":"region","value":"fm"}},{"from":{"field":"region","value":"234"},"to":{"field":"region","value":"fo"}},{"from":{"field":"region","value":"250"},"to":{"field":"region","value":"fr"}},{"from":{"field":"region","value":"249"},"to":{"field":"region","value":"fr"}},{"from":{"field":"region","value":"266"},"to":{"field":"region","value":"ga"}},{"from":{"field":"region","value":"826"},"to":{"field":"region","value":"gb"}},{"from":{"field":"region","value":"308"},"to":{"field":"region","value":"gd"}},{"from":{"field":"region","value":"268"},"to":{"field":"region","value":"ge"}},{"from":{"field":"region","value":"254"},"to":{"field":"region","value":"gf"}},{"from":{"field":"region","value":"831"},"to":{"field":"region","value":"gg"}},{"from":{"field":"region","value":"288"},"to":{"field":"region","value":"gh"}},{"from":{"field":"region","value":"292"},"to":{"field":"region","value":"gi"}},{"from":{"field":"region","value":"304"},"to":{"field":"region","value":"gl"}},{"from":{"field":"region","value":"270"},"to":{"field":"region","value":"gm"}},{"from":{"field":"region","value":"324"},"to":{"field":"region","value":"gn"}},{"from":{"field":"region","value":"312"},"to":{"field":"region","value":"gp"}},{"from":{"field":"region","value":"226"},"to":{"field":"region","value":"gq"}},{"from":{"field":"region","value":"300"},"to":{"field":"region","value":"gr"}},{"from":{"field":"region","value":"239"},"to":{"field":"region","value":"gs"}},{"from":{"field":"region","value":"320"},"to":{"field":"region","value":"gt"}},{"from":{"field":"region","value":"316"},"to":{"field":"region","value":"gu"}},{"from":{"field":"region","value":"624"},"to":{"field":"region","value":"gw"}},{"from":{"field":"region","value":"328"},"to":{"field":"region","value":"gy"}},{"from":{"field":"region","value":"344"},"to":{"field":"region","value":"hk"}},{"from":{"field":"region","value":"334"},"to":{"field":"region","value":"hm"}},{"from":{"field":"region","value":"340"},"to":{"field":"region","value":"hn"}},{"from":{"field":"region","value":"191"},"to":{"field":"region","value":"hr"}},{"from":{"field":"region","value":"332"},"to":{"field":"region","value":"ht"}},{"from":{"field":"region","value":"348"},"to":{"field":"region","value":"hu"}},{"from":{"field":"region","value":"360"},"to":{"field":"region","value":"id"}},{"from":{"field":"region","value":"372"},"to":{"field":"region","value":"ie"}},{"from":{"field":"region","value":"376"},"to":{"field":"region","value":"il"}},{"from":{"field":"region","value":"833"},"to":{"field":"region","value":"im"}},{"from":{"field":"region","value":"356"},"to":{"field":"region","value":"in"}},{"from":{"field":"region","value":"086"},"to":{"field":"region","value":"io"}},{"from":{"field":"region","value":"368"},"to":{"field":"region","value":"iq"}},{"from":{"field":"region","value":"364"},"to":{"field":"region","value":"ir"}},{"from":{"field":"region","value":"352"},"to":{"field":"region","value":"is"}},{"from":{"field":"region","value":"380"},"to":{"field":"region","value":"it"}},{"from":{"field":"region","value":"832"},"to":{"field":"region","value":"je"}},{"from":{"field":"region","value":"388"},"to":{"field":"region","value":"jm"}},{"from":{"field":"region","value":"400"},"to":{"field":"region","value":"jo"}},{"from":{"field":"region","value":"392"},"to":{"field":"region","value":"jp"}},{"from":{"field":"region","value":"404"},"to":{"field":"region","value":"ke"}},{"from":{"field":"region","value":"417"},"to":{"field":"region","value":"kg"}},{"from":{"field":"region","value":"116"},"to":{"field":"region","value":"kh"}},{"from":{"field":"region","value":"296"},"to":{"field":"region","value":"ki"}},{"from":{"field":"region","value":"174"},"to":{"field":"region","value":"km"}},{"from":{"field":"region","value":"659"},"to":{"field":"region","value":"kn"}},{"from":{"field":"region","value":"408"},"to":{"field":"region","value":"kp"}},{"from":{"field":"region","value":"410"},"to":{"field":"region","value":"kr"}},{"from":{"field":"region","value":"414"},"to":{"field":"region","value":"kw"}},{"from":{"field":"region","value":"136"},"to":{"field":"region","value":"ky"}},{"from":{"field":"region","value":"398"},"to":{"field":"region","value":"kz"}},{"from":{"field":"region","value":"418"},"to":{"field":"region","value":"la"}},{"from":{"field":"region","value":"422"},"to":{"field":"region","value":"lb"}},{"from":{"field":"region","value":"662"},"to":{"field":"region","value":"lc"}},{"from":{"field":"region","value":"438"},"to":{"field":"region","value":"li"}},{"from":{"field":"region","value":"144"},"to":{"field":"region","value":"lk"}},{"from":{"field":"region","value":"430"},"to":{"field":"region","value":"lr"}},{"from":{"field":"region","value":"426"},"to":{"field":"region","value":"ls"}},{"from":{"field":"region","value":"440"},"to":{"field":"region","value":"lt"}},{"from":{"field":"region","value":"442"},"to":{"field":"region","value":"lu"}},{"from":{"field":"region","value":"428"},"to":{"field":"region","value":"lv"}},{"from":{"field":"region","value":"434"},"to":{"field":"region","value":"ly"}},{"from":{"field":"region","value":"504"},"to":{"field":"region","value":"ma"}},{"from":{"field":"region","value":"492"},"to":{"field":"region","value":"mc"}},{"from":{"field":"region","value":"498"},"to":{"field":"region","value":"md"}},{"from":{"field":"region","value":"499"},"to":{"field":"region","value":"me"}},{"from":{"field":"region","value":"663"},"to":{"field":"region","value":"mf"}},{"from":{"field":"region","value":"450"},"to":{"field":"region","value":"mg"}},{"from":{"field":"region","value":"584"},"to":{"field":"region","value":"mh"}},{"from":{"field":"region","value":"807"},"to":{"field":"region","value":"mk"}},{"from":{"field":"region","value":"466"},"to":{"field":"region","value":"ml"}},{"from":{"field":"region","value":"496"},"to":{"field":"region","value":"mn"}},{"from":{"field":"region","value":"446"},"to":{"field":"region","value":"mo"}},{"from":{"field":"region","value":"580"},"to":{"field":"region","value":"mp"}},{"from":{"field":"region","value":"474"},"to":{"field":"region","value":"mq"}},{"from":{"field":"region","value":"478"},"to":{"field":"region","value":"mr"}},{"from":{"field":"region","value":"500"},"to":{"field":"region","value":"ms"}},{"from":{"field":"region","value":"470"},"to":{"field":"region","value":"mt"}},{"from":{"field":"region","value":"480"},"to":{"field":"region","value":"mu"}},{"from":{"field":"region","value":"462"},"to":{"field":"region","value":"mv"}},{"from":{"field":"region","value":"454"},"to":{"field":"region","value":"mw"}},{"from":{"field":"region","value":"484"},"to":{"field":"region","value":"mx"}},{"from":{"field":"region","value":"458"},"to":{"field":"region","value":"my"}},{"from":{"field":"region","value":"508"},"to":{"field":"region","value":"mz"}},{"from":{"field":"region","value":"516"},"to":{"field":"region","value":"na"}},{"from":{"field":"region","value":"540"},"to":{"field":"region","value":"nc"}},{"from":{"field":"region","value":"562"},"to":{"field":"region","value":"ne"}},{"from":{"field":"region","value":"574"},"to":{"field":"region","value":"nf"}},{"from":{"field":"region","value":"566"},"to":{"field":"region","value":"ng"}},{"from":{"field":"region","value":"558"},"to":{"field":"region","value":"ni"}},{"from":{"field":"region","value":"528"},"to":{"field":"region","value":"nl"}},{"from":{"field":"region","value":"578"},"to":{"field":"region","value":"no"}},{"from":{"field":"region","value":"524"},"to":{"field":"region","value":"np"}},{"from":{"field":"region","value":"520"},"to":{"field":"region","value":"nr"}},{"from":{"field":"region","value":"570"},"to":{"field":"region","value":"nu"}},{"from":{"field":"region","value":"554"},"to":{"field":"region","value":"nz"}},{"from":{"field":"region","value":"512"},"to":{"field":"region","value":"om"}},{"from":{"field":"region","value":"591"},"to":{"field":"region","value":"pa"}},{"from":{"field":"region","value":"604"},"to":{"field":"region","value":"pe"}},{"from":{"field":"region","value":"258"},"to":{"field":"region","value":"pf"}},{"from":{"field":"region","value":"598"},"to":{"field":"region","value":"pg"}},{"from":{"field":"region","value":"608"},"to":{"field":"region","value":"ph"}},{"from":{"field":"region","value":"586"},"to":{"field":"region","value":"pk"}},{"from":{"field":"region","value":"616"},"to":{"field":"region","value":"pl"}},{"from":{"field":"region","value":"666"},"to":{"field":"region","value":"pm"}},{"from":{"field":"region","value":"612"},"to":{"field":"region","value":"pn"}},{"from":{"field":"region","value":"630"},"to":{"field":"region","value":"pr"}},{"from":{"field":"region","value":"275"},"to":{"field":"region","value":"ps"}},{"from":{"field":"region","value":"620"},"to":{"field":"region","value":"pt"}},{"from":{"field":"region","value":"585"},"to":{"field":"region","value":"pw"}},{"from":{"field":"region","value":"600"},"to":{"field":"region","value":"py"}},{"from":{"field":"region","value":"634"},"to":{"field":"region","value":"qa"}},{"from":{"field":"region","value":"959"},"to":{"field":"region","value":"qm"}},{"from":{"field":"region","value":"960"},"to":{"field":"region","value":"qn"}},{"from":{"field":"region","value":"962"},"to":{"field":"region","value":"qp"}},{"from":{"field":"region","value":"963"},"to":{"field":"region","value":"qq"}},{"from":{"field":"region","value":"964"},"to":{"field":"region","value":"qr"}},{"from":{"field":"region","value":"965"},"to":{"field":"region","value":"qs"}},{"from":{"field":"region","value":"966"},"to":{"field":"region","value":"qt"}},{"from":{"field":"region","value":"967"},"to":{"field":"region","value":"eu"}},{"from":{"field":"region","value":"968"},"to":{"field":"region","value":"qv"}},{"from":{"field":"region","value":"969"},"to":{"field":"region","value":"qw"}},{"from":{"field":"region","value":"970"},"to":{"field":"region","value":"qx"}},{"from":{"field":"region","value":"971"},"to":{"field":"region","value":"qy"}},{"from":{"field":"region","value":"972"},"to":{"field":"region","value":"qz"}},{"from":{"field":"region","value":"638"},"to":{"field":"region","value":"re"}},{"from":{"field":"region","value":"642"},"to":{"field":"region","value":"ro"}},{"from":{"field":"region","value":"688"},"to":{"field":"region","value":"rs"}},{"from":{"field":"region","value":"643"},"to":{"field":"region","value":"ru"}},{"from":{"field":"region","value":"646"},"to":{"field":"region","value":"rw"}},{"from":{"field":"region","value":"682"},"to":{"field":"region","value":"sa"}},{"from":{"field":"region","value":"090"},"to":{"field":"region","value":"sb"}},{"from":{"field":"region","value":"690"},"to":{"field":"region","value":"sc"}},{"from":{"field":"region","value":"729"},"to":{"field":"region","value":"sd"}},{"from":{"field":"region","value":"752"},"to":{"field":"region","value":"se"}},{"from":{"field":"region","value":"702"},"to":{"field":"region","value":"sg"}},{"from":{"field":"region","value":"654"},"to":{"field":"region","value":"sh"}},{"from":{"field":"region","value":"705"},"to":{"field":"region","value":"si"}},{"from":{"field":"region","value":"744"},"to":{"field":"region","value":"sj"}},{"from":{"field":"region","value":"703"},"to":{"field":"region","value":"sk"}},{"from":{"field":"region","value":"694"},"to":{"field":"region","value":"sl"}},{"from":{"field":"region","value":"674"},"to":{"field":"region","value":"sm"}},{"from":{"field":"region","value":"686"},"to":{"field":"region","value":"sn"}},{"from":{"field":"region","value":"706"},"to":{"field":"region","value":"so"}},{"from":{"field":"region","value":"740"},"to":{"field":"region","value":"sr"}},{"from":{"field":"region","value":"728"},"to":{"field":"region","value":"ss"}},{"from":{"field":"region","value":"678"},"to":{"field":"region","value":"st"}},{"from":{"field":"region","value":"222"},"to":{"field":"region","value":"sv"}},{"from":{"field":"region","value":"534"},"to":{"field":"region","value":"sx"}},{"from":{"field":"region","value":"760"},"to":{"field":"region","value":"sy"}},{"from":{"field":"region","value":"748"},"to":{"field":"region","value":"sz"}},{"from":{"field":"region","value":"796"},"to":{"field":"region","value":"tc"}},{"from":{"field":"region","value":"148"},"to":{"field":"region","value":"td"}},{"from":{"field":"region","value":"260"},"to":{"field":"region","value":"tf"}},{"from":{"field":"region","value":"768"},"to":{"field":"region","value":"tg"}},{"from":{"field":"region","value":"764"},"to":{"field":"region","value":"th"}},{"from":{"field":"region","value":"762"},"to":{"field":"region","value":"tj"}},{"from":{"field":"region","value":"772"},"to":{"field":"region","value":"tk"}},{"from":{"field":"region","value":"626"},"to":{"field":"region","value":"tl"}},{"from":{"field":"region","value":"795"},"to":{"field":"region","value":"tm"}},{"from":{"field":"region","value":"788"},"to":{"field":"region","value":"tn"}},{"from":{"field":"region","value":"776"},"to":{"field":"region","value":"to"}},{"from":{"field":"region","value":"792"},"to":{"field":"region","value":"tr"}},{"from":{"field":"region","value":"780"},"to":{"field":"region","value":"tt"}},{"from":{"field":"region","value":"798"},"to":{"field":"region","value":"tv"}},{"from":{"field":"region","value":"158"},"to":{"field":"region","value":"tw"}},{"from":{"field":"region","value":"834"},"to":{"field":"region","value":"tz"}},{"from":{"field":"region","value":"804"},"to":{"field":"region","value":"ua"}},{"from":{"field":"region","value":"800"},"to":{"field":"region","value":"ug"}},{"from":{"field":"region","value":"581"},"to":{"field":"region","value":"um"}},{"from":{"field":"region","value":"840"},"to":{"field":"region","value":"us"}},{"from":{"field":"region","value":"858"},"to":{"field":"region","value":"uy"}},{"from":{"field":"region","value":"860"},"to":{"field":"region","value":"uz"}},{"from":{"field":"region","value":"336"},"to":{"field":"region","value":"va"}},{"from":{"field":"region","value":"670"},"to":{"field":"region","value":"vc"}},{"from":{"field":"region","value":"862"},"to":{"field":"region","value":"ve"}},{"from":{"field":"region","value":"092"},"to":{"field":"region","value":"vg"}},{"from":{"field":"region","value":"850"},"to":{"field":"region","value":"vi"}},{"from":{"field":"region","value":"704"},"to":{"field":"region","value":"vn"}},{"from":{"field":"region","value":"548"},"to":{"field":"region","value":"vu"}},{"from":{"field":"region","value":"876"},"to":{"field":"region","value":"wf"}},{"from":{"field":"region","value":"882"},"to":{"field":"region","value":"ws"}},{"from":{"field":"region","value":"973"},"to":{"field":"region","value":"xa"}},{"from":{"field":"region","value":"974"},"to":{"field":"region","value":"xb"}},{"from":{"field":"region","value":"975"},"to":{"field":"region","value":"xc"}},{"from":{"field":"region","value":"976"},"to":{"field":"region","value":"xd"}},{"from":{"field":"region","value":"977"},"to":{"field":"region","value":"xe"}},{"from":{"field":"region","value":"978"},"to":{"field":"region","value":"xf"}},{"from":{"field":"region","value":"979"},"to":{"field":"region","value":"xg"}},{"from":{"field":"region","value":"980"},"to":{"field":"region","value":"xh"}},{"from":{"field":"region","value":"981"},"to":{"field":"region","value":"xi"}},{"from":{"field":"region","value":"982"},"to":{"field":"region","value":"xj"}},{"from":{"field":"region","value":"983"},"to":{"field":"region","value":"xk"}},{"from":{"field":"region","value":"984"},"to":{"field":"region","value":"xl"}},{"from":{"field":"region","value":"985"},"to":{"field":"region","value":"xm"}},{"from":{"field":"region","value":"986"},"to":{"field":"region","value":"xn"}},{"from":{"field":"region","value":"987"},"to":{"field":"region","value":"xo"}},{"from":{"field":"region","value":"988"},"to":{"field":"region","value":"xp"}},{"from":{"field":"region","value":"989"},"to":{"field":"region","value":"xq"}},{"from":{"field":"region","value":"990"},"to":{"field":"region","value":"xr"}},{"from":{"field":"region","value":"991"},"to":{"field":"region","value":"xs"}},{"from":{"field":"region","value":"992"},"to":{"field":"region","value":"xt"}},{"from":{"field":"region","value":"993"},"to":{"field":"region","value":"xu"}},{"from":{"field":"region","value":"994"},"to":{"field":"region","value":"xv"}},{"from":{"field":"region","value":"995"},"to":{"field":"region","value":"xw"}},{"from":{"field":"region","value":"996"},"to":{"field":"region","value":"xx"}},{"from":{"field":"region","value":"997"},"to":{"field":"region","value":"xy"}},{"from":{"field":"region","value":"998"},"to":{"field":"region","value":"xz"}},{"from":{"field":"region","value":"720"},"to":{"field":"region","value":"ye"}},{"from":{"field":"region","value":"887"},"to":{"field":"region","value":"ye"}},{"from":{"field":"region","value":"175"},"to":{"field":"region","value":"yt"}},{"from":{"field":"region","value":"710"},"to":{"field":"region","value":"za"}},{"from":{"field":"region","value":"894"},"to":{"field":"region","value":"zm"}},{"from":{"field":"region","value":"716"},"to":{"field":"region","value":"zw"}},{"from":{"field":"region","value":"999"},"to":{"field":"region","value":"zz"}},{"from":{"field":"variants","value":"aaland"},"to":{"field":"region","value":"ax"}},{"from":{"field":"variants","value":"polytoni"},"to":{"field":"variants","value":"polyton"}},{"from":{"field":"variants","value":"heploc"},"to":{"field":"variants","value":"alalc97"}},{"from":{"field":"variants","value":"arevela"},"to":{"field":"language","value":"hy"}},{"from":{"field":"variants","value":"arevmda"},"to":{"field":"language","value":"hyw"}}]')},9460:function(e){e.exports=JSON.parse('{"region":{"172":["ru","am","az","by","ge","kg","kz","md","tj","tm","ua","uz"],"200":["cz","sk"],"530":["cw","sx","bq"],"532":["cw","sx","bq"],"536":["sa","iq"],"582":["fm","mh","mp","pw"],"810":["ru","am","az","by","ee","ge","kz","kg","lv","lt","md","tj","tm","ua","uz"],"830":["je","gg"],"890":["rs","me","si","hr","mk","ba"],"891":["rs","me"],"an":["cw","sx","bq"],"cs":["rs","me"],"fq":["aq","tf"],"nt":["sa","iq"],"pc":["fm","mh","mp","pw"],"su":["ru","am","az","by","ee","ge","kz","kg","lv","lt","md","tj","tm","ua","uz"],"yu":["rs","me"],"062":["034","143"],"ant":["cw","sx","bq"],"scg":["rs","me"],"ntz":["sa","iq"],"sun":["ru","am","az","by","ee","ge","kz","kg","lv","lt","md","tj","tm","ua","uz"],"yug":["rs","me"]}}')},7778:function(e){e.exports=JSON.parse('[{"from":"in","to":"id"},{"from":"iw","to":"he"},{"from":"ji","to":"yi"},{"from":"jw","to":"jv"},{"from":"mo","to":"ro"},{"from":"scc","to":"sr"},{"from":"scr","to":"hr"},{"from":"aam","to":"aas"},{"from":"adp","to":"dz"},{"from":"aue","to":"ktz"},{"from":"ayx","to":"nun"},{"from":"bgm","to":"bcg"},{"from":"bjd","to":"drl"},{"from":"ccq","to":"rki"},{"from":"cjr","to":"mom"},{"from":"cka","to":"cmr"},{"from":"cmk","to":"xch"},{"from":"coy","to":"pij"},{"from":"cqu","to":"quh"},{"from":"drh","to":"mn"},{"from":"drw","to":"fa-af"},{"from":"gav","to":"dev"},{"from":"gfx","to":"vaj"},{"from":"ggn","to":"gvr"},{"from":"gti","to":"nyc"},{"from":"guv","to":"duz"},{"from":"hrr","to":"jal"},{"from":"ibi","to":"opa"},{"from":"ilw","to":"gal"},{"from":"jeg","to":"oyb"},{"from":"kgc","to":"tdf"},{"from":"kgh","to":"kml"},{"from":"koj","to":"kwv"},{"from":"krm","to":"bmf"},{"from":"ktr","to":"dtp"},{"from":"kvs","to":"gdj"},{"from":"kwq","to":"yam"},{"from":"kxe","to":"tvd"},{"from":"kzj","to":"dtp"},{"from":"kzt","to":"dtp"},{"from":"lii","to":"raq"},{"from":"lmm","to":"rmx"},{"from":"meg","to":"cir"},{"from":"mst","to":"mry"},{"from":"mwj","to":"vaj"},{"from":"myt","to":"mry"},{"from":"nad","to":"xny"},{"from":"ncp","to":"kdz"},{"from":"nnx","to":"ngv"},{"from":"nts","to":"pij"},{"from":"oun","to":"vaj"},{"from":"pcr","to":"adx"},{"from":"pmc","to":"huw"},{"from":"pmu","to":"phr"},{"from":"ppa","to":"bfy"},{"from":"ppr","to":"lcq"},{"from":"pry","to":"prt"},{"from":"puz","to":"pub"},{"from":"sca","to":"hle"},{"from":"skk","to":"oyb"},{"from":"tdu","to":"dtp"},{"from":"thc","to":"tpo"},{"from":"thx","to":"oyb"},{"from":"tie","to":"ras"},{"from":"tkk","to":"twm"},{"from":"tlw","to":"weo"},{"from":"tmp","to":"tyj"},{"from":"tne","to":"kak"},{"from":"tnf","to":"fa-af"},{"from":"tsf","to":"taj"},{"from":"uok","to":"ema"},{"from":"xba","to":"cax"},{"from":"xia","to":"acn"},{"from":"xkh","to":"waw"},{"from":"xsj","to":"suj"},{"from":"ybd","to":"rki"},{"from":"yma","to":"lrr"},{"from":"ymt","to":"mtm"},{"from":"yos","to":"zom"},{"from":"yuu","to":"yug"},{"from":"asd","to":"snz"},{"from":"dit","to":"dif"},{"from":"llo","to":"ngt"},{"from":"myd","to":"aog"},{"from":"nns","to":"nbr"},{"from":"sgn-br","to":"bzs"},{"from":"sgn-co","to":"csn"},{"from":"sgn-de","to":"gsg"},{"from":"sgn-dk","to":"dsl"},{"from":"sgn-fr","to":"fsl"},{"from":"sgn-gb","to":"bfi"},{"from":"sgn-gr","to":"gss"},{"from":"sgn-ie","to":"isg"},{"from":"sgn-it","to":"ise"},{"from":"sgn-jp","to":"jsl"},{"from":"sgn-mx","to":"mfs"},{"from":"sgn-ni","to":"ncs"},{"from":"sgn-nl","to":"dse"},{"from":"sgn-no","to":"nsi"},{"from":"sgn-pt","to":"psr"},{"from":"sgn-se","to":"swl"},{"from":"sgn-us","to":"ase"},{"from":"sgn-za","to":"sfs"},{"from":"no-bokmal","to":"nb"},{"from":"no-nynorsk","to":"nn"},{"from":"aa-saaho","to":"ssy"},{"from":"sh","to":"sr-latn"},{"from":"cnr","to":"sr-me"},{"from":"no","to":"nb"},{"from":"tl","to":"fil"},{"from":"az-az","to":"az-latn-az"},{"from":"bs-ba","to":"bs-latn-ba"},{"from":"ha-latn-gh","to":"ha-gh"},{"from":"ha-latn-ne","to":"ha-ne"},{"from":"ha-latn-ng","to":"ha-ng"},{"from":"kk-cyrl-kz","to":"kk-kz"},{"from":"ky-cyrl-kg","to":"ky-kg"},{"from":"ks-arab-in","to":"ks-in"},{"from":"mn-cyrl-mn","to":"mn-mn"},{"from":"ms-latn-bn","to":"ms-bn"},{"from":"ms-latn-my","to":"ms-my"},{"from":"ms-latn-sg","to":"ms-sg"},{"from":"pa-in","to":"pa-guru-in"},{"from":"pa-pk","to":"pa-arab-pk"},{"from":"shi-ma","to":"shi-tfng-ma"},{"from":"sr-ba","to":"sr-cyrl-ba"},{"from":"sr-me","to":"sr-latn-me"},{"from":"sr-rs","to":"sr-cyrl-rs"},{"from":"sr-xk","to":"sr-cyrl-xk"},{"from":"tzm-latn-ma","to":"tzm-ma"},{"from":"ug-arab-cn","to":"ug-cn"},{"from":"uz-af","to":"uz-arab-af"},{"from":"uz-uz","to":"uz-latn-uz"},{"from":"vai-lr","to":"vai-vaii-lr"},{"from":"yue-cn","to":"yue-hans-cn"},{"from":"yue-hk","to":"yue-hant-hk"},{"from":"zh-cn","to":"zh-hans-cn"},{"from":"zh-hk","to":"zh-hant-hk"},{"from":"zh-mo","to":"zh-hant-mo"},{"from":"zh-sg","to":"zh-hans-sg"},{"from":"zh-tw","to":"zh-hant-tw"},{"from":"aju","to":"jrb"},{"from":"als","to":"sq"},{"from":"arb","to":"ar"},{"from":"ayr","to":"ay"},{"from":"azj","to":"az"},{"from":"bcc","to":"bal"},{"from":"bcl","to":"bik"},{"from":"bxk","to":"luy"},{"from":"bxr","to":"bua"},{"from":"cld","to":"syr"},{"from":"cmn","to":"zh"},{"from":"cwd","to":"cr"},{"from":"dgo","to":"doi"},{"from":"dhd","to":"mwr"},{"from":"dik","to":"din"},{"from":"diq","to":"zza"},{"from":"lbk","to":"bnc"},{"from":"ekk","to":"et"},{"from":"emk","to":"man"},{"from":"esk","to":"ik"},{"from":"fat","to":"ak"},{"from":"fuc","to":"ff"},{"from":"gaz","to":"om"},{"from":"gbo","to":"grb"},{"from":"gno","to":"gon"},{"from":"gug","to":"gn"},{"from":"gya","to":"gba"},{"from":"hdn","to":"hai"},{"from":"hea","to":"hmn"},{"from":"ike","to":"iu"},{"from":"kmr","to":"ku"},{"from":"knc","to":"kr"},{"from":"kng","to":"kg"},{"from":"knn","to":"kok"},{"from":"kpv","to":"kv"},{"from":"lvs","to":"lv"},{"from":"mhr","to":"chm"},{"from":"mup","to":"raj"},{"from":"khk","to":"mn"},{"from":"npi","to":"ne"},{"from":"ojg","to":"oj"},{"from":"ory","to":"or"},{"from":"pbu","to":"ps"},{"from":"pes","to":"fa"},{"from":"plt","to":"mg"},{"from":"pnb","to":"lah"},{"from":"quz","to":"qu"},{"from":"rmy","to":"rom"},{"from":"spy","to":"kln"},{"from":"src","to":"sc"},{"from":"swh","to":"sw"},{"from":"ttq","to":"tmh"},{"from":"tw","to":"ak"},{"from":"umu","to":"del"},{"from":"uzn","to":"uz"},{"from":"xpe","to":"kpe"},{"from":"xsl","to":"den"},{"from":"ydd","to":"yi"},{"from":"zai","to":"zap"},{"from":"zsm","to":"ms"},{"from":"zyb","to":"za"},{"from":"him","to":"srx"},{"from":"mnk","to":"man"},{"from":"bh","to":"bho"},{"from":"prs","to":"fa-af"},{"from":"swc","to":"sw-cd"},{"from":"aar","to":"aa"},{"from":"abk","to":"ab"},{"from":"ave","to":"ae"},{"from":"afr","to":"af"},{"from":"aka","to":"ak"},{"from":"amh","to":"am"},{"from":"arg","to":"an"},{"from":"ara","to":"ar"},{"from":"asm","to":"as"},{"from":"ava","to":"av"},{"from":"aym","to":"ay"},{"from":"aze","to":"az"},{"from":"bak","to":"ba"},{"from":"bel","to":"be"},{"from":"bul","to":"bg"},{"from":"bih","to":"bho"},{"from":"bis","to":"bi"},{"from":"bam","to":"bm"},{"from":"ben","to":"bn"},{"from":"bod","to":"bo"},{"from":"bre","to":"br"},{"from":"bos","to":"bs"},{"from":"cat","to":"ca"},{"from":"che","to":"ce"},{"from":"cha","to":"ch"},{"from":"cos","to":"co"},{"from":"cre","to":"cr"},{"from":"ces","to":"cs"},{"from":"chu","to":"cu"},{"from":"chv","to":"cv"},{"from":"cym","to":"cy"},{"from":"dan","to":"da"},{"from":"deu","to":"de"},{"from":"div","to":"dv"},{"from":"dzo","to":"dz"},{"from":"ewe","to":"ee"},{"from":"ell","to":"el"},{"from":"eng","to":"en"},{"from":"epo","to":"eo"},{"from":"spa","to":"es"},{"from":"est","to":"et"},{"from":"eus","to":"eu"},{"from":"fas","to":"fa"},{"from":"ful","to":"ff"},{"from":"fin","to":"fi"},{"from":"fij","to":"fj"},{"from":"fao","to":"fo"},{"from":"fra","to":"fr"},{"from":"fry","to":"fy"},{"from":"gle","to":"ga"},{"from":"gla","to":"gd"},{"from":"glg","to":"gl"},{"from":"grn","to":"gn"},{"from":"guj","to":"gu"},{"from":"glv","to":"gv"},{"from":"hau","to":"ha"},{"from":"heb","to":"he"},{"from":"hin","to":"hi"},{"from":"hmo","to":"ho"},{"from":"hrv","to":"hr"},{"from":"hat","to":"ht"},{"from":"hun","to":"hu"},{"from":"hye","to":"hy"},{"from":"her","to":"hz"},{"from":"ina","to":"ia"},{"from":"ind","to":"id"},{"from":"ile","to":"ie"},{"from":"ibo","to":"ig"},{"from":"iii","to":"ii"},{"from":"ipk","to":"ik"},{"from":"ido","to":"io"},{"from":"isl","to":"is"},{"from":"ita","to":"it"},{"from":"iku","to":"iu"},{"from":"jpn","to":"ja"},{"from":"jav","to":"jv"},{"from":"kat","to":"ka"},{"from":"kon","to":"kg"},{"from":"kik","to":"ki"},{"from":"kua","to":"kj"},{"from":"kaz","to":"kk"},{"from":"kal","to":"kl"},{"from":"khm","to":"km"},{"from":"kan","to":"kn"},{"from":"kor","to":"ko"},{"from":"kau","to":"kr"},{"from":"kas","to":"ks"},{"from":"kur","to":"ku"},{"from":"kom","to":"kv"},{"from":"cor","to":"kw"},{"from":"kir","to":"ky"},{"from":"lat","to":"la"},{"from":"ltz","to":"lb"},{"from":"lug","to":"lg"},{"from":"lim","to":"li"},{"from":"lin","to":"ln"},{"from":"lao","to":"lo"},{"from":"lit","to":"lt"},{"from":"lub","to":"lu"},{"from":"lav","to":"lv"},{"from":"mlg","to":"mg"},{"from":"mah","to":"mh"},{"from":"mri","to":"mi"},{"from":"mkd","to":"mk"},{"from":"mal","to":"ml"},{"from":"mon","to":"mn"},{"from":"mol","to":"ro"},{"from":"mar","to":"mr"},{"from":"msa","to":"ms"},{"from":"mlt","to":"mt"},{"from":"mya","to":"my"},{"from":"nau","to":"na"},{"from":"nob","to":"nb"},{"from":"nde","to":"nd"},{"from":"nep","to":"ne"},{"from":"ndo","to":"ng"},{"from":"nld","to":"nl"},{"from":"nno","to":"nn"},{"from":"nor","to":"nb"},{"from":"nbl","to":"nr"},{"from":"nav","to":"nv"},{"from":"nya","to":"ny"},{"from":"oci","to":"oc"},{"from":"oji","to":"oj"},{"from":"orm","to":"om"},{"from":"ori","to":"or"},{"from":"oss","to":"os"},{"from":"pan","to":"pa"},{"from":"pli","to":"pi"},{"from":"pol","to":"pl"},{"from":"pus","to":"ps"},{"from":"por","to":"pt"},{"from":"que","to":"qu"},{"from":"roh","to":"rm"},{"from":"run","to":"rn"},{"from":"ron","to":"ro"},{"from":"rus","to":"ru"},{"from":"kin","to":"rw"},{"from":"san","to":"sa"},{"from":"srd","to":"sc"},{"from":"snd","to":"sd"},{"from":"sme","to":"se"},{"from":"sag","to":"sg"},{"from":"hbs","to":"sr-latn"},{"from":"sin","to":"si"},{"from":"slk","to":"sk"},{"from":"slv","to":"sl"},{"from":"smo","to":"sm"},{"from":"sna","to":"sn"},{"from":"som","to":"so"},{"from":"sqi","to":"sq"},{"from":"srp","to":"sr"},{"from":"ssw","to":"ss"},{"from":"sot","to":"st"},{"from":"sun","to":"su"},{"from":"swe","to":"sv"},{"from":"swa","to":"sw"},{"from":"tam","to":"ta"},{"from":"tel","to":"te"},{"from":"tgk","to":"tg"},{"from":"tha","to":"th"},{"from":"tir","to":"ti"},{"from":"tuk","to":"tk"},{"from":"tgl","to":"fil"},{"from":"tsn","to":"tn"},{"from":"ton","to":"to"},{"from":"tur","to":"tr"},{"from":"tso","to":"ts"},{"from":"tat","to":"tt"},{"from":"twi","to":"ak"},{"from":"tah","to":"ty"},{"from":"uig","to":"ug"},{"from":"ukr","to":"uk"},{"from":"urd","to":"ur"},{"from":"uzb","to":"uz"},{"from":"ven","to":"ve"},{"from":"vie","to":"vi"},{"from":"vol","to":"vo"},{"from":"wln","to":"wa"},{"from":"wol","to":"wo"},{"from":"xho","to":"xh"},{"from":"yid","to":"yi"},{"from":"yor","to":"yo"},{"from":"zha","to":"za"},{"from":"zho","to":"zh"},{"from":"zul","to":"zu"},{"from":"alb","to":"sq"},{"from":"arm","to":"hy"},{"from":"baq","to":"eu"},{"from":"bur","to":"my"},{"from":"chi","to":"zh"},{"from":"cze","to":"cs"},{"from":"dut","to":"nl"},{"from":"fre","to":"fr"},{"from":"geo","to":"ka"},{"from":"ger","to":"de"},{"from":"gre","to":"el"},{"from":"ice","to":"is"},{"from":"mac","to":"mk"},{"from":"mao","to":"mi"},{"from":"may","to":"ms"},{"from":"per","to":"fa"},{"from":"rum","to":"ro"},{"from":"slo","to":"sk"},{"from":"tib","to":"bo"},{"from":"wel","to":"cy"}]')},8589:function(e){e.exports=JSON.parse('{"en-gb-oed":"en-GB-oxendict","i-ami":"ami","i-bnn":"bnn","i-default":null,"i-enochian":null,"i-hak":"hak","i-klingon":"tlh","i-lux":"lb","i-mingo":null,"i-navajo":"nv","i-pwn":"pwn","i-tao":"tao","i-tay":"tay","i-tsu":"tsu","sgn-be-fr":"sfb","sgn-be-nl":"vgt","sgn-ch-de":"sgg","art-lojban":"jbo","cel-gaulish":null,"no-bok":"nb","no-nyn":"nn","zh-guoyu":"cmn","zh-hakka":"hak","zh-min":null,"zh-min-nan":"nan","zh-xiang":"hsn"}')},858:function(e){e.exports=JSON.parse('["art-lojban","cel-gaulish","no-bok","no-nyn","zh-guoyu","zh-hakka","zh-min","zh-min-nan","zh-xiang"]')}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,r),a.exports}r.amdO={},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,{a:t}),t},r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};var n={};return function(){r.d(n,{default:function(){return c}}),r(8416);var e,t=r(1715),i=r(8080),a=r(1737),o=r(1139),s=function(){var e,t="application/dash+xml";function r(r,n,i){if(!r||!/^VIDEO$/i.test(r.nodeName))return null;if(r._dashjs_player)return r._dashjs_player;var a,s=r.id||r.name||"video element";if(!(n=n||[].slice.call(r.querySelectorAll("source")).filter((function(e){return e.type==t}))[0])&&r.src)(n=document.createElement("source")).src=r.src;else if(!n&&!r.src)return null;return i=i||{},(a=(0,o.Z)(i).create()).initialize(r,n.src,r.autoplay),e||(e=a.getDebug().getLogger()),e.debug("Converted "+s+" to dash.js player and added content: "+n.src),r._dashjs_player=a,a}function n(e){return/^VIDEO$/i.test(e.nodeName)?e:n(e.parentNode)}return{create:r,createAll:function(e,i){var a=[];e=e||"[data-dashjs-player]";for(var o=(i=i||document).querySelectorAll(e),s=0;s<o.length;s++){var l=r(o[s],null);a.push(l)}for(var u=i.querySelectorAll('source[type="'+t+'"]'),c=0;c<u.length;c++){var f=r(n(u[c]),null);a.push(f)}return a}}}();!("undefined"!=typeof window&&window&&window.dashjs&&window.dashjs.skipAutoCreate)&&"undefined"!=typeof window&&window&&window.addEventListener&&("complete"===window.document.readyState?window.dashjs?s.createAll():e=window.setInterval((function(){window.dashjs&&(window.clearInterval(e),s.createAll())}),500):window.addEventListener("load",(function e(){window.removeEventListener("load",e),s.createAll()})));var l=s,u=r(6398);dashjs.Protection=a.default,dashjs.MetricsReporting=i.default,dashjs.MediaPlayerFactory=l,dashjs.Debug=u.Z,dashjs.supportsMediaSource=t.B;var c=dashjs}(),n.default}();export{Yo as H,Vo as d};
