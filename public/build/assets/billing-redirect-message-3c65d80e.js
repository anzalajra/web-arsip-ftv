import{j as e}from"./vendor-query-78cda8b8.js";import{c as t,A as n,m as r}from"./vendor-ui-7d465812.js";import{z as s,A as i,D as a,u as l,a as o,B as c,f as u,o as d,E as m,T as p}from"./main-07195345.js";import{r as f,L as v}from"./vendor-core-56622d1d.js";import{T as x}from"./TaskAlt-d1035321.js";var h,j="https://js.stripe.com/v3",b=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,y=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",n=document.createElement("script");n.src="".concat(j).concat(t);var r=document.head||document.body;if(!r)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return r.appendChild(n),n},w=null,g=null,S=null,N=function(e){return null!==w?w:(w=new Promise((function(t,n){if("undefined"!=typeof window&&"undefined"!=typeof document)if(window.Stripe,window.Stripe)t(window.Stripe);else try{var r=function(){for(var e=document.querySelectorAll('script[src^="'.concat(j,'"]')),t=0;t<e.length;t++){var n=e[t];if(b.test(n.src))return n}return null}();if(r&&e);else if(r){if(r&&null!==S&&null!==g){var s;r.removeEventListener("load",S),r.removeEventListener("error",g),null===(s=r.parentNode)||void 0===s||s.removeChild(r),r=y(e)}}else r=y(e);S=function(e,t){return function(){window.Stripe?e(window.Stripe):t(new Error("Stripe.js not available"))}}(t,n),g=function(e){return function(){e(new Error("Failed to load Stripe.js"))}}(n),r.addEventListener("load",S),r.addEventListener("error",g)}catch(i){return void n(i)}else t(null)}))).catch((function(e){return w=null,Promise.reject(e)}))},E=function(){return h||(h=N(null).catch((function(e){return h=null,Promise.reject(e)})))};Promise.resolve().then((function(){return E()})).catch((function(e){}));var I=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];!0;var r=Date.now();return E().then((function(e){return function(e,t,n){if(null===e)return null;var r=e.apply(void 0,t);return function(e,t){e&&e._registerWrapper&&e._registerWrapper({name:"stripe-js",version:"2.4.0",startTime:t})}(r,n),r}(e,t,r)}))};function _(e,t){return o.post("billing/stripe/create-partial-subscription",{product_id:e,price_id:t}).then((e=>e.data))}function L({productId:n,priceId:r,type:u="subscription",submitLabel:d,returnUrl:m}){const{stripe:p,elements:v,paymentElementRef:x,stripeIsEnabled:h}=function({type:e,productId:t,priceId:n}){const{user:r}=s(),c=i(),u=f.useRef(!1),d=f.useRef(null),{localeCode:m}=a(),[p,v]=f.useState(null),[x,h]=f.useState(null),{branding:{site_name:j},billing:{stripe_public_key:b,stripe:{enable:y}}}=l();return f.useEffect((()=>{y&&b&&!u.current&&(Promise.all([I(b,{apiVersion:"2022-08-01",locale:m}),"setupIntent"===e?o.post("billing/stripe/create-setup-intent").then((e=>e.data)):_(t,n)]).then((([e,{clientSecret:t}])=>{if(e&&d.current){const n=e.elements({clientSecret:t,appearance:{theme:c?"night":"stripe"}});n.create("payment",{business:{name:j},terms:{card:"never"},fields:{billingDetails:{address:"auto"}},defaultValues:{billingDetails:{email:null==r?void 0:r.email}}}).mount(d.current),v(e),h(n)}})),u.current=!0)}),[t,b,y,c,m,j,e,null==r?void 0:r.email]),{stripe:p,elements:x,paymentElementRef:d,stripeIsEnabled:null!=b&&y}}({type:u,productId:n,priceId:r}),[j,b]=f.useState(null),[y,w]=f.useState(!1),g=!h||null!=v&&null!=p;return e.jsxs("form",{onSubmit:async e=>{var t,n;if(e.preventDefault(),p&&v){w(!0);try{const e="subscription"===u?"confirmPayment":"confirmSetup",r=await p[e]({elements:v,confirmParams:{return_url:m}});"validation_error"!==(null==(t=r.error)?void 0:t.type)&&(null==(n=r.error)?void 0:n.message)&&b(r.error.message)}catch{}w(!1)}},children:[e.jsx("div",{ref:x,className:t("min-h-[303px]",!h&&"hidden"),children:h&&e.jsx(P,{})}),j&&!y&&e.jsx("div",{className:"mt-20 text-danger",children:j}),e.jsx(c,{variant:"flat",color:"primary",size:"md",className:"mt-40 w-full",type:"submit",disabled:y||!g,children:d})]})}function P(){return e.jsxs(f.Fragment,{children:[e.jsx(u,{className:"mb-20 h-30"}),e.jsx(u,{className:"mb-20 h-30"}),e.jsx(u,{className:"mb-20 h-30"}),e.jsx(u,{className:"h-30"})]})}function k({config:t}){return e.jsx(n,{initial:!1,mode:"wait",children:e.jsx("div",{className:"mt-80",children:t?e.jsxs(r.div,{className:"text-center",...d,children:["success"===t.status?e.jsx(x,{className:"text-6xl text-positive"}):e.jsx(m,{className:"text-6xl text-danger"}),e.jsx("div",{className:"mt-30 text-2xl font-semibold",children:e.jsx(p,{...t.message})}),e.jsx(c,{variant:"flat",color:"primary",className:"mt-30 w-full",size:"md",elementType:v,to:t.link,children:e.jsx(p,{...t.buttonLabel})})]},"payment-status"):e.jsx(z,{},"loading-skeleton")})})}function z(){return e.jsxs(r.div,{className:"max-w-280 text-center",...d,children:[e.jsx(u,{size:"w-50 h-50",variant:"rect"}),e.jsx(u,{className:"mt-30 text-2xl"}),e.jsx(u,{size:"h-42",className:"mt-30"})]},"loading-skeleton")}export{k as B,L as S,I as l};
