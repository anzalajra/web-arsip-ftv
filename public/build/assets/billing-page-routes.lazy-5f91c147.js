import{j as e,u as s,a as n}from"./vendor-query-78cda8b8.js";import{j as a,q as i,S as t,T as l,N as r,k as c,F as d,l as o,n as m,b as x,B as u,p,a as j,u as h,o as g,e as b,f as v,i as f,m as y,g as N,s as w,t as _,v as C,w as k,x as z,y as P}from"./main-a00ca822.js";import{r as S,O as I,L,o as F,n as B,m as T}from"./vendor-core-56622d1d.js";import{C as $}from"./CalendarToday-6bd95645.js";import{S as q,u as R,a as Y}from"./use-resume-subscription-3a3ff196.js";import{E,O as G,B as A,a as U}from"./breadcrumb-50a88f63.js";import{A as K,m as O}from"./vendor-ui-7d465812.js";import{S as W,l as Q,B as D}from"./billing-redirect-message-86584d05.js";import"./vendor-form-c566d70e.js";import"./TaskAlt-f55d509f.js";function H(){var e,s,n;const i=a("me",{with:["subscriptions.product","subscriptions.price"]});return{subscription:null==(s=null==(e=i.data)?void 0:e.user.subscriptions)?void 0:s[0],isLoading:i.isLoading,user:null==(n=i.data)?void 0:n.user}}function J(){i.invalidateQueries({queryKey:["users"]})}function M(){const s=H();return e.jsxs(S.Fragment,{children:[e.jsx(t,{children:e.jsx(l,{message:"Billing"})}),e.jsx(r,{menuPosition:"billing-page"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"container mx-auto my-24 flex-auto px-24",children:s.isLoading?e.jsx(c,{className:"my-80","aria-label":"Loading user..",isIndeterminate:!0}):e.jsx(I,{})}),e.jsx(d,{className:"container mx-auto px-24"})]})]})}function V({title:s,children:n}){return e.jsxs("div",{className:"mb-64",children:[e.jsx("div",{className:"text-sm font-medium uppercase pb-16 mb-16 border-b",children:s}),n]})}function X(){const{subscription:s}=H();if(!(null==s?void 0:s.price)||!(null==s?void 0:s.product))return null;const n=e.jsx("span",{className:"whitespace-nowrap",children:e.jsx(o,{preset:"long",date:s.ends_at})});return e.jsx(V,{title:e.jsx(l,{message:"Current plan"}),children:e.jsxs("div",{className:"mt-24 flex flex-col justify-between gap-20",children:[e.jsxs("div",{children:[e.jsx(m,{className:"mb-10 w-min",size:"xs",radius:"rounded",color:"danger",children:e.jsx(l,{message:"Canceled"})}),e.jsx("div",{className:"mb-2 text-xl font-bold",children:s.product.name}),e.jsx(x,{className:"mb-8 text-xl",price:s.price}),e.jsxs("div",{className:"flex items-center gap-8 text-base",children:[e.jsx($,{size:"sm",className:"text-muted"}),e.jsx("div",{className:"flex-auto",children:e.jsx(l,{message:"Your plan will be canceled on :date",values:{date:n}})})]})]}),e.jsx("div",{className:"w-[233px]",children:e.jsx(u,{variant:"flat",color:"primary",size:"md",className:"mb-12 w-full",elementType:L,to:"/billing/renew",children:e.jsx(l,{message:"Renew plan"})})})]})})}function Z(){const{subscription:s}=H();if(!(null==s?void 0:s.price)||!(null==s?void 0:s.product))return null;const n=e.jsx(o,{preset:"long",date:s.renews_at});return e.jsxs(S.Fragment,{children:[s.past_due?e.jsx(ee,{}):null,e.jsx(V,{title:e.jsx(l,{message:"Current plan"}),children:e.jsxs("div",{className:"mt-24 flex justify-between gap-20",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 text-xl font-bold",children:s.product.name}),e.jsx(x,{className:"mb-2 text-xl",price:s.price}),e.jsx("div",{className:"text-base",children:e.jsx(l,{message:"Your plan renews on :date",values:{date:n}})})]}),e.jsxs("div",{className:"w-[233px]",children:[e.jsx(u,{variant:"flat",color:"primary",size:"md",className:"mb-12 w-full",elementType:L,to:"/billing/change-plan",disabled:"none"===s.gateway_name,children:e.jsx(l,{message:"Change plan"})}),e.jsx(u,{variant:"outline",color:"danger",size:"md",className:"w-full",elementType:L,to:"/billing/cancel",children:e.jsx(l,{message:"Cancel plan"})})]})]})})]})}function ee(){return e.jsx(q,{className:"mb-24",color:"danger",title:"Payment is past due",description:"Your recent recurring payment has failed with the payment method we have on file. Please update your payment method to avoid any service interruptions."})}const se=""+new URL("paypal-c2a77c63.svg",import.meta.url).href;function ne(){const{user:s,subscription:n}=H();if(!s||!n)return null;const a="paypal"===n.gateway_name?ie:ae;return e.jsx(V,{title:e.jsx(l,{message:"Payment method"}),children:e.jsx(a,{methodClassName:"whitespace-nowrap text-base max-w-[464px] flex items-center gap-10",linkClassName:"flex items-center gap-4 text-muted mt-18 block hover:underline"})})}function ae({methodClassName:s,linkClassName:n}){const{user:a}=H();return a?e.jsxs(S.Fragment,{children:[e.jsxs("div",{className:s,children:[e.jsx("span",{className:"capitalize",children:a.card_brand})," ••••",a.card_last_four,a.card_expires&&e.jsx("div",{className:"ml-auto",children:e.jsx(l,{message:"Expires :date",values:{date:a.card_expires}})})]}),e.jsxs(L,{className:n,to:"/billing/change-payment-method",children:[e.jsx(E,{size:"sm"}),e.jsx(l,{message:"Change payment method"})]})]}):null}function ie({methodClassName:s,linkClassName:n}){const{subscription:a}=H();return e.jsxs(S.Fragment,{children:[e.jsx("div",{className:s,children:e.jsx(p,{src:se})}),e.jsxs("a",{className:n,href:`https://www.sandbox.paypal.com/myaccount/autopay/connect/${null==a?void 0:a.gateway_id}/funding`,target:"_blank",rel:"noreferrer",children:[e.jsx(E,{size:"sm"}),e.jsx(l,{message:"Change payment method"})]})]})}const te="billing/invoices";function le(e){return s({queryKey:[te],queryFn:()=>function(e){return j.get(te,{params:{userId:e}}).then((e=>e.data))}(e)})}function re(){var s;const{user:n}=H(),a=le(null==n?void 0:n.id);if(!n)return null;const i=null==(s=a.data)?void 0:s.invoices;return e.jsx(V,{title:e.jsx(l,{message:"Payment history"}),children:e.jsx("div",{className:"max-w-[464px]",children:e.jsx(K,{initial:!1,mode:"wait",children:a.isLoading?e.jsx(de,{},"loading-skeleton"):e.jsx(ce,{invoices:i},"invoices")})})})}function ce({invoices:s}){const{base_url:n}=h();return e.jsxs(O.div,{...g,children:[(null==s?void 0:s.length)?void 0:e.jsx("div",{className:"italic text-muted",children:e.jsx(l,{message:"No invoices yet"})}),null==s?void 0:s.map((s=>{var a;return e.jsxs("div",{className:"mb-14 flex items-center justify-between gap-10 whitespace-nowrap text-base",children:[e.jsxs("a",{href:`${n}/billing/invoices/${s.uuid}`,target:"_blank",className:"flex items-center gap-8 hover:underline",rel:"noreferrer",children:[e.jsx(o,{date:s.created_at}),e.jsx(G,{size:"xs"})]}),s.subscription.price&&e.jsx("div",{children:e.jsx(b,{value:s.subscription.price.amount,currency:s.subscription.price.currency})}),e.jsx(m,{size:"xs",color:s.paid?"positive":"danger",radius:"rounded",children:s.paid?e.jsx(l,{message:"Paid"}):e.jsx(l,{message:"Unpaid"})}),e.jsx("div",{children:null==(a=s.subscription.product)?void 0:a.name})]},s.id)}))]})}function de(){return e.jsxs(O.div,{...g,children:[e.jsx(v,{className:"mb-14"}),e.jsx(v,{className:"mb-14"}),e.jsx(v,{className:"mb-14"}),e.jsx(v,{className:"mb-14"}),e.jsx(v,{})]})}function oe(){const{subscription:s}=H();if(!(null==s?void 0:s.price)||!(null==s?void 0:s.product))return null;const n=s.ends_at?e.jsx(X,{}):e.jsx(Z,{});return e.jsxs("div",{children:[n,e.jsx(ne,{}),e.jsx(re,{})]})}function me(){const s=f();return e.jsxs(S.Fragment,{children:[e.jsxs(A,{children:[e.jsx(U,{isLink:!0,onSelected:()=>s("/billing"),children:e.jsx(l,{message:"Billing"})}),e.jsx(U,{children:e.jsx(l,{message:"Payment method"})})]}),e.jsx("h1",{className:"my-32 text-3xl font-bold md:my-64",children:e.jsx(l,{message:"Change payment method"})}),e.jsx(I,{})]})}function xe(){const{base_url:s}=h();return e.jsxs("div",{className:"max-w-[464px]",children:[e.jsx(W,{type:"setupIntent",submitLabel:e.jsx(l,{message:"Change"}),returnUrl:`${s}/billing/change-payment-method/done`}),e.jsx(u,{variant:"outline",className:"mt-16 w-full",size:"md",to:"/billing",elementType:L,type:"button",children:e.jsx(l,{message:"Go back"})})]})}const ue="/billing";function pe(){const{billing:{stripe_public_key:s}}=h(),n=f(),[a]=F(),i=a.get("setup_intent_client_secret"),[t,l]=S.useState(),r=S.useRef();return S.useEffect((()=>{!r.current&&i&&(Q(s).then((e=>{e?e.retrieveSetupIntent(i).then((({setupIntent:e})=>{var s;"succeeded"===(null==e?void 0:e.status)&&(s=e.payment_method,j.post("billing/stripe/change-default-payment-method",{payment_method_id:s})).then((()=>{J()})),l(je(null==e?void 0:e.status))})):l(je())})),r.current=!0)}),[s,i]),i?e.jsx(D,{config:t}):(n(ue),null)}function je(e){switch(e){case"succeeded":return{...he,message:y("Payment method changed successfully!"),status:"success"};case"processing":return{...he,message:y("Your request is processing. We'll update you when your payment method is confirmed."),status:"success"};case"requires_payment_method":return{...he,message:y("Payment method confirmation failed. Please try another payment method."),status:"error"};default:return{...he,message:y("Something went wrong"),status:"error"}}}const he={link:ue,buttonLabel:y("Go back")};function ge(){const s=f();return e.jsxs(S.Fragment,{children:[e.jsxs(A,{children:[e.jsx(U,{isLink:!0,onSelected:()=>s("/billing"),children:e.jsx(l,{message:"Billing"})}),e.jsx(U,{children:e.jsx(l,{message:"Plans"})})]}),e.jsx("h1",{className:"my-32 text-3xl font-bold md:my-64",children:e.jsx(l,{message:"Change your plan"})}),e.jsx(V,{title:e.jsx(l,{message:"Available plans"}),children:e.jsx(K,{initial:!1,mode:"wait",children:e.jsx(be,{})})})]})}function be(){var s,n;const a=N(),[i,t]=S.useState("monthly");return a.isLoading?e.jsx(ye,{},"plan-skeleton"):e.jsxs(S.Fragment,{children:[e.jsx(w,{products:null==(s=a.data)?void 0:s.products,selectedCycle:i,onChange:t,className:"mb-20",size:"md"}),null==(n=a.data)?void 0:n.products.map((s=>{const n=_(i,s.prices);return!n||s.hidden?null:S.createElement(O.div,{...g,key:s.id,className:"justify-between gap-40 border-b py-32 md:flex"},e.jsxs("div",{className:"mb-40 md:mb-0",children:[e.jsx("div",{className:"text-xl font-bold",children:s.name}),e.jsx(x,{price:n,className:"text-lg"}),e.jsx("div",{className:"mt-12 text-base",children:s.description}),e.jsx(ve,{plan:s})]}),e.jsx(fe,{product:s,price:n}))}))]},"plan-list")}function ve({plan:s}){return s.feature_list.length?e.jsxs("div",{className:"mt-32",children:[e.jsx("div",{className:"mb-10 text-sm font-semibold",children:e.jsx(l,{message:"What's included"})}),s.feature_list.map((s=>e.jsxs("div",{className:"flex items-center gap-10 text-sm",children:[e.jsx(C,{className:"text-positive",size:"sm"}),e.jsx(l,{message:s})]},s)))]}):null}function fe({product:s,price:n}){const{subscription:a}=H();return(null==a?void 0:a.price)&&(null==a?void 0:a.product)?a.product_id===s.id&&a.price_id===n.id?e.jsxs("div",{className:"flex w-[168px] items-center justify-center gap-10 text-muted",children:[e.jsx(C,{size:"md"}),e.jsx(l,{message:"Current plan"})]}):e.jsx(u,{variant:"flat",color:"primary",className:"w-[168px]",size:"md",elementType:L,to:`/billing/change-plan/${s.id}/${n.id}/confirm`,children:e.jsx(l,{message:"Continue"})}):null}function ye(){return e.jsxs(O.div,{...g,className:"border-b py-32 text-2xl",children:[e.jsx(v,{className:"mb-8"}),e.jsx(v,{className:"mb-14"}),e.jsx(v,{className:"mb-24"}),e.jsx(v,{className:"mb-12"})]},"plan-skeleton")}function Ne(){const{trans:e}=k(),s=f();return n({mutationFn:e=>function({subscriptionId:e,...s}){return j.post(`billing/subscriptions/${e}/change-plan`,s).then((e=>e.data))}(e),onSuccess:()=>{z(e(y("Plan changed."))),J(),s("/billing")},onError:e=>P(e)})}const we="/billing/change-plan";function _e(){const{productId:s,priceId:n}=B(),a=f(),i=N(),{subscription:t}=H(),r=Ne();if(!i.data||(null==t?void 0:t.price_id)==n)return e.jsx(T,{to:"/billing/change-plan",replace:!0});const c=i.data.products.find((e=>`${e.id}`===s)),d=null==c?void 0:c.prices.find((e=>`${e.id}`===n));if(!c||!d||!t)return a(we),null;const m=e.jsxs("span",{className:"whitespace-nowrap",children:[e.jsx(o,{date:t.renews_at,preset:"long"}),";"]});return e.jsxs(S.Fragment,{children:[e.jsxs(A,{children:[e.jsx(U,{isLink:!0,onSelected:()=>a("/billing"),children:e.jsx(l,{message:"Billing"})}),e.jsx(U,{onSelected:()=>a(we),children:e.jsx(l,{message:"Plans"})}),e.jsx(U,{children:e.jsx(l,{message:"Confirm"})})]}),e.jsx("h1",{className:"my-32 text-3xl font-bold md:my-64",children:e.jsx(l,{message:"Confirm your new plan"})}),e.jsx(V,{title:e.jsx(l,{message:"Changing to"}),children:e.jsxs("div",{className:"max-w-[464px]",children:[e.jsx("div",{className:"text-xl font-bold",children:c.name}),e.jsx(x,{price:d,className:"text-lg"}),e.jsx("div",{className:"mb-48 mt-12 border-b pb-24 text-base",children:e.jsx(l,{message:"You will be charged the new price starting :date",values:{date:m}})}),e.jsxs("div",{children:[e.jsx("div",{children:e.jsx(u,{variant:"flat",color:"primary",size:"md",className:"mb-16 w-full",onClick:()=>{r.mutate({subscriptionId:t.id,newProductId:c.id,newPriceId:d.id})},disabled:r.isPending,children:e.jsx(l,{message:"Confirm"})})}),e.jsx("div",{children:e.jsx(u,{variant:"outline",className:"w-full",to:we,elementType:L,children:e.jsx(l,{message:"Go back"})})}),e.jsx("div",{className:"mt-12 text-xs text-muted",children:e.jsx(l,{message:"By confirming your new plan, you agree to our terms of Service and privacy policy."})})]})]})})]})}const Ce="/billing";function ke(){const s=f(),n=N(),{subscription:a}=H(),i=R(),t=null==a?void 0:a.product,r=null==a?void 0:a.price;if(!n.data)return null;if(!a||!t||!r)return s(Ce),null;const c=e.jsx("span",{className:"whitespace-nowrap",children:e.jsx(o,{date:a.renews_at,preset:"long"})});return e.jsxs(S.Fragment,{children:[e.jsxs(A,{children:[e.jsx(U,{isLink:!0,onSelected:()=>s(Ce),children:e.jsx(l,{message:"Billing"})}),e.jsx(U,{children:e.jsx(l,{message:"Cancel"})})]}),e.jsx("h1",{className:"my-32 text-3xl font-bold md:my-64",children:e.jsx(l,{message:"Cancel your plan"})}),e.jsx(V,{title:e.jsx(l,{message:"Current plan"}),children:e.jsxs("div",{className:"max-w-[464px]",children:[e.jsx("div",{className:"text-xl font-bold",children:t.name}),e.jsx(x,{price:r,className:"text-lg"}),e.jsxs("div",{className:"mb-48 mt-12 border-b pb-24 text-base",children:[e.jsx(l,{message:"Your plan will be canceled, but is still available until the end of your billing period on :date",values:{date:c}}),e.jsx("div",{className:"mt-20",children:e.jsx(l,{message:"If you change your mind, you can renew your subscription."})})]}),e.jsxs("div",{children:[e.jsx("div",{children:e.jsx(u,{variant:"flat",color:"primary",size:"md",className:"mb-16 w-full",onClick:()=>{i.mutate({subscriptionId:a.id},{onSuccess:()=>{J(),s("/billing")}})},disabled:i.isPending,children:e.jsx(l,{message:"Cancel plan"})})}),e.jsx("div",{children:e.jsx(u,{variant:"outline",className:"w-full",to:Ce,elementType:L,children:e.jsx(l,{message:"Go back"})})}),e.jsx("div",{className:"mt-12 text-xs text-muted",children:e.jsx(l,{message:"By cancelling your plan, you agree to our terms of service and privacy policy."})})]})]})})]})}const ze="/billing";function Pe(){const s=f(),n=N(),{subscription:a}=H(),i=Y(),t=null==a?void 0:a.product,r=null==a?void 0:a.price;if(!n.data)return null;if(!a||!t||!r)return s(ze),null;const c=e.jsxs("span",{className:"whitespace-nowrap",children:[e.jsx(o,{date:a.ends_at,preset:"long"}),";"]});return e.jsxs(S.Fragment,{children:[e.jsxs(A,{children:[e.jsx(U,{isLink:!0,onSelected:()=>s(ze),children:e.jsx(l,{message:"Billing"})}),e.jsx(U,{children:e.jsx(l,{message:"Renew"})})]}),e.jsx("h1",{className:"my-32 text-3xl font-bold md:my-64",children:e.jsx(l,{message:"Renew your plan"})}),e.jsx(V,{title:e.jsx(l,{message:"Current plan"}),children:e.jsxs("div",{className:"max-w-[464px]",children:[e.jsx("div",{className:"text-xl font-bold",children:t.name}),e.jsx(x,{price:r,className:"text-lg"}),e.jsx("div",{className:"mb-48 mt-12 border-b pb-24 text-base",children:e.jsx(l,{message:"This plan will no longer be canceled. It will renew on :date",values:{date:c}})}),e.jsx(u,{variant:"flat",color:"primary",size:"md",className:"mb-16 w-full",onClick:()=>{i.mutate({subscriptionId:a.id},{onSuccess:()=>{J(),s("/billing")}})},disabled:i.isPending,children:e.jsx(l,{message:"Renew plan"})}),e.jsx(u,{variant:"outline",className:"w-full",to:ze,elementType:L,children:e.jsx(l,{message:"Go back"})}),e.jsx("div",{className:"mt-12 text-xs text-muted",children:e.jsx(l,{message:"By renewing your plan, you agree to our terms of service and privacy policy."})})]})})]})}export{oe as BillingPage,M as BillingPageLayout,pe as ChangePaymentMethodDone,me as ChangePaymentMethodLayout,xe as ChangePaymentMethodPage,ge as ChangePlanPage,ke as ConfirmPlanCancellationPage,_e as ConfirmPlanChangePage,Pe as ConfirmPlanRenewalPage};
